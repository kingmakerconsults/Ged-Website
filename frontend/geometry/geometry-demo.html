<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Geometry Playground Demo</title>
    <style>
      :root {
        color-scheme: light dark;
        font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f1f5f9;
        color: #0f172a;
      }
      body {
        margin: 0;
        padding: 24px;
        background: linear-gradient(145deg, #0ea5e9 0%, #1e3a8a 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        box-sizing: border-box;
      }
      h1 {
        color: #f8fafc;
        text-shadow: 0 12px 24px rgba(15, 23, 42, 0.45);
        margin-bottom: 16px;
      }
      .demo-shell {
        background: rgba(248, 250, 252, 0.92);
        backdrop-filter: blur(14px);
        border-radius: 24px;
        padding: 20px;
        display: grid;
        gap: 20px;
        grid-template-columns: 1fr;
        box-shadow: 0 32px 60px rgba(15, 23, 42, 0.2);
      }
      .demo-main {
        display: grid;
        gap: 20px;
        grid-template-columns: minmax(0, 2fr) minmax(260px, 0.8fr);
      }
      .canvas-wrapper {
        position: relative;
        min-height: 520px;
        border-radius: 16px;
        overflow: hidden;
      }
      .hint-wrapper {
        margin-top: -8px;
      }
      @media (max-width: 1024px) {
        .demo-main {
          grid-template-columns: 1fr;
        }
        .canvas-wrapper {
          min-height: 400px;
        }
      }
    </style>
  </head>
  <body>
    <h1>Geometry Playground</h1>
    <div class="demo-shell">
      <div id="toolbar"></div>
      <div class="demo-main">
        <div>
          <div class="canvas-wrapper" id="canvas"></div>
          <div class="hint-wrapper" id="hints"></div>
        </div>
        <div id="inspector"></div>
      </div>
    </div>
    <script type="module">
      import GeometryCanvas from './GeometryCanvas.js';
      import ShapeLibrary from './ShapeLibrary.js';
      import InspectorPanel from './InspectorPanel.js';
      import HintPanel from './HintPanel.js';
      import { getState, subscribe } from './geometryStore.js';

      const toolbarMount = document.getElementById('toolbar');
      const canvasMount = document.getElementById('canvas');
      const inspectorMount = document.getElementById('inspector');
      const hintMount = document.getElementById('hints');

      const toolbar = new ShapeLibrary(toolbarMount);
      const canvas = new GeometryCanvas(canvasMount);
      const inspector = new InspectorPanel(inspectorMount);
      const hintPanel = new HintPanel(hintMount);

      const syncTheme = state => {
        hintPanel.setProps({ theme: state.theme });
      };

      const syncHints = state => {
        const selected = state.shapes.find(shape => shape.id === state.selectedId);
        hintPanel.setProps({
          targetGoal: selected ? `Explore ${selected.label}` : 'Explore the figure',
          shapeData: selected || null,
        });
      };

      syncTheme(getState());
      syncHints(getState());

      subscribe(state => {
        syncTheme(state);
        syncHints(state);
      });

      window.geometryDemo = {
        toolbar,
        canvas,
        inspector,
        hintPanel,
      };
    </script>
  </body>
</html>
