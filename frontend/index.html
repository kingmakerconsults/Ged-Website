        onboardingDeferred: false,
    const [onboardingDeferred, setOnboardingDeferred] = useState(() => !!DEFAULT_LOCAL_PROFILE.profile.onboardingDeferred);
        const completeFlag = !!localProfile?.profile?.onboardingComplete;
        const deferredFlag = !!localProfile?.profile?.onboardingDeferred;
        setOnboardingComplete(completeFlag);
        setOnboardingDeferred(deferredFlag);
            window._onboardingComplete = completeFlag;
            window._onboardingDeferred = deferredFlag;
    }, [localProfile?.profile?.onboardingComplete, localProfile?.profile?.onboardingDeferred]);
        if (!onboardingComplete && !onboardingDeferred) {
    }, [currentUser, onboardingComplete, onboardingDeferred]);
                    onboardingDeferred: false,
    const handleSkipOnboarding = useCallback(() => {
        setLocalProfile((prev) => ({
            ...prev,
            profile: {
                ...prev.profile,
                onboardingDeferred: true,
            },
        }));
        window.alert('You can finish onboarding anytime from your profile.');
        setView('start');
    }, [setView]);

        if (!onboardingComplete && !onboardingDeferred) {
    }, [onboardingComplete, onboardingDeferred]);
        if (!onboardingComplete && !onboardingDeferred) {
    }, [loadProfileOnce, onboardingComplete, onboardingDeferred, profileData]);
                        onSkipOnboarding={handleSkipOnboarding}
                        onboardingDeferred={onboardingDeferred}
                        onboardingDeferred={onboardingDeferred}
    onSkipOnboarding,
    onboardingDeferred,
    const requiresOnboarding = !onboardingComplete && !onboardingDeferred;
    const highlightName = requiresOnboarding && !profile.name;
    const highlightTest = requiresOnboarding && !hasAnyTestProgress;
    const highlightChallenges = requiresOnboarding && selectedCount === 0;
        if (requiresOnboarding) {
                        <strong>
                            {onboardingDeferred
                                ? 'Ready to finish onboarding? Complete the checklist below when you have time.'
                                : 'Welcome! Before we start, fill this out so we can build you a plan:'}
                        </strong>
                        <div className="mt-3 flex flex-col gap-2 sm:flex-row sm:items-center">
                            <button
                                id="finishOnboardingBtn"
                                type="button"
                                onClick={onFinishOnboarding}
                                className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                                disabled={finishingOnboarding}
                            >
                                {finishingOnboarding ? 'Checkingâ€¦' : "I'm Done"}
                            </button>
                            <button
                                type="button"
                                onClick={onSkipOnboarding}
                                className="inline-flex items-center justify-center rounded-lg border border-slate-300 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-slate-400 focus-visible:ring-offset-2 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-800/70"
                            >
                                {onboardingDeferred ? 'Back to dashboard' : 'Skip for now'}
                            </button>
                        </div>
                        {onboardingDeferred && (
                            <p className="mt-2 text-xs text-slate-600">
                                You can come back any time to complete onboarding and unlock personalized reminders.
                            </p>
                        )}
                                                                data-selected={isChecked ? 'true' : 'false'}
                                                                className={`ml-8 mt-2 flex items-start gap-2 rounded-lg border px-3 py-2 text-sm transition focus-within:ring-2 focus-within:ring-sky-200 focus-within:ring-offset-0 dark:focus-within:ring-sky-500/40 ${
                                                                    isChecked
                                                                        ? 'border-sky-400 bg-sky-50 text-slate-700 shadow-sm dark:border-sky-500 dark:bg-sky-900/40 dark:text-slate-100'
                                                                        : 'border-transparent text-slate-600 hover:border-slate-200 dark:text-slate-300 dark:hover:border-slate-500'
                                                                }`}
                                                                <span className="flex-1">{opt.label || opt.subtopic || opt.subject}</span>
function StartScreen({ currentUser, onLogout, progress, profileBundle: profileData, onboardingComplete, onboardingDeferred, onShowProfile, onSelectQuiz, vocabulary, onSelectGenerator, onStartPopQuiz, onStartComprehensiveExam, setIsLoading, setLoadingMessage, setShowFormulaSheet, onOpenMathTools, theme = 'light' }) {
                            {!onboardingComplete && !onboardingDeferred && (
