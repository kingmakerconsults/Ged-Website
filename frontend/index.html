<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr. Smith's Learning Canvas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    /* Cross-browser baseline: match IE/Edge spacing */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    html {
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }

    body, h1, h2, h3, p, ul, ol {
      margin: 0;
      padding: 0;
    }

    ul, ol {
      list-style: none;
    }

    /* Force IE-style default border behavior */
    * {
      border-style: solid;
      border-width: 0;
    }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="lib/normalizeProse.js"></script>
    <script src="lib/mathSanitizer.js"></script>
    <script src="lib/sanitizeExamText.js"></script>
    <script>
      // Safe, cross-browser math fixer that ONLY edits text inside math delimiters.
      // Supports $...$, $$...$$, \(...\), \[...\]
      (function () {
        // Insert a "\" before common LaTeX macros when missing, but don't use look-behind
        const MACRO_FIX = /(^|[^\\])\b(frac|sqrt|times|div|cdot|le|ge|lt|gt|pi|sin|cos|tan|log|ln|pm|mp|neq|approx|theta|alpha|beta|gamma)\b(?=\s*[\[{(])/g;

        function addMissingBackslashesInSegment(seg) {
          return seg.replace(MACRO_FIX, (_m, p1, macro) => `${p1}\\${macro}`);
        }

        // Apply fix ONLY inside math segments
        function fixAllMathInText(input) {
          if (typeof input !== 'string' || input.length === 0) return input;

          // $...$ and $$...$$
          input = input.replace(/\$\$([\s\S]*?)\$\$|\$([\s\S]*?)\$/g, (m, m1, m2) => {
            const body = m1 ?? m2;
            const fixed = addMissingBackslashesInSegment(body);
            return m1 != null ? `$$${fixed}$$` : `$${fixed}$`;
          });

          // \(...\)
          input = input.replace(/\\\(([\s\S]*?)\\\)/g, (_m, body) => `\\(${addMissingBackslashesInSegment(body)}\\)`);

          // \[...\]
          input = input.replace(/\\\[([\s\S]*?)\\\]/g, (_m, body) => `\\[${addMissingBackslashesInSegment(body)}\\]`);

          return input;
        }

        // Expose/override
        window.TextSanitizer = window.TextSanitizer || {};
        window.TextSanitizer.fixAllMathInText = fixAllMathInText;
        window.TextSanitizer.addMissingBackslashesInMath = fixAllMathInText; // backward-compat with your current call site
      })();
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" type="text/css" href="https://jsxgraph.org/distrib/jsxgraph.css" />
    <script type="text/javascript" src="https://jsxgraph.org/distrib/jsxgraphcore.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" crossorigin="anonymous"></script>

    <script>
        window.addEventListener('error', (event) => {
            const detail = event.error || event.message;
            console.error('Global error:', detail);
        });
        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
        });
    </script>

    <script>
        window.__APP_CONFIG__ = window.__APP_CONFIG__ || {};
        if (typeof window.__APP_CONFIG__.geometryFiguresEnabled === 'undefined') {
            window.__APP_CONFIG__.geometryFiguresEnabled = false;
        }
    </script>
    <script>
      window.__APP_CONFIG__ = window.__APP_CONFIG__ || {};
      if (typeof window.__APP_CONFIG__.mathRenderMode === 'undefined') {
        window.__APP_CONFIG__.mathRenderMode = 'plain'; // 'plain' now, 'math-lite' later
      }
            if (typeof window.__APP_CONFIG__.premadeUsesKatex === 'undefined') {
                window.__APP_CONFIG__.premadeUsesKatex = true;
            }
    </script>
    <script src="https://ged-website.onrender.com/client-config.js"></script>

    <script>
        (function preloadPreferences() {
            if (typeof window === 'undefined' || typeof document === 'undefined') {
                return;
            }
            const root = document.documentElement;
            const sizeClasses = ['fs-sm', 'fs-md', 'fs-lg', 'fs-xl'];
            try {
                const stored = localStorage.getItem('prefs');
                if (!stored) {
                    return;
                }
                const parsed = JSON.parse(stored);
                if (parsed && typeof parsed === 'object') {
                    sizeClasses.forEach((cls) => root.classList.remove(cls));
                    const sizes = new Set(['sm', 'md', 'lg', 'xl']);
                    const fontSize = sizes.has(parsed.fontSize) ? parsed.fontSize : 'md';
                    root.classList.add(`fs-${fontSize}`);
                }
            } catch (error) {
                console.warn('Failed to preload saved preferences:', error);
            }
        })();
    </script>

    <script>
        (function preloadTheme() {
            if (typeof window === 'undefined' || typeof document === 'undefined') {
                return;
            }

            let theme = 'light';
            try {
                const saved = window.localStorage ? window.localStorage.getItem('appTheme') : null;
                const prefersDark = window.matchMedia
                    && typeof window.matchMedia === 'function'
                    && window.matchMedia('(prefers-color-scheme: dark)').matches;
                theme = (saved === 'light' || saved === 'dark') ? saved : (prefersDark ? 'dark' : 'light');
            } catch (error) {
                console.warn('theme preload failed', error);
            }

            const root = document.documentElement;
            root.setAttribute('data-theme', theme);
            root.classList.toggle('dark', theme === 'dark');

            const applyToBody = () => {
                const bodyEl = document.body || document.createElement('body');
                bodyEl.setAttribute('data-theme', theme);
                bodyEl.classList.toggle('dark', theme === 'dark');
            };

            applyToBody();
            if (!document.body) {
                document.addEventListener('DOMContentLoaded', applyToBody, { once: true });
            }

            try {
                Object.defineProperty(window, '__START_THEME__', {
                    value: theme,
                    writable: false,
                    configurable: false,
                });
            } catch (error) {
                window.__START_THEME__ = theme;
            }
        })();
    </script>

    <style>
        html {
            font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            text-rendering: optimizeLegibility;
        }

        body {
            font-family: inherit;
            font-size: 16px;
            line-height: 1.4;
        }

        :root.fs-sm { font-size: 14px; }
        :root.fs-md { font-size: 16px; }
        :root.fs-lg { font-size: 18px; }
        :root.fs-xl { font-size: 20px; }

        :root[data-theme="light"] {
            --bg-color: #ffffff;
            --panel-bg: #ffffff;
            --text-color: #222222;
            --subtext-color: #444444;
            --border-color: #cccccc;
            --button-bg: #f0f0f0;
            --button-hover-bg: #e5e5e5;
            --shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        :root:not([data-theme]) {
            --bg-color: #ffffff;
            --panel-bg: #ffffff;
            --text-color: #222222;
            --subtext-color: #444444;
            --border-color: #cccccc;
            --button-bg: #f0f0f0;
            --button-hover-bg: #e5e5e5;
            --shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        }

        :root {
            color-scheme: light;
            --bg-page: #ffffff;
            --bg-surface: #ffffff;
            --bg-overlay: rgba(255, 255, 255, 0.6);
            --bg-muted: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #1e293b;
            --text-tertiary: #334155;
            --option-text: #334155;
            --accent: #38bdf8;
            --accent-hover: #0ea5e9;
            --accent-border: #38bdf8;
            --accent-soft: #e0f2fe;
            --accent-ring: rgba(56,189,248,0.4);
            --accent-text: #0c4a6e;
            --border-strong: rgba(255,255,255,0.25);
            --border-subtle: rgba(0,0,0,0.03);
            --border-focus: #38bdf8;
            --shadow-strong: 0 18px 32px -24px rgba(15, 23, 42, 0.3);
            --shadow-hover: 0 12px 20px -6px rgba(0,0,0,0.1);
            --option-shadow: 0 4px 10px -2px rgba(0,0,0,0.08);
            --option-hover-shadow: 0 8px 16px -4px rgba(0,0,0,0.12);
            --success-bg: #dcfce7;
            --success-border: #22c55e;
            --success-text: #065f46;
            --danger-bg: #fee2e2;
            --danger-border: #ef4444;
            --danger-text: #7f1d1d;
            --option-hover-bg: #f8fafc;
            --explanation-bg: #f8fafc;
            --explanation-border: #38bdf8;
            --explanation-text: #1e293b;
            --explanation-shadow: 0 0 0 rgba(0,0,0,0);
            --selection-bg: #fef9c3;
            --vocabulary-bg: #ffffff;
            --quiz-scrollbar-track: #f1f1f1;
            --quiz-scrollbar-thumb: #888;
            --quiz-scrollbar-thumb-hover: #555;
            --nav-active-bg: #1e293b;
            --nav-active-text: #f8fafc;
            --nav-answered-bg: #10b981;
            --nav-answered-text: #ecfdf5;
            --nav-default-bg: #e2e8f0;
            --nav-default-text: #1e293b;
            --nav-marked-ring: rgba(250,204,21,0.75);
            --timer-low-bg: #fee2e2;
            --timer-low-text: #b91c1c;
            --timer-default-bg: #e2e8f0;
            --timer-default-text: #1e293b;
            --modal-overlay: rgba(15,23,42,0.55);
            --modal-surface: #ffffff;
            --modal-border: rgba(148,163,184,0.35);
            --modal-text: #0f172a;
            --button-secondary-bg: #ffffff;
            --button-secondary-border: rgba(148,163,184,0.45);
            --button-secondary-text: #1e293b;
            --subject-science-accent: #dc2626;
            --subject-science-text: #ffffff;
            --subject-science-surface-text: #7f1d1d;
            --subject-science-accent-text: #7f1d1d;
            --subject-science-border: rgba(248,113,113,0.8);
            --subject-science-gradient: linear-gradient(135deg, #f87171, #facc15);
            --subject-social-accent: #16a34a;
            --subject-social-text: #f0fdf4;
            --subject-social-surface-text: #14532d;
            --subject-social-accent-text: #14532d;
            --subject-social-border: rgba(74,222,128,0.7);
            --subject-social-gradient: linear-gradient(135deg, #16a34a, #a3e635);
            --subject-rla-accent: #7c3aed;
            --subject-rla-text: #f5f3ff;
            --subject-rla-surface-text: #4c1d95;
            --subject-rla-accent-text: #4c1d95;
            --subject-rla-border: rgba(167,139,250,0.7);
            --subject-rla-gradient: linear-gradient(135deg, #7c3aed, #ec4899);
            --subject-math-accent: #0284c7;
            --subject-math-text: #e0f2fe;
            --subject-math-surface-text: #0c4a6e;
            --subject-math-accent-text: #0c4a6e;
            --subject-math-border: rgba(56,189,248,0.7);
            --subject-math-gradient: linear-gradient(135deg, #0ea5e9, #22d3ee);
            --subject-simulations-accent: #f97316;
            --subject-simulations-text: #fff7ed;
            --subject-simulations-surface-text: #7c2d12;
            --subject-simulations-accent-text: #7c2d12;
            --subject-simulations-border: rgba(251,146,60,0.75);
            --subject-simulations-gradient: linear-gradient(135deg, #f97316, #facc15);
            --surface-mobile: #ffffff;
            --text-mobile: #1a1a1a;
            --math-surface: #ffffff;
            --math-surface-border: rgba(15,23,42,0.08);
            --math-divider: rgba(148,163,184,0.25);
            --math-text: #0f172a;
            --math-muted-text: #1e293b;
        }

        /* Badge strip (light defaults; neutral for dark as images are colored) */
        .badge-strip {
            display: flex;
            gap: 0.75rem;
            padding: 0.75rem 1rem 0.25rem;
            align-items: center;
        }
        .badge-icon {
            height: 42px;
            width: auto;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(15,23,42,0.12));
        }
        @media (max-width: 768px) {
            .badge-strip { overflow-x: auto; }
        }

        .frac {
            background: rgba(0,0,0,0.05);
            padding: 0.15em 0.4em;
            border-radius: 0.4em;

            /* Make it read clearly in a question stem */
            font-weight: 600;
            font-size: 0.95em;
            line-height: 1.1;
            letter-spacing: 0.02em;

            /* IMPORTANT: force normal digits, not tiny numerator/denominator */
            font-variant-numeric: normal;
            font-feature-settings: "frac" 0, "numr" 0, "dnom" 0;

            font-family: "Inter", "Roboto", "Segoe UI", "Cambria Math", "Noto Sans Math", system-ui, sans-serif;

            display: inline-flex;
            align-items: center;
            vertical-align: baseline;
        }

        .math-inline {
            font-family: "Inter", "Segoe UI", system-ui, sans-serif;
            font-weight: 500;
            color: var(--text-primary);
        }

        .math-inline sup {
            font-size: 0.75em;
            vertical-align: super;
            line-height: 0;
            font-weight: 500;
        }

        /* Ensure KaTeX inherits context colors */
        .question-stem .katex,
        .option .katex {
            color: inherit;
        }
        .dark .katex { color: var(--text-primary); }

        [data-theme="dark"] .frac {
            background: rgba(255,255,255,0.07);
        }

        .dark {
            color-scheme: dark;
            --bg-page: #020617;
            --bg-surface: rgba(15, 23, 42, 0.9);
            --bg-overlay: rgba(30, 41, 59, 0.72);
            --bg-muted: rgba(51,65,85,0.6);
            --surface-mobile: rgba(15, 23, 42, 0.95);
            --text-mobile: #f8fafc;
            --text-primary: #e2e8f0;
            --text-secondary: #f8fafc;
            --text-tertiary: #cbd5f5;
            --option-text: #f8fafc;
            --accent: #38bdf8;
            --accent-hover: #0ea5e9;
            --accent-border: rgba(56,189,248,0.8);
            --accent-soft: rgba(56,189,248,0.22);
            --accent-ring: rgba(56,189,248,0.5);
            --accent-text: #eafeff;
            --border-strong: rgba(255,255,255,0.14);
            --border-subtle: rgba(226,232,240,0.08);
            --border-focus: rgba(56,189,248,0.8);
            --shadow-strong: 0 30px 60px -15px rgba(0,0,0,0.9);
            --shadow-hover: 0 20px 32px -8px rgba(0,0,0,0.8);
            --option-shadow: 0 8px 20px -4px rgba(0,0,0,0.9);
            --option-hover-shadow: 0 12px 22px -6px rgba(0,0,0,0.6);
            --success-bg: rgba(34,197,94,0.28);
            --success-border: rgba(34,197,94,0.9);
            --success-text: #ecfdf5;
            --danger-bg: rgba(239,68,68,0.28);
            --danger-border: rgba(239,68,68,0.85);
            --danger-text: #fff1f2;
            --option-hover-bg: rgba(51,65,85,0.6);
            --explanation-bg: rgba(2,6,23,0.9);
            --explanation-border: rgba(56,189,248,0.9);
            --explanation-text: #f8fafc;
            --explanation-shadow: 0 16px 32px -8px rgba(0,0,0,0.9);
            --selection-bg: rgba(250,204,21,0.18);
            --vocabulary-bg: rgba(15,23,42,0.9);
            --quiz-scrollbar-track: rgba(15,23,42,0.4);
            --quiz-scrollbar-thumb: rgba(148,163,184,0.5);
            --quiz-scrollbar-thumb-hover: rgba(226,232,240,0.65);
            --nav-active-bg: rgba(51,65,85,0.85);
            --nav-active-text: #f8fafc;
            --nav-answered-bg: rgba(34,197,94,0.65);
            --nav-answered-text: #ecfdf5;
            --nav-default-bg: rgba(15,23,42,0.8);
            --nav-default-text: #e2e8f0;
            --nav-marked-ring: rgba(253,224,71,0.65);
            --timer-low-bg: rgba(239,68,68,0.25);
            --timer-low-text: #fecdd3;
            --timer-default-bg: rgba(30,41,59,0.65);
            --timer-default-text: #e2e8f0;
            --modal-overlay: rgba(2,6,23,0.82);
            --modal-surface: rgba(15,23,42,0.96);
            --modal-border: rgba(148,163,184,0.35);
            --modal-text: #e2e8f0;
            --button-secondary-bg: rgba(15,23,42,0.85);
            --button-secondary-border: rgba(148,163,184,0.35);
            --button-secondary-text: #e2e8f0;
            --subject-science-accent: #f87171;
            --subject-science-text: #fff5f5;
            --subject-science-surface-text: #fff5f5;
            --subject-science-accent-text: #fff5f5;
            --subject-science-border: rgba(252,165,165,0.8);
            --subject-science-gradient: linear-gradient(135deg, rgba(248,113,113,0.85), rgba(250,204,21,0.7));
            --subject-social-accent: #22c55e;
            --subject-social-text: #ecfdf5;
            --subject-social-surface-text: #ecfdf5;
            --subject-social-accent-text: #ecfdf5;
            --subject-social-border: rgba(74,222,128,0.75);
            --subject-social-gradient: linear-gradient(135deg, rgba(16,185,129,0.9), rgba(163,230,53,0.7));
            --subject-rla-accent: #8b5cf6;
            --subject-rla-text: #ede9fe;
            --subject-rla-surface-text: #ede9fe;
            --subject-rla-accent-text: #ede9fe;
            --subject-rla-border: rgba(167,139,250,0.7);
            --subject-rla-gradient: linear-gradient(135deg, rgba(139,92,246,0.9), rgba(236,72,153,0.65));
            --subject-math-accent: #0ea5e9;
            --subject-math-text: #ffffff;
            --subject-math-surface-text: #ffffff;
            --subject-math-accent-text: #ffffff;
            --subject-math-border: rgba(56,189,248,0.7);
            --subject-math-gradient: linear-gradient(135deg, rgba(14,165,233,0.9), rgba(34,211,238,0.7));
            --subject-simulations-accent: #fb923c;
            --subject-simulations-text: #fff7ed;
            --subject-simulations-surface-text: #fff7ed;
            --subject-simulations-accent-text: #fff7ed;
            --subject-simulations-border: rgba(251,191,36,0.75);
            --subject-simulations-gradient: linear-gradient(135deg, rgba(249,115,22,0.9), rgba(250,204,21,0.7));
            --math-surface: #000000;
            --math-surface-border: rgba(226,232,240,0.22);
            --math-divider: rgba(148,163,184,0.35);
            --math-text: #ffffff;
            --math-muted-text: rgba(248,250,252,0.85);
        }

        body {
            font-family: inherit;
            font-size: 16px;
            line-height: 1.4;
            background-color: var(--bg-page, var(--bg-color));
            color: var(--text-color, var(--text-primary));
        }
        h1, h2, h3 {
            font-family: 'Poppins', 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-weight: 600;
        }
        h1 {
            font-size: 2.25rem;
            color: var(--text-primary);
            line-height: 1.2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        h2 {
            font-size: 1.5rem;
            color: var(--text-secondary);
            line-height: 1.3;
        }
        h3 {
            font-size: 1.125rem;
            color: var(--text-tertiary);
            line-height: 1.4;
            word-break: break-word;
        }
        p,
        li {
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 1rem;
            line-height: 1.7;
            color: var(--subtext-color, var(--text-tertiary));
        }
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            background: url('Logo.svg') center/105vmin no-repeat;
            opacity: 0.12;
            z-index: -1;
            pointer-events: none;
            animation: floatLogo 12s ease-in-out infinite alternate;
        }
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 25% 25%, rgba(14,165,233,0.03) 0%, transparent 50%),
                        radial-gradient(circle at 75% 75%, rgba(236,72,153,0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: -2;
        }
        @keyframes floatLogo {
            0%, 100% { transform: translateY(0); opacity: 0.12; }
            50% { transform: translateY(-10px); opacity: 0.15; }
        }
        .glass {
            background-color: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--border-strong);
            border-radius: 1rem;
            box-shadow: var(--shadow-strong);
            color: var(--text-primary);
        }
        [data-theme="light"] .glass {
            background-color: #ffffff;
            color: #0f172a;
            border-color: rgba(148, 163, 184, 0.22);
        }

        @supports ((-webkit-backdrop-filter: blur(10px)) or (backdrop-filter: blur(10px))) {
            .glass {
                background-color: var(--bg-overlay);
                -webkit-backdrop-filter: blur(10px);
                backdrop-filter: blur(10px);
            }
        }
        .hero-section {
            position: relative;
            overflow: hidden;
            color: var(--hero-text-color, var(--text-color, var(--text-primary)));
        }
        .hero-section > * {
            position: relative;
            z-index: 1;
        }
        .hero-title {
            color: var(--hero-text-color, var(--text-color, var(--text-primary)));
        }
        [data-theme="light"] .hero-section::before {
            content: "";
            position: absolute;
            inset: 0;
            /* Subtle white gradient wash to distinguish content area while keeping page white */
            background: linear-gradient(180deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.65) 35%, rgba(255,255,255,0.45) 100%);
            backdrop-filter: none;
            z-index: 0;
            pointer-events: none;
        }
        [data-theme="light"] .quiz-panel,
        [data-theme="light"] .question-container,
        [data-theme="light"] .passage-section {
            color: var(--text-color);
            background-color: var(--panel-bg);
        }
        [data-theme="light"] .passage-section p,
        [data-theme="light"] .question-container p,
        [data-theme="light"] .quiz-panel p {
            color: var(--text-color);
        }
        [data-theme="light"] .quiz-panel,
        [data-theme="light"] .content-card,
        [data-theme="light"] .question-container {
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }
        .dashboard-row,
        .quiz-panel,
        .question-area,
        .passage-block,
        .profile-block {
            min-width: 0;
        }
        [data-theme="light"] .quiz-panel button,
        [data-theme="light"] .quiz-nav button,
        [data-theme="light"] .start-btn,
        [data-theme="light"] .action-button {
            color: var(--text-color);
            background-color: var(--button-bg);
            border: 1px solid var(--border-color);
        }
        [data-theme="light"] .quiz-panel button:hover,
        [data-theme="light"] .quiz-nav button:hover,
        [data-theme="light"] .start-btn:hover,
        [data-theme="light"] .action-button:hover {
            background-color: var(--button-hover-bg);
        }
        [data-theme="light"] .math-theme button,
        [data-theme="light"] .science-theme button,
        [data-theme="light"] .rla-theme button,
        [data-theme="light"] .social-theme button {
            color: #111111;
        }
        [data-theme="light"] .answer-option {
            color: var(--text-color);
            background-color: #f9f9f9;
            border: 1px solid var(--border-color);
        }
        [data-theme="light"] .answer-option:hover {
            background-color: #eaeaea;
        }
        [data-theme="light"] .answer-option.correct {
            background-color: #d2f8d2;
            color: #111111;
        }
        [data-theme="light"] .answer-option.incorrect {
            background-color: #fdecec;
            color: #111111;
        }
        [data-theme="light"] svg,
        [data-theme="light"] .icon {
            fill: currentColor;
            stroke: currentColor;
            color: var(--text-color);
        }
        [data-theme="light"] input,
        [data-theme="light"] textarea,
        [data-theme="light"] select {
            color: #000000;
            background-color: #ffffff;
        }
        [data-theme="light"] input::placeholder,
        [data-theme="light"] textarea::placeholder {
            color: #475569;
        }
        /* Dark mode form fields: ensure strong contrast for typed text and placeholders */
        [data-theme="dark"] input,
        [data-theme="dark"] select,
        [data-theme="dark"] textarea {
            color: #ffffff;
            background-color: rgba(2,6,23,0.85);
            border-color: rgba(148,163,184,0.45);
        }
        [data-theme="dark"] input::placeholder,
        [data-theme="dark"] textarea::placeholder {
            color: #94a3b8;
        }
        /* Essay/practice textareas in dark mode */
        [data-theme="dark"] .practice-textarea {
            color: #ffffff;
            background-color: rgba(2,6,23,0.85);
            border-color: rgba(148,163,184,0.45);
        }
        [data-theme="dark"] .practice-textarea::placeholder {
            color: #94a3b8;
        }
        /* Subject-accented headings and light-mode white panels for specific review surfaces */
        [data-theme="light"] .panel-surface {
            background-color: #ffffff !important;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 1px 2px rgba(0,0,0,0.04);
        }
        /* Dashboard panels: force white in LIGHT mode only (do not affect dark mode or themed cards) */
        [data-theme="light"] .panel,
        [data-theme="light"] .block-profile.panel,
        [data-theme="light"] .block-vocab.panel {
            background-color: #ffffff; /* solid white surface */
            color: var(--text-color);  /* keep normal readable text */
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow, 0 1px 2px rgba(0,0,0,0.05));
            background-image: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
        }

                /* 1) Generic dashboard section shells that still inherit the dark page bg */
                        [data-theme="light"] .card,
                [data-theme="light"] .box,
                [data-theme="light"] .quiz-section,
                [data-theme="light"] .dashboard-row,
                [data-theme="light"] .section,
                [data-theme="light"] .section-container {
                    background-color: #ffffff;
                    border: 1px solid var(--border-color);
                    box-shadow: var(--shadow);
                    color: var(--text-color);
                            background-image: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                }

                /* 2) "Vocabulary Spotlight" bar uses its own wrapper; make its shell white */
                        [data-theme="light"] .vocabulary-ticker {
                    background-color: #ffffff;
                    border: 1px solid var(--border-color);
                    box-shadow: var(--shadow);
                            background-image: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                }

                /* Keep ticker chips as they are */
                [data-theme="light"] .vocabulary-ticker-track,
                [data-theme="light"] .vocabulary-chip { background-color: inherit; }

                /* 3) Section headers that may still be using a dark strip */
                [data-theme="light"] .section-title,
                [data-theme="light"] .section-header,
                [data-theme="light"] .panel-header {
                    background-color: #ffffff;
                    color: var(--text-color);
                    border-bottom: 1px solid var(--border-color);
                }

                /* 4) Do NOT touch themed tiles/cards (subject gradients/stats) */
                [data-theme="light"] .subject-card,
                [data-theme="light"] .stat { background: unset; border: none; box-shadow: none; }

                        /* A) Make the primary dashboard wrapper truly white in LIGHT mode */
                                [data-theme="light"] .content-card {
                            background-color: #ffffff !important;
                            /* ensure the white fills behind inner gaps */
                            background-clip: padding-box;
                                    background-image: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                        }

                        /* B) Ensure inner shells don't re-expose the dark page bg */
                                [data-theme="light"] .content-card .dashboard-sections,
                        [data-theme="light"] .content-card .dashboard-row,
                        [data-theme="light"] .content-card .section,
                        [data-theme="light"] .content-card .section-container,
                        [data-theme="light"] .content-card .section-header,
                        [data-theme="light"] .content-card .panel-header,
                        [data-theme="light"] .content-card .vocabulary-ticker {
                            background-color: #ffffff !important;
                            color: var(--text-color);
                            /* keep our existing light borders/shadows */
                            border: 1px solid var(--border-color);
                            box-shadow: var(--shadow);
                                    background-image: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                        }

                                /* Make the welcome header and subtitle jet-black in LIGHT mode */
                                [data-theme="light"] .content-card header.text-center h1,
                                [data-theme="light"] .content-card header.text-center p {
                                    color: #000000 !important;
                                }

                                /* Profile page: render text black in LIGHT mode except buttons */
                                [data-theme="light"] #profileView h1,
                                [data-theme="light"] #profileView h2,
                                [data-theme="light"] #profileView h3,
                                [data-theme="light"] #profileView p,
                                [data-theme="light"] #profileView label,
                                [data-theme="light"] #profileView li,
                                [data-theme="light"] #profileView dt,
                                [data-theme="light"] #profileView dd {
                                    color: #000000 !important;
                                }
                                /* Do not alter button label colors in profile view */
                                [data-theme="light"] #profileView button,
                                [data-theme="light"] #profileView button * {
                                    color: inherit;
                                }

                                /* Settings page: render text black in LIGHT mode except buttons */
                                [data-theme="light"] #settingsView h1,
                                [data-theme="light"] #settingsView h2,
                                [data-theme="light"] #settingsView h3,
                                [data-theme="light"] #settingsView p,
                                [data-theme="light"] #settingsView label,
                                [data-theme="light"] #settingsView li,
                                [data-theme="light"] #settingsView dt,
                                [data-theme="light"] #settingsView dd {
                                    color: #000000 !important;
                                }
                                [data-theme="light"] #settingsView button,
                                [data-theme="light"] #settingsView button * {
                                    color: inherit;
                                }
                                        /* Settings Back to Dashboard (and other buttons) should have black text in light mode */
                                        [data-theme="light"] #settingsView .settings-header button {
                                            color: #000000 !important;
                                            background-color: #ffffff !important;
                                            border: 1px solid #d1d5db !important;
                                        }
                                        [data-theme="light"] #settingsView .settings-header button:hover:not(:disabled) {
                                            background-color: #f0f0f0 !important;
                                        }

                                        /* Settings page: force Font Size and Color Mode texts to black in BOTH themes */
                                        #settingsView fieldset > legend,
                                        #settingsView fieldset > p {
                                            color: #000000 !important;
                                        }
                                        /* Option labels and their subtext (for both Font Size and Color Mode) */
                                        #settingsView label span .font-semibold,
                                        #settingsView label span .text-xs {
                                            color: #000000 !important;
                                        }

                        /* C) Do NOT affect the subject tiles/gradients or stat boxes */
                        [data-theme="light"] .content-card .subject-card,
                        [data-theme="light"] .content-card .stat {
                            background: unset !important;
                            border: none !important;
                            box-shadow: none !important;
                        }

                        /* D) If any 'glass' overlays are applied inside the content card, keep them light */
                        [data-theme="light"] .content-card .glass {
                            background-color: rgba(255,255,255,0.75) !important;
                            border-color: rgba(148,163,184,0.22) !important;
                        }

                        /* E) Guard against accidental dark variants leaking in light mode */
                        html[data-theme="light"] body:not(.dark) .content-card [class*="dark:bg-"] {
                            background-color: inherit !important; /* neutralize dark:bg-* when not in dark */
                        }

                                /* ------------------------------ */
                                /* Light-mode polish: Dashboard & Settings (scoped) */
                                /* 1) Card surfaces & elevation (subtle, white on white) */
                                [data-theme="light"] .content-card,
                                [data-theme="light"] .dashboard-row,
                                [data-theme="light"] .panel,
                                [data-theme="light"] .box,
                                [data-theme="light"] .section,
                                [data-theme="light"] .profile-block,
                                [data-theme="light"] .vocabulary-ticker,
                                [data-theme="light"] .settings-card,
                                [data-theme="light"] .settings-section {
                                    position: relative;
                                    background: linear-gradient(135deg, #ffffff, #f9fafb);
                                    border: 1px solid rgba(148,163,184,0.2);
                                    border-radius: 1rem;
                                    box-shadow: 0 6px 14px rgba(2,6,23,0.05);
                                    transition: box-shadow .25s ease, transform .2s ease;
                                }

                                [data-theme="light"] .panel:hover,
                                [data-theme="light"] .box:hover,
                                [data-theme="light"] .settings-section:hover {
                                    transform: translateY(-2px);
                                    box-shadow: 0 12px 24px rgba(2,6,23,0.08);
                                }

                                /* Keep subject tiles/gradients untouched */
                                [data-theme="light"] .subject-card,
                                [data-theme="light"] .subject-gradient,
                                [data-theme="light"] .stat { background: unset; box-shadow: none; border: none; }

                                /* 2) Section headers feel “distinct” without dark bars */
                                [data-theme="light"] .section-header,
                                [data-theme="light"] .panel-header,
                                [data-theme="light"] .settings-header {
                                    background: linear-gradient(90deg, rgba(14,165,233,0.06), rgba(236,72,153,0.06));
                                    border-bottom: 1px solid rgba(148,163,184,0.18);
                                    border-radius: .75rem .75rem 0 0;
                                    padding: .6rem .9rem;
                                }

                                /* 3) Typography upgrades (titles, labels; content stays black on white) */
                                [data-theme="light"] .content-card,
                                [data-theme="light"] .settings-card {
                                    -webkit-font-smoothing: antialiased;
                                    -moz-osx-font-smoothing: grayscale;
                                }

                                [data-theme="light"] .section-title,
                                [data-theme="light"] .panel-title,
                                [data-theme="light"] .settings-title {
                                    font-weight: 700;
                                    letter-spacing: .02em;
                                    line-height: 1.25;
                                    color: #0f172a;
                                    text-shadow: 0 1px 0 rgba(255,255,255,0.6);
                                    margin-bottom: .5rem;
                                    border-bottom: 2px solid rgba(148,163,184,0.18);
                                    padding-bottom: .4rem;
                                }

                                [data-theme="light"] .overline,
                                [data-theme="light"] .label-lite {
                                    font-size: .75rem;
                                    font-weight: 700;
                                    letter-spacing: .06em;
                                    text-transform: uppercase;
                                    color: #334155;
                                    opacity: .9;
                                }

                                [data-theme="light"] .question-text,
                                [data-theme="light"] .passage,
                                [data-theme="light"] .answer-option,
                                [data-theme="light"] .settings-description {
                                    color: #0b1220; /* dark text for readability */
                                    text-shadow: none;
                                }

                                /* 4) Buttons & controls: subtle lift, scoped to Dashboard & Settings containers */
                                [data-theme="light"] .content-card button,
                                [data-theme="light"] .content-card .action-button,
                                [data-theme="light"] .settings-card button,
                                [data-theme="light"] .settings-card .action-button {
                                    border-radius: .6rem;
                                    border: 1px solid rgba(148,163,184,0.25);
                                    box-shadow: 0 2px 6px rgba(2,6,23,0.06);
                                    transition: transform .15s ease, box-shadow .2s ease, background-color .2s ease;
                                }
                                [data-theme="light"] .content-card button:hover,
                                [data-theme="light"] .content-card .action-button:hover,
                                [data-theme="light"] .settings-card button:hover,
                                [data-theme="light"] .settings-card .action-button:hover {
                                    transform: translateY(-1px);
                                    box-shadow: 0 6px 14px rgba(2,6,23,0.09);
                                }

                                /* 5) Pills/chips (Vocabulary, Settings options) look premium */
                                [data-theme="light"] .content-card .chip,
                                [data-theme="light"] .content-card .vocabulary-chip,
                                [data-theme="light"] .content-card .option-pill,
                                [data-theme="light"] .settings-card .chip,
                                [data-theme="light"] .settings-card .option-pill {
                                    background: linear-gradient(180deg, #ffffff, #f3f6fb);
                                    border: 1px solid rgba(148,163,184,0.25);
                                    border-radius: 999px;
                                    box-shadow: 0 1px 2px rgba(2,6,23,0.06);
                                }
                                [data-theme="light"] .content-card .option-pill.is-selected,
                                [data-theme="light"] .settings-card .option-pill.is-selected {
                                    background: linear-gradient(180deg, #eef6ff, #e7f0ff);
                                    border-color: rgba(37,99,235,0.45);
                                    box-shadow: 0 4px 10px rgba(37,99,235,0.15);
                                }

                                /* 6) Gentle separators & spacing rhythm */
                                [data-theme="light"] .content-card .divider,
                                [data-theme="light"] .content-card .rule,
                                [data-theme="light"] .settings-card .divider,
                                [data-theme="light"] .settings-card .rule {
                                    border-color: rgba(148,163,184,0.25);
                                    opacity: .9;
                                }
                                [data-theme="light"] .content-card .section,
                                [data-theme="light"] .settings-section { padding: 1.1rem 1.25rem; }

                                /* 7) Guard rails: also for settings container */
                                html[data-theme="light"] body:not(.dark) .settings-card [class*="dark:bg-"] {
                                    background-color: transparent !important;
                                }

                                        /* Math Tools: ensure tab button text is black in LIGHT mode */
                                        [data-theme="light"] .math-tools-tabs button {
                                            color: #000000 !important;
                                        }

                                        /* Math Practice Tools title and graphing Equations label must be black in LIGHT mode */
                                        [data-theme="light"] .math-practice-header h1 { color: #000000 !important; }
                                        [data-theme="light"] .equations-label { color: #000000 !important; }

                                        /* Settings: force Save button text to black in LIGHT mode */
                                        [data-theme="light"] #settingsView button[type="submit"],
                                        [data-theme="light"] #settingsView button[type="submit"] * {
                                            color: #000000 !important;
                                        }

                                        /* Dashboard bottom cards: stronger distinction in LIGHT mode */
                                        [data-theme="light"] .block-start-quiz .panel.card {
                                            background: linear-gradient(135deg, #ffffff, #f9fafb);
                                            border: 1px solid rgba(2,6,23,0.12);
                                            box-shadow: 0 10px 24px rgba(2,6,23,0.08), inset 0 1px 0 rgba(255,255,255,0.6);
                                        }
                                                [data-theme="light"] .scores-shell,
                                                [data-theme="light"] .vocab-shell {
                                                    background: linear-gradient(135deg, #ffffff, #f9fafb);
                                                    border: 1px solid rgba(2,6,23,0.12);
                                                    box-shadow: 0 10px 24px rgba(2,6,23,0.08), inset 0 1px 0 rgba(255,255,255,0.6);
                                                }
        /* Default subject heading color in light mode (fallback) */
        [data-theme="light"] .subject-accent-heading {
            color: var(--accent) !important;
        }
        /* Per-subject heading accents in light mode */
        [data-theme="light"] [data-subject="Math"] .subject-accent-heading {
            color: var(--subject-math-accent) !important;
        }
        [data-theme="light"] [data-subject="Science"] .subject-accent-heading {
            color: var(--subject-science-accent) !important;
        }
        [data-theme="light"] [data-subject="Social Studies"] .subject-accent-heading {
            color: var(--subject-social-accent) !important;
        }
        [data-theme="light"] [data-subject="Reasoning Through Language Arts (RLA)"] .subject-accent-heading {
            color: var(--subject-rla-accent) !important;
        }
        /* Dark mode: always render these headers white for readability */
        [data-theme="dark"] .subject-accent-heading {
            color: #ffffff !important;
        }
        /* Settings: clearer selected state for Font Size and Theme bubbles */
        #settingsView label:has(input[type="radio"][name="fontSize"]:checked) {
            border-color: var(--accent);
            background-color: var(--accent-soft);
            box-shadow: 0 0 0 2px var(--accent-ring);
        }
        #settingsView label:has(input[type="radio"][name="theme"]:checked) {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-ring);
        }
        /* Test Plan: clearer selected state for checkboxes (Not scheduled / Passed) */
        .subject-test-block label.inline-row:has(input:checked) {
            background-color: var(--accent-soft);
            border: 1px solid var(--accent-border);
            border-radius: 0.5rem;
            padding-inline: 0.5rem;
            color: var(--text-primary);
        }
        .subject-test-block label:has(input:focus) {
            outline: 2px solid var(--accent-ring);
            outline-offset: 2px;
        }
        .refresh-button {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }
        [data-theme="light"] .refresh-button {
            background-color: #ffffff;
            color: #000000;
            border: 1px solid #d1d5db;
            box-shadow: inset 0 0 0 1px rgba(148,163,184,0.12);
        }
        /* Ensure Profile refresh button text is black in light mode, overriding broader button color rules */
        [data-theme="light"] #profileView .refresh-button,
        [data-theme="light"] #profileView .refresh-button * {
            color: #000000 !important;
        }
        [data-theme="light"] #profileView .refresh-button {
            background-color: #ffffff !important;
            border: 1px solid #d1d5db !important;
        }
        [data-theme="light"] .refresh-button:hover:not(:disabled) {
            background-color: #f0f0f0;
        }
        [data-theme="dark"] .refresh-button {
            background-color: rgba(15,23,42,0.85);
            color: #ffffff;
            border: 1px solid rgba(148,163,184,0.45);
        }
        [data-theme="dark"] .refresh-button:hover:not(:disabled) {
            background-color: rgba(30,41,59,0.8);
        }
        .subject-description {
            color: var(--text-secondary);
        }
        [data-theme="light"] .subject-description {
            color: var(--text-primary);
        }
        [data-theme="dark"] .subject-description {
            color: rgba(226,232,240,0.95);
        }
        .formula-sheet {
            background-color: #ffffff;
            color: #000000;
        }
        .formula-sheet .formula-sheet-card {
            background-color: #ffffff;
            color: inherit;
            border: 1px solid rgba(148,163,184,0.35);
        }
        .formula-sheet .formula-equation {
            background-color: #ffffff;
            border: 1px solid rgba(148,163,184,0.35);
            color: inherit;
            display: block;
        }
        .formula-sheet .formula-sheet-description {
            color: inherit;
        }
        [data-theme="dark"] .formula-sheet {
            background-color: var(--modal-surface);
            color: var(--modal-text);
        }
        [data-theme="dark"] .formula-sheet .formula-sheet-card {
            background-color: rgba(15,23,42,0.65);
            border-color: rgba(148,163,184,0.45);
        }
        [data-theme="dark"] .formula-sheet .formula-equation {
            background-color: rgba(2,6,23,0.65);
            border-color: rgba(148,163,184,0.45);
            color: var(--modal-text);
        }
        [data-theme="dark"] .science-formula-sheet {
            background-color: #000000;
            color: #ffffff;
        }
        [data-theme="dark"] .science-formula-sheet .formula-sheet-card {
            background-color: rgba(17,24,39,0.85);
            border-color: rgba(148,163,184,0.55);
        }
        [data-theme="dark"] .science-formula-sheet .formula-equation {
            background-color: #000000;
            border-color: rgba(148,163,184,0.55);
            color: #ffffff;
        }
        [data-theme="light"] .science-formula-sheet .formula-sheet-card {
            background-color: #f8fafc;
        }
        [data-theme="light"] .science-formula-sheet .formula-equation {
            background-color: #ffffff;
        }
        .formula-sheet-header {
            background-color: transparent;
        }
        [data-theme="light"] .formula-sheet-header {
            background-color: #ffffff;
        }
        [data-theme="dark"] .formula-sheet-header {
            background-color: rgba(0,0,0,0.65);
        }
        .formula-sheet-title,
        .formula-sheet-close {
            color: inherit;
        }
        .formula-sheet-section {
            border-color: rgba(148,163,184,0.35);
            color: inherit;
        }
        [data-theme="dark"] .formula-sheet-section {
            border-color: rgba(148,163,184,0.45);
        }
        .quiz-count-text {
            font-weight: 600;
        }
        [data-theme="light"] .quiz-count-text[data-subject="Science"] { color: var(--subject-science-accent-text, #7f1d1d); }
        [data-theme="light"] .quiz-count-text[data-subject="Math"] { color: var(--subject-math-accent-text, #0c4a6e); }
        [data-theme="light"] .quiz-count-text[data-subject="Social Studies"] { color: var(--subject-social-accent-text, #14532d); }
        [data-theme="light"] .quiz-count-text[data-subject="RLA"] { color: var(--subject-rla-accent-text, #4c1d95); }
        .subject-card {
            transition: all 0.3s ease;
            transform: translateY(0);
            position: relative;
            overflow: visible;
        }
        .subject-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }
        /* Overlay badge shown on passed subject cards */
        .subject-badge {
            position: absolute;
            top: -14px;
            right: -10px;
            height: 54px;
            width: auto;
            z-index: 5;
            pointer-events: none; /* let clicks pass through to card */
            filter: drop-shadow(0 2px 4px rgba(15,23,42,0.2));
        }
        @media (max-width: 768px) {
            .subject-badge { top: -10px; right: -8px; height: 46px; }
        }
        .quiz-nav {
            scrollbar-width: thin;
            scrollbar-color: var(--quiz-scrollbar-thumb) var(--quiz-scrollbar-track);
        }
        .quiz-nav::-webkit-scrollbar { height: 4px; }
        .quiz-nav::-webkit-scrollbar-track { background: var(--quiz-scrollbar-track); }
        .quiz-nav::-webkit-scrollbar-thumb { background: var(--quiz-scrollbar-thumb); border-radius: 2px; }
        .quiz-nav::-webkit-scrollbar-thumb:hover { background: var(--quiz-scrollbar-thumb-hover); }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes floatIn {
            0%   { opacity: 0; transform: translateY(10px) scale(0.98); }
            100% { opacity: 1; transform: translateY(0) scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 0.6s ease-in-out; }
        .animate-floatIn { animation: floatIn 0.5s ease; }
        .prose ::selection { background-color: var(--selection-bg); }
        .prose { max-width: 65ch; margin: auto; }
        .prose p { margin-bottom: 1em; }
        .exam-root, .exam-body, .passage, .question-stem, .choice-text, .explanation, .rubric {
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: auto;
            white-space: normal;
            line-height: 1.5;
            text-align: left;
            max-width: 75ch;
        }

        .passage-text {
            color: #000000;
        }

        .dark .passage-text {
            color: var(--text-primary);
        }

        .dark .question-stem {
            color: #ffffff;
        }

        .dark .question-stem * {
            color: inherit;
        }

        .break-all, [data-break="all"] {
            word-break: normal !important;
            overflow-wrap: break-word !important;
        }

        .math, code, pre, kbd, samp, .token {
            overflow-wrap: anywhere;
        }
        #pong-canvas { background-color: #1a202c; border-radius: 0.5rem; border: 2px solid #4a5568; }
        .option {
            border: 2px solid var(--border-subtle);
            border-radius: 0.75rem;
            background-color: var(--bg-surface);
            padding: 0.75rem 1rem;
            box-shadow: var(--option-shadow);
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            color: var(--option-text);
        }
        .option:hover:not(.selected):not(.correct):not(.incorrect) {
            background-color: var(--option-hover-bg);
            transform: scale(1.01);
            box-shadow: var(--option-hover-shadow);
        }
        .option.selected {
            background-color: var(--accent-soft);
            border-color: var(--accent-border);
            box-shadow: 0 0 0 3px var(--accent-ring);
            color: var(--accent-text);
            font-weight: 600;
        }
        .option.correct {
            background-color: var(--success-bg);
            border-color: var(--success-border);
            color: var(--success-text);
            animation: correctPop 0.28s ease-out;
            box-shadow: 0 0 0 1px rgba(34,197,94,0.15);
        }
        @keyframes correctPop {
            0% { transform: scale(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
            40% { transform: scale(1.03); box-shadow: 0 10px 20px rgba(16,185,129,0.25); }
            100% { transform: scale(1); box-shadow: 0 0 0 rgba(0,0,0,0); }
        }
        .option.incorrect {
            background-color: var(--danger-bg);
            border-color: var(--danger-border);
            position: relative;
            animation: shakeWrong 0.22s linear;
            color: var(--danger-text);
            box-shadow: 0 0 0 1px rgba(239,68,68,0.1);
        }
        .dark .option.correct {
            box-shadow: 0 0 0 1px var(--success-border);
        }
        .dark .option.incorrect {
            box-shadow: 0 0 0 1px var(--danger-border);
        }
        @keyframes shakeWrong {
            0% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            50% { transform: translateX(3px); }
            75% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }
        .explanation {
            background-color: var(--explanation-bg);
            border-left: 4px solid var(--explanation-border);
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
            font-size: 0.9rem;
            line-height: 1.4;
            color: var(--explanation-text);
            animation: explainReveal 0.25s ease-out;
            box-shadow: var(--explanation-shadow);
        }
        .option:focus-visible {
            outline: 2px solid var(--border-focus);
            outline-offset: 2px;
        }
        button[data-role="primary"] {
            background-color: var(--accent);
            border: 1px solid var(--accent-border);
            color: var(--accent-text);
            font-weight: 600;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            box-shadow: 0 10px 20px -12px rgba(14,116,144,0.6);
        }
        button[data-role="primary"]:hover:not(:disabled) {
            background-color: var(--accent-hover);
            transform: translateY(-1px);
            box-shadow: 0 12px 22px -10px rgba(14,116,144,0.65);
        }
        button[data-role="primary"]:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        button[data-role="secondary"] {
            background-color: var(--button-secondary-bg);
            border: 1px solid var(--button-secondary-border);
            color: var(--button-secondary-text);
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        button[data-role="secondary"]:hover:not(:disabled) {
            background-color: var(--bg-muted);
            border-color: var(--border-strong);
        }
        @keyframes explainReveal {
            0% { opacity: 0; transform: translateY(4px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .good-evidence {
            background-color: #dcfce7; /* Tailwind green-100 */
            color: #166534; /* Tailwind green-800 */
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }
        .bad-evidence {
            background-color: #fee2e2; /* Tailwind red-100 */
            color: #991b1b; /* Tailwind red-800 */
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 500;
        }
        .vocabulary-ticker {
            position: relative;
            overflow: hidden;
            background-color: var(--vocabulary-bg);
        }
        .vocabulary-ticker-track {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            width: max-content;
            padding: 0.75rem 1rem;
            animation: vocabularyTickerScroll 70s linear infinite;
        }
        .vocabulary-ticker:hover .vocabulary-ticker-track {
            animation-play-state: paused;
        }
        .vocabulary-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.45rem 0.85rem;
            border-radius: 9999px;
            border: 1px solid rgba(100, 116, 139, 0.2);
            background-color: #f8fafc;
            background-image: linear-gradient(to bottom right, rgba(255,255,255,0.9), rgba(248,250,252,0.6));
            color: #0f172a;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(15, 23, 42, 0.08);
            white-space: nowrap;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .dark .vocabulary-chip {
            border-color: rgba(226,232,240,0.18);
            background-color: rgba(15,23,42,0.8);
            color: #f8fafc;
            box-shadow: 0 8px 20px rgba(0,0,0,0.9);
        }
        .vocabulary-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 14px rgba(15, 23, 42, 0.15);
        }
        .dark .vocabulary-chip:hover {
            box-shadow: 0 14px 24px rgba(0,0,0,0.6);
        }
        .vocabulary-chip-dot {
            width: 0.6rem;
            height: 0.6rem;
            border-radius: 9999px;
        }
        .vocabulary-chip-label {
            font-size: 0.7rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: #64748b;
        }
        .dark .vocabulary-chip-label { color: #f8fafc; }
        @keyframes vocabularyTickerScroll {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }
        .question-stem,
        .question-stem * {
            font-style: normal !important;
        }
        .question-stem {
            white-space: normal;
            overflow-wrap: break-word;
            word-break: normal;
        }
        .question-stem table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
        }
        .question-stem th,
        .question-stem td {
            border: 1px solid #e5e7eb;
            padding: 0.4rem 0.6rem;
            text-align: left;
        }
        .question-stem thead th {
            background: #f3f4f6;
            font-weight: 600;
        }
        .dark .question-stem th,
        .dark .question-stem td {
            border: 1px solid rgba(226,232,240,0.18);
            padding: 0.4rem 0.6rem;
            text-align: left;
            color: #f8fafc;
            background-color: rgba(15,23,42,0.6);
        }
        .dark .question-stem thead th {
            background-color: rgba(30,41,59,0.8);
            color: #ffffff;
            font-weight: 600;
        }
        h3 {
            overflow-wrap: break-word;
        }

        @media (max-width: 768px) {
            body {
                font-size: 1rem;
                line-height: 1.5;
            }

            h1,
            .section-title,
            .panel-title {
                font-size: 1.125rem;
                line-height: 1.3;
            }

            .dashboard-sections {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .block-start-quiz {
                order: 1;
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 1rem;
            }

            .block-test-date { order: 2; }
            .block-challenges { order: 3; }
            .block-vocab { order: 4; }
            .block-profile { order: 5; }
            .block-adminStuff { order: 6; }

            .two-col,
            .flex-row,
            .dashboard-row {
                display: flex !important;
                flex-direction: column;
                gap: 1rem;
            }

            .dashboard-row {
                order: 2;
            }

            .card,
            .panel,
            .box,
            .quiz-section,
            .quiz-block,
            .profile-block {
                width: 100%;
                max-width: 100%;
                min-width: 0;
            }

            button,
            .answerOption,
            .subject-choice,
            .mode-toggle,
            .quiz-start-btn {
                font-size: 1rem;
                line-height: 1.4;
                padding: 0.9rem 1rem;
                border-radius: 0.6rem;
            }

            .card,
            .panel,
            .quiz-block,
            .profile-block,
            .question-area,
            .passage-block {
                padding: 1rem 1rem;
                border-radius: 0.75rem;
            }

            /* Force high contrast for learning content on mobile */
            .passage-block,
            .question-area,
            .quiz-block,
            .card,
            .panel {
                background-color: var(--surface-mobile, #ffffff);
                color: var(--text-mobile, #1a1a1a);
            }

            .passage-block p,
            .question-area,
            .quiz-block .questionText,
            .quiz-block .passageText {
                color: inherit;
            }

            .subject-bar {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .subject-bar button,
            .subject-choice,
            .mode-toggle {
                flex: 1 1 calc(50% - 0.5rem);
                max-width: calc(50% - 0.5rem);
                text-align: center;
            }

            .card,
            .panel,
            .quiz-block,
            .passage-block,
            .question-area {
                overflow-wrap: break-word;
                word-break: break-word;
            }
        }

        /* FORM CONTROL NORMALIZATION */
        button,
        input,
        select,
        textarea {
            font-family: inherit;
            font-size: 1rem;
            line-height: 1.4;
            color: var(--text-primary);
            background-color: var(--bg-surface);
            border-radius: 0.5rem;
            border: 1px solid var(--border-subtle);
            -webkit-appearance: none;
            appearance: none;
        }

        button {
            cursor: pointer;
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        input[type="date"],
        select {
            color-scheme: light dark;
            background-color: var(--bg-surface);
            color: var(--text-primary);
            border: 1px solid var(--border-subtle);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
        }

        /* Countdown chip for Upcoming Test UI */
        .countdown-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.6rem;
            border-radius: 9999px;
            border: 1px solid var(--accent-border);
            background: rgba(56,189,248,0.14);
            color: var(--accent-text);
            font-weight: 700;
            font-size: 0.9rem;
            line-height: 1.1;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            user-select: none;
        }
        [data-theme="dark"] .countdown-chip {
            background: rgba(56,189,248,0.24);
            border-color: rgba(56,189,248,0.55);
            color: var(--accent-text);
            box-shadow: 0 8px 20px rgba(0,0,0,0.45);
        }
        .countdown-chip .dot {
            width: 0.45rem;
            height: 0.45rem;
            border-radius: 9999px;
            background: var(--accent);
            box-shadow: 0 0 0 2px var(--accent-soft);
        }
        .countdown-chip .label {
            letter-spacing: 0.02em;
        }
    </style>
</head>
<body data-theme="light" style="background-color: var(--bg-page); color: var(--text-primary);">
    <div id="root"></div>

                        <!-- Centralized JSON loader: build-time bundles only (no large runtime scripts) -->
                        <script>
                            (function(){
                                                        // --- helpers: merge + normalization + counting ---
                                                        function normalizeSubjectKey(key) {
                                                            if (!key) return null;
                                                            const trimmed = String(key).trim();
                                                            const lower = trimmed.toLowerCase();
                                                            if ([
                                                                'social studies',
                                                                'social-studies',
                                                                'social_studies',
                                                                'civics & government',
                                                            ].includes(lower)) {
                                                                return 'Social Studies';
                                                            }
                                                            return trimmed;
                                                        }

                                                        function mergeExpandedIntoBase(base, incoming) {
                                                            if (!incoming || typeof incoming !== 'object') return base || {};
                                                            const out = base || {};
                                                            for (const [subjectNameRaw, incSubject] of Object.entries(incoming)) {
                                                                if (!incSubject) continue;
                                                                const subjectName = normalizeSubjectKey(subjectNameRaw) || subjectNameRaw;
                                                                if (!out[subjectName]) out[subjectName] = { icon: null, description: '', categories: {}, quizzes: [] };
                                                                const outSubj = out[subjectName];
                                                                // subject-level quizzes
                                                                if (Array.isArray(incSubject.quizzes)) {
                                                                    const existing = new Set((outSubj.quizzes || []).map(q => q && (q.quizId || q.id)));
                                                                    outSubj.quizzes = Array.isArray(outSubj.quizzes) ? outSubj.quizzes : [];
                                                                    incSubject.quizzes.forEach((q) => {
                                                                        if (!q) return;
                                                                        const qid = q.quizId || q.id;
                                                                        if (!qid || !existing.has(qid)) {
                                                                            outSubj.quizzes.push(q);
                                                                            if (qid) existing.add(qid);
                                                                        }
                                                                    });
                                                                }
                                                                // categories/topics/quizzes
                                                                const incCats = incSubject.categories || {};
                                                                outSubj.categories = outSubj.categories || {};
                                                                for (const [catName, incCat] of Object.entries(incCats)) {
                                                                    if (!outSubj.categories[catName]) {
                                                                        outSubj.categories[catName] = { description: incCat?.description || '', topics: Array.isArray(incCat?.topics) ? [...incCat.topics] : [] };
                                                                        continue;
                                                                    }
                                                                    const outCat = outSubj.categories[catName];
                                                                    outCat.description = outCat.description || incCat?.description || '';
                                                                    const outTopics = Array.isArray(outCat.topics) ? outCat.topics : [];
                                                                    const incTopics = Array.isArray(incCat?.topics) ? incCat.topics : [];
                                                                    const byId = new Map(outTopics.map((t, i) => [t?.id || `idx_${i}`, { t, i }]));
                                                                    incTopics.forEach((t) => {
                                                                        if (!t) return;
                                                                        const key = t.id || t.title || `topic_${outTopics.length + 1}`;
                                                                        if (!byId.has(key)) {
                                                                            outTopics.push(t);
                                                                            byId.set(key, { t, i: outTopics.length - 1 });
                                                                        } else {
                                                                            const { i, t: existingT } = byId.get(key);
                                                                            const outQuizzes = Array.isArray(existingT.quizzes) ? existingT.quizzes : [];
                                                                            const incQuizzes = Array.isArray(t.quizzes) ? t.quizzes : [];
                                                                            const exists = new Set(outQuizzes.map(q => q && (q.quizId || q.id)));
                                                                            incQuizzes.forEach((q) => {
                                                                                const qid = q && (q.quizId || q.id);
                                                                                if (!qid || !exists.has(qid)) { outQuizzes.push(q); if (qid) exists.add(qid); }
                                                                            });
                                                                            outTopics[i] = { ...existingT, quizzes: outQuizzes };
                                                                        }
                                                                    });
                                                                    outCat.topics = outTopics;
                                                                }
                                                            }
                                                            return out;
                                                        }

                                                        function normalizeQuiz(q, subject) {
                                                            if (!q || typeof q !== 'object') return q;
                                                            const quizId = q.quizId || q.id || `${(subject||'quiz').toLowerCase()}_${Math.random().toString(36).slice(2,7)}`;
                                                            return {
                                                                quizId,
                                                                title: q.title || q.label || 'Practice Quiz',
                                                                label: q.label,
                                                                description: q.description || '',
                                                                questions: Array.isArray(q.questions) ? q.questions : q.items || [],
                                                                __topicGuess: q.topicId || q.topic || null,
                                                            };
                                                        }

                                                        function countQuizzesForSubject(subjectData) {
                                                            if (!subjectData) return 0;
                                                            let total = 0;
                                                            if (Array.isArray(subjectData.quizzes)) total += subjectData.quizzes.length;
                                                            const cats = subjectData.categories || {};
                                                            Object.values(cats).forEach((cat) => {
                                                                const topics = Array.isArray(cat?.topics) ? cat.topics : [];
                                                                topics.forEach((t) => {
                                                                    if (Array.isArray(t?.quizzes)) total += t.quizzes.length;
                                                                    else if (Array.isArray(t?.questions) && t.questions.length) total += 1;
                                                                });
                                                            });
                                                            return total;
                                                        }

                                                        function forceSocialStudiesMerge(catalog, extraSSArray) {
                                                            const canonicalKey = 'Social Studies';
                                                            const out = catalog || {};
                                                            // unify variant subject keys
                                                            Object.keys(out).forEach((k) => {
                                                                const norm = normalizeSubjectKey(k);
                                                                if (norm === canonicalKey && k !== canonicalKey) {
                                                                    mergeExpandedIntoBase(out, { [canonicalKey]: out[k] });
                                                                    delete out[k];
                                                                }
                                                            });
                                                            if (!out[canonicalKey]) out[canonicalKey] = { categories: {}, quizzes: [] };
                                                            // merge standalone array if provided
                                                            if (Array.isArray(extraSSArray) && extraSSArray.length) {
                                                                const topics = extraSSArray.map((q, idx) => {
                                                                    const nq = normalizeQuiz(q, canonicalKey);
                                                                    return {
                                                                        id: nq.__topicGuess || `ss_extra_${idx+1}`,
                                                                        title: nq.title || 'Social Studies Quiz',
                                                                        description: nq.description || '',
                                                                        quizzes: [nq],
                                                                    };
                                                                });
                                                                const struct = { [canonicalKey]: { categories: { 'Civics & Government': { topics } } } };
                                                                mergeExpandedIntoBase(out, struct);
                                                            }
                                                            return out;
                                                        }

                                                        // One-pass loader: try each known quiz JSON once; no infinite retry
                                                        const QUIZ_FILENAMES = [
                                                            'math.quizzes.part1.json',
                                                            'math.quizzes.part2.json',
                                                            'science.quizzes.part1.json',
                                                            'science.quizzes.part2.json',
                                                            'rla.quizzes.part1.json',
                                                            'rla.quizzes.part2.json',
                                                            'social-studies.quizzes.json',
                                                            'social-studies.extras.json'
                                                        ];
                                                        // Resolve backend origin from client config or fallback to current origin
                                                        const API_BASE = (typeof window !== 'undefined' && window.__CLIENT_CONFIG__ && window.__CLIENT_CONFIG__.API_BASE_URL)
                                                            ? window.__CLIENT_CONFIG__.API_BASE_URL
                                                            : (typeof API_BASE_URL === 'string' && API_BASE_URL) || (typeof window !== 'undefined' ? window.location.origin : '');

                                                        async function loadAllQuizPartsOnce() {
                                                            const parts = [];
                                                            for (const name of QUIZ_FILENAMES) {
                                                                const url = `${API_BASE}/quizzes/${name}`;
                                                                try {
                                                                    const res = await fetch(url, { cache: 'no-cache' });
                                                                    if (!res.ok) {
                                                                        console.warn('[quizzes] failed to load', url, res.status);
                                                                        continue;
                                                                    }
                                                                    const json = await res.json();
                                                                    parts.push(json);
                                                                } catch (err) {
                                                                    console.warn('[quizzes] error fetching', url, err?.message || err);
                                                                }
                                                            }
                                                            return parts;
                                                        }

                                                        function mergeQuizPayloads(parts) {
                                                            const bySubject = {};
                                                            let ssExtras = [];
                                                            for (const p of parts) {
                                                                if (!p) continue;
                                                                if (Array.isArray(p)) {
                                                                    // Treat any array payload as Social Studies extras array
                                                                    ssExtras = ssExtras.concat(p);
                                                                    continue;
                                                                }
                                                                const subj = p.subject || null;
                                                                const cats = p.categories || {};
                                                                if (!subj) continue;
                                                                if (!bySubject[subj]) bySubject[subj] = { subject: subj, categories: {} };
                                                                const target = bySubject[subj].categories;
                                                                for (const [catName, cat] of Object.entries(cats)) {
                                                                    if (!target[catName]) { target[catName] = { ...(cat || {}) }; continue; }
                                                                    const cur = target[catName];
                                                                    const newTopics = Array.isArray(cat?.topics) ? cat.topics : [];
                                                                    const existingIds = new Set((cur.topics || []).map((t) => t && t.id));
                                                                    cur.topics = (cur.topics || []).slice();
                                                                    for (const t of newTopics) {
                                                                        if (!existingIds.has(t.id)) cur.topics.push(t);
                                                                    }
                                                                }
                                                            }
                                                            return { bySubject, ssExtras };
                                                        }

                                                        async function buildUnifiedCatalog() {
                                                            const parts = await loadAllQuizPartsOnce();
                                                            if (!parts.length && (typeof window !== 'undefined' && window.__DEBUG_QUIZZES)) {
                                                                console.warn('[quizzes] no quiz parts loaded — using empty catalog');
                                                            }
                                                            const { bySubject, ssExtras } = mergeQuizPayloads(parts);
                                                            // Adapt to AppData shape
                                                            const app = {};
                                                            Object.entries(bySubject).forEach(([subject, payload]) => {
                                                                app[subject] = { icon: null, description: '', categories: {} };
                                                                const cats = payload.categories || {};
                                                                for (const [catName, cat] of Object.entries(cats)) {
                                                                    app[subject].categories[catName] = { description: '', topics: Array.isArray(cat.topics) ? cat.topics : [] };
                                                                }
                                                            });
                                                            // Fallback: if nothing loaded from backend, try legacy global datasets
                                                            if (Object.keys(app).length === 0 && typeof window !== 'undefined') {
                                                                try {
                                                                    const legacy = window.MergedExpandedQuizData
                                                                        || window.ExpandedQuizData
                                                                        || window.__ESM_ExpandedQuizData
                                                                        || (window.Data && window.Data.expandedQuizData) || null;
                                                                    if (legacy && typeof legacy === 'object') {
                                                                        Object.entries(legacy).forEach(([subject, data]) => {
                                                                            const cats = (data && data.categories) || {};
                                                                            app[subject] = { icon: null, description: '', categories: {} };
                                                                            for (const [catName, cat] of Object.entries(cats)) {
                                                                                app[subject].categories[catName] = { description: '', topics: Array.isArray(cat?.topics) ? cat.topics : [] };
                                                                            }
                                                                        });
                                                                    }
                                                                } catch {}
                                                            }
                                                            // Normalize and force Social Studies merge with any extras
                                                            const merged = forceSocialStudiesMerge(app, ssExtras);
                                                            window.UnifiedQuizCatalog = merged;
                                                            if (typeof window !== 'undefined') {
                                                                // Mutate existing AppData in place so legacy helpers resolve topics correctly
                                                                try {
                                                                    if (typeof AppData === 'object' && AppData) {
                                                                        Object.entries(merged).forEach(([subject, data]) => { AppData[subject] = data; });
                                                                    }
                                                                } catch {}
                                                                // Integrate with existing library builder
                                                                if (typeof buildQuizLibraryFromAppData === 'function') {
                                                                    window.QUIZ_LIBRARY = buildQuizLibraryFromAppData((typeof AppData === 'object' && AppData) ? AppData : merged);
                                                                }
                                                                window.AppData = (typeof AppData === 'object' && AppData) ? AppData : merged;
                                                            }
                                                            if (typeof window !== 'undefined' && window.__DEBUG_QUIZZES) {
                                                                console.log('[quizzes] UnifiedQuizCatalog built from JSON bundles:', Object.keys(bySubject));
                                                                try {
                                                                    const ssTotal = countQuizzesForSubject(window.UnifiedQuizCatalog['Social Studies']);
                                                                    console.log('[premade] social studies total =', ssTotal);
                                                                } catch {}
                                                            }
                                                        }

                                                        // Fire and forget; UI reads window.QUIZ_LIBRARY dynamically
                                                        buildUnifiedCatalog();
                            })();
                        </script>

            <!-- Removed per-subject ESM array loaders: now bundled into JSON at build time -->

                <!-- Removed runtime deep merge of many sources: now using prebuilt JSON bundles only -->

<script type="text/babel" data-presets="env,react">
const { useState, useEffect, useRef, useCallback, useMemo } = React;

const SUBJECT_PROGRESS_KEYS = [
    "Social Studies",
    "Reasoning Through Language Arts (RLA)",
    "Science",
    "Math"
];

const GED_PASSING_SCORE = 145;

// Global premade catalog; ensure it's on window to be shareable across late loaders
let PREMADE_QUIZ_CATALOG = (typeof window !== 'undefined' && window.PREMADE_QUIZ_CATALOG) ? window.PREMADE_QUIZ_CATALOG : {};
if (typeof window !== 'undefined') {
    window.PREMADE_QUIZ_CATALOG = PREMADE_QUIZ_CATALOG;
}

const getPremadeQuizTotal = (subject) => {
    try {
        const src = (typeof window !== 'undefined' && window.UnifiedQuizCatalog) ? window.UnifiedQuizCatalog : (typeof window !== 'undefined' ? window.AppData : AppData);
        const subjectData = src?.[subject];
        if (!subjectData) return 0;
        let total = 0;
        if (Array.isArray(subjectData.quizzes)) total += subjectData.quizzes.length;
        const cats = subjectData.categories || {};
        for (const catName of Object.keys(cats)) {
            const topics = Array.isArray(cats[catName]?.topics) ? cats[catName].topics : [];
            topics.forEach((t) => {
                if (Array.isArray(t?.quizzes)) total += t.quizzes.length;
                else if (Array.isArray(t?.questions)) total += 1; // count bare question topics as one quiz
            });
        }
        return total;
    } catch { return 0; }
};

const createEmptyProgress = () => SUBJECT_PROGRESS_KEYS.reduce((acc, subject) => {
    acc[subject] = {
        attempts: [],
        attemptCount: 0,
        averageScaledScore: null,
        completedCount: 0,
        completionPercentage: 0,
        passedExamCodes: [],
        totalPremadeExams: getPremadeQuizTotal(subject),
        lastAttempt: null,
    };
    return acc;
}, {});

const buildProgressFromAttempts = (attempts = []) => {
    const progress = createEmptyProgress();
    const subjectStats = SUBJECT_PROGRESS_KEYS.reduce((acc, subject) => {
        acc[subject] = { scoreSum: 0, count: 0, passed: new Set() };
        return acc;
    }, {});

    const normalizedAttempts = Array.isArray(attempts) ? attempts : [];

    normalizedAttempts.forEach((entry) => {
        const subjectKey = entry?.subject;
        if (!subjectKey || !progress[subjectKey]) {
            return;
        }

        const normalized = {
            id: entry?.id ?? null,
            quizCode: entry?.quizCode || entry?.quiz_code || entry?.quizId || entry?.quiz_id || null,
            quizTitle: entry?.quizTitle || entry?.quiz_title || entry?.quizName || null,
            quizType: entry?.quizType || entry?.quiz_type || null,
            score: typeof entry?.score === 'number' ? entry.score : Number.isFinite(Number(entry?.score)) ? Math.round(Number(entry.score)) : null,
            totalQuestions: typeof entry?.totalQuestions === 'number' ? entry.totalQuestions : Number.isFinite(Number(entry?.total_questions)) ? Math.round(Number(entry.total_questions)) : Number.isFinite(Number(entry?.totalQuestions)) ? Math.round(Number(entry.totalQuestions)) : null,
            scaledScore: typeof entry?.scaledScore === 'number' ? Math.round(entry.scaledScore) : Number.isFinite(Number(entry?.scaled_score)) ? Math.round(Number(entry.scaled_score)) : null,
            attemptedAt: entry?.attemptedAt || entry?.attempted_at || entry?.takenAt || null,
        };

        const derivedPassed = (() => {
            if (typeof entry?.passed === 'boolean') {
                return entry.passed;
            }
            if (typeof entry?.passed === 'string') {
                const lowered = entry.passed.trim().toLowerCase();
                if (lowered === 'true' || lowered === '1') return true;
                if (lowered === 'false' || lowered === '0') return false;
            }
            if (normalized.scaledScore != null) {
                return normalized.scaledScore >= GED_PASSING_SCORE;
            }
            return null;
        })();

        normalized.passed = derivedPassed;

        progress[subjectKey].attempts.push(normalized);

        if (normalized.scaledScore != null) {
            subjectStats[subjectKey].scoreSum += normalized.scaledScore;
            subjectStats[subjectKey].count += 1;
        }

        if (normalized.passed && normalized.quizCode) {
            subjectStats[subjectKey].passed.add(normalized.quizCode);
        }
    });

    SUBJECT_PROGRESS_KEYS.forEach((subject) => {
        const stats = subjectStats[subject];
        const subjectProgress = progress[subject];
        const totalPremade = getPremadeQuizTotal(subject);

        subjectProgress.attempts.sort((a, b) => {
            const aDate = a.attemptedAt ? new Date(a.attemptedAt).getTime() : 0;
            const bDate = b.attemptedAt ? new Date(b.attemptedAt).getTime() : 0;
            if (bDate === aDate) {
                return (b.id ?? 0) - (a.id ?? 0);
            }
            return bDate - aDate;
        });

        subjectProgress.attemptCount = subjectProgress.attempts.length;
        subjectProgress.averageScaledScore = stats.count ? Math.round(stats.scoreSum / stats.count) : null;
        subjectProgress.completedCount = stats.passed.size;
        subjectProgress.passedExamCodes = Array.from(stats.passed);
        subjectProgress.totalPremadeExams = totalPremade;
        subjectProgress.completionPercentage = totalPremade > 0
            ? Math.min(100, Math.round((stats.passed.size / totalPremade) * 100))
            : 0;
        subjectProgress.lastAttempt = subjectProgress.attempts[0] || null;
    });

    return progress;
};

const ensureUserProfile = (user) => {
    if (!user || typeof user !== 'object') {
        return null;
    }
    const email = typeof user.email === 'string' ? user.email : '';
    const baseName = user.name && typeof user.name === 'string' && user.name.trim()
        ? user.name.trim()
        : (email.includes('@') ? email.split('@')[0] : (email || 'Learner'));
    const picture = user.picture && typeof user.picture === 'string' && user.picture.trim()
        ? user.picture.trim()
        : `https://ui-avatars.com/api/?background=0ea5e9&color=fff&name=${encodeURIComponent(baseName)}`;
    const role = typeof user.role === 'string' ? user.role : 'student';
    const organizationId = user.organization_id ?? null;
    const organizationName = user.organization_name ?? null;

    return {
        ...user,
        name: baseName,
        picture,
        role,
        organization_id: organizationId,
        organization_name: organizationName,
    };
};

const DEFAULT_COLOR_SCHEME = {
    background: 'var(--nav-active-bg)',
    onBackgroundText: 'var(--nav-active-text)',
    accent: 'var(--accent)',
    accentText: 'var(--accent-text)',
    navAnsweredBg: 'var(--nav-answered-bg)',
    navAnsweredText: 'var(--nav-answered-text)',
    navDefaultBg: 'var(--nav-default-bg)',
    navDefaultText: 'var(--nav-default-text)',
    navMarkedRing: 'var(--nav-marked-ring)',
    optionSelectedBg: 'var(--accent-soft)',
    optionSelectedBorder: 'var(--accent-border)',
    optionHover: 'var(--option-hover-bg)',
    scoreBackground: 'var(--bg-overlay)',
    scoreText: 'var(--accent-text)',
    scoreBorder: 'var(--border-subtle)',
    surface: 'var(--bg-surface)',
    surfaceStrong: 'var(--bg-overlay)',
    surfaceBorder: 'var(--border-subtle)',
    divider: 'var(--border-subtle)',
    text: 'var(--text-primary)',
    mutedText: 'var(--text-secondary)',
    inputBorder: 'var(--border-subtle)',
    ring: 'var(--accent-ring)',
    timerLowBg: 'var(--timer-low-bg)',
    timerLowText: 'var(--timer-low-text)',
    timerDefaultBg: 'var(--timer-default-bg)',
    timerDefaultText: 'var(--timer-default-text)',
};

const SUBJECT_COLORS = {
    Science: {
        background: 'var(--subject-science-accent)',
        text: 'var(--subject-science-surface-text)',
        heroText: 'var(--subject-science-text)',
        border: 'var(--subject-science-border)',
        scoreBackground: 'var(--bg-overlay)',
        scoreText: 'var(--subject-science-text)',
        scoreBorder: 'var(--subject-science-border)',
        accent: 'var(--subject-science-accent)',
        accentText: 'var(--subject-science-accent-text)',
    },
    'Social Studies': {
        background: 'var(--subject-social-accent)',
        text: 'var(--subject-social-surface-text)',
        heroText: 'var(--subject-social-text)',
        border: 'var(--subject-social-border)',
        scoreBackground: 'var(--bg-overlay)',
        scoreText: 'var(--subject-social-text)',
        scoreBorder: 'var(--subject-social-border)',
        accent: 'var(--subject-social-accent)',
        accentText: 'var(--subject-social-accent-text)',
    },
    'Reasoning Through Language Arts (RLA)': {
        background: 'var(--subject-rla-accent)',
        text: 'var(--subject-rla-surface-text)',
        heroText: 'var(--subject-rla-text)',
        border: 'var(--subject-rla-border)',
        scoreBackground: 'var(--bg-overlay)',
        scoreText: 'var(--subject-rla-text)',
        scoreBorder: 'var(--subject-rla-border)',
        accent: 'var(--subject-rla-accent)',
        accentText: 'var(--subject-rla-accent-text)',
    },
    Math: {
        background: 'var(--subject-math-accent)',
        text: 'var(--math-text)',
        heroText: 'var(--subject-math-text)',
        border: 'var(--math-surface-border)',
        scoreBackground: 'var(--bg-overlay)',
        scoreText: 'var(--math-text)',
        scoreBorder: 'var(--math-surface-border)',
        accent: 'var(--subject-math-accent)',
        accentText: 'var(--subject-math-accent-text)',
        surface: 'var(--math-surface)',
        surfaceStrong: 'var(--math-surface)',
        surfaceBorder: 'var(--math-surface-border)',
        divider: 'var(--math-divider)',
        mutedText: 'var(--math-muted-text)',
        onBackgroundText: 'var(--math-text)',
    },
    Simulations: {
        background: 'var(--subject-simulations-accent)',
        text: 'var(--subject-simulations-surface-text)',
        heroText: 'var(--subject-simulations-text)',
        border: 'var(--subject-simulations-border)',
        scoreBackground: 'var(--bg-overlay)',
        scoreText: 'var(--subject-simulations-text)',
        scoreBorder: 'var(--subject-simulations-border)',
        accent: 'var(--subject-simulations-accent)',
        accentText: 'var(--subject-simulations-accent-text)',
    },
};

const SUBJECT_BG_GRADIENTS = {
    Math: 'var(--subject-math-gradient)',
    Science: 'var(--subject-science-gradient)',
    'Social Studies': 'var(--subject-social-gradient)',
    'Reasoning Through Language Arts (RLA)': 'var(--subject-rla-gradient)',
    Simulations: 'var(--subject-simulations-gradient)',
};

const SUBJECT_LIGHT_SURFACE_GRADIENTS = {
    Math: 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(2,132,199,0.12))',
    Science: 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(220,38,38,0.12))',
    'Social Studies': 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(22,163,74,0.12))',
    'Reasoning Through Language Arts (RLA)': 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(124,58,237,0.12))',
    Simulations: 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(249,115,22,0.12))',
};

const SUBJECT_LIGHT_TINTS = {
    Math: 'rgba(2,132,199,0.2)',
    Science: 'rgba(220,38,38,0.2)',
    'Social Studies': 'rgba(22,163,74,0.2)',
    'Reasoning Through Language Arts (RLA)': 'rgba(124,58,237,0.2)',
    Simulations: 'rgba(249,115,22,0.2)',
};

const SUBJECT_SHORT_LABELS = {
    Science: 'Science',
    Math: 'Math',
    'Social Studies': 'Social Studies',
    'Reasoning Through Language Arts (RLA)': 'RLA',
};

const VOCABULARY_SUBJECT_COLORS = {
    Science: '#dc2626',
    Math: '#0284c7',
    'Social Studies': '#16a34a',
    'Reasoning Through Language Arts (RLA)': '#7c3aed',
};

const MAX_TICKER_WORDS_PER_SUBJECT = 10;

const FALLBACK_VOCABULARY = {
    Science: [
        {
            term: "Hypothesis",
            definition: "A testable explanation for an observation that can be supported or refuted through experimentation.",
        },
        {
            term: "Variable",
            definition: "A factor in an experiment that can change or be controlled.",
        },
        {
            term: "Control Group",
            definition: "The group in an experiment that does not receive the independent variable and is used for comparison.",
        },
        {
            term: "Ecosystem",
            definition: "A community of living organisms interacting with each other and with their physical environment.",
        },
        {
            term: "Photosynthesis",
            definition: "The process by which plants use light energy to convert carbon dioxide and water into glucose and oxygen.",
        },
        {
            term: "Cellular Respiration",
            definition: "The process in which cells break down glucose and oxygen to release energy, carbon dioxide, and water.",
        },
        {
            term: "Mitosis",
            definition: "A type of cell division that results in two identical daughter cells.",
        },
        {
            term: "DNA",
            definition: "The molecule that carries genetic information in living organisms.",
        },
        {
            term: "Atom",
            definition: "The smallest unit of an element that retains the properties of that element.",
        },
        {
            term: "Molecule",
            definition: "Two or more atoms that are chemically bonded together.",
        },
        {
            term: "Gravity",
            definition: "The force of attraction between objects with mass.",
        },
        {
            term: "Qualitative Observation",
            definition: "An observation that describes qualities or characteristics without using numbers.",
        },
        {
            term: "Quantitative Observation",
            definition: "An observation that uses numbers or measurements to describe what is observed.",
        },
        {
            term: "Homeostasis",
            definition: "The process by which organisms maintain stable internal conditions despite external changes.",
        },
        {
            term: "Independent Variable",
            definition: "The factor that is purposely changed in an experiment to test its effect.",
        },
        {
            term: "Dependent Variable",
            definition: "The factor that is measured in an experiment and changes in response to the independent variable.",
        },
        {
            term: "Scientific Method",
            definition: "A systematic process of asking questions, forming hypotheses, conducting experiments, and drawing conclusions.",
        },
        {
            term: "Plate Tectonics",
            definition: "The theory explaining the movement of Earth's lithospheric plates and the activity at their boundaries.",
        },
        {
            term: "Fossil",
            definition: "The preserved remains, impression, or trace of an organism from the past.",
        },
        {
            term: "Energy Transfer",
            definition: "The movement of energy from one object or system to another.",
        },
    ],
    Math: [
        {
            term: "Integer",
            definition: "A whole number that can be positive, negative, or zero.",
        },
        {
            term: "Fraction",
            definition: "A number that represents a part of a whole or a part of a set.",
        },
        {
            term: "Decimal",
            definition: "A number that uses a decimal point to show a value smaller than one.",
        },
        {
            term: "Percent",
            definition: "A ratio that compares a number to 100.",
        },
        {
            term: "Ratio",
            definition: "A comparison of two quantities by division.",
        },
        {
            term: "Proportion",
            definition: "An equation stating that two ratios are equivalent.",
        },
        {
            term: "Equation",
            definition: "A mathematical statement that shows two expressions are equal.",
        },
        {
            term: "Variable",
            definition: "A symbol, usually a letter, that represents an unknown value.",
        },
        {
            term: "Coefficient",
            definition: "The number that is multiplied by a variable in an algebraic expression.",
        },
        {
            term: "Expression",
            definition: "A mathematical phrase that can contain numbers, variables, and operations.",
        },
        {
            term: "Inequality",
            definition: "A mathematical statement that compares two expressions using greater than, less than, or equal to symbols.",
        },
        {
            term: "Slope",
            definition: "A measure of the steepness of a line, found by the ratio of rise over run.",
        },
        {
            term: "Quadratic Equation",
            definition: "An equation in the form ax² + bx + c = 0, where a, b, and c are constants and a ≠ 0.",
        },
        {
            term: "Linear Function",
            definition: "A function whose graph is a straight line.",
        },
        {
            term: "Pythagorean Theorem",
            definition: "A formula that relates the side lengths of a right triangle: a² + b² = c².",
        },
        {
            term: "Mean",
            definition: "The average of a set of numbers, found by adding the numbers and dividing by how many there are.",
        },
        {
            term: "Median",
            definition: "The middle value in an ordered set of numbers.",
        },
        {
            term: "Mode",
            definition: "The number that appears most often in a set of data.",
        },
        {
            term: "Range",
            definition: "The difference between the highest and lowest values in a data set.",
        },
        {
            term: "Probability",
            definition: "The likelihood that an event will occur, expressed as a ratio, fraction, or percent.",
        },
        {
            term: "Factor",
            definition: "A number that divides another number evenly.",
        },
        {
            term: "Multiple",
            definition: "The product of a number and any whole number.",
        },
        {
            term: "Prime Number",
            definition: "A whole number greater than 1 that has exactly two factors: 1 and itself.",
        },
        {
            term: "Composite Number",
            definition: "A whole number greater than 1 that has more than two factors.",
        },
        {
            term: "Perimeter",
            definition: "The total distance around the outside of a shape.",
        },
        {
            term: "Area",
            definition: "The amount of surface covered by a shape.",
        },
        {
            term: "Volume",
            definition: "The amount of space a three-dimensional object occupies.",
        },
        {
            term: "Circumference",
            definition: "The distance around a circle.",
        },
        {
            term: "Exponent",
            definition: "A small number written above and to the right of a base number that shows how many times the base is multiplied by itself.",
        },
        {
            term: "Order of Operations",
            definition: "The rules that tell you the correct sequence to evaluate a mathematical expression (PEMDAS).",
        },
    ],
    'Reasoning Through Language Arts (RLA)': [
        {
            term: "Main Idea",
            definition: "The central point or most important concept that an author wants the reader to understand.",
        },
        {
            term: "Supporting Detail",
            definition: "Information that explains, proves, or enhances the main idea.",
        },
        {
            term: "Inference",
            definition: "A conclusion reached by using evidence from the text and your own reasoning.",
        },
        {
            term: "Tone",
            definition: "The author's attitude toward the subject or audience.",
        },
        {
            term: "Theme",
            definition: "The underlying message or lesson the author wants to convey.",
        },
        {
            term: "Thesis Statement",
            definition: "A sentence that states the main point or argument of an essay.",
        },
        {
            term: "Topic Sentence",
            definition: "The sentence that expresses the main idea of a paragraph.",
        },
        {
            term: "Transition",
            definition: "A word or phrase that connects ideas and helps writing flow smoothly.",
        },
        {
            term: "Evidence",
            definition: "Facts, examples, or details used to support a claim.",
        },
        {
            term: "Claim",
            definition: "A statement or position that requires support.",
        },
        {
            term: "Counterclaim",
            definition: "An opposing viewpoint that challenges the writer's claim.",
        },
        {
            term: "Audience",
            definition: "The specific group of readers or listeners a text is written for.",
        },
        {
            term: "Purpose",
            definition: "The reason why an author writes a text: to inform, persuade, entertain, or explain.",
        },
        {
            term: "Figurative Language",
            definition: "Words or expressions that go beyond literal meaning, such as metaphors and similes.",
        },
        {
            term: "Metaphor",
            definition: "A comparison between two unlike things without using like or as.",
        },
        {
            term: "Simile",
            definition: "A comparison between two unlike things using the words like or as.",
        },
        {
            term: "Connotation",
            definition: "The emotional or cultural meaning attached to a word.",
        },
        {
            term: "Denotation",
            definition: "The literal, dictionary definition of a word.",
        },
        {
            term: "Context Clues",
            definition: "Hints within a sentence or paragraph that help the reader determine the meaning of an unfamiliar word.",
        },
        {
            term: "Revising",
            definition: "Improving a draft by adding, removing, or rearranging ideas for clarity and effectiveness.",
        },
        {
            term: "Editing",
            definition: "Correcting grammar, spelling, and punctuation errors in a draft.",
        },
        {
            term: "Proofreading",
            definition: "Reviewing a final draft carefully to catch small errors before publishing.",
        },
        {
            term: "Persuasive Writing",
            definition: "Writing that aims to convince the reader to accept a viewpoint or take a specific action.",
        },
        {
            term: "Narrative Writing",
            definition: "Writing that tells a story with characters, setting, and plot.",
        },
        {
            term: "Informational Text",
            definition: "Nonfiction writing that provides facts about a topic.",
        },
        {
            term: "Point of View",
            definition: "The perspective from which a story is told.",
        },
        {
            term: "First-Person Point of View",
            definition: "A storytelling perspective in which the narrator is a character in the story and uses words like I and we.",
        },
        {
            term: "Third-Person Point of View",
            definition: "A storytelling perspective where the narrator is outside the story and uses words like he, she, or they.",
        },
        {
            term: "Chronological Order",
            definition: "A text structure that presents events in the order they happened.",
        },
        {
            term: "Cause and Effect",
            definition: "A text structure that explains why something happens and the result of it.",
        },
    ],
    'Social Studies': [
        {
            term: "Democracy",
            definition: "A system of government in which citizens hold the power to make decisions through voting.",
        },
        {
            term: "Republic",
            definition: "A form of government in which citizens elect representatives to make decisions on their behalf.",
        },
        {
            term: "Constitution",
            definition: "A written plan that outlines the structure, powers, and limits of a government.",
        },
        {
            term: "Amendment",
            definition: "A change or addition to a legal or governmental document, such as the U.S. Constitution.",
        },
        {
            term: "Federalism",
            definition: "A system of government in which power is divided between a national government and state governments.",
        },
        {
            term: "Separation of Powers",
            definition: "The division of government responsibilities into distinct branches to prevent any one branch from becoming too powerful.",
        },
        {
            term: "Checks and Balances",
            definition: "A system that allows each branch of government to limit the powers of the other branches.",
        },
        {
            term: "Suffrage",
            definition: "The right to vote in political elections.",
        },
        {
            term: "Civil Rights",
            definition: "The rights of citizens to political and social freedom and equality.",
        },
        {
            term: "Industrialization",
            definition: "The development of industries in a country or region on a wide scale.",
        },
        {
            term: "Urbanization",
            definition: "The growth of cities and the movement of people from rural areas to urban centers.",
        },
        {
            term: "Immigration",
            definition: "The movement of people into a country from another country.",
        },
        {
            term: "Cultural Diffusion",
            definition: "The spread of cultural beliefs and practices from one group to another.",
        },
        {
            term: "Economy",
            definition: "The system by which goods and services are produced, distributed, and consumed.",
        },
        {
            term: "Inflation",
            definition: "A general increase in prices and a decrease in the purchasing value of money.",
        },
        {
            term: "Gross Domestic Product",
            definition: "The total value of all goods and services produced in a country during a specific time period.",
        },
        {
            term: "Supply and Demand",
            definition: "The relationship between the amount of a product available and the desire of buyers for it, which affects price.",
        },
        {
            term: "Primary Source",
            definition: "An original document or firsthand account created at the time of an event.",
        },
        {
            term: "Secondary Source",
            definition: "A document or account that interprets or analyzes primary sources.",
        },
        {
            term: "Manifest Destiny",
            definition: "The 19th-century belief that the United States was destined to expand across the North American continent.",
        },
        {
            term: "Reconstruction",
            definition: "The period after the U.S. Civil War when southern states were reorganized and reintegrated into the Union.",
        },
        {
            term: "Great Depression",
            definition: "A severe worldwide economic downturn that took place during the 1930s.",
        },
        {
            term: "Cold War",
            definition: "The period of political tension and military rivalry between the United States and the Soviet Union after World War II.",
        },
        {
            term: "Bill of Rights",
            definition: "The first ten amendments to the U.S. Constitution that protect individual liberties.",
        },
        {
            term: "Legislature",
            definition: "The branch of government responsible for making laws.",
        },
        {
            term: "Executive Branch",
            definition: "The branch of government responsible for enforcing laws.",
        },
        {
            term: "Judicial Branch",
            definition: "The branch of government responsible for interpreting laws and administering justice.",
        },
        {
            term: "Monarchy",
            definition: "A form of government in which a single person, such as a king or queen, rules for life.",
        },
        {
            term: "Tariff",
            definition: "A tax imposed on imported goods.",
        },
        {
            term: "Treaty",
            definition: "A formal agreement between two or more countries.",
        },
    ],
};

function normalizeVocabularyEntry(entry) {
    if (!entry) return null;
    if (typeof entry === 'string') {
        const trimmed = entry.trim();
        return trimmed ? { term: trimmed, definition: '' } : null;
    }
    if (typeof entry !== 'object') return null;
    const term = typeof entry.term === 'string' ? entry.term.trim() : '';
    if (!term) return null;
    const definition = typeof entry.definition === 'string' ? entry.definition.trim() : '';
    const example = typeof entry.example === 'string' ? entry.example.trim() : '';
    const normalized = { term, definition };
    if (example) {
        normalized.example = example;
    }
    return normalized;
}

function mergeVocabularyData(base, override) {
    const result = { ...base };
    if (!override || typeof override !== 'object') {
        return result;
    }
    Object.entries(override).forEach(([subject, entries]) => {
        if (!Array.isArray(entries)) {
            return;
        }
        const normalizedEntries = entries
            .map(normalizeVocabularyEntry)
            .filter(Boolean);
        if (normalizedEntries.length) {
            result[subject] = normalizedEntries;
        }
    });
    return result;
}

class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props);
        this.state = { err: null };
    }

    static getDerivedStateFromError(err) {
        return { err };
    }

    componentDidCatch(err, info) {
        console.error('Render error:', err, info);
    }

    render() {
        if (this.state.err) {
            return (
                <div style={{ padding: '16px', background: '#fee2e2', color: '#991b1b', fontFamily: 'Inter, sans-serif' }}>
                    <h2 style={{ marginTop: 0 }}>Something went wrong.</h2>
                    <pre style={{ whiteSpace: 'pre-wrap' }}>{String(this.state.err)}</pre>
                </div>
            );
        }

        return this.props.children;
    }
}

const { tokenizeMathSegments, restoreMathSegments, normalizeCurrencyOutsideMath, normalizeLatexMacrosInMath, stripTextMacroInPlain, applyPhraseSpacingRepairs, addMissingBackslashesInMath, fixAllMathInText, collapseUnderscoredLatexMacros } = window.TextSanitizer || {};

const API_BASE_URL = 'https://ged-website.onrender.com';
const SCORE_FETCH_INTERVAL_MS = 45000;

async function generateTopicQuiz(subjectParam, topic, difficulty) {
    const response = await fetch(`${API_BASE_URL}/api/topic-based/${encodeURIComponent(subjectParam)}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ topic, difficulty })
    });

    let payload = null;
    try {
        payload = await response.json();
    } catch (err) {
        throw new Error('The quiz service returned invalid JSON.');
    }

    if (!response.ok) {
        const message = payload?.error || `Request failed with status ${response.status}`;
        throw new Error(message);
    }

    if (!payload?.success || !Array.isArray(payload.items)) {
        throw new Error('The quiz service returned an unexpected payload.');
    }

    return payload.items.map((item, idx) => ({ ...item, questionNumber: item.questionNumber ?? idx + 1 }));
}
const SUBJECT_PARAM_MAP = {
    'Science': 'Science',
    'Social Studies': 'Social Studies',
    'Math': 'Math',
    'Reasoning Through Language Arts (RLA)': 'RLA',
    'RLA': 'RLA'
};

const resolveSubjectParam = (subject) => {
    if (!subject) {
        return '';
    }
    return SUBJECT_PARAM_MAP[subject] || subject;
};

function applySafeMathFix(text) {
    if (typeof text !== 'string') {
        return text;
    }
    if (typeof fixAllMathInText === 'function') {
        return fixAllMathInText(text);
    }
    let working = text;
    if (typeof collapseUnderscoredLatexMacros === 'function') {
        working = collapseUnderscoredLatexMacros(working);
    }
    if (typeof addMissingBackslashesInMath === 'function') {
        return addMissingBackslashesInMath(working);
    }
    const legacy = (typeof window !== 'undefined' && window.TextSanitizer && window.TextSanitizer.addMissingBackslashesInMath);
    if (typeof legacy === 'function') {
        return legacy(working);
    }
    return working;
}

const ALLOWED_HTML_TAGS = [
    'a','b','strong','i','em','u','s','span','p','br','ul','ol','li','table','thead','tbody','tfoot','tr','th','td','caption',
    'colgroup','col','code','pre','sup','sub','div','img'
];
const ALLOWED_HTML_ATTR = ['href','title','target','rel','colspan','rowspan','align','scope','src','alt','class'];
const ENTITY_DECODER = typeof document !== 'undefined' ? document.createElement('textarea') : null;

function collapseSplitLatexCommands(source) {
    if (typeof source !== 'string' || source.length === 0) {
        return source;
    }

    let normalized = source.replace(/\\{2}(?=[A-Za-z_])/g, '\\');

    let previous;
    do {
        previous = normalized;
        normalized = normalized.replace(/([A-Za-z])\\_/g, '$1');
    } while (normalized !== previous);

    return normalized.replace(/\\([A-Za-z])(?:\\([A-Za-z]))+/g, (match) => `\\${match.replace(/\\/g, '')}`);
}

function normalizeLatex(text) {
    if (typeof text !== 'string' || text.length === 0) {
        return text;
    }

    let normalized = text;

    normalized = normalized.replace(/(?<!\\)\$([0-9]+(?:\.[0-9]{1,2})?)/g, (_match, amount) => `\\$${amount}`);

    normalized = normalized
        .replace(/\$\$([\s\S]*?)\$\$/g, '$1')
        .replace(/(?<!\\)\$([^$]*?)(?<!\\)\$/g, '$1')
        .replace(/\\\(([^]*?)\\\)/g, '$1')
        .replace(/\\\[([^]*?)\\\]/g, '$1');

    // unwrap accidentally math-wrapped currency, e.g. "$12.50$" -> "$12.50"
    normalized = normalized.replace(/\$(\s*\d+(?:[.,]\d{1,2}))\$/g, (_m, amount) => `$${amount.trim()}`);
    // close-up whitespace after literal $, e.g. "$   12" -> "$12"
    normalized = normalized.replace(/\$\s+(\d)/g, '$$1');

    normalized = normalized.replace(/\\dfrac/g, '\\frac');

    normalized = normalized
        // repair /frac, ^rac, ↑rac, stray spaces before 'rac'
        .replace(/(?:\\|\/|[\u2191\^])\s*rac\s*\{/g, '\\frac{')
        .replace(/\\frac\s+([^\s{}]+)\s+([^\s{}]+)/g, '\\frac{$1}{$2}')
        .replace(/\\frac\s*\{\s*([^{}]+?)\s*\}\s*\{\s*([^{}]+?)\s*\}/g, (_match, a, b) => `\\frac{${a.trim()}}{${b.trim()}}`);

    normalized = collapseSplitLatexCommands(normalized);

    if (typeof collapseUnderscoredLatexMacros === 'function') {
        normalized = collapseUnderscoredLatexMacros(normalized);
    }

    normalized = normalized.replace(/(?<![A-Za-z])rac\s*\{/g, '\\frac{');

    normalized = normalized.replace(/<\/?(?:table|thead|tbody|tfoot|tr|th|td|caption|colgroup|col)[^>]*>/gi, ' ');
    normalized = normalized.replace(/<[^>]+>/g, ' ');

    normalized = normalized.replace(/(?<!\\)\*/g, '\\*');

    normalized = normalized.replace(/(?<!\\)_/g, (match, offset, source) => {
        const prev = offset > 0 ? source[offset - 1] : '';
        if (/^[A-Za-z0-9)]$/.test(prev)) {
            return match;
        }
        return '\\_';
    });

    return normalized.replace(/\s{2,}/g, ' ').trim();
}

function normalizeLatexForKaTeX(latex) {
    if (typeof latex !== 'string') return latex;
    return latex
        .replace(/\\\\([A-Za-z]+)/g, '\\$1')
        .replace(/\\left\s*/g, '')
        .replace(/\\right\s*/g, '');
}

const KATEX_RENDER_OPTIONS = { throwOnError: false, strict: 'ignore' };

function renderLatexToHtml(latexInput) {
    if (typeof latexInput !== 'string') {
        return '';
    }
    if (typeof katex === 'undefined') {
        throw new Error('KaTeX not available');
    }
    const latex = normalizeLatexForKaTeX(latexInput);
    if (typeof document !== 'undefined' && typeof document.createElement === 'function' && typeof katex.render === 'function') {
        const container = document.createElement('span');
        katex.render(latex, container, KATEX_RENDER_OPTIONS);
        return container.innerHTML;
    }
    if (typeof katex.renderToString === 'function') {
        return katex.renderToString(latex, KATEX_RENDER_OPTIONS);
    }
    throw new Error('KaTeX render helpers missing');
}

function normalizeFormulaLatex(latex) {
    if (typeof latex !== 'string') {
        return '';
    }

    let working = latex;

    try {
        working = applySafeMathFix(working);
    } catch (error) {
        console.warn('Failed to sanitize formula latex:', error?.message || error);
    }

    try {
        working = normalizeLatex(working);
    } catch (error) {
        console.warn('Failed to normalize formula latex:', error?.message || error);
    }

    return working;
}

function smartWrapLatex(input) {
    if (typeof input !== 'string' || input.length === 0) {
        return input;
    }

    const slots = [];
    const masked = input.replace(/\\\([^\)]*\\\)|\$[^$]+\$/g, (match) => {
        slots.push(match);
        return `@@M${slots.length - 1}@@`;
    });

    const MACRO_PATTERN = /\\(?:frac|sqrt|text|pi|times|cdot|le|ge|lt|gt|neq|approx|sin|cos|tan|log|ln|pm|mp|theta|alpha|beta|gamma)\b/y;

    const grabBraces = (source, start) => {
        if (source[start] !== '{') {
            return 0;
        }
        let depth = 0;
        let index = start;
        while (index < source.length) {
            const ch = source[index++];
            if (ch === '{') {
                depth += 1;
            } else if (ch === '}') {
                depth -= 1;
                if (depth === 0) {
                    return index - start;
                }
            }
        }
        return 0;
    };

    let result = '';
    let cursor = 0;

    while (cursor < masked.length) {
        const char = masked[cursor];
        if (char === '\\') {
            MACRO_PATTERN.lastIndex = cursor;
            const match = MACRO_PATTERN.exec(masked);
            if (match) {
                let end = MACRO_PATTERN.lastIndex;
                if (match[0] === '\\frac') {
                    const first = grabBraces(masked, end);
                    if (first) {
                        end += first;
                        const second = grabBraces(masked, end);
                        if (second) {
                            end += second;
                        }
                    }
                } else {
                    const groupLen = grabBraces(masked, end);
                    if (groupLen) {
                        end += groupLen;
                    }
                }
                const segment = masked.slice(cursor, end);
                result += `\\(${segment}\\)`;
                cursor = end;
                continue;
            }
        }
        result += char;
        cursor += 1;
    }

    // Sanity cases:
    // equation \frac{x}{4} = \frac{15}{20}?
    // 1\frac{1}{2} cups
    // no more than \text{P500}, spent \text{P120}
    // /frac{3}{4}, ^rac{2}{3}, ↑rac{1}{2}

    return result.replace(/@@M(\d+)@@/g, (_match, index) => slots[Number(index)]);
}

function escapeHtml(value) {
    if (typeof value !== 'string' || value.length === 0) {
        return '';
    }
    return value
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
}

function stripLeakedMathPlaceholders(text) {
    if (typeof text !== 'string' || text.length === 0) {
        return text;
    }
    return text
        .replace(/(?:\f|\\f)\\?_?MATH_SEGMENT_[A-Z0-9]+/gi, '')
        .replace(/MATH_SEGMENT_[A-Z0-9]+/gi, '');
}

function formatExponents(input) {
    if (typeof input !== 'string') return input;

    const safe = input
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;");

    return safe.replace(/([A-Za-z0-9\)])\^(\d+)/g, (_, base, exp) => `${base}<sup>${exp}</sup>`);
}

function renderStem(text) {
    if (typeof text !== 'string') {
        return '';
    }

    const cleanedText = preprocessRawContent(text, { normalizeSpacing: true });
    const segments = extractMathSegments(cleanedText);
    const renderedParts = [];

    for (const segment of segments) {
        if (segment.type === 'math') {
            const pretty = formatExponents(segment.value);
            renderedParts.push(`<span class="math-inline">${pretty}</span>`);
        } else {
            renderedParts.push(segment.value);
        }
    }

    const combinedHtml = renderedParts.join('');
    return DOMPurify.sanitize(combinedHtml, {
        ALLOWED_TAGS: [...ALLOWED_HTML_TAGS, 'span', 'sup', 'path', 'svg'],
        ALLOWED_ATTR: [...ALLOWED_HTML_ATTR, 'style', 'd', 'viewBox', 'xmlns']
    });
}

// Render KaTeX for premade/static quizzes only; leaves AI/dynamic to renderStem
function renderStemWithKatex(text) {
    if (typeof text !== 'string') return '';

    // Work on RAW text: do not preprocess away math delimiters for premade content
    const segments = extractMathSegments(text);
    const parts = [];

    const moneyRegex = /^\$\d+(?:\.\d{1,2})?$/; // "$16" or "$12.50"
    const pureNumber = /^\d+(?:\.\d{1,2})?$/;     // 16 or 12.50

    for (const seg of segments.length ? segments : [{ type: 'text', value: text }]) {
        if (seg.type !== 'math') {
            // Sanitize non-math text directly; keep allowed tags minimal
            parts.push(typeof DOMPurify !== 'undefined'
                ? DOMPurify.sanitize(seg.value, { ALLOWED_TAGS: ALLOWED_HTML_TAGS, ALLOWED_ATTR: ALLOWED_HTML_ATTR })
                : escapeHtml(seg.value));
            continue;
        }

        const raw = seg.raw || '';
        const body = (seg.value || '').trim();

        // Money guard: If raw has single-dollar delimiters and body is a plain number, treat as currency text
        const isSingleDollarWrapped = /^\$[^$][\s\S]*\$$/.test(raw) && !/^\$\$[\s\S]*\$\$/.test(raw);
        const isPlainMoney = isSingleDollarWrapped && pureNumber.test(body);

        if (isPlainMoney) {
            const escaped = `\\$${body}`;
            parts.push(`<span class="math-inline">${escaped}</span>`);
            continue;
        }

        // Also handle the rare case where the content itself starts with $digits ... within other delimiters
        if (moneyRegex.test(body)) {
            const escaped = body.replace(/^\$/,'\\$');
            parts.push(`<span class="math-inline">${escaped}</span>`);
            continue;
        }

        try {
            const html = katex.renderToString(body, { throwOnError: false, displayMode: Boolean(seg.displayMode) });
            parts.push(html);
        } catch (e) {
            // Fallback to plain sanitized text for this segment
            const safe = typeof DOMPurify !== 'undefined'
                ? DOMPurify.sanitize(body, { ALLOWED_TAGS: ALLOWED_HTML_TAGS, ALLOWED_ATTR: ALLOWED_HTML_ATTR })
                : escapeHtml(body);
            parts.push(`<span class="math-inline">${safe}</span>`);
        }
    }

    const combined = parts.join('');
    // Final pass sanitize
    return typeof DOMPurify !== 'undefined'
        ? DOMPurify.sanitize(combined, { ALLOWED_TAGS: [...ALLOWED_HTML_TAGS, 'span', 'sup', 'svg', 'path'], ALLOWED_ATTR: [...ALLOWED_HTML_ATTR, 'style', 'd', 'viewBox', 'xmlns'] })
        : combined;
}

const GEOMETRY_FIGURES_ENABLED = Boolean(
    typeof window !== 'undefined' &&
    window.__APP_CONFIG__ &&
    window.__APP_CONFIG__.geometryFiguresEnabled
);

const DEFAULT_FIGURE_STYLE = {
    stroke: '#000000',
    fill: 'rgba(96, 165, 250, 0.12)',
    labelColor: '#000000',
    pointFill: '#ffffff'
};

const normalizeNumber = value => {
    if (typeof value === 'number') return value;
    const parsed = Number(value);
    return Number.isFinite(parsed) ? parsed : undefined;
};

const normalizePoint = (point = {}) => {
    const x = normalizeNumber(point.x);
    const y = normalizeNumber(point.y);
    if (typeof x !== 'number' || typeof y !== 'number') {
        return undefined;
    }
    return {
        x,
        y,
        label: typeof point.label === 'string' ? point.label : undefined
    };
};

const mapPoints = list => {
    if (!Array.isArray(list)) return [];
    return list.map(normalizePoint).filter(Boolean);
};

const midpoint = (a, b) => ({
    x: (a.x + b.x) / 2,
    y: (a.y + b.y) / 2
});

const findPointByLabel = (points, label) => {
    if (!label) return undefined;
    return points.find(pt => pt.label === label);
};

const renderPointMarkers = (points, style) => {
    return points.map((pt, index) => (
        <g key={`pt-${index}`}>
            <circle cx={pt.x} cy={pt.y} r={1.8} fill={style.pointFill} stroke={style.stroke} strokeWidth={0.6} />
            {pt.label && (
                <text x={pt.x + 2.8} y={pt.y - 2.2} fontSize={6} fill={style.labelColor}>
                    {pt.label}
                </text>
            )}
        </g>
    ));
};

const renderSideLabels = (points, sideLabels = [], style) => {
    if (!Array.isArray(sideLabels)) return [];
    return sideLabels.map((entry, index) => {
        if (!entry || !Array.isArray(entry.between) || entry.between.length !== 2 || typeof entry.text !== 'string') {
            return null;
        }
        const a = findPointByLabel(points, entry.between[0]);
        const b = findPointByLabel(points, entry.between[1]);
        if (!a || !b) return null;
        const mid = midpoint(a, b);
        return (
            <text key={`side-label-${index}`} x={mid.x} y={mid.y - 1.5} fontSize={6} textAnchor="middle" fill={style.labelColor}>
                {entry.text}
            </text>
        );
    }).filter(Boolean);
};

const renderAdditionalLabels = (labels = [], style) => {
    if (!Array.isArray(labels)) return [];
    return labels.map((label, index) => {
        const normalized = normalizePoint(label);
        if (!normalized || typeof label.text !== 'string') {
            return null;
        }
        const dx = normalizeNumber(label.dx) || 0;
        const dy = normalizeNumber(label.dy) || 0;
        return (
            <text key={`label-${index}`} x={normalized.x + dx} y={normalized.y + dy} fontSize={6} textAnchor={label.textAnchor || 'middle'} fill={style.labelColor}>
                {label.text}
            </text>
        );
    }).filter(Boolean);
};

const renderSegments = (segments = [], style) => {
    if (!Array.isArray(segments)) return [];
    return segments.map((segment, index) => {
        if (!segment || !Array.isArray(segment.from) || !Array.isArray(segment.to)) {
            return null;
        }
        const from = segment.from.map(normalizeNumber);
        const to = segment.to.map(normalizeNumber);
        if (from.length !== 2 || to.length !== 2 || from.some(v => typeof v !== 'number') || to.some(v => typeof v !== 'number')) {
            return null;
        }
        const dashArray = segment.dashed ? '4,3' : undefined;
        const labelText = typeof segment.label === 'string' ? segment.label : null;
        const labelOffset = Array.isArray(segment.labelOffset) ? segment.labelOffset.map(normalizeNumber) : [];
        const mid = { x: (from[0] + to[0]) / 2, y: (from[1] + to[1]) / 2 };

        return (
            <g key={`segment-${index}`}>
                <line x1={from[0]} y1={from[1]} x2={to[0]} y2={to[1]} stroke={style.stroke} strokeWidth={1} strokeDasharray={dashArray} />
                {labelText && (
                    <text x={mid.x + (labelOffset[0] || 0)} y={mid.y + (labelOffset[1] || -2)} fontSize={6} textAnchor="middle" fill={style.labelColor}>
                        {labelText}
                    </text>
                )}
            </g>
        );
    }).filter(Boolean);
};

const polygonRenderer = (params = {}, style, { includeRightAngle } = {}) => {
    const points = mapPoints(params.points);
    if (points.length < 3) return null;

    const polygonPoints = points.map(pt => `${pt.x},${pt.y}`).join(' ');
    const elements = [
        <polygon key="polygon" points={polygonPoints} fill={style.fill} stroke={style.stroke} strokeWidth={1.5} />,
        ...renderPointMarkers(points, style),
        ...renderSideLabels(points, params.sideLabels, style),
        ...renderAdditionalLabels(params.labels, style),
        ...renderSegments(params.segments, style)
    ];

    if (includeRightAngle && params.rightAngle) {
        const vertexLabel = params.rightAngle.vertex;
        const size = normalizeNumber(params.rightAngle.size) || 8;
        const vertex = findPointByLabel(points, vertexLabel) || points[0];
        const vertexIndex = points.findIndex(pt => pt === vertex);
        const prev = points[(vertexIndex - 1 + points.length) % points.length];
        const next = points[(vertexIndex + 1) % points.length];
        if (prev && next) {
            const v1 = { x: prev.x - vertex.x, y: prev.y - vertex.y };
            const v2 = { x: next.x - vertex.x, y: next.y - vertex.y };
            const len1 = Math.hypot(v1.x, v1.y) || 1;
            const len2 = Math.hypot(v2.x, v2.y) || 1;
            const u1 = { x: (v1.x / len1) * size, y: (v1.y / len1) * size };
            const u2 = { x: (v2.x / len2) * size, y: (v2.y / len2) * size };
            const p1 = { x: vertex.x + u1.x, y: vertex.y + u1.y };
            const p2 = { x: p1.x + u2.x, y: p1.y + u2.y };
            const p3 = { x: vertex.x + u2.x, y: vertex.y + u2.y };
            elements.push(
                <polygon
                    key="right-angle"
                    points={`${vertex.x},${vertex.y} ${p1.x},${p1.y} ${p2.x},${p2.y} ${p3.x},${p3.y}`}
                    fill="rgba(30, 64, 175, 0.12)"
                    stroke={style.stroke}
                    strokeWidth={0.8}
                />
            );
        }
    }

    return {
        elements,
        pointsForBounds: points
    };
};

const rectangleRenderer = (params = {}, style) => {
    const origin = normalizePoint(params.origin) || { x: 15, y: 15 };
    const width = normalizeNumber(params.width);
    const height = normalizeNumber(params.height);
    if (typeof width !== 'number' || typeof height !== 'number') return null;
    const points = [
        origin,
        { x: origin.x + width, y: origin.y },
        { x: origin.x + width, y: origin.y + height },
        { x: origin.x, y: origin.y + height }
    ];

    const base = polygonRenderer({ points, labels: params.labels, sideLabels: params.sideLabels, segments: params.segments }, style);
    if (!base) return null;
    return base;
};

const circleRenderer = (params = {}, style) => {
    const center = normalizePoint(params.center) || { x: 50, y: 50 };
    const radius = normalizeNumber(params.radius);
    if (typeof radius !== 'number') return null;
    const points = mapPoints(params.points);
    const elements = [
        <circle key="circle" cx={center.x} cy={center.y} r={radius} fill={style.fill} stroke={style.stroke} strokeWidth={1.5} />,
        ...renderPointMarkers(points, style),
        ...renderAdditionalLabels(params.labels, style),
        ...renderSegments(params.segments, style)
    ];

    if (params.radiusLabel) {
        elements.push(
            <text key="radius-label" x={center.x + radius / 2} y={center.y - 2} fontSize={6} textAnchor="middle" fill={style.labelColor}>
                {params.radiusLabel}
            </text>
        );
    }

    if (params.showRadius !== false) {
        elements.push(
            <line key="radius-line" x1={center.x} y1={center.y} x2={center.x + radius} y2={center.y} stroke={style.stroke} strokeWidth={1} strokeDasharray="4,3" />
        );
    }

    return {
        elements,
        pointsForBounds: [...points, { x: center.x + radius, y: center.y }, { x: center.x - radius, y: center.y }, { x: center.x, y: center.y + radius }, { x: center.x, y: center.y - radius }]
    };
};

const regularPolygonRenderer = (params = {}, style) => {
    const center = normalizePoint(params.center) || { x: 50, y: 50 };
    const radius = normalizeNumber(params.radius);
    const sides = Math.max(3, Math.floor(normalizeNumber(params.sides) || 0));
    if (typeof radius !== 'number' || !Number.isFinite(sides) || sides < 3) return null;
    const startAngle = (normalizeNumber(params.startAngle) || -90) * (Math.PI / 180);
    const points = Array.from({ length: sides }).map((_, index) => {
        const angle = startAngle + (index * 2 * Math.PI) / sides;
        return {
            x: center.x + radius * Math.cos(angle),
            y: center.y + radius * Math.sin(angle),
            label: params.pointLabels && params.pointLabels[index] ? params.pointLabels[index] : undefined
        };
    });

    return polygonRenderer({ points, labels: params.labels, sideLabels: params.sideLabels, segments: params.segments }, style);
};

const angleRenderer = (params = {}, style) => {
    const vertex = normalizePoint(params.vertex);
    const ray1 = normalizePoint(params.ray1);
    const ray2 = normalizePoint(params.ray2);
    if (!vertex || !ray1 || !ray2) return null;

    const pointsForBounds = [vertex, ray1, ray2];
    const elements = [
        <line key="ray1" x1={vertex.x} y1={vertex.y} x2={ray1.x} y2={ray1.y} stroke={style.stroke} strokeWidth={1.2} />,
        <line key="ray2" x1={vertex.x} y1={vertex.y} x2={ray2.x} y2={ray2.y} stroke={style.stroke} strokeWidth={1.2} />,
        ...renderPointMarkers([vertex, ray1, ray2], style),
        ...renderAdditionalLabels(params.labels, style),
        ...renderSegments(params.segments, style)
    ];

    const angleLabel = typeof params.angleLabel === 'string' ? params.angleLabel : null;
    const radius = normalizeNumber(params.arcRadius) || 12;

    const drawAngleArc = () => {
        const startVec = { x: ray1.x - vertex.x, y: ray1.y - vertex.y };
        const endVec = { x: ray2.x - vertex.x, y: ray2.y - vertex.y };
        const startAngle = Math.atan2(startVec.y, startVec.x);
        let endAngle = Math.atan2(endVec.y, endVec.x);
        while (endAngle < startAngle) {
            endAngle += Math.PI * 2;
        }
        const arcSweep = endAngle - startAngle;
        const largeArcFlag = arcSweep > Math.PI ? 1 : 0;
        const arcEnd = {
            x: vertex.x + radius * Math.cos(endAngle),
            y: vertex.y + radius * Math.sin(endAngle)
        };
        const arcStart = {
            x: vertex.x + radius * Math.cos(startAngle),
            y: vertex.y + radius * Math.sin(startAngle)
        };

        elements.push(
            <path
                key="angle-arc"
                d={`M ${arcStart.x} ${arcStart.y} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${arcEnd.x} ${arcEnd.y}`}
                fill="none"
                stroke={style.stroke}
                strokeWidth={1}
            />
        );

        if (angleLabel) {
            const labelAngle = startAngle + arcSweep / 2;
            const labelPoint = {
                x: vertex.x + (radius + 6) * Math.cos(labelAngle),
                y: vertex.y + (radius + 6) * Math.sin(labelAngle)
            };
            elements.push(
                <text key="angle-label" x={labelPoint.x} y={labelPoint.y} fontSize={6} textAnchor="middle" fill={style.labelColor}>
                    {angleLabel}
                </text>
            );
        }
    };

    drawAngleArc();

    return { elements, pointsForBounds };
};

const cylinderNetRenderer = (params = {}, style) => {
    const radius = Math.abs(normalizeNumber(params.radius));
    const height = Math.abs(normalizeNumber(params.height));
    if (!Number.isFinite(radius) || !Number.isFinite(height)) return null;
    const circumference = 2 * Math.PI * radius;
    const rectWidth = Math.max(circumference, radius * 4);
    const rectHeight = height;
    const padding = 10;
    const topCenter = { x: padding + rectWidth / 2, y: padding + radius }; // radius used as circle radius on diagram scale
    const bottomCenter = { x: padding + rectWidth / 2, y: padding + rectHeight + radius * 3 };

    const elements = [
        <rect key="lateral" x={padding} y={padding + radius * 2} width={rectWidth} height={rectHeight} fill={style.fill} stroke={style.stroke} strokeWidth={1.2} />,
        <circle key="top-circle" cx={topCenter.x} cy={topCenter.y} r={radius * 1.5} fill={style.fill} stroke={style.stroke} strokeWidth={1.2} />, // scaled for clarity
        <circle key="bottom-circle" cx={bottomCenter.x} cy={bottomCenter.y} r={radius * 1.5} fill={style.fill} stroke={style.stroke} strokeWidth={1.2} />,
        <text key="height-label" x={padding + rectWidth + 6} y={padding + radius * 2 + rectHeight / 2} fontSize={6} fill={style.labelColor}>
            h = {height}
        </text>,
        <text key="circumference-label" x={padding + rectWidth / 2} y={padding + radius * 2 + rectHeight + 8} fontSize={6} textAnchor="middle" fill={style.labelColor}>
            circumference = {circumference.toFixed(2)}
        </text>,
        <text key="radius-label-top" x={topCenter.x + radius * 1.5 + 6} y={topCenter.y} fontSize={6} fill={style.labelColor}>
            r = {radius}
        </text>,
        ...renderAdditionalLabels(params.labels, style)
    ];

    return {
        elements,
        pointsForBounds: [
            { x: padding, y: padding },
            { x: padding + rectWidth, y: padding + radius * 2 + rectHeight },
            { x: bottomCenter.x + radius * 1.5, y: bottomCenter.y + radius * 1.5 }
        ]
    };
};

const rectPrismNetRenderer = (params = {}, style) => {
    const length = Math.abs(normalizeNumber(params.length));
    const width = Math.abs(normalizeNumber(params.width));
    const height = Math.abs(normalizeNumber(params.height));
    if (!Number.isFinite(length) || !Number.isFinite(width) || !Number.isFinite(height)) return null;

    const padding = 10;
    const scale = 1;
    const L = length * scale;
    const W = width * scale;
    const H = height * scale;

    const elements = [];
    const pointsForBounds = [];

    const drawRect = (x, y, w, h, key, label) => {
        elements.push(<rect key={key} x={x} y={y} width={w} height={h} fill={style.fill} stroke={style.stroke} strokeWidth={1.2} />);
        if (label) {
            elements.push(
                <text key={`${key}-label`} x={x + w / 2} y={y + h / 2} fontSize={6} textAnchor="middle" fill={style.labelColor}>
                    {label}
                </text>
            );
        }
        pointsForBounds.push({ x, y }, { x: x + w, y: y + h });
    };

    const startX = padding + W;
    const startY = padding + H;

    drawRect(startX, startY, L, H, 'front', `h = ${height}`);
    drawRect(startX + L, startY, W, H, 'right', `w = ${width}`);
    drawRect(startX - W, startY, W, H, 'left', `w = ${width}`);
    drawRect(startX + L + W, startY, W, H, 'extra', '');
    drawRect(startX, startY - H, L, H, 'top', `l = ${length}`);
    drawRect(startX, startY + H, L, H, 'bottom', `l = ${length}`);

    elements.push(...renderAdditionalLabels(params.labels, style));

    return { elements, pointsForBounds };
};

const geometryRenderers = {
    triangle: (params, style) => polygonRenderer(params, style || DEFAULT_FIGURE_STYLE, {}),
    right_triangle: (params, style) => polygonRenderer(params, style || DEFAULT_FIGURE_STYLE, { includeRightAngle: true }),
    rectangle: (params, style) => rectangleRenderer(params, style || DEFAULT_FIGURE_STYLE),
    circle: (params, style) => circleRenderer(params, style || DEFAULT_FIGURE_STYLE),
    polygon: (params, style) => polygonRenderer(params, style || DEFAULT_FIGURE_STYLE, {}),
    regular_polygon: (params, style) => regularPolygonRenderer(params, style || DEFAULT_FIGURE_STYLE),
    line_angle: (params, style) => angleRenderer(params, style || DEFAULT_FIGURE_STYLE),
    cylinder_net: (params, style) => cylinderNetRenderer(params, style || DEFAULT_FIGURE_STYLE),
    rect_prism_net: (params, style) => rectPrismNetRenderer(params, style || DEFAULT_FIGURE_STYLE)
};

function GeometryFigure({ spec, className }) {
    if (!GEOMETRY_FIGURES_ENABLED || !spec || typeof spec !== 'object') {
        return null;
    }

    const style = {
        ...DEFAULT_FIGURE_STYLE,
        ...(spec.style || {})
    };

    const renderer = geometryRenderers[spec.shape];
    if (!renderer) {
        console.warn('Unsupported geometry shape:', spec.shape);
        return null;
    }

    const renderResult = renderer(spec.params || {}, style);
    if (!renderResult) {
        return null;
    }

    const points = renderResult.pointsForBounds && renderResult.pointsForBounds.length > 0
        ? renderResult.pointsForBounds
        : [{ x: 0, y: 0 }, { x: 100, y: 100 }];

    let minX = Math.min(...points.map(pt => pt.x));
    let maxX = Math.max(...points.map(pt => pt.x));
    let minY = Math.min(...points.map(pt => pt.y));
    let maxY = Math.max(...points.map(pt => pt.y));

    if (spec.view) {
        const { xMin, xMax, yMin, yMax } = spec.view;
        if (typeof xMin === 'number') minX = Math.min(minX, xMin);
        if (typeof xMax === 'number') maxX = Math.max(maxX, xMax);
        if (typeof yMin === 'number') minY = Math.min(minY, yMin);
        if (typeof yMax === 'number') maxY = Math.max(maxY, yMax);
    }

    const padding = (spec.view && typeof spec.view.padding === 'number') ? spec.view.padding : 8;
    const width = Math.max(maxX - minX, 20);
    const height = Math.max(maxY - minY, 20);

    const viewBox = `${minX - padding} ${minY - padding} ${width + padding * 2} ${height + padding * 2}`;

    return (
        <svg
            className={className}
            viewBox={viewBox}
            xmlns="http://www.w3.org/2000/svg"
            role="img"
            aria-label="Geometry figure"
            preserveAspectRatio="xMidYMid meet"
        >
            {renderResult.elements}
        </svg>
    );
}

function postRenderGuardrails(container, { itemIndex } = {}) {
    if (!container || typeof document === 'undefined' || typeof NodeFilter === 'undefined' || !container.innerHTML) {
        return;
    }

    const issues = new Set();
    const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null);
    const tableTextNodes = [];
    while (walker.nextNode()) {
        const currentNode = walker.currentNode;
        if (!currentNode || !currentNode.nodeValue) continue;
        const value = currentNode.nodeValue;
        if (/<\s*(?:tr|th|td)/i.test(value)) {
            tableTextNodes.push(currentNode);
        }
    }

    tableTextNodes.forEach(node => {
        if (!node.parentNode) return;
        const codeEl = document.createElement('code');
        codeEl.className = 'raw-html-fragment';
        codeEl.textContent = node.nodeValue;
        node.parentNode.replaceChild(codeEl, node);
        issues.add('tableMarkup');
    });

    if (issues.size > 0) {
        const context = typeof itemIndex !== 'undefined' ? ` for item ${itemIndex}` : '';
        console.warn(`[MathText] Post-render guardrails triggered${context}: ${Array.from(issues).join(', ')}`);
    }
}

function MathText({ text, className, subject }) {
    if (typeof text !== 'string' || text.trim() === '') {
        return <span className={className}></span>;
    }

    let renderedHtml;

    // ONLY run the complex math/currency renderer for the Math subject.
    if (subject === 'Math') {
        renderedHtml = renderStem(text);
    } else {
        // For all other subjects, just sanitize the HTML and display it.
        renderedHtml = DOMPurify.sanitize(text);
    }

    const formattedHtml = formatFractions(renderedHtml);

    return <span className={className} dangerouslySetInnerHTML={{ __html: formattedHtml }} />;
}

function renderQuestionTextForDisplay(text, isPremade) {
    const useKatex = Boolean(
        window.__APP_CONFIG__ && window.__APP_CONFIG__.premadeUsesKatex === true && isPremade === true
    );
    const html = useKatex ? renderStemWithKatex(text) : renderStem(text);
    return { __html: html };
}

function normalizeLineBreaks(value) {
    if (typeof value !== 'string') return value;
    return value
        .replace(/\r\n?/g, '\n')
        .replace(/([^\n])\n(?!\n)/g, '$1 ')
        .replace(/\n{3,}/g, '\n\n');
}

function surroundOperatorWithSpaces(source, match, offset) {
    const before = offset > 0 ? source[offset - 1] : '';
    const after = offset + match.length < source.length ? source[offset + match.length] : '';
    const isAlphaBefore = before && /[A-Za-z]/.test(before);
    const isAlphaAfter = after && /[A-Za-z]/.test(after);
    if (isAlphaBefore || isAlphaAfter) {
        return match;
    }
    const trimmed = match.replace(/\s+/g, ' ').trim();
    const leading = before && !/[\s\n]/.test(before) ? ' ' : '';
    const trailing = after && !/[\s\n]/.test(after) ? ' ' : '';
    return `${leading}${trimmed}${trailing}`;
}

function normalizePunctuationSpacing(value) {
    if (typeof value !== 'string') return value;
    let result = value.replace(/([.,;:!?])(?=\S)/g, (match, punct, offset, string) => {
        const nextChar = string[offset + match.length];
        if (!nextChar) return match;
        if (/\s/.test(nextChar)) return match;
        if ((punct === ':' || punct === ',' || punct === '.') && /[0-9]/.test(nextChar)) {
            return match;
        }
        if ((punct === ':' || punct === '.') && nextChar === '/') {
            return match;
        }
        return `${punct} `;
    });
    const wordOperators = ['plus', 'minus', 'times'];
    wordOperators.forEach(op => {
        const regex = new RegExp(op, 'gi');
        result = result.replace(regex, (match, offset, string) => surroundOperatorWithSpaces(string, match, offset));
    });
    const dividedRegex = /divided\s+by/gi;
    result = result.replace(dividedRegex, (match, offset, string) => surroundOperatorWithSpaces(string, match, offset));
    result = result.replace(/[^\S\r\n]+([.,;:!?])/g, '$1');
    result = result.replace(/[^\S\r\n]{2,}/g, ' ');
    return result;
}

const LATEX_CONTROL_CHAR_ESCAPE = {
    '\f': 'f',
    '\n': 'n',
    '\t': 't',
    '\r': 'r',
    '\b': 'b',
    '\v': 'v'
};

function escapeLatexControlCharacters(input) {
    return input.replace(/[\f\n\t\r\b\v]/g, char => {
        const replacement = LATEX_CONTROL_CHAR_ESCAPE[char];
        return replacement ? `\\${replacement}` : char;
    });
}

function repairLatexCorruption(value) {
    if (typeof value !== 'string') return value;
    let working = value.replace(/(?:\^|\f)rac\{/gi, '\\frac{');
    working = working.replace(/\$\$([\s\S]+?)\$\$/g, (_, inner) => `$$${escapeLatexControlCharacters(inner)}$$`);
    working = working.replace(/\$([\s\S]+?)\$/g, (_, inner) => `$${escapeLatexControlCharacters(inner)}$`);
    working = working.replace(/\\\(([\s\S]+?)\\\)/g, (_, inner) => `\\(${escapeLatexControlCharacters(inner)}\\)`);
    return working;
}

function decodeHtmlEntities(value) {
    if (typeof value !== 'string') return '';
    if (!ENTITY_DECODER) return value;
    ENTITY_DECODER.innerHTML = value;
    return ENTITY_DECODER.value;
}

function neutralizeUnpairedDollarSigns(text) {
    if (typeof text !== 'string' || text.indexOf('$') === -1) {
        return text;
    }

    if (!(tokenizeMathSegments && restoreMathSegments)) {
        return text.replace(/(^|[^\\])\$(?!\d)/g, (_, prefix) => `${prefix}&#36;`);
    }

    const { masked, segments } = tokenizeMathSegments(text);
    const working = masked.replace(/(^|[^\\])\$(?!\d)/g, (_, prefix) => `${prefix}&#36;`);
    return restoreMathSegments(working, segments);
}

function escapeCurrencyDollarsMathSafe(input) {
    if (typeof input !== 'string') return input;

    if (!(tokenizeMathSegments && restoreMathSegments)) {
        let fallback = input.replace(/\\$(\s*\d[\d.,]*)/g, '&#36;$1');
        fallback = fallback.replace(/(\d[\d.,]*)(\s*)\$(?!\d)/g, '&#36;$1');
        return fallback.replace(/(^|[^&])\$(?!\d)/g, (_, prefix) => `${prefix}&#36;`);
    }

    const { masked, segments } = tokenizeMathSegments(input);
    let working = masked.replace(/\\$(\s*\d[\d.,]*)/g, '&#36;$1');
    working = working.replace(/(\d[\d.,]*)(\s*)\$(?!\d)/g, '&#36;$1');
    working = working.replace(/(^|[^&])\$(?!\d)/g, (_, prefix) => `${prefix}&#36;`);
    return restoreMathSegments(working, segments);
}

function stripBackslashesOutsideMath(input) {
    if (typeof input !== 'string') return input;

    if (!(tokenizeMathSegments && restoreMathSegments)) {
        return input.replace(/\\(?=\d|\$)/g, '');
    }

    const { masked, segments } = tokenizeMathSegments(input);
    const cleaned = masked.replace(/\\(?=\d|\$)/g, '');
    return restoreMathSegments(cleaned, segments);
}

function deglueCommonBigrams(s) {
    if (typeof s !== 'string') return s;
    const replacements = {
        inthe: 'in the',
        ofthe: 'of the',
        forthe: 'for the',
        tothe: 'to the',
        theof: 'the of'
    };

    return s.replace(/\b(inthe|ofthe|forthe|tothe|theof)\b/gi, (match) => {
        const replacement = replacements[match.toLowerCase()];
        if (!replacement) {
            return match;
        }
        if (match === match.toUpperCase()) {
            return replacement.toUpperCase();
        }
        if (match[0] === match[0].toUpperCase()) {
            return replacement.charAt(0).toUpperCase() + replacement.slice(1);
        }
        return replacement;
    });
}

function addSpacesAroundInlineMath(s) {
    if (typeof s !== 'string') return s;
    return s
        .replace(/([A-Za-z])\$(?!\$)/g, '$1 $')
        .replace(/\$(?!\$)([A-Za-z])/g, ' $1');
}

function repairSpacedTags(s) {
    if (typeof s !== 'string') return s;
    return s
        .replace(/<\s*\/\s*([a-z]+)\s*>/gi, '</$1>')
        .replace(/<\s*([a-z]+)(\s[^>]*)?>/gi, (_, tagName, attrs = '') => {
            const normalizedAttrs = attrs ? attrs.replace(/\s+$/, '') : '';
            return `<${tagName}${normalizedAttrs}>`;
        });
}

function protectTables(text) {
    if (typeof text !== 'string' || text.toLowerCase().indexOf('<table') === -1) {
        return text;
    }

    return text.replace(/<table[\s\S]*?<\/table>/gi, (tableContent) =>
        tableContent.replace(/\$/g, '&#36;')
    );
}

function preprocessRawContent(value, { normalizeSpacing = false } = {}) {
    if (typeof value !== 'string') return '';
    let working = normalizeLineBreaks(value);
    if (normalizeSpacing) {
        working = normalizePunctuationSpacing(working);
    }
    working = repairLatexCorruption(working);
    working = decodeHtmlEntities(working);

    if (tokenizeMathSegments && restoreMathSegments) {
        const { masked, segments } = tokenizeMathSegments(working);
        let plain = masked;
        if (stripTextMacroInPlain) {
            plain = stripTextMacroInPlain(plain);
        }
        if (applyPhraseSpacingRepairs) {
            plain = applyPhraseSpacingRepairs(plain);
        }
        if (normalizeCurrencyOutsideMath) {
            plain = normalizeCurrencyOutsideMath(plain);
        }
        working = restoreMathSegments(plain, segments);
    } else {
        if (stripTextMacroInPlain) {
            working = stripTextMacroInPlain(working);
        }
        if (applyPhraseSpacingRepairs) {
            working = applyPhraseSpacingRepairs(working);
        }
        if (normalizeCurrencyOutsideMath) {
            working = normalizeCurrencyOutsideMath(working);
        }
    }

    working = stripBackslashesOutsideMath(working);
    working = neutralizeUnpairedDollarSigns(working);
    working = escapeCurrencyDollarsMathSafe(working);
    working = working.replace(/(\d[\d.,]*)(\s*)&\#36;/g, '&#36;$1');
    working = addSpacesAroundInlineMath(working);
    working = repairSpacedTags(working);
    working = protectTables(working);
    working = deglueCommonBigrams(working);
    working = working.replace(/\$\s*([A-Za-z])\s*\$/g, '$1');
    return working;
}

function extractMathSegments(input) {
    const segments = [];
    if (typeof input !== 'string' || !input.length) {
        return segments;
    }
    const mathRegex = /\$\$([\s\S]+?)\$\$|\\\[([\s\S]+?)\\\]|\$([\s\S]+?)\$|\\\(([\s\S]+?)\\\)/g;
    let lastIndex = 0;
    let match;
    while ((match = mathRegex.exec(input)) !== null) {
        if (match.index > lastIndex) {
            segments.push({ type: 'text', value: input.slice(lastIndex, match.index) });
        }
        if (typeof match[1] !== 'undefined') {
            segments.push({ type: 'math', value: match[1], displayMode: true, raw: match[0] });
        } else if (typeof match[2] !== 'undefined') {
            segments.push({ type: 'math', value: match[2], displayMode: true, raw: match[0] });
        } else if (typeof match[3] !== 'undefined') {
            segments.push({ type: 'math', value: match[3], displayMode: false, raw: match[0] });
        } else {
            segments.push({ type: 'math', value: match[4], displayMode: false, raw: match[0] });
        }
        lastIndex = mathRegex.lastIndex;
    }
    if (lastIndex < input.length) {
        segments.push({ type: 'text', value: input.slice(lastIndex) });
    }
    return segments;
}

function sanitizeHtmlContent(content, { normalizeSpacing = false, skipPreprocess = false } = {}) {
    if (typeof content !== 'string') return '';
    let working = content;
    if (!skipPreprocess) {
        working = preprocessRawContent(working, { normalizeSpacing });
    }

    if (typeof DOMPurify !== 'undefined') {
        return formatFractions(DOMPurify.sanitize(working, {
            ALLOWED_TAGS: ALLOWED_HTML_TAGS,
            ALLOWED_ATTR: ALLOWED_HTML_ATTR
        }));
    }

    return formatFractions(working
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;'));
}

// formatFractions()
// This finds plain-text math-style fractions and wraps them in <span class="frac">...</span>
// We ONLY match "number/number" or "(...)/number" or "(...)/(...)"
function formatFractions(text) {
    if (!text || typeof text !== 'string') return text;

    // 1. (2x + 1)/3  or  (a+b)/(c+d)
    const complexPattern = /\(([^\)]+)\)\s*\/\s*\(([^\)]+)\)/g;

    // 2. (2x + 1)/3  (paren over number)
    const parenOverNumberPattern = /\(([^\)]+)\)\s*\/\s*([0-9]+(\.[0-9]+)?)/g;

    // 3. 3/4 or 12/5 etc. Standalone numeric fractions
    const simpleNumericPattern = /\b([0-9]+(\.[0-9]+)?)\s*\/\s*([0-9]+(\.[0-9]+)?)\b/g;

    let out = text;

    // Order matters: handle the more complex forms first so we don't double-wrap
    out = out.replace(complexPattern, (match) => `<span class="frac">${match}</span>`);
    out = out.replace(parenOverNumberPattern, (match) => `<span class="frac">${match}</span>`);
    out = out.replace(simpleNumericPattern, (match) => `<span class="frac">${match}</span>`);

    return out;
}

function cleanRepeatedText(text) {
    if (!text || typeof text !== 'string') return text;
    const half = Math.floor(text.length / 2);
    if (text.length % 2 === 0) {
        const firstHalf = text.substring(0, half);
        const secondHalf = text.substring(half);
        if (firstHalf === secondHalf) {
            return firstHalf;
        }
    }
    return text;
}

function parseHtmlTable(htmlString) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(htmlString, 'text/html');
    const table = doc.querySelector('table');
    if (!table) return null;
    const headers = [...table.querySelectorAll('th')].map(th => th.innerText);
    const rows = [...table.querySelectorAll('tbody tr')];
    const labels = rows.map(row => row.querySelector('td')?.innerText || '');
    const datasets = [];
    for (let i = 1; i < headers.length; i++) {
        datasets.push({
            label: headers[i],
            data: rows.map(row => parseFloat(row.querySelectorAll('td')[i]?.innerText.replace(/[^0-9.-]+/g,"")) || 0),
            backgroundColor: `rgba(59, 130, 246, 0.6)`,
        });
    }
    return { labels, datasets };
}

function ChartDisplay({ chartData }) {
    const chartRef = React.useRef(null);
    const chartInstanceRef = React.useRef(null);

    React.useEffect(() => {
        if (!chartRef.current || !chartData) return;

        // Destroy any existing instance before creating a new one
        if (chartInstanceRef.current) {
            try { chartInstanceRef.current.destroy(); } catch (e) {}
            chartInstanceRef.current = null;
        }

        chartInstanceRef.current = new Chart(chartRef.current, {
            type: 'bar',
            data: { labels: chartData.labels, datasets: chartData.datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: { duration: 300 }
            }
        });

        return () => {
            if (chartInstanceRef.current) {
                try { chartInstanceRef.current.destroy(); } catch (e) {}
                chartInstanceRef.current = null;
            }
        };
    }, [chartData]);

    return (
        <canvas ref={chartRef} />
    );
}

// Science formula sheet data
const ScienceFormulas = [
    {
        name: "Density",
        formula: "d = \\frac{m}{V}",
        variables: "d = density (mass per unit volume), m = mass, V = volume"
    },
    {
        name: "Average Speed",
        formula: "v = \\frac{d}{t}",
        variables: "v = average speed, d = distance traveled, t = elapsed time"
    },
    {
        name: "Force",
        formula: "F = ma",
        variables: "F = net force, m = mass, a = acceleration"
    },
    {
        name: "Work",
        formula: "W = F \\times d",
        variables: "W = work, F = applied force, d = displacement in the direction of the force"
    },
    {
        name: "Mean (Average)",
        formula: "\\bar{x} = \\frac{\\text{Total of all data values}}{\\text{How many values there are}}",
        variables: "\\bar{x} = mean (average) of the data set: add all values together and divide by how many values there are"
    },
    {
        name: "Range",
        formula: "\\text{Range} = \\text{Maximum value} - \\text{Minimum value}",
        variables: "Describes the spread between the largest and smallest values in a data set."
    }
];

const SCI_NUMERACY_QUESTIONS = [
    {
        questionNumber: 1,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A botanist measures the height (in cm) of five plants: 15, 18, 15, 22, and 20.</p>",
        question: "What is the <strong>mean (average)</strong> height of the plants?",
        answerOptions: [
            { text: "15 cm", rationale: "15 is the mode (most common), not the mean.", isCorrect: false },
            { text: "18 cm", rationale: "Correct. (15+18+15+22+20)=90; 90÷5=18.", isCorrect: true },
            { text: "18.5 cm", rationale: "Close, but not the exact average.", isCorrect: false },
            { text: "22 cm", rationale: "22 is just the tallest plant.", isCorrect: false }
        ]
    },
    {
        questionNumber: 2,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>In pea plants, purple flowers (P) are dominant over white flowers (p). Two heterozygous plants (Pp × Pp) are crossed.</p>",
        question: "What percent of offspring are expected to have <strong>white</strong> flowers?",
        answerOptions: [
            { text: "0%", rationale: "Incorrect. White can appear if the plant gets pp.", isCorrect: false },
            { text: "25%", rationale: "Correct. The Punnett square gives PP, Pp, Pp, pp → 1 of 4 is pp (white).", isCorrect: true },
            { text: "50%", rationale: "50% would be too high; only 1 of 4 is pp.", isCorrect: false },
            { text: "75%", rationale: "75% would be purple, not white.", isCorrect: false }
        ]
    },
    {
        questionNumber: 3,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A rock has a mass of 60 g and displaces 20 cm³ of water.</p>",
        question: "What is the rock’s density?",
        answerOptions: [
            { text: "1 g/cm³", rationale: "That would be 20 g ÷ 20 cm³.", isCorrect: false },
            { text: "3 g/cm³", rationale: "Correct. Density = mass ÷ volume = 60 ÷ 20 = 3 g/cm³.", isCorrect: true },
            { text: "20 g/cm³", rationale: "That’s just the volume, not density.", isCorrect: false },
            { text: "40 g/cm³", rationale: "Not based on 60 ÷ 20.", isCorrect: false }
        ]
    },
    {
        questionNumber: 4,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A car travels 150 km in 3 hours at a constant speed.</p>",
        question: "What is the car’s average speed?",
        answerOptions: [
            { text: "50 km/h", rationale: "Correct. 150 km ÷ 3 h = 50 km/h.", isCorrect: true },
            { text: "30 km/h", rationale: "Too low. That would be 90 km over 3 h.", isCorrect: false },
            { text: "100 km/h", rationale: "Too high. That would be 300 km in 3 h.", isCorrect: false },
            { text: "450 km/h", rationale: "Impossible for the data given.", isCorrect: false }
        ]
    },
    {
        questionNumber: 5,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A student pushes a box with a force of 50 N across the floor for 4 m.</p>",
        question: "How much work was done on the box?",
        answerOptions: [
            { text: "12.5 J", rationale: "This divides instead of multiplying.", isCorrect: false },
            { text: "46 N", rationale: "Newtons measure force, not work (energy).", isCorrect: false },
            { text: "200 J", rationale: "Correct. Work W = F × d = 50 N × 4 m = 200 J.", isCorrect: true },
            { text: "200 N", rationale: "Units are wrong — work is in joules.", isCorrect: false }
        ]
    },
    {
        questionNumber: 6,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A 2 kg cart accelerates at 3 m/s².</p>",
        question: "What net force is acting on the cart?",
        answerOptions: [
            { text: "0.67 N", rationale: "That divides instead of multiplies.", isCorrect: false },
            { text: "1.5 N", rationale: "Still dividing, not multiplying.", isCorrect: false },
            { text: "5 N", rationale: "Close, but 2 × 3 is 6, not 5.", isCorrect: false },
            { text: "6 N", rationale: "Correct. F = m × a = 2 kg × 3 m/s² = 6 N.", isCorrect: true }
        ]
    },
    {
        questionNumber: 7,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: `<p>A student heats four samples of the same liquid:</p>
          <table class="min-w-full text-sm text-left">
            <thead><tr><th>Trial</th><th>Start Temp (°C)</th><th>End Temp (°C)</th></tr></thead>
            <tbody>
              <tr><td>A</td><td>22</td><td>30</td></tr>
              <tr><td>B</td><td>22</td><td>29</td></tr>
              <tr><td>C</td><td>22</td><td>35</td></tr>
              <tr><td>D</td><td>22</td><td>28</td></tr>
            </tbody>
          </table>`,
        question: "Which trial had the greatest temperature increase?",
        answerOptions: [
            { text: "Trial A", rationale: "Increase was 30−22 = 8°C.", isCorrect: false },
            { text: "Trial B", rationale: "Increase was 7°C.", isCorrect: false },
            { text: "Trial C", rationale: "Correct. Increase was 35−22 = 13°C, the largest.", isCorrect: true },
            { text: "Trial D", rationale: "Increase was 6°C.", isCorrect: false }
        ]
    },
    {
        questionNumber: 8,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>Colony counts of bacteria on 5 plates were 12, 15, 15, 18, and 30 (in thousands).</p>",
        question: "What is the <strong>range</strong> of the data?",
        answerOptions: [
            { text: "12", rationale: "12 is just the smallest value.", isCorrect: false },
            { text: "18", rationale: "18 is not max − min.", isCorrect: false },
            { text: "30", rationale: "30 is just the largest value.", isCorrect: false },
            { text: "18 (thousand)", rationale: "Correct. Range = 30 − 12 = 18.", isCorrect: true }
        ]
    },
    {
        questionNumber: 9,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>In the first 20 minutes of a run, a runner goes 10 km. After 10 minutes the runner had 5 km. Assume constant speed.</p>",
        question: "What is the runner’s speed during this period (in km/min)?",
        answerOptions: [
            { text: "0.25 km/min", rationale: "Too low (that would be 5 km in 20 min).", isCorrect: false },
            { text: "0.5 km/min", rationale: "Correct. 10 km ÷ 20 min = 0.5 km/min.", isCorrect: true },
            { text: "2 km/min", rationale: "Too high. That would be 40 km in 20 min.", isCorrect: false },
            { text: "20 km/min", rationale: "Way too high for a human runner.", isCorrect: false }
        ]
    },
    {
        questionNumber: 10,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A sealed container (nothing can enter or escape) has a total mass of 120 g before a chemical reaction and 120 g after.</p>",
        question: "Which statement is best supported by this data?",
        answerOptions: [
            { text: "Mass is created during the reaction.", rationale: "No; mass didn't increase.", isCorrect: false },
            { text: "Mass is destroyed during the reaction.", rationale: "No; mass didn't decrease.", isCorrect: false },
            { text: "Mass is conserved during the reaction.", rationale: "Correct. The total stayed 120 g.", isCorrect: true },
            { text: "The container leaked gas.", rationale: "If it leaked, mass would drop.", isCorrect: false }
        ]
    },
    {
        questionNumber: 11,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A pump moves 12 liters of water in 4 minutes at a constant rate.</p>",
        question: "How many liters will it move in 10 minutes?",
        answerOptions: [
            { text: "20 L", rationale: "That assumes 2 L/min. Actual rate is 3 L/min.", isCorrect: false },
            { text: "24 L", rationale: "That’s 12 L in 4 min scaled to 8 min, not 10.", isCorrect: false },
            { text: "30 L", rationale: "Correct. 12 ÷ 4 = 3 L/min. 3 × 10 = 30 L.", isCorrect: true },
            { text: "120 L", rationale: "Way too high for this rate.", isCorrect: false }
        ]
    },
    {
        questionNumber: 12,
        qaProfileKey: "numeracy",
        type: "knowledge",
        passage: "<p>A household budget is $3,000 per month. Housing is 35% of the budget.</p>",
        question: "How much money goes to housing each month?",
        answerOptions: [
            { text: "$700", rationale: "That’s 700 / 3000 ≈ 23%. Too low.", isCorrect: false },
            { text: "$900", rationale: "That’s 30% of $3,000.", isCorrect: false },
            { text: "$1,050", rationale: "Correct. 35% of $3,000 = 0.35 × 3000 = $1,050.", isCorrect: true },
            { text: "$1,500", rationale: "That would be 50%, not 35%.", isCorrect: false }
        ]
    }
];

const AppData = {
    "Science": {
        icon: "BeakerIcon",
        categories: {
            "Life Science": {
                description: "Explore the fundamental principles of living organisms, from the cellular level to entire ecosystems.",
                topics: [
                    {
                        id: "sci_life_science_basics",
                        title: "Life Science Basics",
                        description: "Cell structure, function, photosynthesis, and cellular respiration.",
                        questions: [
                            { questionNumber: 1, type: 'text', passage: "All living organisms are composed of cells, the basic units of life. The cell theory states that all living things are made of cells, cells are the basic unit of structure and function, and all cells come from pre-existing cells. Within a cell, organelles perform specific functions. The nucleus contains the cell's genetic material (DNA), and mitochondria are responsible for generating energy through cellular respiration.", question: "According to the passage, what is the primary function of mitochondria?", answerOptions: [ { text: "Storing the cell's genetic material.", rationale: "This is the function of the nucleus.", isCorrect: false }, { text: "Controlling all cell activities.", rationale: "This is a broader function of the nucleus.", isCorrect: false }, { text: "Generating energy for the cell.", rationale: "Correct. The passage states mitochondria generate energy.", isCorrect: true }, { text: "Creating new cells.", rationale: "New cells come from pre-existing cells, a process of the entire cell.", isCorrect: false } ] },
                            { questionNumber: 2, type: 'knowledge', question: "Which of the following is the correct order of organization in living things, from simplest to most complex?", answerOptions: [ { text: "Organism, Organ System, Organ, Tissue, Cell", rationale: "This order is reversed.", isCorrect: false }, { text: "Cell, Tissue, Organ, Organ System, Organism", rationale: "Correct. Cells form tissues, tissues form organs, organs form organ systems, and organ systems make up an organism.", isCorrect: true }, { text: "Tissue, Cell, Organ, Organism, Organ System", rationale: "This order is incorrect.", isCorrect: false }, { text: "Cell, Organ, Tissue, Organism, Organ System", rationale: "This order is incorrect.", isCorrect: false } ] },
                            { questionNumber: 3, type: 'text', passage: "Photosynthesis is the process used by plants, algae, and some bacteria to convert light energy into chemical energy. The process uses sunlight, water, and carbon dioxide to create glucose (sugar for energy) and oxygen. This is why plants are called producers; they create their own food.", question: "What are the three essential inputs for photosynthesis?", answerOptions: [ { text: "Sunlight, oxygen, and water.", rationale: "Oxygen is an output, not an input.", isCorrect: false }, { text: "Sunlight, carbon dioxide, and glucose.", rationale: "Glucose is an output.", isCorrect: false }, { text: "Sunlight, water, and carbon dioxide.", rationale: "Correct. The passage lists these three as the necessary ingredients.", isCorrect: true }, { text: "Water, oxygen, and glucose.", rationale: "Oxygen and glucose are outputs.", isCorrect: false } ] },
                            { questionNumber: 4, type: 'knowledge', question: "Which human body system is responsible for transporting oxygen, nutrients, and hormones to cells and removing waste products?", answerOptions: [ { text: "Respiratory System", rationale: "The respiratory system is responsible for gas exchange (breathing).", isCorrect: false }, { text: "Nervous System", rationale: "The nervous system is the body's command center, using electrical signals.", isCorrect: false }, { text: "Digestive System", rationale: "The digestive system breaks down food.", isCorrect: false }, { text: "Circulatory System", rationale: "Correct. The circulatory system, including the heart, blood, and blood vessels, is the body's transport network.", isCorrect: true } ] },
                            { questionNumber: 5, type: 'text', passage: "DNA (Deoxyribonucleic acid) is a molecule that carries the genetic instructions for the development, functioning, growth, and reproduction of all known organisms. A gene is a specific sequence of DNA that codes for a functional product, either RNA or a protein.", question: "What is the relationship between DNA and genes?", answerOptions: [ { text: "A gene is a segment of DNA that codes for a specific product.", rationale: "Correct. The passage defines a gene as a specific sequence of DNA.", isCorrect: true }, { text: "DNA is a type of gene.", rationale: "This is reversed. A gene is a type of DNA sequence.", isCorrect: false }, { text: "DNA and genes are completely unrelated.", rationale: "They are directly related.", isCorrect: false }, { text: "A gene is larger than a DNA molecule.", rationale: "A gene is a part of a larger DNA molecule.", isCorrect: false } ] },
                            { questionNumber: 6, type: 'knowledge', question: "In genetics, what does a Punnett square predict?", answerOptions: [ { text: "The exact genetic makeup of an offspring.", rationale: "It predicts probability, not the exact outcome.", isCorrect: false }, { text: "The probability of an offspring inheriting a particular trait.", rationale: "Correct. A Punnett square is a tool used to predict the possible genetic outcomes and their probabilities.", isCorrect: true }, { text: "The number of chromosomes in a cell.", rationale: "This is determined by a karyotype, not a Punnett square.", isCorrect: false }, { text: "The rate of cellular respiration.", rationale: "This is unrelated to Punnett squares.", isCorrect: false } ] },
                            { questionNumber: 7, type: 'knowledge', question: "Which part of the plant cell is primarily responsible for photosynthesis?", answerOptions: [ { text: "Nucleus", rationale: "The nucleus contains the cell's genetic material.", isCorrect: false }, { text: "Mitochondrion", rationale: "Mitochondria are responsible for cellular respiration.", isCorrect: false }, { text: "Chloroplast", rationale: "Correct. Chloroplasts contain chlorophyll, the pigment that captures light energy.", isCorrect: true }, { text: "Cell Wall", rationale: "The cell wall provides structural support.", isCorrect: false } ] },
                            { questionNumber: 8, type: 'text', passage: "Homeostasis is the state of steady internal, physical, and chemical conditions maintained by living systems. This is the condition of optimal functioning for the organism and includes many variables, such as body temperature and fluid balance, being kept within certain pre-set limits.", question: "Shivering when you are cold is an example of the body trying to maintain homeostasis by:", answerOptions: [ { text: "generating heat through muscle contractions.", rationale: "Correct. Shivering is an involuntary muscle contraction that generates heat to raise body temperature.", isCorrect: true }, { text: "reducing the body's core temperature.", rationale: "It is an attempt to increase, not reduce, temperature.", isCorrect: false }, { text: "saving energy.", rationale: "Shivering consumes energy.", isCorrect: false }, { text: "increasing fluid balance.", rationale: "This is unrelated to the primary purpose of shivering.", isCorrect: false } ] },
                            { questionNumber: 9, type: 'knowledge', question: "In the human respiratory system, what is the primary function of the alveoli?", answerOptions: [ { text: "To filter dust and particles from the air.", rationale: "This is mainly done by hairs and mucus in the nasal passages and trachea.", isCorrect: false }, { text: "To produce sound for speech.", rationale: "This is the function of the larynx (voice box).", isCorrect: false }, { text: "To exchange oxygen and carbon dioxide with the blood.", rationale: "Correct. The alveoli are tiny air sacs where gas exchange occurs.", isCorrect: true }, { text: "To pump air into and out of the lungs.", rationale: "This is the function of the diaphragm muscle.", isCorrect: false } ] },
                            { questionNumber: 10, type: 'knowledge', question: "An allele is a variant form of a gene. If an individual has two identical alleles for a particular gene, they are:", answerOptions: [ { text: "Heterozygous for that gene.", rationale: "Heterozygous means having two different alleles.", isCorrect: false }, { text: "Homozygous for that gene.", rationale: "Correct. 'Homo-' means same.", isCorrect: true }, { text: "Recessive for that gene.", rationale: "Recessive describes an allele that is masked by a dominant one.", isCorrect: false }, { text: "Dominant for that gene.", rationale: "Dominant describes an allele that masks a recessive one.", isCorrect: false } ] },
                            { questionNumber: 11, type: 'text', passage: "The nervous system is composed of two main parts: the Central Nervous System (CNS), which consists of the brain and spinal cord, and the Peripheral Nervous System (PNS), which consists of the nerves that branch out from the CNS to the rest of the body.", question: "A nerve in your arm that sends a signal to your brain is part of which system?", answerOptions: [ { text: "The Central Nervous System (CNS)", rationale: "The CNS is the brain and spinal cord.", isCorrect: false }, { text: "The Peripheral Nervous System (PNS)", rationale: "Correct. Nerves outside the brain and spinal cord are part of the PNS.", isCorrect: true }, { text: "Both the CNS and PNS", rationale: "It is part of the PNS.", isCorrect: false }, { text: "The Circulatory System", rationale: "This is a different body system.", isCorrect: false } ] },
                            { questionNumber: 12, type: 'knowledge', question: "What is the primary function of the digestive system?", answerOptions: [ { text: "To break down food and absorb nutrients.", rationale: "Correct. The digestive system processes food for energy and nutrients.", isCorrect: true }, { text: "To eliminate waste from the blood.", rationale: "This is primarily the function of the urinary system.", isCorrect: false }, { text: "To send signals throughout the body.", rationale: "This is the function of the nervous system.", isCorrect: false }, { text: "To produce hormones.", rationale: "This is the function of the endocrine system.", isCorrect: false } ] },
                            { questionNumber: 13, type: 'text', passage: "Cellular respiration is a set of metabolic reactions and processes that take place in the cells of organisms to convert chemical energy from nutrients into adenosine triphosphate (ATP), and then release waste products. It is the process of 'burning' glucose for energy.", question: "Cellular respiration occurs in which organelle?", answerOptions: [ { text: "Chloroplast", rationale: "Chloroplasts are for photosynthesis.", isCorrect: false }, { text: "Nucleus", rationale: "The nucleus contains genetic material.", isCorrect: false }, { text: "Mitochondria", rationale: "Correct. Mitochondria are known as the 'powerhouses' of the cell because this is where cellular respiration happens.", isCorrect: true }, { text: "Ribosome", rationale: "Ribosomes are responsible for protein synthesis.", isCorrect: false } ] },
                            { questionNumber: 14, type: 'knowledge', question: "Which of the following is an example of an inherited trait in humans?", answerOptions: [ { text: "Eye color", rationale: "Correct. Eye color is determined by genes passed from parents to offspring.", isCorrect: true }, { text: "A scar from an injury", rationale: "This is an acquired characteristic, not inherited.", isCorrect: false }, { text: "The ability to speak English", rationale: "This is a learned behavior.", isCorrect: false }, { text: "A tattoo", rationale: "This is an acquired body modification.", isCorrect: false } ] },
                            { questionNumber: 15, type: 'knowledge', question: "What is the difference between a dominant and a recessive allele?", answerOptions: [ { text: "A dominant allele is always better than a recessive allele.", rationale: "Dominance does not imply superiority.", isCorrect: false }, { text: "A dominant allele will mask the expression of a recessive allele.", rationale: "Correct. If a dominant allele is present, its trait will be expressed.", isCorrect: true }, { text: "Recessive alleles are more common in the population.", rationale: "Dominance is not related to how common an allele is.", isCorrect: false }, { text: "Dominant alleles are only found in homozygous individuals.", rationale: "Dominant alleles are expressed in both homozygous and heterozygous individuals.", isCorrect: false } ] }
                        ]
                    },
                    {
                        id: "sci_ecosystems_environment",
                        title: "Ecosystems & Environment",
                        description: "Ecology, food webs, and human impact on the environment.",
                        questions: [
                            { questionNumber: 1, type: 'text', passage: "An ecosystem consists of all the living organisms (biotic factors) in a particular area, along with all the non-living (abiotic) components of the environment, such as sunlight, soil, water, and temperature. These components are linked together through nutrient cycles and energy flows.", question: "Which of the following is an example of an abiotic factor in an ecosystem?", answerOptions: [ { text: "A tree", rationale: "A tree is a living organism (biotic).", isCorrect: false }, { text: "A fungus", rationale: "A fungus is a living organism (biotic).", isCorrect: false }, { text: "The amount of annual rainfall", rationale: "Correct. Rainfall is a non-living component of the environment.", isCorrect: true }, { text: "An insect", rationale: "An insect is a living organism (biotic).", isCorrect: false } ] },
                            { questionNumber: 2, type: 'knowledge', question: "In a food web, an organism that produces its own food, usually through photosynthesis, is called a:", answerOptions: [ { text: "Consumer", rationale: "Consumers eat other organisms.", isCorrect: false }, { text: "Producer", rationale: "Correct. Producers, like plants, form the base of the food web.", isCorrect: true }, { text: "Decomposer", rationale: "Decomposers break down dead organic matter.", isCorrect: false }, { text: "Scavenger", rationale: "Scavengers are a type of consumer.", isCorrect: false } ] },
                            { questionNumber: 3, type: 'image', imageUrl: "Images/ged-scince-fig-12.png", question: "In this food web, which organism is a primary consumer?", answerOptions: [ { text: "The grass", rationale: "The grass is a producer.", isCorrect: false }, { text: "The rabbit", rationale: "Correct. The rabbit eats the producer (grass), making it a primary consumer.", isCorrect:true }, { text: "The hawk", rationale: "The hawk eats other consumers, making it a secondary or tertiary consumer.", isCorrect: false }, { text: "The fungi", rationale: "The fungi are decomposers.", isCorrect: false } ] },
                            { questionNumber: 4, type: 'text', passage: "The energy pyramid illustrates the flow of energy from one trophic (feeding) level to the next in an ecosystem. A large amount of energy is lost at each level, usually as heat. Typically, only about 10% of the energy from one level is transferred to the level above it.", question: "If the producers in an ecosystem contain 10,000 units of energy, approximately how much energy would be available to the secondary consumers?", answerOptions: [ { text: "10,000 units", rationale: "This is the energy at the producer level.", isCorrect: false }, { text: "1,000 units", rationale: "This is the energy available to the primary consumers (10% of 10,000).", isCorrect: false }, { text: "100 units", rationale: "Correct. Secondary consumers are two levels up. 10% of 10,000 is 1,000 (primary consumers), and 10% of 1,000 is 100.", isCorrect: true }, { text: "10 units", rationale: "This would be the energy available to tertiary consumers.", isCorrect: false } ] },
                            { questionNumber: 5, type: 'knowledge', question: "The process by which water evaporates from oceans, condenses into clouds, falls as precipitation, and returns to the ocean is known as:", answerOptions: [ { text: "The carbon cycle", rationale: "The carbon cycle describes the movement of carbon.", isCorrect: false }, { text: "The nitrogen cycle", rationale: "The nitrogen cycle describes the movement of nitrogen.", isCorrect: false }, { text: "The water cycle", rationale: "Correct. This describes the continuous movement of water on, above, and below the surface of the Earth.", isCorrect: true }, { text: "Photosynthesis", rationale: "Photosynthesis is a process used by plants to create energy.", isCorrect: false } ] },
                            { questionNumber: 6, type: 'text', passage: "Human activities, such as the burning of fossil fuels (coal, oil, and natural gas), release large amounts of carbon dioxide into the atmosphere. Carbon dioxide is a greenhouse gas, which traps heat and contributes to the warming of the planet, a phenomenon known as global warming or climate change.", question: "According to the passage, what is the primary cause of the recent increase in atmospheric carbon dioxide?", answerOptions: [ { text: "Volcanic eruptions", rationale: "While volcanoes release CO2, human activities are the primary cause of the recent increase.", isCorrect: false }, { text: "Deforestation", rationale: "Deforestation contributes, but the burning of fossil fuels is the primary cause mentioned.", isCorrect: false }, { text: "The burning of fossil fuels", rationale: "Correct. The passage explicitly states this as the main source.", isCorrect: true }, { text: "The process of photosynthesis", rationale: "Photosynthesis removes carbon dioxide from the atmosphere.", isCorrect: false } ] },
                            { questionNumber: 7, 'type': 'knowledge', question: "A symbiotic relationship where one organism benefits and the other is neither harmed nor helped is called:", answerOptions: [ { 'text': 'Mutualism', 'rationale': 'In mutualism, both organisms benefit.', 'isCorrect': false }, { 'text': 'Parasitism', 'rationale': 'In parasitism, one organism benefits and the other is harmed.', 'isCorrect': false }, { 'text': 'Commensalism', 'rationale': 'Correct. A classic example is a barnacle on a whale.', 'isCorrect': true }, { 'text': 'Competition', 'rationale': 'Competition is a relationship where two or more organisms vie for the same limited resources.', 'isCorrect': false } ] },
                            { questionNumber: 8, type: 'text', passage: "Biodiversity refers to the variety of life in a particular habitat or ecosystem. High biodiversity is often a sign of a healthy ecosystem. It increases ecosystem productivity and resilience, meaning the ecosystem is better able to withstand and recover from disasters.", question: "What is the primary benefit of high biodiversity in an ecosystem?", answerOptions: [ { text: "It ensures that all organisms are the same size.", rationale: "Biodiversity means variety, not uniformity.", isCorrect: false }, { text: "It increases the ecosystem's stability and resilience.", rationale: "Correct. The passage states that high biodiversity makes an ecosystem more resilient.", isCorrect: true }, { text: "It decreases the total number of organisms.", rationale: "High biodiversity usually correlates with a high number of organisms.", isCorrect: false }, { text: "It simplifies the food web.", rationale: "High biodiversity leads to more complex food webs.", isCorrect: false } ] },
                            { questionNumber: 9, type: 'knowledge', question: "What is the main role of decomposers, such as bacteria and fungi, in an ecosystem?", answerOptions: [ { text: "To produce energy from sunlight.", rationale: "This is the role of producers.", isCorrect: false }, { text: "To consume other organisms for energy.", rationale: "This is the role of consumers.", isCorrect: false }, { text: "To break down dead organic matter and return nutrients to the soil.", rationale: "Correct. Decomposers are essential for recycling nutrients.", isCorrect: true }, { text: "To control the population of primary consumers.", rationale: "This is a role of secondary consumers (predators).", isCorrect: false } ] },
                            { questionNumber: 10, type: 'text', passage: "Natural selection is the process through which populations of living organisms adapt and change. Individuals in a population are naturally variable, meaning that they are all different in some ways. This variation means that some individuals have traits better suited to the environment than others. Individuals with adaptive traits are more likely to survive and reproduce, passing those traits on to their offspring.", question: "Which of the following is a key requirement for natural selection to occur?", answerOptions: [ { text: "All individuals in a population must be identical.", rationale: "Variation is necessary for natural selection to act upon.", isCorrect: false }, { text: "The environment must remain constant over time.", rationale: "Environmental changes are often the driving force of natural selection.", isCorrect: false }, { text: "There must be variation in heritable traits within a population.", rationale: "Correct. Without variation, some individuals would not be better suited than others, and there would be nothing to 'select'.", isCorrect: true }, { text: "Organisms must consciously choose to adapt.", rationale: "Adaptation through natural selection is a passive process, not a conscious choice.", isCorrect: false } ] },
                            { questionNumber: 11, type: 'knowledge', question: "An invasive species is an organism that is not native to a specific location and has a tendency to spread to a degree believed to cause damage to the environment, economy, or human health. Why are invasive species often so successful in new ecosystems?", answerOptions: [ { text: "Because they are usually larger than native species.", rationale: "Size is not the determining factor.", isCorrect: false }, { text: "Because they often lack natural predators in the new environment.", rationale: "Correct. Without predators to control their population, they can multiply rapidly and outcompete native species.", isCorrect: true }, { text: "Because they only eat food that native species do not.", rationale: "They often compete directly with native species for food.", isCorrect: false }, { text: "Because they reproduce more slowly than native species.", rationale: "They often reproduce more quickly.", isCorrect: false } ] },
                            { questionNumber: 12, type: 'knowledge', question: "The gradual process by which ecosystems change and develop over time is called:", answerOptions: [ { text: "Evolution", rationale: "Evolution refers to the change in heritable traits of populations over generations.", isCorrect: false }, { text: "Succession", rationale: "Correct. Ecological succession is the process of change in the species structure of an ecological community over time.", isCorrect: true }, { text: "Homeostasis", rationale: "Homeostasis is the maintenance of a stable internal environment.", isCorrect: false }, { text: "Photosynthesis", rationale: "This is the process of creating energy from sunlight.", isCorrect: false } ] },
                            { questionNumber: 13, type: 'text', passage: "Acid rain is caused by emissions of sulfur dioxide and nitrogen oxide, which react with the water molecules in the atmosphere to produce acids. These emissions primarily come from the burning of fossil fuels in power plants and vehicles. Acid rain can have harmful effects on soil, forests, and aquatic ecosystems.", question: "What is the primary cause of acid rain?", answerOptions: [ { text: "An increase in the pH of rainwater.", rationale: "Acid rain involves a decrease in pH (making it more acidic).", isCorrect: false }, { text: "Pollutants from burning fossil fuels reacting with water in the atmosphere.", rationale: "Correct. The passage identifies sulfur dioxide and nitrogen oxide from fossil fuels as the primary cause.", isCorrect: true }, { text: "The natural carbonation of rainwater.", rationale: "Natural rainwater is slightly acidic, but acid rain is much more so due to pollution.", isCorrect: false }, { text: "Runoff from agricultural fertilizers.", rationale: "Fertilizer runoff causes other problems, like eutrophication, but not acid rain.", isCorrect: false } ] },
                            { questionNumber: 14, type: 'knowledge', question: "A food chain shows a single pathway of energy transfer. Which of the following is a correct and logical food chain?", answerOptions: [ { text: "Hawk -> Snake -> Mouse -> Grass", rationale: "This food chain is backwards.", isCorrect: false }, { text: "Grass -> Mouse -> Snake -> Hawk", rationale: "Correct. This shows the correct flow of energy from producer to primary consumer to secondary consumer to tertiary consumer.", isCorrect: true }, { text: "Mouse -> Grass -> Hawk -> Snake", rationale: "This order is illogical.", isCorrect: false }, { text: "Sun -> Grass -> Hawk -> Mouse", rationale: "This order is illogical.", isCorrect: false } ] },
                            { questionNumber: 15, type: 'knowledge', question: "The concept of a 'carbon footprint' refers to:", answerOptions: [ { text: "The total amount of carbon stored in the soil.", rationale: "This is part of the carbon cycle, but not a carbon footprint.", isCorrect: false }, { text: "The total amount of greenhouse gases generated by our actions.", rationale: "Correct. It is a measure of an individual's or organization's impact on the climate.", isCorrect: true }, { text: "The physical mark left by carbon-based life forms.", rationale: "This is a literal interpretation, not the correct meaning.", isCorrect: false }, { text: "The number of trees planted to offset carbon emissions.", rationale: "This is a way to reduce a carbon footprint, not the footprint itself.", isCorrect: false } ] }
                        ]
                    }
                ]
            },
            "Physical Science": {
                description: "Investigate the principles of chemistry and physics that govern the world around us.",
                topics: [
                    {
                        id: "sci_chem_fundamentals",
                        title: "Chemistry Fundamentals",
                        description: "Properties of matter, atoms, elements, and the periodic table.",
                        questions: [
                            { questionNumber: 1, type: 'text', passage: "All matter is made up of atoms, which are the smallest units of an element that maintain the properties of that element. Atoms are composed of three main subatomic particles: protons, neutrons, and electrons. Protons have a positive charge, neutrons have no charge, and electrons have a negative charge.", question: "Which subatomic particle has a positive charge?", answerOptions: [ { text: "Proton", rationale: "Correct. The passage states that protons have a positive charge.", isCorrect: true }, { text: "Neutron", rationale: "Neutrons have no charge.", isCorrect: false }, { text: "Electron", rationale: "Electrons have a negative charge.", isCorrect: false }, { text: "Atom", rationale: "An atom is the whole unit, not a subatomic particle.", isCorrect: false } ] },
                            { questionNumber: 2, type: 'knowledge', question: "In an atom, which two subatomic particles are found in the nucleus?", answerOptions: [ { text: "Protons and electrons", rationale: "Electrons orbit the nucleus.", isCorrect: false }, { text: "Protons and neutrons", rationale: "Correct. The nucleus at the center of the atom contains the protons and neutrons.", isCorrect: true }, { text: "Neutrons and electrons", rationale: "Electrons orbit the nucleus.", isCorrect: false }, { text: "Only protons", rationale: "The nucleus also contains neutrons (except for the most common isotope of hydrogen).", isCorrect: false } ] },
                            { questionNumber: 3, type: 'text', passage: "The periodic table of elements arranges all known elements in order of increasing atomic number. The atomic number of an element is equal to the number of protons in the nucleus of an atom of that element. This number is unique to each element.", question: "The identity of an element is determined by its number of:", answerOptions: [ { text: "Neutrons", rationale: "The number of neutrons can vary, creating isotopes.", isCorrect: false }, { text: "Electrons", rationale: "The number of electrons can change when an atom forms an ion.", isCorrect: false }, { text: "Protons", rationale: "Correct. The passage states that the atomic number, which is the number of protons, is unique to each element.", isCorrect: true }, { text: "Energy levels", rationale: "The number of energy levels can change.", isCorrect: false } ] },
                            { questionNumber: 4, type: 'image', imageUrl: "Images/licensed-image (5).jpg", question: "This image shows a typical entry on the periodic table for the element Carbon (C). What is the atomic number of Carbon?", answerOptions: [ { text: "12.011", rationale: "This is the atomic mass.", isCorrect: false }, { text: "6", rationale: "Correct. The number at the top is the atomic number.", isCorrect: true }, { text: "C", rationale: "This is the element symbol.", isCorrect: false }, { text: "Carbon", rationale: "This is the element name.", isCorrect: false } ] },
                            { questionNumber: 5, type: 'knowledge', question: "What is the difference between an element and a compound?", answerOptions: [ { text: "An element is a liquid, while a compound is a solid.", rationale: "Elements and compounds can exist in any state of matter.", isCorrect: false }, { text: "An element consists of only one type of atom, while a compound consists of two or more different types of atoms chemically bonded together.", rationale: "Correct. For example, oxygen (O) is an element, while water (H₂O) is a compound.", isCorrect: true }, { text: "Elements are found in nature, while compounds are man-made.", rationale: "Many compounds, like water and carbon dioxide, are found in nature.", isCorrect: false }, { text: "There is no difference.", rationale: "There is a fundamental chemical difference.", isCorrect: false } ] },
                            { questionNumber: 6, type: 'text', passage: "A chemical reaction is a process that leads to the chemical transformation of one set of chemical substances to another. The substances initially involved in a chemical reaction are called reactants, and the substances produced are called products. The law of conservation of mass states that mass is neither created nor destroyed in a chemical reaction.", question: "If 10 grams of reactant A are combined with 5 grams of reactant B in a sealed container and react completely, what will be the total mass of the products?", answerOptions: [ { text: "5 grams", rationale: "This would violate the law of conservation of mass.", isCorrect: false }, { text: "10 grams", rationale: "This would violate the law of conservation of mass.", isCorrect: false }, { text: "15 grams", rationale: "Correct. According to the law of conservation of mass, the total mass of the reactants must equal the total mass of the products.", isCorrect: true }, { text: "It is impossible to tell.", rationale: "The law of conservation of mass allows us to determine the mass.", isCorrect: false } ] },
                            { questionNumber: 7, type: 'knowledge', question: "Which of the following represents a physical change, not a chemical change?", answerOptions: [ { text: "Burning wood", rationale: "Burning is a chemical change (combustion) that creates new substances like ash and smoke.", isCorrect: false }, { text: "Rusting iron", rationale: "Rusting is a chemical change (oxidation) that creates a new substance, iron oxide.", isCorrect: false }, { text: "Boiling water", rationale: "Correct. Boiling water changes its state from liquid to gas (steam), but it is still chemically H₂O. This is a physical change.", isCorrect: true }, { text: "Baking a cake", rationale: "Baking involves chemical reactions that change the ingredients into a new substance.", isCorrect: false } ] },
                            { questionNumber: 8, type: 'text', passage: "The pH scale measures how acidic or basic a substance is. The scale ranges from 0 to 14. A pH of 7 is neutral. A pH less than 7 indicates acidity, while a pH greater than 7 indicates a base (alkalinity).", question: "A substance with a pH of 3 is considered:", answerOptions: [ { text: "Acidic", rationale: "Correct. A pH less than 7 is acidic.", isCorrect: true }, { text: "Basic (alkaline)", rationale: "A pH greater than 7 is basic.", isCorrect: false }, { text: "Neutral", rationale: "A pH of 7 is neutral.", isCorrect: false }, { text: "A solid", rationale: "pH measures acidity, not state of matter.", isCorrect: false } ] },
                            { questionNumber: 9, type: 'knowledge', question: "What is a substance that is dissolved in another substance to form a solution called?", answerOptions: [ { text: "Solvent", rationale: "The solvent is the substance that does the dissolving (e.g., water).", isCorrect: false }, { text: "Solute", rationale: "Correct. The solute is the substance that is dissolved (e.g., salt in saltwater).", isCorrect: true }, { text: "Mixture", rationale: "A mixture is the combination of two or more substances that are not chemically bonded.", isCorrect: false }, { text: "Element", rationale: "An element is a pure substance consisting of only one type of atom.", isCorrect: false } ] },
                            { questionNumber: 10, type: 'knowledge', question: "In the chemical formula for water, H₂O, what does the subscript '2' indicate?", answerOptions: [ { text: "There are two water molecules.", rationale: "A coefficient in front of the formula would indicate the number of molecules.", isCorrect: false }, { text: "There are two oxygen atoms.", rationale: "The '2' is next to the 'H', not the 'O'.", isCorrect: false }, { text: "There are two hydrogen atoms.", rationale: "Correct. The subscript indicates the number of atoms of the element immediately preceding it.", isCorrect: true }, { text: "The molecule has a charge of +2.", rationale: "A superscript would indicate the charge.", isCorrect: false } ] },
                            { questionNumber: 11, type: "knowledge", question: "The columns of the periodic table are called 'groups' or 'families.' Elements in the same group have similar:", answerOptions: [ { text: "Atomic masses", rationale: "Atomic masses increase as you go down a group.", isCorrect: false }, { text: "Chemical properties", rationale: "Correct. Elements in the same group have the same number of valence electrons, which gives them similar chemical behaviors.", isCorrect: true }, { text: "Numbers of protons", rationale: "The number of protons increases down a group.", isCorrect: false }, { text: "Numbers of energy shells", rationale: "The number of energy shells increases as you go down a group.", isCorrect: false } ] },
                            { questionNumber: 12, type: 'text', passage: "A covalent bond is a chemical bond that involves the sharing of electron pairs between atoms. An ionic bond is formed when one atom transfers one or more electrons to another atom, creating ions—charged atoms that are then attracted to each other.", question: "What is the key difference between a covalent bond and an ionic bond?", answerOptions: [ { text: "Covalent bonds involve sharing electrons, while ionic bonds involve transferring electrons.", rationale: "Correct. The passage defines this as the fundamental difference.", isCorrect: true }, { text: "Covalent bonds are stronger than ionic bonds.", rationale: "The relative strength can vary depending on the specific atoms involved.", isCorrect: false }, { text: "Covalent bonds form between metals, and ionic bonds form between nonmetals.", rationale: "Ionic bonds typically form between a metal and a nonmetal, while covalent bonds form between nonmetals.", isCorrect: false }, { text: "Covalent bonds create ions, while ionic bonds do not.", rationale: "This is the opposite of what the passage states.", isCorrect: false } ] },
                            { questionNumber: 13, type: 'knowledge', question: "Which of the following is a property of a solid?", answerOptions: [ { text: "It takes the shape of its container.", rationale: "This is a property of liquids and gases.", isCorrect: false }, { text: "It has a definite shape and a definite volume.", rationale: "Correct. The particles in a solid are tightly packed and vibrate in fixed positions.", isCorrect: true }, { text: "It is easily compressible.", rationale: "This is a property of gases.", isCorrect: false }, { text: "It has no definite shape or volume.", rationale: "This is a property of gases.", isCorrect: false } ] },
                            { questionNumber: 14, type: 'knowledge', question: "A substance that speeds up a chemical reaction without being consumed in the reaction is called a(n):", answerOptions: [ { text: "Reactant", rationale: "A reactant is consumed in the reaction.", isCorrect: false }, { text: "Product", rationale: "A product is formed by the reaction.", isCorrect: false }, { text: "Catalyst", rationale: "Correct. Catalysts lower the activation energy of a reaction, making it happen faster.", isCorrect: true }, { text: "Inhibitor", rationale: "An inhibitor slows down a chemical reaction.", isCorrect: false } ] },
                            { questionNumber: 15, type: 'text', passage: "Isotopes are variants of a particular chemical element which differ in neutron number, and consequently in mass number. All isotopes of a given element have the same number of protons in each atom.", question: "Carbon-12 and Carbon-14 are isotopes of carbon. What is different between an atom of Carbon-12 and an atom of Carbon-14?", answerOptions: [ { text: "The number of protons.", rationale: "They are both carbon, so they must have the same number of protons (6).", isCorrect: false }, { text: "The number of electrons.", rationale: "In a neutral atom, the number of electrons equals the number of protons.", isCorrect: false }, { text: "The number of neutrons.", rationale: "Correct. Carbon-14 has two more neutrons than Carbon-12, which accounts for the difference in their mass numbers.", isCorrect: true }, { text: "Their chemical symbol.", rationale: "They both have the chemical symbol C.", isCorrect: false } ] }
                        ]
                    },
                    {
                        id: "sci_physics_motion",
                        title: "Physics in Motion",
                        description: "Newton's laws of motion, energy transformations, and waves.",
                        questions: [
                            { questionNumber: 1, type: 'text', passage: "Newton's First Law of Motion, often called the law of inertia, states that an object at rest will stay at rest, and an object in motion will stay in motion with the same speed and in the same direction unless acted upon by an unbalanced force.", question: "A book is sitting on a table. According to Newton's First Law, it will not move unless:", answerOptions: [ { text: "it runs out of energy.", rationale: "An object at rest has no kinetic energy to run out of.", isCorrect: false }, { text: "an unbalanced force acts on it.", rationale: "Correct. A force, like a push or a pull, is required to change its state of rest.", isCorrect: true }, { text: "gravity stops acting on it.", rationale: "Gravity is a force constantly acting on the book.", isCorrect: false }, { text: "its inertia is used up.", rationale: "Inertia is a property of mass, not something that can be used up.", isCorrect: false } ] },
                            { questionNumber: 2, type: 'text', passage: "Newton's Second Law of Motion states that the acceleration of an object is directly proportional to the net force acting on it and inversely proportional to its mass. This is often written as the formula F = ma (Force = mass × acceleration).", question: "If you push two objects with the same amount of force, which one will accelerate more?", answerOptions: [ { text: "The object with the larger mass.", rationale: "According to F=ma, if F is constant, a larger mass (m) results in smaller acceleration (a).", isCorrect: false }, { text: "The object with the smaller mass.", rationale: "Correct. If F is constant, a smaller mass (m) will experience a larger acceleration (a).", isCorrect: true }, { text: "They will both accelerate at the same rate.", rationale: "Acceleration depends on mass.", isCorrect: false }, { text: "Neither will accelerate.", rationale: "If a net force is applied, they will accelerate.", isCorrect: false } ] },
                            { questionNumber: 3, type: 'knowledge', question: "Newton's Third Law of Motion states that for every action, there is an equal and opposite reaction. Which of the following is the best example of this law?", answerOptions: [ { text: "A rocket moving upwards by pushing exhaust gases downwards.", rationale: "Correct. The action is the rocket pushing the gas down; the reaction is the gas pushing the rocket up.", isCorrect: true }, { text: "A car slowing down when the brakes are applied.", rationale: "This is an example of the First and Second Laws (a force causing deceleration).", isCorrect: false }, { text: "A ball rolling to a stop due to friction.", rationale: "This is an example of the First Law (an unbalanced force, friction, changing the object's motion).", isCorrect: false }, { text: "A person sitting on a chair.", rationale: "While action-reaction forces are present (person pushes on chair, chair pushes on person), the rocket is a more dynamic example of the law in action.", isCorrect: false } ] },
                            { questionNumber: 4, type: 'text', passage: "Energy can be classified into two main types: potential and kinetic. Potential energy is stored energy, often due to an object's position or state. Kinetic energy is the energy of motion.", question: "A roller coaster car poised at the very top of a tall hill has its maximum:", answerOptions: [ { text: "Kinetic energy", rationale: "Kinetic energy is the energy of motion. At the top of the hill, the car is momentarily at rest, so its kinetic energy is at a minimum.", isCorrect: false }, { text: "Potential energy", rationale: "Correct. Its height gives it the maximum amount of stored gravitational potential energy, which will be converted to kinetic energy as it rolls down.", isCorrect: true }, { text: "Frictional energy", rationale: "Friction is a force that converts kinetic energy into heat, not a primary energy type in this context.", isCorrect: false }, { text: "Both kinetic and potential energy are at a minimum.", rationale: "Potential energy is at its maximum.", isCorrect: false } ] },
                            { questionNumber: 5, type: 'knowledge', question: "The law of conservation of energy states that:", answerOptions: [ { text: "Energy can be created but not destroyed.", rationale: "Energy cannot be created.", isCorrect: false }, { text: "Energy cannot be created or destroyed, only transformed from one form to another.", rationale: "Correct. This is the fundamental principle of energy conservation.", isCorrect: true }, { text: "Kinetic energy is always greater than potential energy.", rationale: "The balance between kinetic and potential energy can vary.", isCorrect: false }, { text: "Energy is lost as heat in every transformation.", rationale: "While some energy is often lost as heat, the total amount of energy is conserved.", isCorrect: false } ] },
                            { questionNumber: 6, type: 'text', passage: "A wave is a disturbance that transfers energy from one place to another. In a transverse wave, the particles of the medium move perpendicular to the direction of energy transfer. In a longitudinal wave, the particles move parallel to the direction of energy transfer.", question: "A sound wave, which consists of compressions and rarefactions of air particles, is an example of a:", answerOptions: [ { text: "Transverse wave", rationale: "Light is an example of a transverse wave.", isCorrect: false }, { text: "Longitudinal wave", rationale: "Correct. In a sound wave, the air particles vibrate back and forth in the same direction that the sound is traveling.", isCorrect: true }, { text: "Stationary wave", rationale: "A stationary wave does not transfer energy from one place to another.", isCorrect: false }, { text: "Surface wave", rationale: "A surface wave occurs at the interface between two media.", isCorrect: false } ] },
                            { questionNumber: 7, type: 'knowledge', question: "What is the term for the number of complete wave cycles that pass a point in a given amount of time?", answerOptions: [ { text: "Wavelength", rationale: "Wavelength is the distance between two corresponding parts of a wave.", isCorrect: false }, { text: "Amplitude", rationale: "Amplitude is the maximum displacement or distance moved by a point on a vibrating body or wave measured from its equilibrium position.", isCorrect: false }, { text: "Frequency", rationale: "Correct. Frequency is typically measured in Hertz (Hz), which is cycles per second.", isCorrect: true }, { text: "Speed", rationale: "Speed is the distance the wave travels per unit of time.", isCorrect: false } ] },
                            { "questionNumber": 8, "type": "knowledge", "question": "In an electrical circuit, what is the property that opposes the flow of electric current?", "answerOptions": [ { "text": "Voltage", "rationale": "Voltage is the electrical potential difference that drives the current.", "isCorrect": false }, { "text": "Current", "rationale": "Current is the flow of electric charge.", "isCorrect": false }, { "text": "Resistance", "rationale": "Correct. Resistance, measured in ohms, is the opposition to the passage of an electric current.", "isCorrect": true }, { "text": "Power", "rationale": "Power is the rate at which electrical energy is transferred.", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "text", "passage": "Ohm's Law describes the relationship between voltage (V), current (I), and resistance (R) in an electrical circuit. The formula is V = IR. This means that for a given resistance, the current is directly proportional to the voltage.", "question": "If the voltage in a circuit is increased while the resistance stays the same, what will happen to the current?", "answerOptions": [ { "text": "It will decrease.", "rationale": "According to V=IR, if V increases and R is constant, I must also increase.", "isCorrect": false }, { "text": "It will increase.", "rationale": "Correct. The law states a direct proportionality between voltage and current.", "isCorrect": true }, { "text": "It will stay the same.", "rationale": "The current will change if the voltage changes.", "isCorrect": false }, { "text": "It will reverse direction.", "rationale": "The direction of the current is determined by the polarity of the voltage source.", "isCorrect": false } ] },
                            { "questionNumber": 10, "type": "knowledge", "question": "Which of the following is the best example of a conductor of electricity?", "answerOptions": [ { "text": "Rubber", "rationale": "Rubber is an insulator.", "isCorrect": false }, { "text": "Glass", "rationale": "Glass is an insulator.", "isCorrect": false }, { "text": "Copper", "rationale": "Correct. Metals like copper have free electrons that allow electric current to flow easily.", "isCorrect": true }, { "text": "Wood", "rationale": "Wood is an insulator.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "knowledge", "question": "The force of gravity between two objects depends on two factors:", "answerOptions": [ { "text": "Their masses and the distance between them.", "rationale": "Correct. Newton's law of universal gravitation states that the force is proportional to the product of their masses and inversely proportional to the square of the distance between them.", "isCorrect": true }, { "text": "Their speed and their temperature.", "rationale": "These factors do not directly determine the force of gravity.", "isCorrect": false }, { "text": "Their chemical composition and their electrical charge.", "rationale": "These factors are not part of the law of gravitation.", "isCorrect": false }, { "text": "Their volume and their shape.", "rationale": "While related to mass and distance, it is mass itself, not volume or shape, that is the key factor.", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "text", "passage": "Speed is a scalar quantity that refers to 'how fast an object is moving.' Velocity is a vector quantity that refers to 'the rate at which an object changes its position.' The key difference is that velocity includes direction.", "question": "A car is traveling at a constant 60 miles per hour as it goes around a circular track. Which of the following is true?", "answerOptions": [ { "text": "The car's speed and velocity are both constant.", "rationale": "The speed is constant, but the velocity is not.", "isCorrect": false }, { "text": "The car's speed is constant, but its velocity is changing.", "rationale": "Correct. Even though the speed is constant, the car's direction is constantly changing, which means its velocity is also changing.", "isCorrect": true }, { "text": "The car's speed is changing, but its velocity is constant.", "rationale": "The speed is stated as constant.", "isCorrect": false }, { "text": "The car's speed and velocity are both changing.", "rationale": "The speed is constant.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "knowledge", "question": "What type of energy is stored in the bonds of chemical compounds, such as in food or batteries?", "answerOptions": [ { "text": "Kinetic energy", "rationale": "Kinetic energy is the energy of motion.", "isCorrect": false }, { "text": "Thermal energy", "rationale": "Thermal energy is related to the temperature of an object.", "isCorrect": false }, { "text": "Chemical potential energy", "rationale": "Correct. This is the energy stored in the chemical bonds of a substance.", "isCorrect": true }, { "text": "Gravitational potential energy", "rationale": "This is energy stored due to an object's height.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "text", "passage": "Magnetism is a force produced by moving electric charges. All magnets have two poles, a north pole and a south pole. Like poles repel each other, while opposite poles attract each other.", "question": "If you bring the north pole of one magnet close to the north pole of another magnet, what will happen?", "answerOptions": [ { "text": "The magnets will attract each other.", "rationale": "Opposite poles attract.", "isCorrect": false }, { "text": "The magnets will repel each other.", "rationale": "Correct. The passage states that like poles repel.", "isCorrect": true }, { "text": "Nothing will happen.", "rationale": "A magnetic force will be exerted.", "isCorrect": false }, { "text": "The magnets will lose their magnetism.", "rationale": "This will not cause them to lose their magnetism.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "knowledge", "question": "Which of the following is a unit of force?", "answerOptions": [ { "text": "Meter", "rationale": "A meter is a unit of distance.", "isCorrect": false }, { "text": "Kilogram", "rationale": "A kilogram is a unit of mass.", "isCorrect": false }, { "text": "Second", "rationale": "A second is a unit of time.", "isCorrect": false }, { "text": "Newton", "rationale": "Correct. The Newton (N) is the standard unit of force in the International System of Units (SI).", "isCorrect": true } ] }
                        ]
                    }
                ]
            },
            "Scientific Numeracy": {
                description: "Practice applying mathematical skills to interpret scientific data, charts, and formulas.",
                image: "./images/scientific_numeracy_icon.png",
                topics: [
                    {
                        id: "sci_scientific_numeracy_core",
                        title: "Scientific Numeracy",
                        description: "Core Skills Practice Set",
                        config: {
                            calculator: true,
                            formulaSheet: true,
                            totalTime: 20 * 60
                        },
                        questions: SCI_NUMERACY_QUESTIONS
                    }
                ]
            },
            "Earth & Space Science": {
                description: "Study the systems of planet Earth and its place in the universe.",
                topics: [
                    {
                        id: "sci_earth_space",
                        title: "Earth & Space Systems",
                        description: "Plate tectonics, the rock cycle, and the solar system.",
                        questions: [
                            { questionNumber: 1, type: 'text', passage: "The Earth's lithosphere is divided into several large and small tectonic plates that float on the semi-fluid asthenosphere beneath. The movement of these plates is responsible for major geological events such as earthquakes, volcanic eruptions, and the formation of mountain ranges.", question: "The theory of plate tectonics helps to explain:", answerOptions: [ { text: "The changing of the seasons.", rationale: "The seasons are caused by the tilt of the Earth's axis.", isCorrect: false }, { text: "The occurrence of earthquakes and the formation of mountains.", rationale: "Correct. The passage directly links plate movement to these geological events.", isCorrect: true }, { text: "The phases of the moon.", rationale: "The moon's phases are caused by its orbit around the Earth.", isCorrect: false }, { text: "The water cycle.", rationale: "The water cycle is driven by solar energy.", isCorrect: false } ] },
                            { questionNumber: 2, type: 'knowledge', question: "What type of plate boundary is formed when two tectonic plates collide with each other?", answerOptions: [ { text: "Divergent boundary", rationale: "At a divergent boundary, plates move apart.", isCorrect: false }, { text: "Convergent boundary", rationale: "Correct. 'Converge' means to come together.", isCorrect: true }, { text: "Transform boundary", rationale: "At a transform boundary, plates slide past each other.", isCorrect: false }, { text: "Static boundary", rationale: "There is no such term in plate tectonics.", isCorrect: false } ] },
                            { questionNumber: 3, type: 'text', passage: "The rock cycle is a model that describes the formation, breakdown, and reformation of a rock as a result of sedimentary, igneous, and metamorphic processes. For example, when magma or lava cools and solidifies, it forms igneous rock. When this rock is weathered and eroded, the sediments can be compacted to form sedimentary rock.", question: "According to the passage, how is igneous rock formed?", answerOptions: [ { text: "From the cooling and solidification of magma or lava.", rationale: "Correct. The passage explicitly states this is how igneous rock is formed.", isCorrect: true }, { text: "From the compaction and cementation of sediments.", rationale: "This describes the formation of sedimentary rock.", isCorrect: false }, { text: "From the application of heat and pressure to existing rock.", rationale: "This describes the formation of metamorphic rock.", isCorrect: false }, { text: "From the weathering of metamorphic rock.", rationale: "Weathering breaks down rock; it does not form it.", isCorrect: false } ] },
                            { questionNumber: 4, type: 'knowledge', question: "Which type of rock is formed from the shells, skeletons, and other remains of living organisms?", answerOptions: [ { text: "Igneous rock", rationale: "Igneous rock is formed from cooled magma.", isCorrect: false }, { text: "Metamorphic rock", rationale: "Metamorphic rock is formed by heat and pressure.", isCorrect: false }, { text: "Organic sedimentary rock", rationale: "Correct. Rocks like limestone and coal are formed from the accumulation of organic debris.", isCorrect: true }, { text: "Chemical sedimentary rock", rationale: "Chemical sedimentary rocks form when minerals precipitate from a solution.", isCorrect: false } ] },
                            { questionNumber: 5, type: 'text', passage: "Weathering is the process that breaks down rocks, soils, and minerals as well as wood and artificial materials through contact with the Earth's atmosphere, water, and biological organisms. Erosion is the process by which soil and rock particles are worn away and moved elsewhere by gravity, or by a moving transport agent such as water, wind, or ice.", question: "What is the key difference between weathering and erosion?", answerOptions: [ { text: "Weathering breaks down rocks, while erosion moves the broken pieces.", rationale: "Correct. Weathering is the breaking, and erosion is the taking.", isCorrect: true }, { text: "Weathering only happens to soil, while erosion only happens to rock.", rationale: "Both processes can happen to both soil and rock.", isCorrect: false }, { text: "Weathering is a chemical process, while erosion is a physical process.", rationale: "Both processes can be either physical or chemical.", isCorrect: false }, { text: "There is no difference; they are the same process.", rationale: "They are two distinct but related processes.", isCorrect: false } ] },
                            { questionNumber: 6, type: 'knowledge', question: "Which of the following is the best example of chemical weathering?", answerOptions: [ { text: "A rock breaking apart due to ice freezing and expanding in its cracks.", rationale: "This is an example of physical weathering (ice wedging).", isCorrect: false }, { text: "The smoothing of a rock by a river.", rationale: "This is an example of physical weathering and erosion.", isCorrect: false }, { text: "The dissolving of limestone by acid rain.", rationale: "Correct. This is a chemical reaction that breaks down the rock.", isCorrect: true }, { text: "The roots of a tree growing into and splitting a rock.", rationale: "This is an example of physical weathering (biological).", isCorrect: false } ] },
                            { questionNumber: 7, type: 'knowledge', question: "What is the correct order of the planets in our solar system, starting from the one closest to the Sun?", answerOptions: [ { text: "Earth, Mars, Jupiter, Saturn, Venus, Mercury, Uranus, Neptune", rationale: "This order is incorrect.", isCorrect: false }, { text: "Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, Neptune", rationale: "Correct. This is the order of the eight planets.", isCorrect: true }, { text: "Mercury, Venus, Mars, Earth, Jupiter, Saturn, Uranus, Neptune", rationale: "Earth and Mars are in the wrong order.", isCorrect: false }, { text: "Jupiter, Saturn, Uranus, Neptune, Mercury, Venus, Earth, Mars", rationale: "This separates the gas giants and terrestrial planets but is not the correct order from the sun.", isCorrect: false } ] },
                            { questionNumber: 8, type: 'text', passage: "A star is a luminous ball of gas, mostly hydrogen and helium, held together by its own gravity. Nuclear fusion reactions in its core support the star against gravity and produce photons and heat, as well as small amounts of heavier elements. The Sun is the closest star to Earth.", question: "What is the primary process that generates energy in a star like our Sun?", answerOptions: [ { text: "Nuclear fusion", rationale: "Correct. The passage states that nuclear fusion reactions in the core produce the star's energy.", isCorrect: true }, { text: "Chemical combustion (burning)", rationale: "Stars are not 'burning' in the traditional sense; it is a nuclear process.", isCorrect: false }, { text: "Gravitational collapse", rationale: "Gravity holds the star together, but fusion is what generates the outward energy.", isCorrect: false }, { text: "Radioactive decay", rationale: "This process occurs but is not the primary source of a star's energy.", isCorrect: false } ] },
                            { questionNumber: 9, type: 'knowledge', question: "Why do we experience seasons on Earth?", answerOptions: [ { text: "Because the Earth's distance from the Sun changes throughout the year.", rationale: "While the distance does change slightly, this is not the primary cause of the seasons.", isCorrect: false }, { text: "Because of the tilt of the Earth's axis relative to its orbit around the Sun.", rationale: "Correct. The tilt causes different parts of the Earth to receive more direct sunlight at different times of the year.", isCorrect: true }, { text: "Because the Sun's energy output changes throughout the year.", rationale: "The Sun's energy output is relatively constant.", isCorrect: false }, { text: "Because of the changing phases of the Moon.", rationale: "The Moon's phases do not affect the seasons.", isCorrect: false } ] },
                            { questionNumber: 10, type: 'knowledge', question: "What causes the phases of the Moon (e.g., new moon, full moon, quarter moon)?", answerOptions: [ { text: "The Earth's shadow falling on the Moon.", rationale: "This describes a lunar eclipse, not the regular phases.", isCorrect: false }, { text: "The changing amount of the sunlit side of the Moon that we can see from Earth as it orbits us.", rationale: "Correct. The phases are a result of our viewing angle of the Moon's illuminated surface.", isCorrect: true }, { "text": "Clouds blocking our view of the Moon.", "rationale": "Clouds can obscure the moon, but they do not cause its phases.", "isCorrect": false }, { "text": "The Moon physically changing its shape.", "rationale": "The Moon is always a sphere; only our view of it changes.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "text", "passage": "Meteorology is the science dealing with the atmosphere and its phenomena, including weather and climate. Weather refers to the short-term conditions of the atmosphere at a particular time and place, including temperature, humidity, precipitation, and wind. Climate, on the other hand, is the long-term average of weather patterns in a region.", "question": "Which of the following is a description of climate, not weather?", "answerOptions": [ { "text": "It is currently raining in Chicago.", "rationale": "This is a short-term condition (weather).", "isCorrect": false }, { "text": "The Sahara Desert receives very little rainfall on average throughout the year.", "rationale": "Correct. This describes a long-term average pattern, which is climate.", "isCorrect": true }, { "text": "Tomorrow's forecast is for a high of 75 degrees.", "rationale": "This is a short-term prediction (weather).", "isCorrect": false }, { "text": "The wind is blowing from the west today.", "rationale": "This is a short-term condition (weather).", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "knowledge", "question": "What is the layer of gases surrounding the Earth called?", "answerOptions": [ { "text": "The lithosphere", "rationale": "The lithosphere is the rigid outer part of the earth, consisting of the crust and upper mantle.", "isCorrect": false }, { "text": "The hydrosphere", "rationale": "The hydrosphere is all the waters on the earth's surface, such as lakes and seas.", "isCorrect": false }, { "text": "The atmosphere", "rationale": "Correct. The atmosphere is the envelope of gases surrounding the earth.", "isCorrect": true }, { "text": "The asthenosphere", "rationale": "The asthenosphere is the upper layer of the earth's mantle, below the lithosphere.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "knowledge", "question": "A solar eclipse occurs when:", "answerOptions": [ { "text": "The Earth passes between the Sun and the Moon.", "rationale": "This describes a lunar eclipse.", "isCorrect": false }, { "text": "The Moon passes between the Sun and the Earth, blocking the Sun's light.", "rationale": "Correct. This alignment casts a shadow on the Earth.", "isCorrect": true }, { "text": "The Sun passes between the Earth and the Moon.", "rationale": "This is not a possible alignment.", "isCorrect": false }, { "text": "Another planet passes between the Earth and the Sun.", "rationale": "This is called a transit, not a solar eclipse.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "image", "imageUrl": "Images/ged-scince-fig-7.png", "question": "This diagram illustrates the rock cycle. What process is required to turn a sedimentary rock into a metamorphic rock?", "answerOptions": [ { "text": "Weathering and erosion", "rationale": "This would break the rock down into sediments.", "isCorrect": false }, { "text": "Melting and cooling", "rationale": "This would turn it into igneous rock.", "isCorrect": false }, { "text": "Heat and pressure", "rationale": "Correct. The diagram shows that heat and pressure transform existing rocks into metamorphic rocks.", "isCorrect": true }, { "text": "Compaction and cementation", "rationale": "This is the process that forms sedimentary rocks from sediment.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "knowledge", "question": "Which planet is known as the 'Red Planet' due to its reddish, iron-rich soil?", "answerOptions": [ { "text": "Jupiter", "rationale": "Jupiter is a gas giant known for its Great Red Spot, but it is not the 'Red Planet.'", "isCorrect": false }, { "text": "Venus", "rationale": "Venus has a thick, yellowish atmosphere.", "isCorrect": false }, { "text": "Mars", "rationale": "Correct. Mars gets its distinctive red color from iron oxide (rust) on its surface.", "isCorrect": true }, { "text": "Saturn", "rationale": "Saturn is a gas giant known for its rings.", "isCorrect": false } ] }
                        ]
                    }
                ]
            }
        }
    },
"Math": {
    icon: "CalculatorIcon",
    categories: {
        "Quantitative Problem Solving": {
            description: "Solve problems using numbers, data, and statistics.",
            icon: "ChartBarIcon", // New Icon
            topics: [
                {
                    id: "math_quant_basics",
                    title: "Whole Numbers, Fractions & Decimals",
                    description: "Operations with integers, fractions, and decimals.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "question": "A construction project requires $\\frac{5}{8}$ inch bolts. If a worker has a bolt that is $\\frac{3}{4}$ inch, is it too large or too small, and by how much?", "answerOptions": [ { "text": "The bolt is $\\frac{1}{8}$ inch too large.", "isCorrect": true, "rationale": "To compare $\\frac{3}{4}$ and $\\frac{5}{8}$, find a common denominator, which is 8. $\\frac{3}{4}$ is equal to $\\frac{6}{8}$, so it exceeds $\\frac{5}{8}$ by $\\frac{1}{8}$." }, { "text": "The bolt is $\\frac{1}{8}$ inch too small.", "isCorrect": false, "rationale": "$\\frac{3}{4}$ is equal to $\\frac{6}{8}$, which is larger than $\\frac{5}{8}$, not smaller." }, { "text": "The bolt is $\\frac{1}{4}$ inch too large.", "isCorrect": false, "rationale": "The difference between $\\frac{3}{4}$ and $\\frac{5}{8}$ is $\\frac{1}{8}$ inch, not $\\frac{1}{4}$ inch." }, { "text": "The bolt matches the required size exactly.", "isCorrect": false, "rationale": "The sizes differ by $\\frac{1}{8}$ inch." } ] },
                        { "questionNumber": 2, "calculator": false, "question": "A recipe calls for $2 \\frac{1}{2}$ cups of flour. If you want to make half the recipe, how much flour do you need?", "answerOptions": [ { "text": "$\\frac{5}{4}$ cups", "isCorrect": true, "rationale": "Half of $2 \\frac{1}{2}$ is $\\left(\\frac{5}{2}\\right) \\div 2 = \\frac{5}{4}$ cups." }, { "text": "$\\frac{3}{2}$ cups", "isCorrect": false, "rationale": "This would be more than half of the original amount." }, { "text": "$1$ cup", "isCorrect": false, "rationale": "This is less than half of $2 \\frac{1}{2}$ cups." }, { "text": "$\\frac{7}{4}$ cups", "isCorrect": false, "rationale": "This is greater than the correct amount." } ] },
                        { "questionNumber": 3, "calculator": false, "question": "A stock's price dropped by \\$1.25 on Monday and then rose by \\$2.50 on Tuesday. What was the net change in the stock's price over the two days?", "answerOptions": [ { "text": "A gain of \\$1.25", "isCorrect": true, "rationale": "The net change is $-1.25 + 2.50 = 1.25$, so the stock gained \\$1.25." }, { "text": "A loss of \\$1.25", "isCorrect": false, "rationale": "Because the net change is positive, the stock did not lose value." }, { "text": "A gain of \\$3.75", "isCorrect": false, "rationale": "Adding the magnitudes $1.25$ and $2.50$ assumes both days were gains." }, { "text": "A loss of \\$3.75", "isCorrect": false, "rationale": "Both days were not losses, so the total change cannot be negative \\$3.75." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "If a pizza is cut into 8 slices and you eat 3 of them, what fraction of the pizza is left?", "answerOptions": [ { "text": "$\\frac{3}{8}$", "isCorrect": false, "rationale": "This is the fraction eaten." }, { "text": "$\\frac{5}{8}$", "isCorrect": true, "rationale": "If 3 out of 8 slices are eaten, $8 - 3 = 5$ slices are left." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "$\\frac{1}{2}$ would be 4 slices." }, { "text": "$\\frac{3}{5}$", "isCorrect": false, "rationale": "This incorrectly uses the eaten slices as the denominator." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "A customer's total bill is \\$34.56. If they pay with a \\$50 bill, how much change should they receive?", "answerOptions": [ { "text": "\\$15.44", "isCorrect": true, "rationale": "\\$50.00 - \\$34.56 = \\$15.44." }, { "text": "\\$16.44", "isCorrect": false, "rationale": "This result comes from subtracting incorrectly." }, { "text": "\\$15.54", "isCorrect": false, "rationale": "The cents are miscalculated." }, { "text": "\\$25.44", "isCorrect": false, "rationale": "This would be the change if the bill were \\$24.56." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "A piece of wood is 8 feet long. If you cut it into 4 equal pieces, how long will each piece be in feet?", "answerOptions": [ { "text": "2 feet", "isCorrect": true, "rationale": "$8 \\text{ feet} / 4 = 2 \\text{ feet}$." }, { "text": "4 feet", "isCorrect": false, "rationale": "This would be cutting it in half." }, { "text": "1 foot", "isCorrect": false, "rationale": "This would be cutting it into 8 pieces." }, { "text": "32 feet", "isCorrect": false, "rationale": "This is multiplication, not division." } ] },
                        { "questionNumber": 7, "calculator": true, "question": "What is $0.75$ expressed as a fraction in simplest form?", "answerOptions": [ { "text": "$\\frac{75}{100}$", "isCorrect": false, "rationale": "This is correct but not in simplest form." }, { "text": "$\\frac{3}{4}$", "isCorrect": true, "rationale": "$0.75$ is $\\frac{75}{100}$, which simplifies to $\\frac{3}{4}$ by dividing both numerator and denominator by 25." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "$\\frac{1}{2}$ is $0.50$." }, { "text": "$\\frac{4}{3}$", "isCorrect": false, "rationale": "This is the reciprocal of the correct answer." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "The temperature was $-5°F$ in the morning and rose to $12°F$ in the afternoon. How many degrees did the temperature increase?", "answerOptions": [ { "text": "7 degrees", "isCorrect": false, "rationale": "This is the difference between 12 and 5, not 12 and -5." }, { "text": "17 degrees", "isCorrect": true, "rationale": "The increase is $12 - (-5) = 12 + 5 = 17$ degrees." }, { "text": "-17 degrees", "isCorrect": false, "rationale": "The temperature increased, so the change is positive." }, { "text": "12 degrees", "isCorrect": false, "rationale": "This ignores the starting negative temperature." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "A carpenter has a board that is $10 \\frac{1}{2}$ feet long. He needs to cut a piece that is $3 \\frac{3}{4}$ feet long. How much of the board is left?", "answerOptions": [ { "text": "$\\frac{27}{4}$ feet", "isCorrect": true, "rationale": "$10 \\frac{1}{2} - 3 \\frac{3}{4} = \\frac{21}{2} - \\frac{15}{4} = \\frac{42}{4} - \\frac{15}{4} = \\frac{27}{4}$ feet." }, { "text": "$\\frac{29}{4}$ feet", "isCorrect": false, "rationale": "This would come from subtracting $3 \\frac{1}{4}$ instead of $3 \\frac{3}{4}$." }, { "text": "$\\frac{13}{2}$ feet", "isCorrect": false, "rationale": "This corresponds to $6 \\frac{1}{2}$ feet, which is too small." }, { "text": "7 feet", "isCorrect": false, "rationale": "This ignores the fractional part of the remaining length." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "If you drive 4.5 miles to the store, then 2.3 miles to the post office, and finally 6.1 miles home, how many miles did you drive in total?", "answerOptions": [ { "text": "12.9 miles", "isCorrect": true, "rationale": "$4.5 + 2.3 + 6.1 = 12.9$ miles." }, { "text": "11.9 miles", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "13.0 miles", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "10.9 miles", "isCorrect": false, "rationale": "This is a calculation error." } ] },
                        { "questionNumber": 11, "calculator": true, "question": "Which of the following numbers is the largest: $0.6, 0.65, 0.065, 0.605$?", "answerOptions": [ { "text": "0.6", "isCorrect": false, "rationale": "$0.6$ is equal to $0.600$." }, { "text": "0.65", "isCorrect": true, "rationale": "Comparing the decimal places, $0.650$ is the largest value." }, { "text": "0.065", "isCorrect": false, "rationale": "This is the smallest value." }, { "text": "0.605", "isCorrect": false, "rationale": "$0.605$ is smaller than $0.650$." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "A company's profit was \\$5,670 in one month. The next month, it was -\\$830 (a loss). What is the difference between the two months' profits?", "answerOptions": [ { "text": "\\$4,840", "isCorrect": false, "rationale": "This is the sum if both months were profitable." }, { "text": "\\$6,500", "isCorrect": true, "rationale": "The difference is \\$5,670 - (-\\$830) = \\$5,670 + \\$830 = \\$6,500." }, { "text": "\\$5,500", "isCorrect": false, "rationale": "This miscalculates the change between the months." }, { "text": "-\\$830", "isCorrect": false, "rationale": "This is the profit for the second month, not the difference." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "If a baker has 12 cups of sugar and each cake requires $1 \\frac{1}{2}$ cups of sugar, how many cakes can the baker make?", "answerOptions": [ { "text": "6 cakes", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "8 cakes", "isCorrect": true, "rationale": "$12 / (1 \\frac{1}{2}) = 12 / (\\frac{3}{2}) = 12 * (\\frac{2}{3}) = 24 / 3 = 8$ cakes." }, { "text": "9 cakes", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "18 cakes", "isCorrect": false, "rationale": "This is multiplication, not division." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "Order the following fractions from smallest to largest: $\\frac{1}{2}, \\frac{3}{5}, \\frac{2}{3}$.", "answerOptions": [ { "text": "$\\frac{3}{5}, \\frac{1}{2}, \\frac{2}{3}$", "isCorrect": false, "rationale": "Find a common denominator (30): $\\frac{1}{2}=\\frac{15}{30}, \\frac{3}{5}=\\frac{18}{30}, \\frac{2}{3}=\\frac{20}{30}$." }, { "text": "$\\frac{1}{2}, \\frac{3}{5}, \\frac{2}{3}$", "isCorrect": true, "rationale": "In decimal form: $\\frac{1}{2}=0.5, \\frac{3}{5}=0.6, \\frac{2}{3} \\approx 0.66...$ The correct order is $\\frac{1}{2}, \\frac{3}{5}, \\frac{2}{3}$." }, { "text": "$\\frac{2}{3}, \\frac{3}{5}, \\frac{1}{2}$", "isCorrect": false, "rationale": "This is largest to smallest." }, { "text": "$\\frac{1}{2}, \\frac{2}{3}, \\frac{3}{5}$", "isCorrect": false, "rationale": "This order is incorrect." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "A submarine is at a depth of -350 feet. It then rises 120 feet. What is its new depth?", "answerOptions": [ { "text": "-470 feet", "isCorrect": false, "rationale": "This would be the depth if it descended further." }, { "text": "-230 feet", "isCorrect": true, "rationale": "$-350 + 120 = -230$ feet." }, { "text": "230 feet", "isCorrect": false, "rationale": "The submarine is still below sea level." }, { "text": "-120 feet", "isCorrect": false, "rationale": "This is the amount it rose, not its new depth." } ] },
                        { "questionNumber": 16, "calculator": true, "question": "A baker uses $\\frac{1}{4}$ of a bag of flour for a batch of cookies. If the bag originally contained 20 cups of flour, how many cups are left?", "answerOptions": [ { "text": "5 cups", "isCorrect": false, "rationale": "This is the amount of flour used, not the amount left." }, { "text": "15 cups", "isCorrect": true, "rationale": "The baker used $\\frac{1}{4} \\times 20 = 5$ cups. The amount left is $20 - 5 = 15$ cups." }, { "text": "10 cups", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "16 cups", "isCorrect": false, "rationale": "This is a calculation error." } ] },
                        { "questionNumber": 17, "calculator": true, "question": "Sarah's temperature was 102.5°F. After taking some medicine, her temperature dropped by 3.8°F. What is her new temperature?", "answerOptions": [ { "text": "98.7°F", "isCorrect": true, "rationale": "$102.5 - 3.8 = 98.7$°F." }, { "text": "99.7°F", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "106.3°F", "isCorrect": false, "rationale": "This is the result of adding the numbers, not subtracting." }, { "text": "98.2°F", "isCorrect": false, "rationale": "This is a calculation error." } ] },
                        { "questionNumber": 18, "calculator": true, "question": "A car travels 350 miles on a full tank of gas. If the tank holds 14 gallons, what is the car's fuel efficiency in miles per gallon (MPG)?", "answerOptions": [ { "text": "20 MPG", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "25 MPG", "isCorrect": true, "rationale": "Fuel efficiency is total miles divided by gallons used: $350 / 14 = 25$ MPG." }, { "text": "30 MPG", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "35 MPG", "isCorrect": false, "rationale": "This is a calculation error." } ] },
                        { "questionNumber": 19, "calculator": true, "question": "A recipe requires $\\frac{3}{4}$ cup of sugar. If you want to make a triple batch, how much sugar do you need?", "answerOptions": [ { "text": "$\\frac{9}{4}$ cups", "isCorrect": true, "rationale": "Triple batch means multiplying by 3: $3 \\times \\frac{3}{4} = \\frac{9}{4}$ cups." }, { "text": "$\\frac{3}{2}$ cups", "isCorrect": false, "rationale": "This represents only doubling the recipe." }, { "text": "$\\frac{15}{4}$ cups", "isCorrect": false, "rationale": "This would correspond to five times the original amount." }, { "text": "3 cups", "isCorrect": false, "rationale": "This replaces the fraction with a whole number incorrectly." } ] },
                        { "questionNumber": 20, "calculator": false, "question": "The temperature was -8°C in the morning and rose by 15°C. What is the new temperature?", "answerOptions": [ { "text": "-23°C", "isCorrect": false, "rationale": "This would be the temperature if it dropped by 15 degrees." }, { "text": "7°C", "isCorrect": true, "rationale": "-8 + 15 = 7°C." }, { "text": "23°C", "isCorrect": false, "rationale": "Incorrect calculation." }, { "text": "-7°C", "isCorrect": false, "rationale": "Incorrect calculation." } ] },
                        { "questionNumber": 21, "calculator": true, "question": "A runner completed a race in 45.67 seconds. The second-place runner finished 1.89 seconds slower. What was the second-place runner's time?", "answerOptions": [ { "text": "43.78 seconds", "isCorrect": false, "rationale": "This would be 1.89 seconds faster." }, { "text": "47.56 seconds", "isCorrect": true, "rationale": "Slower means adding the time. 45.67 + 1.89 = 47.56 seconds." }, { "text": "46.56 seconds", "isCorrect": false, "rationale": "Incorrect calculation." }, { "text": "47.46 seconds", "isCorrect": false, "rationale": "Incorrect calculation." } ] }
                    ]
                },
                {
                    id: "math_quant_ratios_percents",
                    title: "Ratios, Proportions & Percents",
                    description: "Solving real-world problems with ratios and percentages.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "question": "A shirt that originally costs $40 is on sale for $25\\%$ off. What is the sale price of the shirt?", "answerOptions": [ { "text": "$10", "isCorrect": false, "rationale": "This is the discount amount, not the final price." }, { "text": "$30", "isCorrect": true, "rationale": "The discount is $25\\%$ of $\\$40$, which is $0.25 \\times 40 = \\$10$. The sale price is $\\$40 - \\$10 = \\$30$." }, { "text": "$50", "isCorrect": false, "rationale": "This is the price after a 25% increase." }, { "text": "$35", "isCorrect": false, "rationale": "This is a calculation error." } ] },
                        { "questionNumber": 2, "calculator": false, "question": "A map has a scale where 1 inch represents 50 miles. If two cities are 3.5 inches apart on the map, what is the actual distance between them?", "answerOptions": [ { "text": "150 miles", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "175 miles", "isCorrect": true, "rationale": "Set up a proportion: $\\frac{1 \\text{ in}}{50 \\text{ mi}} = \\frac{3.5 \\text{ in}}{x \\text{ mi}}$. Solving for x gives $3.5 \\times 50 = 175$ miles." }, { "text": "200 miles", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "14.3 miles", "isCorrect": false, "rationale": "This is division, not multiplication." } ] },
                        { "questionNumber": 3, "calculator": false, "question": "In a bag of marbles, the ratio of blue marbles to red marbles is $3:5$. If there are 15 red marbles, how many blue marbles are there?", "answerOptions": [ { "text": "9", "isCorrect": true, "rationale": "Set up a proportion: $\\frac{3 \\text{ blue}}{5 \\text{ red}} = \\frac{x \\text{ blue}}{15 \\text{ red}}$. To get from 5 to 15, you multiply by 3. So, multiply 3 by 3 to get 9." }, { "text": "25", "isCorrect": false, "rationale": "This would be the result if the ratio were 5:3." }, { "text": "15", "isCorrect": false, "rationale": "This is the number of red marbles." }, { "text": "3", "isCorrect": false, "rationale": "This is part of the ratio, not the final number." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "A restaurant bill is $80. If you want to leave a $20\\%$ tip, how much should the tip be?", "answerOptions": [ { "text": "$8", "isCorrect": false, "rationale": "This would be a 10% tip." }, { "text": "$16", "isCorrect": true, "rationale": "$20\\%$ of $\\$80$ is $0.20 \\times 80 = \\$16$." }, { "text": "$20", "isCorrect": false, "rationale": "This would be a 25% tip." }, { "text": "$96", "isCorrect": false, "rationale": "This is the total bill plus the tip." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "You scored 45 out of 50 on a test. What is your score as a percentage?", "answerOptions": [ { "text": "$85\\%$", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "$90\\%$", "isCorrect": true, "rationale": "$(\\frac{45}{50}) \\times 100 = 0.9 \\times 100 = 90\\%$." }, { "text": "$95\\%$", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "$45\\%$", "isCorrect": false, "rationale": "This is the raw score, not the percentage." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "The price of a computer increased from $500 to $600. What was the percent increase?", "answerOptions": [ { "text": "$10\\%$", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "$20\\%$", "isCorrect": true, "rationale": "The increase is $\\$100$. The percent increase is (increase / original price) * 100 = (100 / 500) * 100 = $0.2 \\times 100 = 20\\%$." }, { "text": "$25\\%$", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "$100\\%$", "isCorrect": false, "rationale": "This would mean the price doubled." } ] },
                        { "questionNumber": 7, "calculator": true, "question": "A car can travel 300 miles on 12 gallons of gasoline. How many gallons are needed to travel 450 miles?", "answerOptions": [ { "text": "15 gallons", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "18 gallons", "isCorrect": true, "rationale": "The car gets $\\frac{300}{12} = 25$ miles per gallon. To travel 450 miles, you need $\\frac{450}{25} = 18$ gallons." }, { "text": "20 gallons", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "24 gallons", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "A survey of 200 people found that 120 of them prefer coffee to tea. What is the ratio of people who prefer coffee to the total number of people surveyed, in simplest form?", "answerOptions": [ { "text": "$120:200$", "isCorrect": false, "rationale": "This is the correct ratio but not in simplest form." }, { "text": "$3:5$", "isCorrect": true, "rationale": "The ratio is $\\frac{120}{200}$. Divide both sides by the greatest common divisor, 40, to get $\\frac{3}{5}$." }, { "text": "$2:3$", "isCorrect": false, "rationale": "This is the ratio of tea drinkers to coffee drinkers." }, { "text": "$3:2$", "isCorrect": false, "rationale": "This is the ratio of coffee drinkers to tea drinkers." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "If sales tax is $7\\%$, how much tax would you pay on a $150 purchase?", "answerOptions": [ { "text": "$7.00", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "$10.50", "isCorrect": true, "rationale": "$7\\%$ of $\\$150$ is $0.07 \\times 150 = \\$10.50$." }, { "text": "$15.00", "isCorrect": false, "rationale": "This would be a 10% tax." }, { "text": "$1.05", "isCorrect": false, "rationale": "This is a decimal placement error." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "A recipe calls for 2 cups of sugar for every 5 cups of flour. If you use 15 cups of flour, how much sugar do you need?", "answerOptions": [ { "text": "4 cups", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "5 cups", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "6 cups", "isCorrect": true, "rationale": "The ratio is $\\frac{2}{5}$. Set up the proportion $\\frac{2}{5} = \\frac{x}{15}$. To get from 5 to 15, you multiply by 3. So, $2 \\times 3 = 6$ cups." }, { "text": "7.5 cups", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 11, "calculator": true, "question": "A store buys a TV for $200 and marks it up by $60\\%$ to sell. What is the selling price?", "answerOptions": [ { "text": "$260", "isCorrect": false, "rationale": "This would be a 30% markup." }, { "text": "$320", "isCorrect": true, "rationale": "The markup is $60\\%$ of $\\$200$, which is $0.60 \\times 200 = \\$120$. The selling price is $\\$200 + \\$120 = \\$320$." }, { "text": "$280", "isCorrect": false, "rationale": "This would be a 40% markup." }, { "text": "$120", "isCorrect": false, "rationale": "This is the markup amount, not the final price." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "If a city's population grew by $5\\%$ last year and the original population was 80,000, what is the new population?", "answerOptions": [ { "text": "80,400", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "84,000", "isCorrect": true, "rationale": "The growth is $5\\%$ of 80,000, which is $0.05 \\times 80,000 = 4,000$. The new population is $80,000 + 4,000 = 84,000$." }, { "text": "85,000", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "120,000", "isCorrect": false, "rationale": "This would be a 50% growth." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "Two numbers are in the ratio of $7:4$. If the smaller number is 28, what is the larger number?", "answerOptions": [ { "text": "49", "isCorrect": true, "rationale": "The ratio is $\\frac{7}{4}$. Set up the proportion $\\frac{7}{4} = \\frac{x}{28}$. To get from 4 to 28, you multiply by 7. So, $7 \\times 7 = 49$." }, { "text": "16", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "56", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "28", "isCorrect": false, "rationale": "This is the smaller number." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "A company has 500 employees. If $15\\%$ of the employees have been with the company for more than 10 years, how many employees is that?", "answerOptions": [ { "text": "50", "isCorrect": false, "rationale": "This would be 10%." }, { "text": "75", "isCorrect": true, "rationale": "$15\\%$ of 500 is $0.15 \\times 500 = 75$ employees." }, { "text": "100", "isCorrect": false, "rationale": "This would be 20%." }, { "text": "150", "isCorrect": false, "rationale": "This would be 30%." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "If you need to mix cement and sand in a ratio of $1:3$, how much sand would you need if you use 5 bags of cement?", "answerOptions": [ { "text": "3 bags", "isCorrect": false, "rationale": "This is the ratio value, not the total amount." }, { "text": "5 bags", "isCorrect": false, "rationale": "This is the amount of cement." }, { "text": "15 bags", "isCorrect": true, "rationale": "The ratio is 1 part cement to 3 parts sand. If you have 5 bags of cement, you need $5 \\times 3 = 15$ bags of sand." }, { "text": "20 bags", "isCorrect": false, "rationale": "This is the total number of bags." } ] },
                        { "questionNumber": 16, "calculator": true, "question": "A runner completes 8 laps around a track in 12 minutes. At this rate, how many laps can the runner complete in 30 minutes?", "answerOptions": [ { "text": "15 laps", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "20 laps", "isCorrect": true, "rationale": "The runner's rate is $\\frac{12 \\text{ min}}{8 \\text{ laps}} = 1.5$ minutes per lap. In 30 minutes, the runner can complete $\\frac{30}{1.5} = 20$ laps. Alternatively, set up a proportion: $\\frac{8}{12} = \\frac{x}{30}$, which gives $12x = 240$, so $x=20$." }, { "text": "24 laps", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "18 laps", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 17, "calculator": true, "question": "The ratio of boys to girls in a school is 5:6. If there are 240 girls, what is the total number of students in the school?", "answerOptions": [ { "text": "200", "isCorrect": false, "rationale": "This is the number of boys, not the total number of students." }, { "text": "440", "isCorrect": true, "rationale": "Set up the proportion $\\frac{5 \\text{ boys}}{6 \\text{ girls}} = \\frac{x \\text{ boys}}{240 \\text{ girls}}$. This gives $6x = 1200$, so $x = 200$ boys. The total number of students is 200 boys + 240 girls = 440." }, { "text": "480", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "540", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 18, "calculator": true, "question": "A pair of jeans originally priced at $75 is on sale for 40% off. What is the sale price?", "answerOptions": [ { "text": "$30", "isCorrect": false, "rationale": "This is the discount amount, not the final sale price." }, { "text": "$45", "isCorrect": true, "rationale": "The discount is $40\\%$ of $\\$75$, which is $0.40 \\times 75 = \\$30$. The sale price is the original price minus the discount: $\\$75 - \\$30 = \\$45$." }, { "text": "$105", "isCorrect": false, "rationale": "This is the original price plus the discount amount." }, { "text": "$55", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] }
                    ]
                },
                {
                    id: "math_quant_stats_probability",
                    title: "Statistics & Probability",
                    description: "Mean, median, mode, range, and basic probability.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "type": "chart", "passage": "<div class='passage-text'><b>Test Scores: 85, 92, 78, 88, 92</b></div>", "question": "What is the mode of the test scores listed?", "answerOptions": [ { "text": "87", "isCorrect": false, "rationale": "87 is the mean, not the mode." }, { "text": "88", "isCorrect": false, "rationale": "88 is the median, not the mode." }, { "text": "92", "isCorrect": true, "rationale": "The mode is the number that appears most frequently. 92 appears twice." }, { "text": "14", "isCorrect": false, "rationale": "14 is the range, not the mode." } ] },
                        { "questionNumber": 2, "calculator": false, "type": "chart", "passage": "<div class='passage-text'><b>Test Scores: 85, 92, 78, 88, 92</b></div>", "question": "What is the mean (average) of the test scores listed?", "answerOptions": [ { "text": "87", "isCorrect": true, "rationale": "The sum of the scores ($85+92+78+88+92$) is 435. The mean is $435 / 5 = 87$." }, { "text": "88", "isCorrect": false, "rationale": "88 is the median." }, { "text": "92", "isCorrect": false, "rationale": "92 is the mode." }, { "text": "78", "isCorrect": false, "rationale": "78 is the lowest score." } ] },
                        { "questionNumber": 3, "calculator": false, "type": "chart", "passage": "<div class='passage-text'><b>Test Scores: 85, 92, 78, 88, 92</b></div>", "question": "What is the median of the test scores listed?", "answerOptions": [ { "text": "85", "isCorrect": false, "rationale": "This is one of the scores, but not the median." }, { "text": "88", "isCorrect": true, "rationale": "First, order the scores: 78, 85, 88, 92, 92. The median is the middle value, which is 88." }, { "text": "92", "isCorrect": false, "rationale": "92 is the mode." }, { "text": "87", "isCorrect": false, "rationale": "87 is the mean." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "A bag contains 4 red, 5 blue, and 6 green marbles. What is the probability of randomly drawing a blue marble?", "answerOptions": [ { "text": "$\\frac{1}{3}$", "isCorrect": true, "rationale": "There are 5 blue marbles and a total of $4+5+6=15$ marbles. The probability is $\\frac{5}{15}$, which simplifies to $\\frac{1}{3}$." }, { "text": "$\\frac{1}{5}$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$\\frac{5}{10}$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$\\frac{1}{15}$", "isCorrect": false, "rationale": "This would be the probability of drawing one specific marble." } ] },
                        { "questionNumber": 5, "calculator": false, "type": "chart", "passage": "<div class='passage-text'><b>Daily High Temperatures (°F): 65, 68, 72, 72, 75, 78, 81</b></div>", "question": "What is the range of the daily high temperatures?", "answerOptions": [ { "text": "72", "isCorrect": false, "rationale": "72 is the mode and median." }, { "text": "16", "isCorrect": true, "rationale": "The range is the difference between the highest and lowest value: $81 - 65 = 16$." }, { "text": "73", "isCorrect": false, "rationale": "73 is the mean." }, { "text": "81", "isCorrect": false, "rationale": "81 is the highest temperature." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "If you roll a standard six-sided die, what is the probability of rolling an even number?", "answerOptions": [ { "text": "$\\frac{1}{6}$", "isCorrect": false, "rationale": "This is the probability of rolling one specific number." }, { "text": "$\\frac{1}{3}$", "isCorrect": false, "rationale": "There are 3 even numbers (2, 4, 6) out of 6 total possibilities." }, { "text": "$\\frac{1}{2}$", "isCorrect": true, "rationale": "There are 3 even numbers (2, 4, 6) out of 6 total possibilities. The probability is $\\frac{3}{6}$, which simplifies to $\\frac{1}{2}$." }, { "text": "$\\frac{2}{3}$", "isCorrect": false, "rationale": "This is the probability of rolling a number greater than 2." } ] },
                        { "questionNumber": 7, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>Ages of employees: 22, 25, 28, 34, 46</b></div>", "question": "What is the median age of the employees?", "answerOptions": [ { "text": "22", "isCorrect": false, "rationale": "This is the minimum age." }, { "text": "28", "isCorrect": true, "rationale": "The ages are already in order. The median is the middle value, which is 28." }, { "text": "31", "isCorrect": false, "rationale": "31 is the mean." }, { "text": "46", "isCorrect": false, "rationale": "This is the maximum age." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "A spinner is divided into 8 equal sections, numbered 1 through 8. What is the probability of spinning a number greater than 5?", "answerOptions": [ { "text": "$\\frac{1}{8}$", "isCorrect": false, "rationale": "This is the probability of spinning one specific number." }, { "text": "$\\frac{3}{8}$", "isCorrect": true, "rationale": "The numbers greater than 5 are 6, 7, and 8. That's 3 favorable outcomes out of 8 total possibilities." }, { "text": "$\\frac{5}{8}$", "isCorrect": false, "rationale": "This is the probability of spinning 5 or less." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "$\\frac{1}{2}$ would be 4 sections." } ] },
                        { "questionNumber": 9, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>Number of books read per month: 2, 3, 3, 5, 7, 10</b></div>", "question": "What is the mean number of books read?", "answerOptions": [ { "text": "3", "isCorrect": false, "rationale": "3 is the mode." }, { "text": "4", "isCorrect": false, "rationale": "4 is the median." }, { "text": "5", "isCorrect": true, "rationale": "The sum is $2+3+3+5+7+10 = 30$. The mean is $30 / 6 = 5$." }, { "text": "8", "isCorrect": false, "rationale": "8 is the range." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "From a standard deck of 52 cards, what is the probability of drawing a king?", "answerOptions": [ { "text": "$\\frac{1}{52}$", "isCorrect": false, "rationale": "This is the probability of drawing a specific king, not any king." }, { "text": "$\\frac{1}{13}$", "isCorrect": true, "rationale": "There are 4 kings in a 52-card deck. The probability is $\\frac{4}{52}$, which simplifies to $\\frac{1}{13}$." }, { "text": "$\\frac{1}{4}$", "isCorrect": false, "rationale": "This is the probability of drawing a specific suit." }, { "text": "$\\frac{4}{13}$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 11, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>Points scored in 5 games: 10, 15, 12, 10, 18</b></div>", "question": "What is the mode of the points scored?", "answerOptions": [ { "text": "10", "isCorrect": true, "rationale": "The mode is the value that appears most frequently. 10 appears twice." }, { "text": "12", "isCorrect": false, "rationale": "12 is the median." }, { "text": "13", "isCorrect": false, "rationale": "13 is the mean." }, { "text": "8", "isCorrect": false, "rationale": "8 is the range." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "If you flip a coin twice, what is the probability of getting heads both times?", "answerOptions": [ { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "This is the probability of getting heads on a single flip." }, { "text": "$\\frac{1}{3}$", "isCorrect": false, "rationale": "There are 4 possible outcomes (HH, HT, TH, TT)." }, { "text": "$\\frac{1}{4}$", "isCorrect": true, "rationale": "The probability of the first heads is $\\frac{1}{2}$. The probability of the second is $\\frac{1}{2}$. The combined probability is $\\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$." }, { "text": "1", "isCorrect": false, "rationale": "This would mean it is a certain outcome." } ] },
                        { "questionNumber": 13, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>A student's grades are 80, 85, and 90. What grade do they need on the fourth test to have an average of 85?</b></div>", "question": "What grade is needed on the fourth test for an average of 85?", "answerOptions": [ { "text": "80", "isCorrect": false, "rationale": "This would result in an average of 83.75." }, { "text": "85", "isCorrect": true, "rationale": "To have an average of 85 over 4 tests, the total score must be $85 \\times 4 = 340$. The current sum is $80+85+90 = 255$. The needed score is $340 - 255 = 85$." }, { "text": "90", "isCorrect": false, "rationale": "This would result in an average of 86.25." }, { "text": "95", "isCorrect": false, "rationale": "This would result in an average of 87.5." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "A company has 100 employees. 60 are full-time and 40 are part-time. If an employee is selected at random, what is the probability they are part-time?", "answerOptions": [ { "text": "$\\frac{3}{5}$", "isCorrect": false, "rationale": "This is the probability of selecting a full-time employee." }, { "text": "$\\frac{2}{5}$", "isCorrect": true, "rationale": "The probability is $\\frac{40}{100}$, which simplifies to $\\frac{2}{5}$." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "This would be true if there were 50 of each." }, { "text": "$\\frac{1}{40}$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 15, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>Number of daily customers: 102, 115, 98, 120, 115, 130</b></div>", "question": "What is the median number of customers?", "answerOptions": [ { "text": "115", "isCorrect": true, "rationale": "Order the numbers: 98, 102, 115, 115, 120, 130. The median is the average of the two middle numbers (115 and 115), which is 115." }, { "text": "113.3", "isCorrect": false, "rationale": "This is the mean." }, { "text": "98", "isCorrect": false, "rationale": "This is the minimum." }, { "text": "32", "isCorrect": false, "rationale": "This is the range." } ] },
                        { "questionNumber": 16, "calculator": true, "type": "chart", "passage": "<div class='passage-text'><b>Final Exam Scores: 75, 80, 80, 85, 90, 95, 100</b></div>", "question": "What is the mode of the final exam scores?", "answerOptions": [ { "text": "80", "isCorrect": true, "rationale": "The mode is the number that appears most frequently in a data set. The score 80 appears twice." }, { "text": "85", "isCorrect": false, "rationale": "85 is the median of the scores." }, { "text": "86.4", "isCorrect": false, "rationale": "This is the approximate mean of the scores." }, { "text": "25", "isCorrect": false, "rationale": "25 is the range of the scores (100 - 75)." } ] },
                        { "questionNumber": 17, "calculator": true, "question": "A bag contains 3 red marbles, 7 blue marbles, and 5 green marbles. What is the probability of NOT drawing a blue marble?", "answerOptions": [ { "text": "$\\frac{7}{15}$", "isCorrect": false, "rationale": "This is the probability of drawing a blue marble." }, { "text": "$\\frac{8}{15}$", "isCorrect": true, "rationale": "There are 15 total marbles (3+7+5). The number of non-blue marbles is 3 (red) + 5 (green) = 8. So the probability is 8/15." }, { "text": "$\\frac{1}{3}$", "isCorrect": false, "rationale": "This is the probability of drawing a green marble (5/15)." }, { "text": "$\\frac{1}{5}$", "isCorrect": false, "rationale": "This is the probability of drawing a red marble (3/15)." } ] },
                        { "questionNumber": 15, "calculator": true, "type": "graph", "passage": "<div class='passage-text'>A line passes through the points (0, 2) and (3, 8).</div>", "question": "What is the slope of the line?", "answerOptions": [ { "text": "2", "isCorrect": true, "rationale": "The slope is the change in y divided by the change in x: $(8 - 2) / (3 - 0) = 6 / 3 = 2$." }, { "text": "3", "isCorrect": false, "rationale": "This is the change in x." }, { "text": "6", "isCorrect": false, "rationale": "This is the change in y." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "This is the reciprocal of the correct slope." } ] },
                        { "questionNumber": 16, "calculator": true, "question": "What is the y-intercept of the equation $y = 3x - 4$?", "answerOptions": [ { "text": "3", "isCorrect": false, "rationale": "3 is the slope of the line." }, { "text": "-4", "isCorrect": true, "rationale": "In the slope-intercept form $y = mx + b$, 'b' is the y-intercept. In this case, it's -4." }, { "text": "4", "isCorrect": false, "rationale": "The y-intercept is negative." }, { "text": "$\\frac{4}{3}$", "isCorrect": false, "rationale": "This is the x-intercept." } ] },
                        { "questionNumber": 17, "calculator": false, "question": "If $f(x) = 2x^2 + 5x - 3$, what is the value of $f(-2)$?", "answerOptions": [ { "text": "-5", "isCorrect": true, "rationale": "Substitute -2 for x: $f(-2) = 2(-2)^2 + 5(-2) - 3 = 2(4) - 10 - 3 = 8 - 10 - 3 = -5$." }, { "text": "1", "isCorrect": false, "rationale": "Incorrect calculation. $2(4) - 10 - 3 = -5$." }, { "text": "21", "isCorrect": false, "rationale": "Incorrectly handled the negative signs. $5(-2)$ is -10." }, { "text": "-15", "isCorrect": false, "rationale": "Incorrect calculation of the exponent. $(-2)^2$ is 4, not -4." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "A rectangle is 8 inches long and 5 inches wide. What is its area?", "answerOptions": [ { "text": "40 sq in", "isCorrect": true, "rationale": "The area of a rectangle is length times width. $8 \\times 5 = 40$." }, { "text": "26 in", "isCorrect": false, "rationale": "This is the perimeter of the rectangle." }, { "text": "13 in", "isCorrect": false, "rationale": "This is the sum of the length and width." }, { "text": "64 sq in", "isCorrect": false, "rationale": "This would be the area if it were a square with side 8." } ] },
                        { "questionNumber": 16, "calculator": true, "question": "What is the circumference of a circle with a radius of 5 cm? (Use $\\pi \\approx 3.14$)", "answerOptions": [ { "text": "15.7 cm", "isCorrect": false, "rationale": "This is the semi-circumference ($\\pi r$)." }, { "text": "31.4 cm", "isCorrect": true, "rationale": "The formula for circumference is $C = 2\\pi r$. So, $C = 2 \\times 3.14 \\times 5 = 31.4$ cm." }, { "text": "78.5 sq cm", "isCorrect": false, "rationale": "This is the area of the circle ($\\pi r^2$)." }, { "text": "10 cm", "isCorrect": false, "rationale": "This is the diameter of the circle." } ] },
                        { "questionNumber": 17, "calculator": false, "question": "Two angles in a triangle measure 40 degrees and 60 degrees. What is the measure of the third angle?", "answerOptions": [ { "text": "80 degrees", "isCorrect": true, "rationale": "The sum of angles in a triangle is always 180 degrees. $180 - (40 + 60) = 180 - 100 = 80$ degrees." }, { "text": "100 degrees", "isCorrect": false, "rationale": "This is the sum of the two given angles." }, { "text": "90 degrees", "isCorrect": false, "rationale": "This would only be true for a right-angled triangle where the other two angles sum to 90." }, { "text": "Cannot be determined", "isCorrect": false, "rationale": "The third angle can be determined with the given information." } ] },
                        { "questionNumber": 18, "calculator": true, "question": "What is the volume of a cube with a side length of 4 inches?", "answerOptions": [ { "text": "12 cubic in", "isCorrect": false, "rationale": "This is the sum of the side lengths (4+4+4)." }, { "text": "16 sq in", "isCorrect": false, "rationale": "This is the area of one face of the cube." }, { "text": "64 cubic in", "isCorrect": true, "rationale": "The volume of a cube is the side length cubed. $V = s^3 = 4^3 = 64$ cubic inches." }, { "text": "96 sq in", "isCorrect": false, "rationale": "This is the surface area of the cube ($6 \\times s^2$)." } ] }
                    ]
                }
            ]
        },
        "Algebraic Problem Solving": {
            description: "Master expressions, equations, graphing, and functions.",
            icon: "VariableIcon", // New Icon
            topics: [
                {
                    id: "math_alg_expressions",
                    title: "Expressions & Polynomials",
                    description: "Working with variables, exponents, and polynomials.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "question": "Simplify the expression: $3x + 2y - x + 5y$", "answerOptions": [ { "text": "$2x + 7y$", "isCorrect": true, "rationale": "Combine like terms: $(3x - x) + (2y + 5y) = 2x + 7y$." }, { "text": "$4x + 7y$", "isCorrect": false, "rationale": "Incorrectly added $3x$ and $x$." }, { "text": "$2x + 3y$", "isCorrect": false, "rationale": "Incorrectly subtracted $2y$ from $5y$." }, { "text": "$9xy$", "isCorrect": false, "rationale": "You cannot combine $x$ and $y$ terms." } ] },
                        { "questionNumber": 2, "calculator": false, "question": "If $x = 4$, what is the value of the expression $5x - 3$?", "answerOptions": [ { "text": "17", "isCorrect": true, "rationale": "Substitute $x$ with 4: $5(4) - 3 = 20 - 3 = 17$." }, { "text": "23", "isCorrect": false, "rationale": "This would be the result if you added 3." }, { "text": "2", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "12", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 3, "calculator": false, "question": "What is the result of $(2x + 3) + (x - 1)$?", "answerOptions": [ { "text": "$3x + 2$", "isCorrect": true, "rationale": "Combine like terms: $(2x + x) + (3 - 1) = 3x + 2$." }, { "text": "$2x + 2$", "isCorrect": false, "rationale": "Forgot to add the $x$ terms correctly." }, { "text": "$3x + 4$", "isCorrect": false, "rationale": "Incorrectly added 3 and 1." }, { "text": "$2x^2 - 2$", "isCorrect": false, "rationale": "This is incorrect; this is addition, not multiplication." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "Which of the following is equivalent to $3(x + 5)$?", "answerOptions": [ { "text": "$3x + 5$", "isCorrect": false, "rationale": "You must distribute the 3 to both terms inside the parentheses." }, { "text": "$3x + 15$", "isCorrect": true, "rationale": "Using the distributive property, $3 \\times x + 3 \\times 5 = 3x + 15$." }, { "text": "$x + 15$", "isCorrect": false, "rationale": "Forgot to multiply the $x$ by 3." }, { "text": "$8x$", "isCorrect": false, "rationale": "This is an incorrect simplification." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "Simplify: $(x^2 + 4x + 5) - (x^2 - 2x - 1)$", "answerOptions": [ { "text": "$2x^2 + 2x + 4$", "isCorrect": false, "rationale": "Incorrectly added the $x^2$ terms." }, { "text": "$6x + 6$", "isCorrect": true, "rationale": "Distribute the negative: $x^2 + 4x + 5 - x^2 + 2x + 1$. Combine like terms: $(x^2-x^2) + (4x+2x) + (5+1) = 6x + 6$." }, { "text": "$2x + 4$", "isCorrect": false, "rationale": "Incorrectly subtracted $2x$ from $4x$." }, { "text": "$6x + 4$", "isCorrect": false, "rationale": "Incorrectly subtracted 1 from 5." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "Evaluate the expression $2a + 3b$ if $a = 5$ and $b = -2$.", "answerOptions": [ { "text": "16", "isCorrect": false, "rationale": "This would be the result if $b$ were 2." }, { "text": "4", "isCorrect": true, "rationale": "$2(5) + 3(-2) = 10 - 6 = 4$." }, { "text": "10", "isCorrect": false, "rationale": "This is just the first part of the expression." }, { "text": "1", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 7, "calculator": true, "question": "What is the product of $(x + 2)(x + 3)$?", "answerOptions": [ { "text": "$x^2 + 5x + 6$", "isCorrect": true, "rationale": "Use the FOIL method: $(x \\cdot x) + (x \\cdot 3) + (2 \\cdot x) + (2 \\cdot 3) = x^2 + 3x + 2x + 6 = x^2 + 5x + 6$." }, { "text": "$x^2 + 6$", "isCorrect": false, "rationale": "Forgot the middle term (the 'OI' in FOIL)." }, { "text": "$x^2 + 6x + 5$", "isCorrect": false, "rationale": "Incorrectly added the constants." }, { "text": "$2x + 5$", "isCorrect": false, "rationale": "This is addition, not multiplication." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "The expression $x^2 - 9$ is an example of:", "answerOptions": [ { "text": "A perfect square trinomial", "isCorrect": false, "rationale": "A trinomial has three terms." }, { "text": "The difference of squares", "isCorrect": true, "rationale": "This is in the form $a^2 - b^2$, where $a=x$ and $b=3$. It factors to $(x-3)(x+3)$." }, { "text": "A monomial", "isCorrect": false, "rationale": "A monomial has one term." }, { "text": "A cubic expression", "isCorrect": false, "rationale": "A cubic expression has a degree of 3." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "Factor the expression: $x^2 + 7x + 12$", "answerOptions": [ { "text": "$(x + 6)(x + 2)$", "isCorrect": false, "rationale": "$6 \\times 2 = 12$, but $6 + 2 = 8$, not 7." }, { "text": "$(x + 3)(x + 4)$", "isCorrect": true, "rationale": "You need two numbers that multiply to 12 and add to 7. These numbers are 3 and 4." }, { "text": "$(x + 12)(x + 1)$", "isCorrect": false, "rationale": "$12 \\times 1 = 12$, but $12 + 1 = 13$, not 7." }, { "text": "$(x - 3)(x - 4)$", "isCorrect": false, "rationale": "This would result in $-7x$, not $+7x$." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "Simplify: $5(x - 2y) - 3(x + y)$", "answerOptions": [ { "text": "$2x - 13y$", "isCorrect": true, "rationale": "Distribute: $5x - 10y - 3x - 3y$. Combine like terms: $(5x - 3x) + (-10y - 3y) = 2x - 13y$." }, { "text": "$2x - 7y$", "isCorrect": false, "rationale": "Incorrectly added $-10y$ and $3y$." }, { "text": "$8x - 13y$", "isCorrect": false, "rationale": "Incorrectly added $5x$ and $3x$." }, { "text": "$2x + 13y$", "isCorrect": false, "rationale": "Incorrectly handled the signs." } ] },
                        { "questionNumber": 11, "calculator": true, "question": "What is the degree of the polynomial $4x^3 - 2x^5 + 7x - 1$?", "answerOptions": [ { "text": "3", "isCorrect": false, "rationale": "This is the degree of the first term." }, { "text": "5", "isCorrect": true, "rationale": "The degree of a polynomial is the highest exponent of its terms, which is 5." }, { "text": "4", "isCorrect": false, "rationale": "This is the number of terms." }, { "text": "1", "isCorrect": false, "rationale": "This is the degree of the third term." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "If $y = -3$, what is the value of $y^2 + 2y - 1$?", "answerOptions": [ { "text": "-16", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "2", "isCorrect": true, "rationale": "$(-3)^2 + 2(-3) - 1 = 9 - 6 - 1 = 2$." }, { "text": "4", "isCorrect": false, "rationale": "This is a calculation error." }, { "text": "-4", "isCorrect": false, "rationale": "Incorrectly calculated $(-3)^2$ as -9." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "Which expression represents '5 less than twice a number n'?", "answerOptions": [ { "text": "$5 - 2n$", "isCorrect": false, "rationale": "This is '5 minus twice a number'." }, { "text": "$2n - 5$", "isCorrect": true, "rationale": "'Twice a number n' is $2n$, and '5 less than' means you subtract 5 from that." }, { "text": "$2(n - 5)$", "isCorrect": false, "rationale": "This is 'twice the difference of a number and 5'." }, { "text": "$n - 5$", "isCorrect": false, "rationale": "This is '5 less than a number'." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "Expand the expression: $(2x - 1)^2$", "answerOptions": [ { "text": "$4x^2 - 1$", "isCorrect": false, "rationale": "Incorrectly squared each term. You must use FOIL: $(2x-1)(2x-1)$." }, { "text": "$4x^2 + 1$", "isCorrect": false, "rationale": "Incorrectly squared each term." }, { "text": "$4x^2 - 4x + 1$", "isCorrect": true, "rationale": "$(2x - 1)(2x - 1) = 4x^2 - 2x - 2x + 1 = 4x^2 - 4x + 1$." }, { "text": "$2x^2 - 4x + 1$", "isCorrect": false, "rationale": "Incorrectly squared $2x$." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "Simplify the expression: $(8x^6) / (2x^3)$", "answerOptions": [ { "text": "$4x^2$", "isCorrect": false, "rationale": "When dividing powers with the same base, you subtract the exponents." }, { "text": "$6x^3$", "isCorrect": false, "rationale": "Incorrectly subtracted the coefficients." }, { "text": "$4x^3$", "isCorrect": true, "rationale": "Divide the coefficients ($8/2 = 4$) and subtract the exponents ($6-3 = 3$)." }, { "text": "$4x^9$", "isCorrect": false, "rationale": "Incorrectly added the exponents." } ] }
                    ]
                },
                {
                    id: "math_alg_equations_inequalities",
                    title: "Equations & Inequalities",
                    description: "Solving linear and quadratic equations and inequalities.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "question": "Solve for x: $3x + 7 = 19$", "answerOptions": [ { "text": "$x = 4$", "isCorrect": true, "rationale": "Subtract 7 from both sides: $3x = 12$. Divide by 3: $x = 4$." }, { "text": "$x = 8.7$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 3$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 12$", "isCorrect": false, "rationale": "This is the value of $3x$, not $x$." } ] },
                        { "questionNumber": 2, "calculator": false, "question": "What is the solution to the inequality $2x - 5 > 11$?", "answerOptions": [ { "text": "$x < 8$", "isCorrect": false, "rationale": "The inequality sign should not be reversed." }, { "text": "$x > 8$", "isCorrect": true, "rationale": "Add 5 to both sides: $2x > 16$. Divide by 2: $x > 8$." }, { "text": "$x > 3$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x < 3$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 3, "calculator": false, "question": "Solve for y: $5y - 8 = 2y + 7$", "answerOptions": [ { "text": "$y = 3$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$y = 5$", "isCorrect": true, "rationale": "Subtract $2y$ from both sides: $3y - 8 = 7$. Add 8 to both sides: $3y = 15$. Divide by 3: $y = 5$." }, { "text": "$y = -1/3$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$y = 15$", "isCorrect": false, "rationale": "This is the value of $3y$, not $y$." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "Which of the following is a solution to the equation $x^2 - 5x + 6 = 0$?", "answerOptions": [ { "text": "$x = 1$", "isCorrect": false, "rationale": "$1^2 - 5(1) + 6 = 1 - 5 + 6 = 2$, not 0." }, { "text": "$x = 2$", "isCorrect": true, "rationale": "The equation factors to $(x-2)(x-3) = 0$. The solutions are $x=2$ and $x=3$." }, { "text": "$x = 5$", "isCorrect": false, "rationale": "$5^2 - 5(5) + 6 = 25 - 25 + 6 = 6$, not 0." }, { "text": "$x = 6$", "isCorrect": false, "rationale": "$6^2 - 5(6) + 6 = 36 - 30 + 6 = 12$, not 0." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "Solve for x: $x/4 + 2 = 5$", "answerOptions": [ { "text": "$x = 12$", "isCorrect": true, "rationale": "Subtract 2 from both sides: $x/4 = 3$. Multiply by 4: $x = 12$." }, { "text": "$x = 28$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 3$", "isCorrect": false, "rationale": "This is the value of $x/4$, not $x$." }, { "text": "$x = 7$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "Solve the inequality: $-3x + 4 \\le 16$", "answerOptions": [ { "text": "$x \\le -4$", "isCorrect": false, "rationale": "When dividing by a negative number, you must flip the inequality sign." }, { "text": "$x \\ge -4$", "isCorrect": true, "rationale": "Subtract 4: $-3x \\le 12$. Divide by -3 and flip the sign: $x \\ge -4$." }, { "text": "$x \\ge 4$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x \\le 4$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 7, "calculator": true, "question": "The sum of two consecutive integers is 35. What are the integers?", "answerOptions": [ { "text": "15 and 20", "isCorrect": false, "rationale": "These are not consecutive." }, { "text": "17 and 18", "isCorrect": true, "rationale": "Let the integers be $x$ and $x+1$. So, $x + (x+1) = 35$. $2x + 1 = 35$. $2x = 34$. $x = 17$. The integers are 17 and 18." }, { "text": "16 and 19", "isCorrect": false, "rationale": "These are not consecutive." }, { "text": "10 and 25", "isCorrect": false, "rationale": "These are not consecutive." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "Solve for b: $A = \\frac{1}{2}bh$ (the formula for the area of a triangle)", "answerOptions": [ { "text": "$b = \\frac{2A}{h}$", "isCorrect": true, "rationale": "Multiply both sides by 2: $2A = bh$. Divide both sides by h: $b = \\frac{2A}{h}$." }, { "text": "$b = \\frac{A}{2h}$", "isCorrect": false, "rationale": "Forgot to multiply by 2." }, { "text": "$b = \\frac{Ah}{2}$", "isCorrect": false, "rationale": "Incorrectly rearranged the formula." }, { "text": "$b = \\frac{2h}{A}$", "isCorrect": false, "rationale": "Incorrectly rearranged the formula." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "What are the solutions to the quadratic equation $x^2 - 16 = 0$?", "answerOptions": [ { "text": "$x = 4$", "isCorrect": false, "rationale": "This is only one of the solutions." }, { "text": "$x = 4$ and $x = -4$", "isCorrect": true, "rationale": "Add 16 to both sides: $x^2 = 16$. Take the square root of both sides: $x = \\pm 4$." }, { "text": "$x = 8$ and $x = -8$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 16$", "isCorrect": false, "rationale": "This is the value of $x^2$." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "Solve for x: $2(x + 3) = 14$", "answerOptions": [ { "text": "$x = 4$", "isCorrect": true, "rationale": "Distribute the 2: $2x + 6 = 14$. Subtract 6: $2x = 8$. Divide by 2: $x = 4$." }, { "text": "$x = 5.5$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 11$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 8$", "isCorrect": false, "rationale": "This is the value of $2x$." } ] },
                        { "questionNumber": 11, "calculator": true, "question": "A number is doubled and then 5 is subtracted from it. The result is 15. What is the number?", "answerOptions": [ { "text": "5", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "10", "isCorrect": true, "rationale": "Let the number be $x$. The equation is $2x - 5 = 15$. Add 5 to both sides: $2x = 20$. Divide by 2: $x = 10$." }, { "text": "12.5", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "20", "isCorrect": false, "rationale": "This is the value of $2x$." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "Which inequality represents the statement 'x is at least 18'?", "answerOptions": [ { "text": "$x < 18$", "isCorrect": false, "rationale": "This means 'x is less than 18'." }, { "text": "$x > 18$", "isCorrect": false, "rationale": "This means 'x is greater than 18'." }, { "text": "$x \\le 18$", "isCorrect": false, "rationale": "This means 'x is at most 18'." }, { "text": "$x \\ge 18$", "isCorrect": true, "rationale": "'At least 18' means 18 or more, which is represented by the greater than or equal to symbol." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "Solve the system of equations: $x + y = 10$ and $x - y = 4$", "answerOptions": [ { "text": "$x = 7, y = 3$", "isCorrect": true, "rationale": "Add the two equations together: $(x+y) + (x-y) = 10+4$, which simplifies to $2x = 14$, so $x=7$. Substitute $x=7$ into the first equation: $7 + y = 10$, so $y=3$." }, { "text": "$x = 6, y = 4$", "isCorrect": false, "rationale": "This does not satisfy the second equation." }, { "text": "$x = 8, y = 2$", "isCorrect": false, "rationale": "This does not satisfy the second equation." }, { "text": "$x = 5, y = 5$", "isCorrect": false, "rationale": "This does not satisfy the second equation." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "Solve for x: $3(x - 4) = 2(x + 1)$", "answerOptions": [ { "text": "$x = 10$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 14$", "isCorrect": true, "rationale": "Distribute: $3x - 12 = 2x + 2$. Subtract $2x$ from both sides: $x - 12 = 2$. Add 12 to both sides: $x = 14$." }, { "text": "$x = -13$", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$x = 5$", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "The length of a rectangle is 5 more than its width. If the perimeter is 50, what is the width?", "answerOptions": [ { "text": "10", "isCorrect": true, "rationale": "Let $w$ be the width and $l$ be the length. $l = w + 5$. Perimeter $P = 2l + 2w$. Substitute: $50 = 2(w+5) + 2w$. $50 = 2w + 10 + 2w$. $50 = 4w + 10$. $40 = 4w$. $w = 10$." }, { "text": "15", "isCorrect": false, "rationale": "15 is the length, not the width." }, { "text": "20", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "25", "isCorrect": false, "rationale": "This is half the perimeter." } ] }
                    ]
                },
                {
                    id: "math_alg_graphing_functions",
                    title: "Graphing & Functions",
                    description: "Understanding slope, graphing lines, and function notation.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "type": "image", "imageUrl": "Images/math_graph_1.png", "question": "What is the slope of the line shown in the graph?", "answerOptions": [ { "text": "2", "isCorrect": true, "rationale": "The line passes through $(0,-1)$ and $(2,3)$. The slope is $(y_2 - y_1) / (x_2 - x_1) = (3 - (-1)) / (2 - 0) = 4 / 2 = 2$." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "This is run/rise, not rise/run." }, { "text": "-2", "isCorrect": false, "rationale": "The line is rising, so the slope is positive." }, { "text": "1", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 2, "calculator": false, "type": "image", "imageUrl": "Images/math_graph_1.png", "question": "What is the y-intercept of the line shown in the graph?", "answerOptions": [ { "text": "$(2, 0)$", "isCorrect": false, "rationale": "This is the x-intercept." }, { "text": "$(0, -1)$", "isCorrect": true, "rationale": "The y-intercept is the point where the line crosses the y-axis, which is at $(0, -1)$." }, { "text": "$(0, 2)$", "isCorrect": false, "rationale": "This is an incorrect point." }, { "text": "$(-1, 0)$", "isCorrect": false, "rationale": "This is an incorrect point." } ] },
                        { "questionNumber": 3, "calculator": false, "question": "Which of the following equations is written in slope-intercept form ($y = mx + b$)?", "answerOptions": [ { "text": "$y = 3x - 2$", "isCorrect": true, "rationale": "This equation is in the form $y = mx + b$, where $m$ is the slope and $b$ is the y-intercept." }, { "text": "$2x + 3y = 6$", "isCorrect": false, "rationale": "This is the standard form of a linear equation." }, { "text": "$y - 4 = 2(x - 1)$", "isCorrect": false, "rationale": "This is the point-slope form." }, { "text": "$x = 5$", "isCorrect": false, "rationale": "This is the equation of a vertical line." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "If $f(x) = 3x + 5$, what is $f(4)$?", "answerOptions": [ { "text": "12", "isCorrect": false, "rationale": "This is just $3 \\times 4$." }, { "text": "17", "isCorrect": true, "rationale": "Substitute $x$ with 4: $f(4) = 3(4) + 5 = 12 + 5 = 17$." }, { "text": "23", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "8", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "What is the slope of the line with the equation $y = -2x + 7$?", "answerOptions": [ { "text": "7", "isCorrect": false, "rationale": "7 is the y-intercept." }, { "text": "-2", "isCorrect": true, "rationale": "In the form $y = mx + b$, $m$ represents the slope. Here, $m = -2$." }, { "text": "2", "isCorrect": false, "rationale": "The slope is negative." }, { "text": "-7", "isCorrect": false, "rationale": "This is an incorrect value." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "Find the slope of the line that passes through the points $(2, 3)$ and $(5, 9)$.", "answerOptions": [ { "text": "2", "isCorrect": true, "rationale": "The slope formula is $(y_2 - y_1) / (x_2 - x_1)$. $(9 - 3) / (5 - 2) = 6 / 3 = 2$." }, { "text": "$\\frac{1}{2}$", "isCorrect": false, "rationale": "This is the reciprocal of the correct slope." }, { "text": "3", "isCorrect": false, "rationale": "This is the change in x." }, { "text": "6", "isCorrect": false, "rationale": "This is the change in y." } ] },
                        { "questionNumber": 7, "calculator": true, "type": "image", "imageUrl": "Images/math_graph_2.png", "question": "Which point is located in Quadrant IV?", "answerOptions": [ { "text": "Point A", "isCorrect": false, "rationale": "Point A is in Quadrant II (x is negative, y is positive)." }, { "text": "Point B", "isCorrect": true, "rationale": "Point B is in Quadrant IV (x is positive, y is negative)." }, { "text": "Point C", "isCorrect": false, "rationale": "Point C is in Quadrant III (x is negative, y is negative)." }, { "text": "Point D", "isCorrect": false, "rationale": "Point D is in Quadrant I (x is positive, y is positive)." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "If a line has a slope of 3 and passes through the point $(1, 2)$, what is its equation in point-slope form?", "answerOptions": [ { "text": "$y - 2 = 3(x - 1)$", "isCorrect": true, "rationale": "Point-slope form is $y - y_1 = m(x - x_1)$. Substituting the values gives $y - 2 = 3(x - 1)$." }, { "text": "$y - 1 = 3(x - 2)$", "isCorrect": false, "rationale": "The x and y coordinates are swapped." }, { "text": "$y = 3x - 1$", "isCorrect": false, "rationale": "This is the slope-intercept form, which would be $y-2=3x-3 -> y=3x-1$." }, { "text": "$y + 2 = 3(x + 1)$", "isCorrect": false, "rationale": "The signs are incorrect." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "What is the y-intercept of the line with the equation $4x + 2y = 10$?", "answerOptions": [ { "text": "10", "isCorrect": false, "rationale": "You must first solve for y." }, { "text": "5", "isCorrect": true, "rationale": "First, convert to slope-intercept form. $2y = -4x + 10$. $y = -2x + 5$. The y-intercept (b) is 5." }, { "text": "-2", "isCorrect": false, "rationale": "-2 is the slope." }, { "text": "2.5", "isCorrect": false, "rationale": "This is the x-intercept." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "If $g(x) = x^2 - 10$, what is $g(3)$?", "answerOptions": [ { "text": "-1", "isCorrect": true, "rationale": "$g(3) = (3)^2 - 10 = 9 - 10 = -1$." }, { "text": "-4", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "19", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "8", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 11, "calculator": true, "type": "image", "imageUrl": "Images/math_graph_3.png", "question": "The graph shows the cost of renting a car based on the number of miles driven. What does the y-intercept of the graph represent?", "answerOptions": [ { "text": "The cost per mile.", "isCorrect": false, "rationale": "The cost per mile is the slope of the line." }, { "text": "The flat fee or initial cost of the rental.", "isCorrect": true, "rationale": "The y-intercept represents the cost when the miles driven (x) is zero, which is the base rental fee." }, { "text": "The total cost of the rental.", "isCorrect": false, "rationale": "The total cost depends on the miles driven." }, { "text": "The maximum number of miles you can drive.", "isCorrect": false, "rationale": "The graph does not show a maximum." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "Which of the following lines is parallel to the line $y = 4x - 1$?", "answerOptions": [ { "text": "$y = -4x + 2$", "isCorrect": false, "rationale": "This line has a different slope." }, { "text": "$y = 4x + 5$", "isCorrect": true, "rationale": "Parallel lines have the same slope. Both lines have a slope of 4." }, { "text": "$y = (1/4)x + 3$", "isCorrect": false, "rationale": "This slope is the reciprocal, not the same." }, { "text": "$y = - (1/4)x - 1$", "isCorrect": false, "rationale": "This is the slope of a perpendicular line." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "The function $C(t) = 20t + 50$ represents the cost of a plumber's visit, where $t$ is the number of hours. What is the cost of a 3-hour visit?", "answerOptions": [ { "text": "$70", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "$110", "isCorrect": true, "rationale": "$C(3) = 20(3) + 50 = 60 + 50 = \\$110$." }, { "text": "$60", "isCorrect": false, "rationale": "This is just the hourly charge for 3 hours." }, { "text": "$50", "isCorrect": false, "rationale": "This is the flat fee." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "What is the x-intercept of the line $3x + 6y = 18$?", "answerOptions": [ { "text": "3", "isCorrect": false, "rationale": "3 is the y-intercept." }, { "text": "6", "isCorrect": true, "rationale": "To find the x-intercept, set $y = 0$. $3x + 6(0) = 18$. $3x = 18$. $x = 6$. The point is $(6,0)$." }, { "text": "2", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "18", "isCorrect": false, "rationale": "This is the constant in the equation." } ] },
                        { "questionNumber": 15, "calculator": true, "type": "image", "imageUrl": "Images/math_graph_4.png", "question": "The graph shows a parabola. What are the coordinates of the vertex?", "answerOptions": [ { "text": "$(0, 4)$", "isCorrect": false, "rationale": "This is the y-intercept." }, { "text": "$(2, 0)$", "isCorrect": false, "rationale": "This is one of the x-intercepts." }, { "text": "$(3, -2)$", "isCorrect": true, "rationale": "The vertex is the lowest point of the parabola, which is at $(3, -2)$." }, { "text": "$(-2, 3)$", "isCorrect": false, "rationale": "This point is not on the graph." } ] }
                    ]
                },
            ]
        },
        "Geometry": {
            description: "Calculate area, perimeter, volume, and apply geometric theorems.",
            icon: "ShapesIcon", // New Icon
            topics: [
                 {
                    id: "math_geom_basics",
                    title: "Geometry Basics",
                    description: "Calculating area, perimeter, volume, and surface area.",
                    type: "quiz",
                    questions: [
                        { "questionNumber": 1, "calculator": false, "type": "image", "imageUrl": "Images/math_geo_1.png", "question": "What is the area of the rectangle shown?", "answerOptions": [ { "text": "15 sq units", "isCorrect": false, "rationale": "This is the perimeter." }, { "text": "50 sq units", "isCorrect": true, "rationale": "Area of a rectangle is length times width. $A = 10 \\times 5 = 50$." }, { "text": "25 sq units", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "30 sq units", "isCorrect": false, "rationale": "This is the perimeter." } ] },
                        { "questionNumber": 2, "calculator": false, "type": "image", "imageUrl": "Images/math_geo_2.png", "question": "What is the area of the triangle shown?", "answerOptions": [ { "text": "24 sq units", "isCorrect": true, "rationale": "Area of a triangle is $\\frac{1}{2} \\times base \\times height$. $A = 0.5 \\times 8 \\times 6 = 24$." }, { "text": "48 sq units", "isCorrect": false, "rationale": "This is base times height, without multiplying by $\\frac{1}{2}$." }, { "text": "14 sq units", "isCorrect": false, "rationale": "This is the sum of the base and height." }, { "text": "30 sq units", "isCorrect": false, "rationale": "This is the perimeter of a 6-8-10 triangle." } ] },
                        { "questionNumber": 3, "calculator": false, "type": "image", "imageUrl": "Images/math_geo_3.png", "question": "What is the circumference of the circle shown? (Use $\\pi \\approx 3.14$)", "answerOptions": [ { "text": "15.7", "isCorrect": false, "rationale": "This is the circumference if 5 were the diameter." }, { "text": "31.4", "isCorrect": true, "rationale": "Circumference is $2 \\pi r$. $C = 2 \\times 3.14 \\times 5 = 31.4$." }, { "text": "78.5", "isCorrect": false, "rationale": "This is the area of the circle." }, { "text": "25", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 4, "calculator": false, "question": "A box has a length of 6 inches, a width of 4 inches, and a height of 3 inches. What is its volume?", "answerOptions": [ { "text": "13 cubic inches", "isCorrect": false, "rationale": "This is the sum of the dimensions." }, { "text": "72 cubic inches", "isCorrect": true, "rationale": "Volume of a rectangular prism is length $\\times$ width $\\times$ height. $V = 6 \\times 4 \\times 3 = 72$." }, { "text": "24 cubic inches", "isCorrect": false, "rationale": "This is just length times width." }, { "text": "54 cubic inches", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 5, "calculator": false, "question": "What is the perimeter of a square with a side length of 7 cm?", "answerOptions": [ { "text": "14 cm", "isCorrect": false, "rationale": "This is twice the side length." }, { "text": "28 cm", "isCorrect": true, "rationale": "Perimeter of a square is $4s$. $P = 4 \\times 7 = 28$." }, { "text": "49 cm", "isCorrect": false, "rationale": "This is the area of the square ($s^2$)." }, { "text": "21 cm", "isCorrect": false, "rationale": "This is three times the side length." } ] },
                        { "questionNumber": 6, "calculator": true, "question": "A cylinder has a radius of 3 meters and a height of 10 meters. What is its volume? (Use $\\pi \\approx 3.14$)", "answerOptions": [ { "text": "94.2 cubic meters", "isCorrect": false, "rationale": "This is the lateral surface area." }, { "text": "282.6 cubic meters", "isCorrect": true, "rationale": "Volume of a cylinder is $\\pi r^2 h$. $V = 3.14 \\times (3^2) \\times 10 = 3.14 \\times 9 \\times 10 = 282.6$." }, { "text": "90 cubic meters", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "314 cubic meters", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 7, "calculator": true, "question": "The perimeter of a rectangle is 30 feet. If the width is 5 feet, what is the length?", "answerOptions": [ { "text": "10 feet", "isCorrect": true, "rationale": "Perimeter $P = 2l + 2w$. $30 = 2l + 2(5)$. $30 = 2l + 10$. $20 = 2l$. $l = 10$." }, { "text": "12.5 feet", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "15 feet", "isCorrect": false, "rationale": "This is half the perimeter." }, { "text": "20 feet", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 8, "calculator": true, "question": "What is the area of a circle with a diameter of 10 inches? (Use $\\pi \\approx 3.14$)", "answerOptions": [ { "text": "31.4 sq inches", "isCorrect": false, "rationale": "This is the circumference." }, { "text": "78.5 sq inches", "isCorrect": true, "rationale": "The diameter is 10, so the radius is 5. Area is $\\pi r^2$. $A = 3.14 \\times 5^2 = 3.14 \\times 25 = 78.5$." }, { "text": "100 sq inches", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "314 sq inches", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 9, "calculator": true, "question": "Find the volume of a sphere with a radius of 3 cm. (Use $\\pi \\approx 3.14$ and formula $V = \\frac{4}{3}\\pi r^3$)", "answerOptions": [ { "text": "37.68 cubic cm", "isCorrect": false, "rationale": "This is the surface area." }, { "text": "113.04 cubic cm", "isCorrect": true, "rationale": "$V = \\frac{4}{3} \\times 3.14 \\times (3^3) = \\frac{4}{3} \\times 3.14 \\times 27 = 4 \\times 3.14 \\times 9 = 113.04$." }, { "text": "84.78 cubic cm", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "28.26 cubic cm", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 10, "calculator": true, "question": "A right triangle has legs of length 5 and 12. What is the length of the hypotenuse?", "answerOptions": [ { "text": "13", "isCorrect": true, "rationale": "Using the Pythagorean theorem, $a^2 + b^2 = c^2$. $5^2 + 12^2 = 25 + 144 = 169$. The square root of 169 is 13." }, { "text": "17", "isCorrect": false, "rationale": "This is the sum of the lengths." }, { "text": "7", "isCorrect": false, "rationale": "This is the difference of the lengths." }, { "text": "60", "isCorrect": false, "rationale": "This is the product of the lengths." } ] },
                        { "questionNumber": 11, "calculator": true, "question": "What is the surface area of a cube with a side length of 4 inches?", "answerOptions": [ { "text": "64 sq inches", "isCorrect": false, "rationale": "This is the volume of the cube." }, { "text": "96 sq inches", "isCorrect": true, "rationale": "A cube has 6 faces. The area of one face is $4 \\times 4 = 16$. The total surface area is $6 \\times 16 = 96$." }, { "text": "16 sq inches", "isCorrect": false, "rationale": "This is the area of one face." }, { "text": "32 sq inches", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 12, "calculator": true, "question": "A triangle has an area of 30 square meters. If its base is 10 meters, what is its height?", "answerOptions": [ { "text": "3 meters", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "6 meters", "isCorrect": true, "rationale": "Area = $\\frac{1}{2}bh$. $30 = \\frac{1}{2}(10)h$. $30 = 5h$. $h = 6$." }, { "text": "15 meters", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "300 meters", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 13, "calculator": true, "question": "The circumference of a circle is 18.84 cm. What is its radius? (Use $\\pi \\approx 3.14$)", "answerOptions": [ { "text": "3 cm", "isCorrect": true, "rationale": "$C = 2 \\pi r$. $18.84 = 2 \\times 3.14 \\times r$. $18.84 = 6.28r$. $r = 18.84 / 6.28 = 3$." }, { "text": "6 cm", "isCorrect": false, "rationale": "6 is the diameter." }, { "text": "9.42 cm", "isCorrect": false, "rationale": "This is an incorrect calculation." }, { "text": "12 cm", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 14, "calculator": true, "question": "A parallelogram has a base of 12 inches and a height of 5 inches. What is its area?", "answerOptions": [ { "text": "17 sq inches", "isCorrect": false, "rationale": "This is the sum of the base and height." }, { "text": "60 sq inches", "isCorrect": true, "rationale": "Area of a parallelogram is base $\\times$ height. $A = 12 \\times 5 = 60$." }, { "text": "30 sq inches", "isCorrect": false, "rationale": "This would be the area if it were a triangle." }, { "text": "34 sq inches", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] },
                        { "questionNumber": 15, "calculator": true, "question": "A trapezoid has bases of length 8 and 12, and a height of 6. What is its area?", "answerOptions": [ { "text": "60", "isCorrect": true, "rationale": "Area of a trapezoid is $\\frac{1}{2}h(b_1 + b_2)$. $A = 0.5 \\times 6 \\times (8 + 12) = 3 \\times 20 = 60$." }, { "text": "120", "isCorrect": false, "rationale": "Forgot to multiply by $\\frac{1}{2}$." }, { "text": "26", "isCorrect": false, "rationale": "This is the sum of the dimensions." }, { "text": "576", "isCorrect": false, "rationale": "This is an incorrect calculation." } ] }
                    ]
                },
            ]
        }
    }
},
    "Social Studies": {
        icon: "GlobeIcon",
        categories: {
            "U.S. History": {
                description: "Explore the events, figures, and ideas that shaped the United States, from its origins to the present day.",
                topics: [
                    {
                        id: "ss_us_hist_foundations",
                        title: "Foundations (Colonial America)",
                        description: "Exploration, Colonial Regions, Mercantilism, and the French & Indian War.",
                        quizzes: [
                            {
                                id: "ss_us_hist_foundations_quiz1",
                                title: "Foundations: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The period from the early 15th century to the early 17th century is known as the Age of Exploration, driven by the 'Three Gs': God, Gold, and Glory. 'Gold' represented the desire for wealth, such as finding new trade routes for valuable spices and extracting resources like silver and gold from new lands.", "question": "Which of the following best exemplifies the motivation of 'Gold' during the Age of Exploration?", "answerOptions": [ { "text": "Building missions to convert indigenous populations.", "isCorrect": false, "rationale": "This is an example of the 'God' motivation." }, { "text": "Establishing a direct sea route to India to trade for spices.", "isCorrect": true, "rationale": "Establishing new trade routes for valuable goods was a primary economic motivation ('Gold')." }, { "text": "Conquering new lands to expand an empire's prestige.", "isCorrect": false, "rationale": "This is an example of the 'Glory' motivation." }, { "text": "Creating detailed maps of newly discovered coastlines.", "isCorrect": false, "rationale": "This was a result of exploration, not the primary motivation." } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "Mercantilism was the dominant economic theory during this period. It held that a nation's wealth and power were best served by increasing exports and collecting precious metals. Colonies were crucial to this system, existing to provide raw materials to the mother country and to serve as a market for its manufactured goods.", "question": "Under the theory of mercantilism, what was the primary purpose of colonies?", "answerOptions": [ { "text": "To become independent, self-sufficient nations.", "isCorrect": false, "rationale": "This is the opposite of mercantilism, which required colonies to be dependent." }, { "text": "To enrich the mother country by providing resources and buying its goods.", "isCorrect": true, "rationale": "Colonies existed to serve the economic interests of the mother country." }, { "text": "To establish free trade agreements with indigenous populations.", "isCorrect": false, "rationale": "Mercantilism is a system of controlled, not free, trade." }, { "text": "To serve as military outposts against rival empires.", "isCorrect": false, "rationale": "While they could serve this function, their primary purpose was economic." } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "Which colonial region was known for its economy based on shipbuilding, fishing, and trade, with small farms due to rocky soil?", "answerOptions": [ { "text": "The Southern Colonies", "isCorrect": false, "rationale": "The Southern Colonies' economy was based on large-scale plantation agriculture." }, { "text": "The Middle Colonies", "isCorrect": false, "rationale": "The Middle Colonies were known as the 'breadbasket' for their grain production." }, { "text": "The New England Colonies", "isCorrect": true, "rationale": "New England's geography led to an economy centered on maritime activities." }, { "text": "The Western Frontier", "isCorrect": false, "rationale": "The Western Frontier was largely undeveloped during this period." } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The Middle Colonies, including New York and Pennsylvania, were characterized by greater religious and ethnic diversity. Fertile soil supported a thriving agricultural economy based on grains like wheat, earning the region the nickname 'the breadbasket colonies.'", "question": "The Middle Colonies were known as the 'breadbasket colonies' because of their:", "answerOptions": [ { "text": "high level of ethnic diversity.", "isCorrect": false, "rationale": "While diverse, the nickname refers to their agricultural output." }, { "text": "successful production of grain crops.", "isCorrect": true, "rationale": "The passage directly links the nickname to the region's grain-based economy." }, { "text": "central role in colonial trade.", "isCorrect": false, "rationale": "While they had important ports, their primary identity was agricultural." }, { "text": "practice of religious toleration.", "isCorrect": false, "rationale": "This was a social characteristic, not the reason for the nickname." } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The economy of the Southern Colonies, such as Virginia, was heavily dependent on:", "answerOptions": [ { "text": "large-scale manufacturing.", "isCorrect": false, "rationale": "Manufacturing was not a significant part of the Southern economy." }, { "text": "cash crop agriculture on large plantations.", "isCorrect": true, "rationale": "The Southern economy was defined by plantations growing crops like tobacco and rice." }, { "text": "fur trading with Native American tribes.", "isCorrect": false, "rationale": "Fur trading was more prominent in the northern colonies." }, { "text": "shipbuilding and international trade.", "isCorrect": false, "rationale": "This was the economic focus of New England." } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_foundations_quiz2",
                                title: "Foundations: Quiz 2",
                                "questions": [
                                    { "questionNumber": 1, "type": "text", "passage": "The French and Indian War (1754-1763) was a conflict between Great Britain and France over territory in North America. The British victory was decisive, and the Treaty of Paris (1763) forced France to cede all of its North American territories east of the Mississippi River to Britain.", "question": "What was a major consequence of the French and Indian War?", "answerOptions": [ { "text": "France expanded its colonial holdings in North America.", "isCorrect": false, "rationale": "France lost nearly all of its North American territory." }, { "text": "Great Britain gained control of vast new territories in North America.", "isCorrect": true, "rationale": "France ceded its territories east of the Mississippi to Britain." }, { "text": "The American colonies declared independence from Britain.", "isCorrect": false, "rationale": "The war's aftermath led to tensions that caused the revolution, but independence was not an immediate consequence." }, { "text": "Spain became the dominant power in North America.", "isCorrect": false, "rationale": "The war established Great Britain as the dominant power." } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The Virginia House of Burgesses, established in 1619, holds what significance in American history?", "answerOptions": [ { "text": "It was the first permanent English settlement in North America.", "isCorrect": false, "rationale": "The first settlement was Jamestown; the House of Burgesses was its assembly." }, { "text": "It was the first representative legislative assembly in the American colonies.", "isCorrect": true, "rationale": "It was the first elected body, setting a precedent for self-government." }, { "text": "It was a trade agreement between colonists and Native Americans.", "isCorrect": false, "rationale": "It was a legislative body, not a trade agreement." }, { "text": "It was a military alliance formed to fight against the French.", "isCorrect": false, "rationale": "It was a political institution, not a military alliance." } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Columbian Exchange refers to the transfer of plants, animals, diseases, and people between the Old World (Europe, Asia, Africa) and the New World (the Americas). From the New World, Europe gained crops like potatoes and maize (corn). From the Old World, the Americas received animals like horses but also devastating diseases like smallpox.", "question": "Which of the following was a direct consequence of the Columbian Exchange?", "answerOptions": [ { "text": "The introduction of horses to the Americas.", "isCorrect": true, "rationale": "Horses came from the Old World to the Americas." }, { "text": "A decrease in the population of Europe.", "isCorrect": false, "rationale": "New crops from the Americas led to a population boom in Europe." }, { "text": "The spread of maize from Europe to the Americas.", "isCorrect": false, "rationale": "The opposite is true; maize went from the Americas to Europe." }, { "text": "An improvement in the health of indigenous populations.", "isCorrect": false, "rationale": "Old World diseases devastated indigenous populations." } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The Mayflower Compact (1620) is significant because it was:", "answerOptions": [ { "text": "a declaration of war against England.", "isCorrect": false, "rationale": "It was an agreement to form a government, not a declaration of war." }, { "text": "an early example of a social contract, where people agreed to form a government and obey its laws.", "isCorrect": true, "rationale": "The signers agreed to create a 'civil body politic' and abide by its rules." }, { "text": "the first constitution of the United States.", "isCorrect": false, "rationale": "The U.S. Constitution was written much later, in 1787." }, { "text": "a document granting religious freedom to all colonists.", "isCorrect": false, "rationale": "It was about forming a government, not granting universal religious freedom." } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The system of indentured servitude was a common way for poor Europeans to migrate to the American colonies. In exchange for passage, they would work for a landowner for a fixed period, typically four to seven years. This system provided a crucial labor force before the large-scale adoption of slavery.", "question": "What was the primary purpose of indentured servitude?", "answerOptions": [ { "text": "To establish a system of permanent, inherited slavery.", "isCorrect": false, "rationale": "Indentured servitude was a temporary labor contract." }, { "text": "To provide a labor force for the colonies.", "isCorrect": true, "rationale": "The system provided a crucial labor force for the growing colonies." }, { "text": "To promote religious diversity in the colonies.", "isCorrect": false, "rationale": "The system's primary purpose was economic (labor)." }, { "text": "To train colonists for military service.", "isCorrect": false, "rationale": "Indentured servitude was a labor system, not a military one." } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_foundations_quiz3",
                                title: "Foundations: Quiz 3",
                                "questions": [
                                    { "questionNumber": 1, "type": "image", "imageUrl": "Images/This-Question-is-based-on-the-following-graph.png", "question": "This map shows the New England colonies. Which economic activity would be most characteristic of this region during the colonial era?", "answerOptions": [ { "text": "Growing tobacco on large plantations.", "isCorrect": false, "rationale": "This was characteristic of the Southern colonies." }, { "text": "Building ships and engaging in maritime trade.", "isCorrect": true, "rationale": "The region's long coastline and forests made shipbuilding and trade central to its economy." }, { "text": "Cultivating wheat on large farms for export.", "isCorrect": false, "rationale": "This was the specialty of the Middle Colonies." }, { "text": "Mining for gold and silver.", "isCorrect": false, "rationale": "There were no significant gold or silver mines in New England." } ] },
                                    { "questionNumber": 2, "type": "image", "imageUrl": "Images/A map of the Triangular Trade routes..jpg", "question": "This map shows the Triangular Trade. The route that transported enslaved Africans from Africa to the Americas was known as the:", "answerOptions": [ { "text": "The Columbian Exchange", "isCorrect": false, "rationale": "The Columbian Exchange refers to the transfer of goods and diseases, not the specific slave route." }, { "text": "The Middle Passage", "isCorrect": true, "rationale": "This is the specific term for the sea journey endured by enslaved Africans across the Atlantic." }, { "text": "The Silk Road", "isCorrect": false, "rationale": "The Silk Road was an ancient trade route connecting the East and West over land." }, { "text": "The Spice Route", "isCorrect": false, "rationale": "This refers to the sea routes from Europe to the East Indies." } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Great Awakening was a religious revival in the 1730s and 1740s that emphasized personal religious experience. It challenged the authority of established church ministers and led to the growth of new Protestant denominations.", "question": "What was a significant effect of the Great Awakening?", "answerOptions": [ { "text": "It strengthened the authority of the established churches.", "isCorrect": false, "rationale": "It challenged traditional religious authority." }, { "text": "It encouraged colonists to question traditional authority.", "isCorrect": true, "rationale": "By emphasizing personal experience, it fostered a spirit of individualism and a willingness to challenge authority." }, { "text": "It led to a decline in religious belief throughout the colonies.", "isCorrect": false, "rationale": "It was a religious 'revival,' increasing religious fervor." }, { "text": "It unified all colonial churches under one denomination.", "isCorrect": false, "rationale": "It led to the growth of new denominations, increasing diversity." } ] },
                                    { "questionNumber": 4, "type": "image", "imageUrl": "Images/American_School_-_Join_or_Die_drawing_considers_the_first_political_cartoon_published_in_the_Penns_-_(MeisterDrucke-971488).jpg", "question": "This political cartoon by Benjamin Franklin, created in 1754, was used to promote the Albany Plan of Union. What was the primary goal of this plan?", "answerOptions": [ { "text": "To declare independence from Great Britain.", "isCorrect": false, "rationale": "The plan was proposed before the revolutionary period and did not call for independence." }, { "text": "To create a unified colonial government for defense against the French.", "isCorrect": true, "rationale": "The plan aimed to unite the colonies for common defense at the start of the French and Indian War." }, { "text": "To abolish slavery in all thirteen colonies.", "isCorrect": false, "rationale": "Abolition was not a goal of the Albany Plan." }, { "text": "To establish a single currency for all the colonies.", "isCorrect": false, "rationale": "The primary goal was defense, not currency." } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "Which colony was founded by William Penn as a haven for Quakers and was known for its policy of religious toleration?", "answerOptions": [ { "text": "Massachusetts", "isCorrect": false, "rationale": "Massachusetts was founded by Puritans and was not initially tolerant of other religions." }, { "text": "Virginia", "isCorrect": false, "rationale": "Virginia was founded primarily for economic reasons and had an established Anglican church." }, { "text": "Pennsylvania", "isCorrect": true, "rationale": "Pennsylvania was established by William Penn with the specific goal of providing a place for Quakers and others to practice their religion freely." }, { "text": "Georgia", "isCorrect": false, "rationale": "Georgia was founded as a buffer colony and a place for debtors." } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_revolution",
                        title: "The American Revolution (1763-1783)",
                        description: "Causes (Stamp Act, Intolerable Acts), Declaration of Independence, Key Battles (Saratoga, Yorktown), Treaty of Paris.",
                        quizzes: [
                            {
                                id: "ss_us_hist_revolution_quiz1",
                                title: "The American Revolution: Quiz 1",
                                questions: [
                                    { questionNumber: 1, type: 'text', passage: "After the French and Indian War (1754-1763), Great Britain was left with a significant war debt. To manage this debt, the British Parliament began imposing new taxes on the American colonies. Acts like the Stamp Act (1765) and the Townshend Acts (1767) taxed goods such as paper, glass, and tea. Colonists strongly protested these taxes, arguing that they were a form of 'taxation without representation,' since the colonies had no elected representatives in the British Parliament to voice their interests.", question: "What was the primary argument used by American colonists to protest the taxes imposed by the British Parliament after 1763?", answerOptions: [ { text: "The taxes were economically ruinous and would destroy colonial businesses.", rationale: "While the economic burden was a concern, the core *political* argument was about the lack of representation, not just the economic impact.", isCorrect: false }, { text: "The taxes violated their rights as British citizens because they were not represented in Parliament.", rationale: "Correct. The slogan 'taxation without representation' captures the central grievance: that Parliament had no authority to tax them without their consent, which could only be given through their own elected representatives.", isCorrect: true }, { text: "The taxes were intended to punish the colonies for their role in the French and Indian War.", rationale: "The passage states the taxes were to manage war debt, not as a punishment for the war itself.", isCorrect: false }, { text: "The taxes unfairly benefited French merchants over American merchants.", rationale: "The issue was with British taxation, not benefits for the French. The conflict was between the colonies and Great Britain.", isCorrect: false } ] },
                                    { questionNumber: 2, type: 'quote', passage: "'We hold these truths to be self-evident, that all men are created equal, that they are endowed by their Creator with certain unalienable Rights, that among these are Life, Liberty and the pursuit of Happiness.--That to secure these rights, Governments are instituted among Men, deriving their just powers from the consent of the governed.' - Declaration of Independence, 1776", question: "The ideas expressed in this excerpt are most directly influenced by which intellectual movement?", answerOptions: [ { text: "The Renaissance", rationale: "The Renaissance focused on art, humanism, and the revival of classical learning, but the direct political philosophy in the quote comes from a later period.", isCorrect: false }, { text: "The Protestant Reformation", rationale: "The Reformation challenged religious authority, but the specific concepts of natural rights and consent of the governed are from the Enlightenment.", isCorrect: false }, { text: "The Enlightenment", rationale: "Correct. Philosophers like John Locke articulated the core ideas of natural (unalienable) rights and the principle that governments derive their legitimacy from the consent of the people they govern. This quote is a direct reflection of Enlightenment political theory.", isCorrect: true }, { text: "The Scientific Revolution", rationale: "The Scientific Revolution emphasized reason and empirical observation, which influenced the Enlightenment, but the political ideas themselves are hallmarks of the Enlightenment.", isCorrect: false } ] },
                                    { questionNumber: 3, type: 'text', passage: "The American victory at the Battle of Saratoga in 1777 is widely considered the turning point of the Revolutionary War. The defeat of a major British army convinced France that the American colonists could potentially win the war. As a result, France formally recognized American independence and entered the war as an ally of the United States, providing crucial military and financial support that was instrumental in the final victory at Yorktown.", question: "What was the most important strategic outcome of the American victory at Saratoga?", answerOptions: [ { text: "It was the final battle that ended the Revolutionary War.", rationale: "The passage states that the final victory was at Yorktown. Saratoga was a turning point, not the end.", isCorrect: false }, { text: "It secured a crucial foreign alliance with France.", rationale: "Correct. The passage explicitly states that the victory at Saratoga convinced France to become an ally, which provided the 'crucial military and financial support' needed to win the war.", isCorrect: true }, { text: "It resulted in the capture of the British capital in North America.", rationale: "Saratoga was a field victory in upstate New York; it did not involve the capture of a major capital city like New York or Philadelphia at that time.", isCorrect: false }, { text: "It was the first time the colonial militia defeated British regular troops.", rationale: "While a major victory, it was not the first time colonists had successfully engaged British troops (e.g., Lexington and Concord, Bunker Hill). Its strategic importance was in securing the French alliance.", isCorrect: false } ] },
                                    { questionNumber: 4, type: 'cause-effect', question: "Which statement best describes the cause-and-effect relationship between the French and Indian War and the American Revolution?", answerOptions: [ { text: "The American victory in the French and Indian War gave the colonies the confidence to declare independence.", rationale: "The war was a victory for the British, with colonists fighting alongside them. The confidence came later from protesting British policies.", isCorrect: false }, { text: "The French and Indian War created a permanent alliance between the British and Native American tribes, angering the colonists.", rationale: "The war fractured relationships between the British and many tribes. The Proclamation of 1763, which restricted colonial settlement, was a greater source of anger.", isCorrect: false }, { text: "The debt Great Britain incurred from the French and Indian War led to taxation policies that angered the colonists.", rationale: "Correct. The war was very expensive for Britain. The subsequent attempt to pay down that debt by taxing the colonies directly, without their political representation, was a primary cause of the Revolution.", isCorrect: true }, { text: "The French, after losing the war, encouraged the American colonies to rebel against their British rulers.", rationale: "French support came much later, after the Revolution had already begun and the colonists proved they could win at Saratoga.", isCorrect: false } ] },
                                    { questionNumber: 5, type: 'text', passage: "In response to the Boston Tea Party in 1773, where colonists destroyed a shipment of British tea, the British Parliament passed a series of punitive measures in 1774 known in the colonies as the Intolerable Acts (or Coercive Acts). These acts closed the port of Boston until the tea was paid for, restricted town meetings in Massachusetts, and allowed British officials accused of crimes to be tried in Britain. These measures were intended to punish Massachusetts and isolate it from the other colonies.", question: "What was the most significant, unintended consequence of the Intolerable Acts?", answerOptions: [ { text: "They successfully forced Massachusetts colonists to pay for the destroyed tea.", rationale: "The acts did not lead to the colonists paying for the tea; instead, they escalated tensions.", isCorrect: false }, { text: "They caused other colonies to sever ties with Massachusetts for fear of similar punishment.", rationale: "The acts had the opposite effect. Instead of isolating Massachusetts, they unified the colonies against what they saw as British tyranny.", isCorrect: false }, { text: "They were repealed after colonial leaders sent a petition to the King.", rationale: "The acts were not repealed and were a direct cause of further revolutionary action.", isCorrect: false }, { text: "They unified the colonies in their opposition to British rule, leading to the First Continental Congress.", rationale: "Correct. Rather than isolating Massachusetts, the harshness of the acts convinced other colonies that their own rights were in jeopardy, prompting them to convene the First Continental Congress to coordinate a response.", isCorrect: true } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_revolution_quiz2",
                                title: "The American Revolution: Quiz 2",
                                questions: [
                                    { questionNumber: 1, type: 'knowledge', question: "During the American Revolution, colonists who supported independence were known as Patriots. What was the term for colonists who remained loyal to Great Britain?", answerOptions: [ { text: "Separatists", rationale: "This term is more commonly associated with the Pilgrims who wanted to separate from the Church of England.", isCorrect: false }, { text: "Federalists", rationale: "This term refers to those who supported the ratification of the U.S. Constitution after the Revolution.", isCorrect: false }, { text: "Tories", rationale: "Correct. Colonists who remained loyal to the British Crown were often called Loyalists or, using the name of the British political party that supported the monarchy, Tories.", isCorrect: true }, { text: "Abolitionists", rationale: "This term refers to people who advocated for the abolition of slavery, a movement that gained prominence later.", isCorrect: false } ] },
                                    { questionNumber: 2, type: 'quote', passage: "'Every thing that is right or reasonable pleads for separation. The blood of the slain, the weeping voice of nature cries, 'TIS TIME TO PART.' - Thomas Paine, Common Sense, 1776", question: "What was the primary purpose of Thomas Paine's pamphlet, Common Sense?", answerOptions: [ { text: "To negotiate a peaceful settlement with King George III.", rationale: "The quote 'TIS TIME TO PART' shows that the purpose was the opposite of seeking a peaceful settlement; it was a call for a definitive break.", isCorrect: false }, { text: "To persuade undecided American colonists to support independence from Britain.", rationale: "Correct. Common Sense was written in plain, powerful language to make a compelling, emotional, and logical case for independence, and it was incredibly effective in swaying public opinion.", isCorrect: true }, { text: "To outline a new system of government for the United States.", rationale: "While Paine argued for a republic, the pamphlet's main goal was to argue for independence itself, not to draft a detailed constitution.", isCorrect: false }, { text: "To recruit soldiers for the Continental Army.", rationale: "While it likely inspired people to fight, its primary purpose was political persuasion, not direct military recruitment.", isCorrect: false } ] },
                                    { questionNumber: 3, type: 'knowledge', question: "Who was appointed Commander-in-Chief of the Continental Army during the American Revolution?", answerOptions: [ { text: "Thomas Jefferson", rationale: "Thomas Jefferson was the primary author of the Declaration of Independence and served as a diplomat, but he was not a military commander.", isCorrect: false }, { text: "Benjamin Franklin", rationale: "Benjamin Franklin was a key diplomat who helped secure the alliance with France, but he did not lead the army.", isCorrect: false }, { text: "John Adams", rationale: "John Adams was a leading voice for independence in the Continental Congress and a diplomat, but not the military leader.", isCorrect: false }, { text: "George Washington", rationale: "Correct. The Second Continental Congress appointed George Washington as the Commander-in-Chief of the Continental Army in 1775, and he led the army throughout the war.", isCorrect: true } ] },
                                    { questionNumber: 4, type: 'text', passage: "The Treaty of Paris, signed in 1783, formally ended the American Revolutionary War. The key terms of the treaty included Great Britain's formal recognition of the United States as an independent nation. It also established the boundaries of the new nation, granting the U.S. territory that stretched west to the Mississippi River, north to the Great Lakes, and south to Florida.", question: "Besides the recognition of American independence, what was another significant outcome of the Treaty of Paris?", answerOptions: [ { text: "The United States was required to pay war reparations to Great Britain.", rationale: "The treaty did not require the U.S. to pay reparations to Britain.", isCorrect: false }, { text: "France received all of Britain's former territories in North America.", rationale: "The treaty granted territory to the United States, not France.", isCorrect: false }, { text: "The United States gained a vast amount of new territory, significantly expanding its borders.", rationale: "Correct. The treaty granted the U.S. control of the territory west to the Mississippi River, which was a massive expansion of its land.", isCorrect: true }, { text: "Great Britain agreed to help the United States establish its new government.", rationale: "The treaty ended the war but did not include provisions for Britain to assist in the formation of the U.S. government.", isCorrect: false } ] },
                                    { questionNumber: 5, type: 'knowledge', question: "The final, decisive battle of the American Revolution, where Lord Cornwallis surrendered to George Washington, took place at:", answerOptions: [ { text: "Saratoga", rationale: "Saratoga was a crucial turning point, but not the final battle.", isCorrect: false }, { text: "Bunker Hill", rationale: "Bunker Hill was an early battle that showed the colonists' resolve, but it was not the final victory.", isCorrect: false }, { text: "Yorktown", rationale: "Correct. The siege of Yorktown in 1781, with combined American and French forces, led to the surrender of the main British army and effectively ended the war.", isCorrect: true }, { text: "Lexington and Concord", rationale: "These were the first shots of the war, not the end.", isCorrect: false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_revolution_quiz3",
                                title: "The American Revolution: Quiz 3",
                                questions: [
                                    { questionNumber: 1, type: 'image', imageUrl: "Images/join_or_die_cartoon.jpg", question: "This 1754 political cartoon by Benjamin Franklin was originally created to encourage colonial unity during the French and Indian War. How was its message re-purposed during the American Revolution?", answerOptions: [ { text: "It was used by Loyalists to argue that the colonies were too weak to survive without Britain.", rationale: "Patriots, not Loyalists, used this cartoon to argue for unity against Britain.", "isCorrect": false }, { text: "It became a symbol of colonial unity and resistance against British rule.", rationale: "Correct. The powerful message of 'Join, or Die' was easily adapted to represent the need for the colonies to unite against British tyranny or be defeated individually.", "isCorrect": true }, { text: "It was changed to depict a snake attacking a British lion.", rationale: "The original image was powerful enough and did not need to be changed.", "isCorrect": false }, { text: "It lost its relevance and was not used during the Revolution.", rationale: "The cartoon was widely used and became an important symbol of the revolutionary cause.", "isCorrect": false } ] },
                                    { questionNumber: 2, type: 'chart', passage: `<div class="passage-text"><b>Comparing Forces in the American Revolution</b><table class="w-full text-left mt-2"><thead><tr class="border-b"><th class="p-2">Factor</th><th class="p-2">Great Britain</th><th class="p-2">American Colonies</th></tr></thead><tbody><tr class="border-b"><td class="p-2 font-semibold">Population</td><td class="p-2">~ 8 million</td><td class="p-2">~ 2.5 million</td></tr><tr class="border-b"><td class="p-2 font-semibold">Military</td><td class="p-2">Large, well-trained army; powerful navy</td><td class="p-2">Small, inexperienced militia; no navy</td></tr><tr class="border-b"><td class="p-2 font-semibold">Leadership</td><td class="p-2">Experienced officers</td><td class="p-2">Committed, capable leaders (e.g., Washington)</td></tr><tr class="border-b"><td class="p-2 font-semibold">Geography</td><td class="p-2">Long supply lines (3,000 miles)</td><td class="p-2">Fighting on home ground; vast territory</td></tr><tr class="border-b"><td class="p-2 font-semibold">Motivation</td><td class="p-2">Hired mercenaries; varied support at home</td><td class="p-2">Fighting for liberty and independence</td></tr></tbody></table></div>`, question: "Based on the chart, which factor provided the most significant advantage for the American colonies in their war against Great Britain?", answerOptions: [ { text: "Superior military training and equipment.", rationale: "The chart clearly indicates that Great Britain, not the colonies, had the superior military.", isCorrect: false }, { text: "A larger and more supportive population base.", rationale: "The chart shows Great Britain had a much larger population.", isCorrect: false }, { text: "Geographical factors and a stronger motivation for fighting.", rationale: "Correct. The chart shows that fighting on their own vast territory (a geographical advantage) and fighting for a cause like independence (a motivational advantage) were key strengths for the Americans, offsetting British military superiority.", isCorrect: true }, { text: "Support from a powerful and established navy.", rationale: "The chart states the colonies had 'no navy' at the outset.", isCorrect: false } ] },
                                    { questionNumber: 3, type: 'text', passage: "The winter of 1777-1778 at Valley Forge was a time of immense hardship for the Continental Army. Soldiers suffered from a lack of food, clothing, and shelter, and many died from disease. However, the army did not disintegrate. Under the command of George Washington and the training of the Prussian officer Baron von Steuben, the soldiers who remained were forged into a more disciplined and professional fighting force.", "question": "What was the significance of the Continental Army's winter at Valley Forge?", "answerOptions": [ { "text": "It was a major military victory against the British.", "rationale": "Valley Forge was a winter encampment, not a battle.", "isCorrect": false }, { "text": "It marked the end of the Revolutionary War.", "rationale": "The war continued for several more years after Valley Forge.", "isCorrect": false }, { "text": "Despite extreme hardship, the army emerged as a more professional and disciplined force.", "rationale": "Correct. The passage highlights that the training and perseverance during the harsh winter transformed the army.", "isCorrect": true }, { "text": "It led to George Washington being replaced as commander.", "rationale": "Washington's leadership was crucial in holding the army together during this difficult time.", "isCorrect": false } ] },
                                    { questionNumber: 4, type: 'knowledge', question: "What was the main purpose of the Declaration of Independence?", "answerOptions": [ { "text": "To create a detailed plan for the new American government.", "rationale": "The plan for government came later with the Articles of Confederation and the Constitution.", "isCorrect": false }, { "text": "To formally state the colonies' reasons for separating from Great Britain and to articulate their political philosophy.", "rationale": "Correct. The Declaration listed grievances against the King and asserted the philosophical principles (like natural rights) that justified the separation.", "isCorrect": true }, { "text": "To request financial aid from France and Spain.", "rationale": "While the colonists sought foreign aid, that was not the purpose of this specific document.", "isCorrect": false }, { "text": "To offer a final peace proposal to King George III.", "rationale": "It was a declaration of separation, not a peace proposal.", "isCorrect": false } ] },
                                    { questionNumber: 5, type: 'analysis', passage: `<p class="passage-text mb-4"><b>Historian A:</b> The American Revolution was fundamentally an economic conflict. The British Empire's mercantilist policies, such as the Navigation Acts and various taxes, restricted colonial trade and manufacturing. The core of the dispute was the colonists' desire for economic freedom—the ability to trade with whomever they pleased and to develop their own industries without British interference.</p><p class="passage-text"><b>Historian B:</b> The Revolution was primarily a political and ideological struggle. Colonists saw themselves as freeborn Britons entitled to certain rights, most notably the right to be taxed only by their own elected representatives. When Parliament violated this principle, it was seen as an act of tyranny. The conflict was not about the amount of the tax, but the principle of self-government.</p>`, question: "What is the central point of disagreement between Historian A and Historian B?", answerOptions: [ { text: "Whether the colonists were justified in rebelling.", rationale: "Both historians are explaining the causes of the rebellion, not debating its justification.", isCorrect: false }, { text: "The primary motivation behind the colonists' drive for independence.", rationale: "Correct. Historian A argues the main driver was economic freedom (the desire to make more money), while Historian B argues it was political principle (the right of self-government).", isCorrect: true }, { text: "The date when the American Revolution truly began.", rationale: "Neither historian is concerned with dating the start of the Revolution.", isCorrect: false }, { text: "Whether the British policies were fair to the colonists.", rationale: "Both passages imply the policies led to conflict, but their focus is on the colonists' motivation, not the fairness of British actions from a neutral perspective.", isCorrect: false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_new_nation",
                        title: "Westward Expansion",
                        description: "Articles of Confederation, Constitutional Convention, Westward Expansion (Louisiana Purchase, Lewis & Clark).",
                        quizzes: [
                            {
                                id: "ss_us_hist_westward_expansion_quiz1",
                                title: "Westward Expansion: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Manifest Destiny was a widely held cultural belief in the 19th-century United States that American settlers were destined to expand across North America. This idea was used to justify westward expansion, the removal of Native American tribes, and the war with Mexico. Proponents argued that it was not only the nation's destiny but its duty to spread democracy and Protestant Christianity across the continent.", "question": "What was the core idea of Manifest Destiny?", "answerOptions": [ { "text": "That the United States should limit its territory to the original thirteen colonies.", "isCorrect": false }, { "text": "That American settlers were destined to expand across the continent, spreading their institutions with them.", "isCorrect": true }, { "text": "That the United States should form a military alliance with Mexico.", "isCorrect": false }, { "text": "That Native American tribes should be given full citizenship.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "Which of the following events, completed in 1869, was a major catalyst for westward expansion by making travel and trade across the continent significantly faster and cheaper?", "answerOptions": [ { "text": "The Lewis and Clark Expedition", "isCorrect": false }, { "text": "The construction of the Transcontinental Railroad", "isCorrect": true }, { "text": "The California Gold Rush", "isCorrect": false }, { "text": "The passage of the Homestead Act", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Homestead Act of 1862 was a pivotal piece of legislation that encouraged westward migration. It allowed any adult citizen, or intended citizen, who had never borne arms against the U.S. government to claim 160 acres of surveyed government land. Claimants were required to 'improve' the plot by building a dwelling and cultivating the land for five years before receiving full ownership.", "question": "What was the main purpose of the Homestead Act of 1862?", "answerOptions": [ { "text": "To create national parks and preserve wilderness.", "isCorrect": false }, { "text": "To sell government land to railroad companies.", "isCorrect": false }, { "text": "To encourage the settlement of the American West by individual farmers.", "isCorrect": true }, { "text": "To establish large, government-owned farms.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The forced removal of the Cherokee Nation from their ancestral lands in the southeastern United States to territory in present-day Oklahoma is known as the:", "answerOptions": [ { "text": "The Oregon Trail", "isCorrect": false }, { "text": "The Trail of Tears", "isCorrect": true }, { "text": "The Great Migration", "isCorrect": false }, { "text": "The Santa Fe Trail", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The California Gold Rush began in 1848 after gold was discovered at Sutter's Mill. The news of gold brought some 300,000 people to California from the rest of the United States and abroad. This massive influx of 'forty-niners' dramatically increased California's population, leading to its rapid statehood in 1850 and fueling economic growth and westward expansion.", "question": "What was a major consequence of the California Gold Rush?", "answerOptions": [ { "text": "A rapid increase in California's population and its admission to the Union as a state.", "isCorrect": true }, { "text": "A war between the United States and Mexico.", "isCorrect": false }, { "text": "The discovery of a water route to the Pacific Ocean.", "isCorrect": false }, { "text": "A decline in the value of gold.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_westward_expansion_quiz2",
                                title: "Westward Expansion: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The Oregon Trail was a major overland route for westward migration in the 19th century. What was the primary motivation for most pioneers who traveled the Oregon Trail?", "answerOptions": [ { "text": "To find gold and become rich.", "isCorrect": false }, { "text": "To establish new trade routes with Asia.", "isCorrect": false }, { "text": "To acquire fertile farmland and start new lives in the West.", "isCorrect": true }, { "text": "To escape religious persecution in the East.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Mexican-American War (1846-1848) was a conflict between the United States and Mexico, primarily over the U.S. annexation of Texas. The war ended with the Treaty of Guadalupe Hidalgo, in which Mexico ceded a vast territory, known as the Mexican Cession, to the United States. This territory included present-day California, Nevada, Utah, and parts of several other states.", "question": "What was a major outcome of the Mexican-American War?", "answerOptions": [ { "text": "The United States lost territory to Mexico.", "isCorrect": false }, { "text": "The United States acquired a vast amount of territory, significantly expanding its borders.", "isCorrect": true }, { "text": "Mexico and the United States formed a permanent military alliance.", "isCorrect": false }, { "text": "The issue of slavery in the new territories was permanently resolved.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The Battle of the Little Bighorn in 1876, often referred to as 'Custer's Last Stand,' was a significant event in the Great Sioux War. What was the outcome of this battle?", "answerOptions": [ { "text": "A decisive victory for the U.S. Army, leading to the immediate surrender of the Sioux.", "isCorrect": false }, { "text": "A major victory for the Lakota, Cheyenne, and Arapaho tribes against the U.S. Army.", "isCorrect": true }, { "text": "A peace treaty that granted the Sioux permanent control of the Black Hills.", "isCorrect": false }, { "text": "A stalemate that resulted in a temporary truce.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The near-extermination of the American bison (buffalo) in the late 19th century had a devastating impact on the Plains Indians. For these tribes, the bison was a primary source of food, clothing, shelter, and spiritual inspiration. The destruction of the bison herds, driven by commercial hunting and U.S. government policy, was a key factor in forcing the Plains tribes onto reservations.", "question": "What was the primary consequence of the destruction of the bison herds for the Plains Indians?", "answerOptions": [ { "text": "It had little impact, as they primarily relied on farming.", "isCorrect": false }, { "text": "It forced them to migrate to Canada.", "isCorrect": false }, { "text": "It destroyed their traditional way of life and forced them onto reservations.", "isCorrect": true }, { "text": "It led to a shift from hunting to fishing.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The concept of 'popular sovereignty' was a controversial idea during the westward expansion. What did it propose?", "answerOptions": [ { "text": "That the President should have the power to decide the status of slavery in new territories.", "isCorrect": false }, { "text": "That the settlers in a new territory should vote to decide whether to allow slavery.", "isCorrect": true }, { "text": "That Congress should ban slavery in all new territories.", "isCorrect": false }, { "text": "That Native American tribes should have the final say on the status of slavery.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_westward_expansion_quiz3",
                                title: "Westward Expansion: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "Which invention, perfected in the 1870s, played a crucial role in ending the era of the open range and the long cattle drives by allowing ranchers to fence off their lands?", "answerOptions": [ { "text": "The steel plow", "isCorrect": false }, { "text": "The windmill", "isCorrect": false }, { "text": "Barbed wire", "isCorrect": true }, { "text": "The railroad", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Dawes Act of 1887 was a U.S. law that aimed to assimilate Native Americans into mainstream American society. It broke up reservation lands, which were held communally by tribes, and distributed them to individual Native American families. The policy was a failure, leading to the loss of millions of acres of tribal land and a breakdown of traditional Native American cultures.", "question": "What was the primary goal of the Dawes Act of 1887?", "answerOptions": [ { "text": "To strengthen tribal governments and preserve Native American culture.", "isCorrect": false }, { "text": "To encourage Native Americans to assimilate by turning them into individual farmers.", "isCorrect": true }, { "text": "To create new, larger reservations for Native American tribes.", "isCorrect": false }, { "text": "To grant immediate U.S. citizenship to all Native Americans.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The Wounded Knee Massacre in 1890 is considered the final major conflict of the American Indian Wars. What happened at Wounded Knee?", "answerOptions": [ { "text": "A successful peace treaty was signed between the U.S. government and the Lakota.", "isCorrect": false }, { "text": "A battle in which Native American warriors defeated a U.S. Army regiment.", "isCorrect": false }, { "text": "The U.S. Army killed approximately 300 Lakota men, women, and children.", "isCorrect": true }, { "text": "A Ghost Dance ceremony that led to a spiritual revival.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "Frederick Jackson Turner's 'Frontier Thesis,' presented in 1893, was an influential idea in American history. Turner argued that the existence of a frontier—a line between 'civilization' and 'wilderness'—had been a defining characteristic of American culture, fostering individualism, democracy, and innovation. He declared that the frontier had closed, raising questions about the future of American identity.", "question": "According to Frederick Jackson Turner's 'Frontier Thesis,' what role did the frontier play in American history?", "answerOptions": [ { "text": "It was a source of conflict that weakened the nation.", "isCorrect": false }, { "text": "It was a defining force that shaped American character and institutions.", "isCorrect": true }, { "text": "It was a barrier to economic growth and progress.", "isCorrect": false }, { "text": "It had little to no impact on American culture.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The Gadsden Purchase in 1854 was a land deal between the United States and Mexico. What was the primary purpose of this purchase?", "answerOptions": [ { "text": "To acquire land for a southern transcontinental railroad route.", "isCorrect": true }, { "text": "To gain access to new gold mines.", "isCorrect": false }, { "text": "To create a buffer zone between the two countries.", "isCorrect": false }, { "text": "To settle a border dispute over the state of Texas.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_new_nation_quiz1",
                                title: "A New Nation: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Following the Revolutionary War, the newly independent states adopted the Articles of Confederation as their first national government. The Articles created a weak central government, reflecting the states' fear of a strong, centralized authority like the British monarchy. Under the Articles, the national Congress had no power to tax, raise a national army, or regulate interstate commerce. These weaknesses quickly became apparent, leading to events like Shays' Rebellion.", "question": "The primary weakness of the government formed by the Articles of Confederation was that it...", "answerOptions": [ { "text": "gave too much power to the executive branch.", "rationale": "There was no strong executive branch under the Articles; power was concentrated in a weak Congress.", "isCorrect": false }, { "text": "lacked the authority to effectively govern and manage the nation.", "rationale": "Correct. The inability to tax, raise an army, or regulate trade meant the central government was too weak to manage the nation's finances, defense, or economy, leading to instability.", "isCorrect": true }, { "text": "favored the larger states over the smaller states.", "rationale": "This was a key debate during the Constitutional Convention. Under the Articles, each state had one vote, which was a point of contention but not the primary weakness of the government's overall power.", "isCorrect": false }, { "text": "created a judicial system that frequently overruled state laws.", "rationale": "There was no national judicial system under the Articles of Confederation.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What event highlighted the weaknesses of the Articles of Confederation and convinced many national leaders that a stronger central government was needed?", "answerOptions": [ { "text": "The Boston Tea Party", "rationale": "The Boston Tea Party occurred before the Articles were written and was a protest against British rule.", "isCorrect": false }, { "text": "Shays' Rebellion", "rationale": "Correct. Shays' Rebellion, an uprising of debt-ridden farmers in Massachusetts, could not be effectively put down by the weak national government, alarming leaders and demonstrating the need for a stronger federal authority.", "isCorrect": true }, { "text": "The Whiskey Rebellion", "rationale": "The Whiskey Rebellion occurred after the Constitution was ratified and was suppressed by the new, stronger federal government.", "isCorrect": false }, { "text": "The Battle of Yorktown", "rationale": "This was the final major battle of the Revolution, which occurred before the full weaknesses of the Articles became apparent.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Constitutional Convention of 1787 was called to address the problems of the Articles of Confederation. A major point of contention was representation in Congress. The Virginia Plan, favored by large states, proposed representation based on population. The New Jersey Plan, favored by small states, proposed equal representation for all states. The dispute was resolved by the Great Compromise (or Connecticut Compromise), which created a bicameral (two-house) legislature.", "question": "How did the Great Compromise resolve the debate over representation?", "answerOptions": [ { "text": "It created a single legislative house with representation based on population.", "rationale": "This describes the Virginia Plan, which was not adopted in its entirety.", "isCorrect": false }, { "text": "It established a system where all states had equal representation in a single house.", "rationale": "This describes the New Jersey Plan, which was also not adopted in its entirety.", "isCorrect": false }, { "text": "It created a two-house Congress, with one house based on population (House of Representatives) and the other with equal representation (Senate).", "rationale": "Correct. This accurately describes the bicameral solution of the Great Compromise, which balanced the interests of both large and small states.", "isCorrect": true }, { "text": "It allowed states to choose whether their representation would be equal or based on population.", "rationale": "The compromise established a uniform system for all states, not a choice.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The Three-Fifths Compromise, reached during the Constitutional Convention, concerned which of the following issues?", "answerOptions": [ { "text": "The number of votes required to pass a law.", "rationale": "This was determined by the rules of Congress, not the Three-Fifths Compromise.", "isCorrect": false }, { "text": "How to count enslaved people for the purposes of representation and taxation.", "rationale": "Correct. The compromise determined that three-fifths of the enslaved population would be counted when determining a state's population for representation in the House and for levying federal taxes.", "isCorrect": true }, { "text": "The process for admitting new states to the Union.", "rationale": "This process was outlined in the Constitution but was not part of the Three-Fifths Compromise.", "isCorrect": false }, { "text": "The balance of power between the federal government and the states.", "rationale": "This was a broader theme of the convention, addressed by federalism, not this specific compromise.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "To prevent any one branch of the new government from becoming too powerful, the framers of the Constitution created a system of checks and balances. For example, the President (Executive Branch) can veto laws passed by Congress (Legislative Branch). Congress can impeach and remove the President. The Supreme Court (Judicial Branch) can declare laws unconstitutional, a power known as judicial review.", "question": "Which of the following is an example of the system of checks and balances?", "answerOptions": [ { "text": "The President issuing an executive order.", "rationale": "This is a power of the executive branch, but not in itself an example of checking another branch.", "isCorrect": false }, { "text": "The Senate confirming a presidential appointment to the Supreme Court.", "rationale": "Correct. This is an example of the Legislative Branch (Senate) checking the power of the Executive Branch (President) to appoint judges.", "isCorrect": true }, { "text": "A state government passing a law about local schools.", "rationale": "This is an example of federalism, the division of power between state and national governments, not checks and balances between federal branches.", "isCorrect": false }, { "text": "A citizen voting in a presidential election.", "rationale": "This is an example of popular sovereignty, not the system of checks and balances between the branches of government.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_new_nation_quiz2",
                                title: "A New Nation: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The first ten amendments to the U.S. Constitution, which guarantee specific individual rights and liberties, are collectively known as:", "answerOptions": [ { "text": "The Articles of Confederation", "rationale": "The Articles were the first form of national government, replaced by the Constitution.", "isCorrect": false }, { "text": "The Federalist Papers", "rationale": "The Federalist Papers were essays written to persuade people to ratify the Constitution.", "isCorrect": false }, { "text": "The Declaration of Independence", "rationale": "This document declared separation from Britain but is not part of the Constitution.", "isCorrect": false }, { "text": "The Bill of Rights", "rationale": "Correct. The first ten amendments are known as the Bill of Rights and were added to protect individual freedoms from government intrusion.", "isCorrect": true } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "During the debate over the ratification of the Constitution, two opposing groups emerged. The Federalists, led by figures like Alexander Hamilton and James Madison, supported the Constitution and a strong national government. The Anti-Federalists, led by figures like Patrick Henry and George Mason, opposed the Constitution, fearing it would create a government that was too powerful and would threaten individual liberties. The addition of the Bill of Rights was a key compromise to secure ratification.", "question": "Why did the Anti-Federalists push for the inclusion of a Bill of Rights in the Constitution?", "answerOptions": [ { "text": "To strengthen the power of the national government.", "rationale": "They wanted to limit the national government's power, not strengthen it.", "isCorrect": false }, { "text": "To protect individual liberties from potential government overreach.", "rationale": "Correct. The Anti-Federalists' primary concern was that the new national government would be too powerful and would infringe on the rights of the people, so they demanded a written guarantee of those rights.", "isCorrect": true }, { "text": "To ensure the federal government had the power to tax.", "rationale": "The power to tax was a key feature of the Constitution that the Anti-Federalists were generally wary of.", "isCorrect": false }, { "text": "To create a national bank.", "rationale": "The national bank was a later proposal by Hamilton and was not a concern related to the Bill of Rights.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "image", "imageUrl": "Images/Louisiana_Purchase.png", "question": "This map illustrates the impact of the Louisiana Purchase in 1803. What was the most significant effect of this event?", "answerOptions": [ { "text": "It led to an immediate war with France.", "rationale": "The purchase was a peaceful transaction with France, not a cause for war.", "isCorrect": false }, { "text": "It significantly reduced the size of the United States.", "rationale": "The map clearly shows a massive increase in U.S. territory.", "isCorrect": false }, { "text": "It nearly doubled the size of the United States and gave it control of the Mississippi River.", "rationale": "Correct. The Louisiana Purchase was a massive land acquisition that dramatically increased the nation's size and secured control over the vital Mississippi River trade route.", "isCorrect": true }, { "text": "It ended the practice of slavery in all U.S. territories.", "rationale": "The purchase intensified the debate over the expansion of slavery into new territories; it did not end it.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Who were the two explorers President Thomas Jefferson commissioned to lead an expedition to explore the newly acquired Louisiana Territory and find a water route to the Pacific Ocean?", "answerOptions": [ { "text": "Alexander Hamilton and Aaron Burr", "rationale": "These were political rivals, not explorers of the West.", "isCorrect": false }, { "text": "John Adams and John Quincy Adams", "rationale": "These were the second and sixth U.S. Presidents.", "isCorrect": false }, { "text": "Meriwether Lewis and William Clark", "rationale": "Correct. The Lewis and Clark Expedition (1804-1806) was tasked with exploring and mapping the Louisiana Purchase.", "isCorrect": true }, { "text": "Daniel Boone and Davy Crockett", "rationale": "These were famous frontiersmen but were not the leaders of this official government expedition.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The expedition led by Lewis and Clark, also known as the Corps of Discovery, had multiple objectives. They were to map the new territory, establish friendly relations with Native American tribes, document new plant and animal species, and find a practical overland route to the Pacific Ocean. Their journey, which took over two years, provided invaluable information about the American West.", "question": "Which of the following was NOT a primary goal of the Lewis and Clark expedition?", "answerOptions": [ { "text": "To establish large American settlements in the West.", "rationale": "Correct. The primary goal was exploration, mapping, and scientific discovery, not immediate large-scale settlement.", "isCorrect": true }, { "text": "To map the territory of the Louisiana Purchase.", "rationale": "The passage explicitly states that mapping the new territory was one of their objectives.", "isCorrect": false }, { "text": "To document new plants and animals.", "rationale": "The passage lists documenting new species as one of their goals.", "isCorrect": false }, { "text": "To establish trade relations with Native American tribes.", "rationale": "The passage mentions establishing friendly relations with Native American tribes as a key objective.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_new_nation_quiz3",
                                title: "A New Nation: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The principle of dividing governmental power between a central, national government and state governments is known as:", "answerOptions": [ { "text": "Separation of Powers", "rationale": "Separation of powers refers to the division of power among the legislative, executive, and judicial branches of the federal government.", "isCorrect": false }, { "text": "Checks and Balances", "rationale": "Checks and balances is the system that allows each branch to limit the power of the others.", "isCorrect": false }, { "text": "Federalism", "rationale": "Correct. Federalism is the constitutional principle that divides power and authority between the national government and the various state governments.", "isCorrect": true }, { "text": "Popular Sovereignty", "rationale": "Popular sovereignty is the principle that the authority of the government is created and sustained by the consent of its people.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What important precedent was established by the Supreme Court case Marbury v. Madison (1803)?", "answerOptions": [ { "text": "The right to a speedy trial.", "rationale": "This right is guaranteed by the Sixth Amendment.", "isCorrect": false }, { "text": "The principle of judicial review.", "rationale": "Correct. This landmark case established the Supreme Court's power to declare an act of Congress unconstitutional, which is the principle of judicial review.", "isCorrect": true }, { "text": "The supremacy of federal law over state law.", "rationale": "This principle was established in other cases, such as McCulloch v. Maryland, but Marbury v. Madison was about judicial review.", "isCorrect": false }, { "text": "The right to freedom of speech.", "rationale": "This right is guaranteed by the First Amendment.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "President George Washington's Farewell Address, published in 1796, offered his advice to the nation. He warned against the dangers of political factions (or parties), arguing they would lead to division and distract from the public good. He also advised the nation to avoid 'entangling alliances' with foreign powers and to maintain a policy of neutrality in foreign affairs.", "question": "What was one of the key warnings President Washington gave in his Farewell Address?", "answerOptions": [ { "text": "He warned against the dangers of political parties.", "rationale": "Correct. The passage explicitly states that Washington 'warned against the dangers of political factions (or parties).'", "isCorrect": true }, { "text": "He warned that the Constitution was too weak.", "rationale": "Washington supported the Constitution and the strong central government it created.", "isCorrect": false }, { "text": "He advised the nation to seek strong military alliances with European powers.", "rationale": "He advised the opposite, warning against 'entangling alliances.'", "isCorrect": false }, { "text": "He warned that the presidency should be a lifetime appointment.", "rationale": "By stepping down after two terms, he set a precedent against a lifetime presidency.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The first Secretary of the Treasury, Alexander Hamilton, proposed a financial plan to address the nation's debt. Which of the following was a key part of his plan?", "answerOptions": [ { "text": "The immediate abolition of all federal taxes.", "rationale": "Hamilton's plan involved creating new taxes, such as a tax on whiskey, to raise revenue.", "isCorrect": false }, { "text": "The creation of a national bank.", "rationale": "Correct. A central part of Hamilton's plan was the establishment of the Bank of the United States to stabilize the nation's finances and manage its debt.", "isCorrect": true }, { "text": "Giving all federal land to individual states.", "rationale": "Hamilton's plan strengthened federal power, it did not give federal assets away to the states.", "isCorrect": false }, { "text": "Refusing to pay any debts from the Revolutionary War.", "rationale": "Hamilton's plan called for the federal government to assume and pay off the war debts to establish good credit.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The Northwest Ordinance of 1787 was one of the most significant achievements of the Congress under the Articles of Confederation. It established a process for creating new states in the Northwest Territory (the region north of the Ohio River and west of Pennsylvania). It guaranteed religious freedom in the territory, prohibited slavery, and set aside land for public schools.", "question": "What was a major provision of the Northwest Ordinance of 1787?", "answerOptions": [ { "text": "It allowed for the expansion of slavery into the new territories.", "rationale": "The passage explicitly states that the ordinance 'prohibited slavery' in the Northwest Territory.", "isCorrect": false }, { "text": "It established a clear procedure for territories to become states.", "rationale": "Correct. The passage states that the ordinance 'established a process for creating new states.'", "isCorrect": true }, { "text": "It sold the entire territory to France.", "rationale": "The ordinance organized the territory for American settlement, it did not sell it.", "isCorrect": false }, { "text": "It required all settlers to belong to a single, established church.", "rationale": "The passage states it 'guaranteed religious freedom,' not religious uniformity.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_divided_nation",
                        title: "A Nation Divided (1824-1877)",
                        description: "Sectionalism, Manifest Destiny, The Civil War, Reconstruction Amendments (13th, 14th, 15th).",
                        questions: [
                            { "questionNumber": 1, "type": "text", "passage": "Sectionalism, or loyalty to one's own region or section of the country rather than to the country as a whole, intensified in the decades before the Civil War. The North developed an industrial economy based on manufacturing, while the South's economy was agrarian, relying on enslaved labor to produce cash crops like cotton. These economic differences led to conflicting views on issues like tariffs and states' rights.", "question": "What was the primary economic difference that fueled sectionalism between the North and South?", "answerOptions": [ { "text": "The North favored agriculture, while the South focused on manufacturing.", "rationale": "This is the opposite of the historical reality described in the passage.", "isCorrect": false }, { "text": "The North's industrial economy and the South's agrarian, slave-based economy.", "rationale": "Correct. The passage identifies the North's industrial base versus the South's agricultural and slave-labor economy as the fundamental difference.", "isCorrect": true }, { "text": "Both regions were primarily industrial, but competed for the same markets.", "rationale": "The South's economy was not primarily industrial.", "isCorrect": false }, { "text": "The North focused on trade with Europe, while the South focused on trade with Asia.", "rationale": "Both regions traded with Europe, but their economic systems were the source of conflict.", "isCorrect": false } ] },
                            { "questionNumber": 2, "type": "image", "imageUrl": "Images/territorial-gains-by-the-us.jpg", "question": "This map shows the territorial expansion of the United States. The belief that it was the divine destiny of the U.S. to expand across the continent, as depicted here, was known as:", "answerOptions": [ { "text": "The Monroe Doctrine", "rationale": "The Monroe Doctrine was a foreign policy statement warning European nations against colonizing the Americas.", "isCorrect": false }, { "text": "Popular Sovereignty", "rationale": "Popular sovereignty was the idea that settlers in a territory could decide for themselves whether to allow slavery.", "isCorrect": false }, { "text": "Manifest Destiny", "rationale": "Correct. Coined in the 1840s, Manifest Destiny was the widely held belief that American settlers were destined to expand across North America, as shown in the map.", "isCorrect": true }, { "text": "The American System", "rationale": "The American System was an economic plan to promote industry through tariffs and internal improvements.", "isCorrect": false } ] },
                            { "questionNumber": 3, "type": "text", "passage": "The Missouri Compromise of 1820 was an attempt to resolve the issue of slavery's expansion. It admitted Missouri to the Union as a slave state and Maine as a free state, maintaining the balance of power between free and slave states in the Senate. It also prohibited slavery in the rest of the Louisiana Purchase territory north of the 36°30′ parallel.", "question": "What was the main goal of the Missouri Compromise?", "answerOptions": [ { "text": "To abolish slavery in all U.S. territories.", "rationale": "The compromise allowed slavery in Missouri and did not abolish it elsewhere.", "isCorrect": false }, { "text": "To maintain the balance of power between free and slave states.", "rationale": "Correct. By admitting one slave state (Missouri) and one free state (Maine), the compromise preserved the equal balance in the Senate, temporarily defusing the sectional crisis.", "isCorrect": true }, { "text": "To give all western territories the right to popular sovereignty.", "rationale": "The compromise established a specific line (36°30′) to determine where slavery was allowed, rather than letting settlers decide everywhere.", "isCorrect": false }, { "text": "To purchase more territory from France.", "rationale": "The compromise dealt with territory already acquired through the Louisiana Purchase.", "isCorrect": false } ] },
                            { "questionNumber": 4, "type": "knowledge", "question": "Which of the following events was the immediate cause of the secession of the first seven Southern states in 1860-1861?", "answerOptions": [ { "text": "The Supreme Court's Dred Scott decision.", "rationale": "The Dred Scott decision (1857) angered the North and heightened tensions, but it was not the immediate trigger for secession.", "isCorrect": false }, { "text": "John Brown's raid on Harpers Ferry.", "rationale": "John Brown's raid (1859) terrified the South, but it was not the direct cause of secession.", "isCorrect": false }, { "text": "The election of Abraham Lincoln as President.", "rationale": "Correct. The election of Lincoln, who ran on a platform of preventing the expansion of slavery, convinced Southern leaders that their way of life was under threat, leading them to secede before he even took office.", "isCorrect": true }, { "text": "The passage of the Kansas-Nebraska Act.", "rationale": "The Kansas-Nebraska Act (1854) increased tensions by allowing popular sovereignty, but it did not cause immediate secession.", "isCorrect": false } ] },
                            { "questionNumber": 5, "type": "text", "passage": "The Emancipation Proclamation, issued by President Abraham Lincoln in 1863, declared that all enslaved people in the Confederate states 'shall be then, thenceforward, and forever free.' However, it did not apply to the slave-holding border states that had remained in the Union. While its immediate practical effect was limited, it was a crucial turning point, reframing the purpose of the Civil War as a fight against slavery.", "question": "What was a significant limitation of the Emancipation Proclamation when it was issued?", "answerOptions": [ { "text": "It was immediately declared unconstitutional by the Supreme Court.", "rationale": "The Supreme Court did not rule on its constitutionality at the time.", "isCorrect": false }, { "text": "It freed all enslaved people throughout the entire United States.", "rationale": "This is incorrect. The proclamation explicitly did not apply to the loyal border states.", "isCorrect": false }, { "text": "It only applied to enslaved people in Confederate-held territory, where the Union had no power to enforce it.", "rationale": "Correct. The proclamation freed slaves only in the states that had seceded, where the federal government could not enforce the law until the Union army conquered the territory.", "isCorrect": true }, { "text": "It was rejected by the abolitionist movement as being too radical.", "rationale": "Abolitionists generally supported it, though some wished it had gone further.", "isCorrect": false } ] },
                            { "questionNumber": 6, "type": "knowledge", "question": "Which battle is considered the major turning point of the Civil War in the Eastern Theater, after which the Confederacy was largely on the defensive?", "answerOptions": [ { "text": "The Battle of Antietam", "rationale": "Antietam was a crucial Union victory that led to the Emancipation Proclamation, but Gettysburg is considered the major turning point.", "isCorrect": false }, { "text": "The Battle of Gettysburg", "rationale": "Correct. The Union victory at Gettysburg in July 1863, combined with the victory at Vicksburg, marked the turning point of the war. Lee's invasion of the North was repelled, and the Confederate army suffered losses from which it never fully recovered.", "isCorrect": true }, { "text": "The First Battle of Bull Run", "rationale": "This was the first major battle of the war and a Confederate victory, showing the war would be long and bloody.", "isCorrect": false }, { "text": "The Battle of Vicksburg", "rationale": "Vicksburg was the turning point in the Western Theater, as it gave the Union control of the Mississippi River.", "isCorrect": false } ] },
                            { "questionNumber": 7, "type": "text", "passage": "The period after the Civil War, from 1865 to 1877, is known as Reconstruction. The primary goals were to rebuild the South, readmit the former Confederate states to the Union, and integrate the newly freed African Americans into American society. This era saw significant political conflict over how to achieve these goals.", "question": "Which of the following was a primary goal of the Reconstruction era?", "answerOptions": [ { "text": "To punish all former Confederate soldiers.", "rationale": "While some 'Radical Republicans' favored punishment for leaders, the primary goals were focused on reunification and integration.", "isCorrect": false }, { "text": "To establish a separate nation for African Americans in the South.", "rationale": "The goal was to integrate African Americans into American society, not to create a separate nation.", "isCorrect": false }, { "text": "To rebuild the South and integrate newly freed slaves into society.", "rationale": "Correct. The passage identifies rebuilding the South and integrating the freedmen as primary goals of Reconstruction.", "isCorrect": true }, { "text": "To expand U.S. territory by annexing parts of Mexico.", "rationale": "Territorial expansion was not a goal of the Reconstruction era.", "isCorrect": false } ] },
                            { "questionNumber": 8, "type": "knowledge", "question": "Which constitutional amendment formally abolished slavery throughout the United States?", "answerOptions": [ { "text": "The 13th Amendment", "rationale": "Correct. Ratified in 1865, the 13th Amendment abolished slavery and involuntary servitude, except as punishment for a crime.", "isCorrect": true }, { "text": "The 14th Amendment", "rationale": "The 14th Amendment granted citizenship and equal protection under the law.", "isCorrect": false }, { "text": "The 15th Amendment", "rationale": "The 15th Amendment granted African American men the right to vote.", "isCorrect": false }, { "text": "The 12th Amendment", "rationale": "The 12th Amendment revised presidential election procedures.", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "text", "passage": "The 14th Amendment, ratified in 1868, is one of the most consequential amendments to the Constitution. Its first section includes the Citizenship Clause, which grants citizenship to all persons born or naturalized in the U.S., and the Equal Protection Clause, which prohibits states from denying any person within their jurisdiction the equal protection of the laws.", "question": "The 'Equal Protection Clause' of the 14th Amendment was intended to...", "answerOptions": [ { "text": "guarantee that all citizens would have the same income.", "rationale": "The clause guarantees equal treatment under the law, not equal economic outcomes.", "isCorrect": false }, { "text": "ensure that states could not pass discriminatory laws against certain groups of citizens.", "rationale": "Correct. The clause was specifically designed to prevent Southern states from passing discriminatory laws, known as Black Codes, against newly freed African Americans.", "isCorrect": true }, { "text": "give the federal government the power to abolish all state laws.", "rationale": "The clause limits state power but does not abolish state laws wholesale.", "isCorrect": false }, { "text": "guarantee every citizen the right to vote.", "rationale": "The right to vote was addressed separately by the 15th Amendment.", "isCorrect": false } ] },
                            { "questionNumber": 10, "type": "knowledge", "question": "The 15th Amendment to the Constitution, ratified in 1870, stated that the right to vote could not be denied on the basis of...", "answerOptions": [ { "text": "gender.", "rationale": "The 15th Amendment did not grant women the right to vote; that came later with the 19th Amendment.", "isCorrect": false }, { "text": "property ownership.", "rationale": "While property qualifications for voting were being eliminated, this amendment did not address that issue.", "isCorrect": false }, { "text": "race, color, or previous condition of servitude.", "rationale": "Correct. The 15th Amendment was specifically designed to grant African American men the right to vote by prohibiting racial discrimination in voting.", "isCorrect": true }, { "text": "age.", "rationale": "The amendment did not set a national voting age.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "text", "passage": "Despite the passage of the Reconstruction Amendments, Southern states implemented various measures to disenfranchise African American voters. These included poll taxes (requiring a fee to vote), literacy tests (requiring voters to read and interpret complex texts), and grandfather clauses (which allowed a man to vote only if his ancestor had been eligible to vote before 1867).", "question": "How did a 'grandfather clause' work to disenfranchise African Americans?", "answerOptions": [ { "text": "It required voters to prove they owned property, which few African Americans did.", "rationale": "This describes a property qualification, not a grandfather clause.", "isCorrect": false }, { "text": "It exempted white voters from literacy tests and poll taxes while still subjecting Black voters to them.", "rationale": "Correct. Because African Americans could not vote before 1867, these clauses effectively exempted illiterate or poor white voters from the tests and taxes that were used to block Black voters.", "isCorrect": true }, { "text": "It required voters to be a certain age, which most former slaves were not.", "rationale": "This describes an age restriction, not a grandfather clause.", "isCorrect": false }, { "text": "It required voters to pass a test on the Constitution.", "rationale": "This describes a literacy test, which grandfather clauses were designed to help white voters bypass.", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "knowledge", "question": "What was the system of agricultural labor that emerged in the South after the Civil War, in which a landowner allowed a tenant to use the land in return for a share of the crops produced?", "answerOptions": [ { "text": "The plantation system", "rationale": "The plantation system, based on slavery, was abolished by the war.", "isCorrect": false }, { "text": "Sharecropping", "rationale": "Correct. Sharecropping became widespread in the South and often trapped poor farmers, both Black and white, in a cycle of debt.", "isCorrect": true }, { "text": "Indentured servitude", "rationale": "Indentured servitude was a system of temporary labor common in the colonial era.", "isCorrect": false }, { "text": "The factory system", "rationale": "The factory system was characteristic of the industrial North, not Southern agriculture.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "text", "passage": "The Compromise of 1877 is widely considered the end of the Reconstruction era. In a disputed presidential election, Republican Rutherford B. Hayes was awarded the presidency over Democrat Samuel Tilden. In exchange, the Republicans agreed to withdraw the last federal troops from the South. This withdrawal removed the protection for African Americans' civil rights and allowed the white Democratic 'Redeemers' to regain control of Southern state governments.", "question": "What was the most significant result of the Compromise of 1877?", "answerOptions": [ { "text": "It strengthened the federal government's protection of civil rights in the South.", "rationale": "It did the opposite; the withdrawal of federal troops ended this protection.", "isCorrect": false }, { "text": "It marked the end of the Reconstruction era and the federal government's active role in Southern society.", "rationale": "Correct. By removing federal troops, the compromise effectively ended the period of Reconstruction and federal enforcement of civil rights.", "isCorrect": true }, { "text": "It led to the impeachment of President Hayes.", "rationale": "Hayes was not impeached; the compromise gave him the presidency.", "isCorrect": false }, { "text": "It resulted in a new wave of industrialization in the South.", "rationale": "While the 'New South' did see some industrialization, the immediate result of the compromise was political.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "knowledge", "question": "General William T. Sherman's 'March to the Sea' during the Civil War was an example of what military strategy?", "answerOptions": [ { "text": "Guerilla warfare", "rationale": "This was a conventional military campaign, not guerilla warfare.", "isCorrect": false }, { "text": "Trench warfare", "rationale": "Trench warfare was characteristic of World War I, not the Civil War.", "isCorrect": false }, { "text": "Naval blockade", "rationale": "This was a land-based campaign, though the Union did maintain a naval blockade of Southern ports.", "isCorrect": false }, { "text": "Total war", "rationale": "Correct. Sherman's march was a campaign of total war, aimed at destroying not only military targets but also the economic resources and civilian morale that supported the Confederate war effort.", "isCorrect": true } ] },
                            { "questionNumber": 15, "type": "knowledge", "question": "The Union's 'Anaconda Plan' was a key military strategy during the Civil War. What were the two main components of this plan?", "answerOptions": [ { "text": "A massive invasion of Richmond and a diplomatic mission to Great Britain.", "rationale": "While capturing Richmond was a major goal, the Anaconda Plan was focused on economic pressure and division.", "isCorrect": false }, { "text": "A naval blockade of Southern ports and gaining control of the Mississippi River.", "rationale": "Correct. The plan aimed to 'squeeze' the Confederacy by cutting off its trade via a blockade and splitting it in two by controlling the Mississippi.", "isCorrect": true }, { "text": "Encouraging slave rebellions and assassinating Confederate leaders.", "rationale": "These were not official components of the Anaconda Plan's military strategy.", "isCorrect": false }, { "text": "A defensive posture around Washington D.C. and trench warfare in Virginia.", "rationale": "The Anaconda Plan was a proactive, offensive strategy, not a defensive one.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "ss_us_hist_industrial_america",
                        title: "Industrial America (1877-1914)",
                        description: "Industrialization, Immigration, Urbanization, The Progressive Era.",
                        quizzes: [
                            {
                                id: "ss_us_hist_industrial_america_quiz1",
                                title: "Industrial America: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The late 19th century was a period of rapid industrialization in the United States. Key to this was the development of new technologies. The Bessemer process, for example, made the production of steel cheap and efficient. This led to a boom in railroad construction, the building of skyscrapers, and the growth of heavy industry. Innovations like the telephone, invented by Alexander Graham Bell, and the electric light bulb, perfected by Thomas Edison, revolutionized communication and daily life.", "question": "According to the passage, how did the Bessemer process contribute to industrialization?", "answerOptions": [ { "text": "It improved communication between cities.", "isCorrect": false }, { "text": "By making steel production more affordable, it enabled the growth of railroads and construction.", "isCorrect": true }, { "text": "It created a new source of electrical power for factories.", "isCorrect": false }, { "text": "It led to a decrease in the number of factories.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "image", "imageUrl": "Images/Protectors-of-Our-Industries-Political-Cartoon-e1608514567301.jpg", "question": "This political cartoon, titled 'The Protectors of Our Industries,' satirizes the powerful industrialists of the Gilded Age. What term was often used to criticize business leaders like the ones depicted, who used ruthless tactics to amass great wealth?", "answerOptions": [ { "text": "Muckrakers", "isCorrect": false }, { "text": "Progressives", "isCorrect": false }, { "text": "Robber Barons", "isCorrect": true }, { "text": "Philanthropists", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "During the late 19th century, a new wave of immigrants arrived in the United States, primarily from Southern and Eastern Europe. These 'new immigrants' came from countries like Italy, Poland, and Russia. They were often culturally different from earlier immigrants, who had mostly come from Northern and Western Europe. Many 'new immigrants' were Catholic or Jewish, spoke little English, and settled in crowded ethnic neighborhoods in large cities.", "question": "What was a key difference between the 'new immigrants' of the late 19th century and earlier immigrants?", "answerOptions": [ { "text": "Earlier immigrants primarily settled in cities, while 'new immigrants' moved to farms.", "isCorrect": false }, { "text": "'New immigrants' were primarily from Southern and Eastern Europe, unlike earlier immigrants from Northern and Western Europe.", "isCorrect": true }, { "text": "'New immigrants' were fluent in English, while earlier immigrants were not.", "isCorrect": false }, { "text": "'New immigrants' were almost all Protestant, like earlier immigrant groups.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "image", "imageUrl": "Images/licensed-image (13).jpg", "question": "This photograph shows immigrants arriving at Ellis Island in the early 20th century. The process these individuals are undergoing is most likely:", "answerOptions": [ { "text": "a welcoming ceremony with city officials.", "isCorrect": false }, { "text": "a medical and legal inspection to determine their eligibility for admission to the United States.", "isCorrect": true }, { "text": "a recruitment event for the U.S. military.", "isCorrect": false }, { "text": "a class to learn how to speak English.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "image", "imageUrl": "Images/Questions-are-based-on-the-following-graph.-7.png", "question": "This graph shows a significant trend of population growth, similar to the urbanization seen in the U.S. What was a major social problem that arose from the rapid growth of cities in the late 19th and early 20th centuries?", "answerOptions": [ { "text": "A shortage of factory jobs.", "isCorrect": false }, { "text": "Poor living conditions and the spread of disease in tenements.", "isCorrect": true }, { "text": "A lack of cultural diversity in cities.", "isCorrect": false }, { "text": "A decrease in the overall U.S. population.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_industrial_america_quiz2",
                                title: "Industrial America: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "image", "imageUrl": "Images/Bosses-of-the-Senate.jpg", "question": "This political cartoon, 'The Bosses of the Senate,' criticizes the immense power of corporate monopolies during the Gilded Age. How did political machines, which also held great power at the time, maintain their influence?", "answerOptions": [ { "text": "By winning the support of wealthy business owners through fair practices.", "isCorrect": false }, { "text": "By providing essential services and assistance to poor and immigrant communities in exchange for their votes.", "isCorrect": true }, { "text": "By running honest and transparent city governments.", "isCorrect": false }, { "text": "By strictly enforcing laws against corruption and graft.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Progressive Era (roughly 1890-1920) was a period of widespread social activism and political reform. Progressives sought to address the problems caused by industrialization, urbanization, and political corruption. They believed that the government should take a more active role in regulating the economy and protecting the welfare of its citizens.", "question": "What was a core belief of the Progressive movement?", "answerOptions": [ { "text": "That government should be smaller and have less influence (laissez-faire).", "isCorrect": false }, { "text": "That the government should actively intervene to address social and economic problems.", "isCorrect": true }, { "text": "That political machines were the most efficient way to run city governments.", "isCorrect": false }, { "text": "That the United States should return to an agrarian economy.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "Journalists who exposed corruption in business and government during the Progressive Era were known by what name?", "answerOptions": [ { "text": "Yellow Journalists", "isCorrect": false }, { "text": "Muckrakers", "isCorrect": true }, { "text": "Federalists", "isCorrect": false }, { "text": "Abolitionists", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "Upton Sinclair's 1906 novel, 'The Jungle,' was a shocking exposé of the meatpacking industry in Chicago. The book detailed the unsanitary conditions, the exploitation of workers, and the contaminated meat that was sold to the public. The public outcry following the publication of 'The Jungle' led directly to the passage of the Meat Inspection Act and the Pure Food and Drug Act in 1906.", "question": "What was the most direct consequence of the publication of Upton Sinclair's 'The Jungle'?", "answerOptions": [ { "text": "A major strike by meatpacking workers.", "isCorrect": false }, { "text": "The passage of federal legislation to protect consumers by regulating the food industry.", "isCorrect": true }, { "text": "The shutdown of the entire Chicago meatpacking industry.", "isCorrect": false }, { "text": "A decline in the popularity of novels.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "During the Progressive Era, political reforms such as the initiative, referendum, and recall were designed to:", "answerOptions": [ { "text": "increase the power of political bosses and party leaders.", "isCorrect": false }, { "text": "make the government more responsive and accountable to the people.", "isCorrect": true }, { "text": "strengthen the power of large corporations.", "isCorrect": false }, { "text": "limit the voting rights of immigrants.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_industrial_america_quiz3",
                                title: "Industrial America: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "President Theodore Roosevelt was known as a 'trust buster' for his efforts to use the Sherman Antitrust Act to break up large corporate monopolies that were harmful to the public interest. He believed that the government should distinguish between 'good trusts,' which were efficient and fair, and 'bad trusts,' which used their power to exploit consumers and stifle competition.", "question": "What was President Theodore Roosevelt's approach to dealing with trusts (monopolies)?", "answerOptions": [ { "text": "He believed all trusts were beneficial and should be left unregulated.", "isCorrect": false }, { "text": "He sought to break up all large corporations, regardless of their practices.", "isCorrect": false }, { "text": "He used government power to regulate or break up trusts that he believed acted against the public interest.", "isCorrect": true }, { "text": "He believed only state governments, not the federal government, had the power to regulate trusts.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The movement to protect America's natural resources, which gained national prominence under President Theodore Roosevelt, is known as:", "answerOptions": [ { "text": "Urbanization", "isCorrect": false }, { "text": "Conservation", "isCorrect": true }, { "text": "Industrialization", "isCorrect": false }, { "text": "Populism", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "What was the primary goal of the women's suffrage movement?", "answerOptions": [ { "text": "To secure better working conditions for women in factories.", "isCorrect": false }, { "text": "To gain women the right to vote.", "isCorrect": true }, { "text": "To prohibit the sale of alcoholic beverages.", "isCorrect": false }, { "text": "To improve public education for girls.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The Plessy v. Ferguson Supreme Court case in 1896 was a major setback for civil rights. The Court ruled that racially segregated public facilities were legal, as long as the facilities for blacks and whites were 'separate but equal.' This doctrine of 'separate but equal' legalized segregation and stood as law until it was overturned decades later.", "question": "What legal doctrine was established by the Supreme Court's ruling in Plessy v. Ferguson?", "answerOptions": [ { "text": "Judicial Review", "isCorrect": false }, { "text": "Separate but equal", "isCorrect": true }, { "text": "Equal protection under the law", "isCorrect": false }, { "text": "Innocent until proven guilty", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "Which constitutional amendment, ratified in 1920, granted women the right to vote?", "answerOptions": [ { "text": "The 17th Amendment", "isCorrect": false }, { "text": "The 18th Amendment", "isCorrect": false }, { "text": "The 19th Amendment", "isCorrect": true }, { "text": "The 21st Amendment", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_global_conflicts",
                        title: "Global Conflicts (1914-1945)",
                        description: "World War I, The Great Depression, World War II.",
                        quizzes: [
                            {
                                id: "ss_us_hist_global_conflicts_quiz1",
                                title: "Global Conflicts: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Initially, the United States adopted a policy of neutrality at the outbreak of World War I in 1914. However, several events shifted public opinion and led to U.S. entry. Germany's policy of unrestricted submarine warfare, which resulted in the sinking of ships with American passengers, most notably the Lusitania, caused outrage. The final catalyst was the Zimmermann Telegram, a secret message from Germany to Mexico proposing a military alliance against the U.S.", "question": "What was the immediate cause for the United States to declare war on Germany in World War I?", "answerOptions": [ { "text": "The assassination of Archduke Franz Ferdinand.", "rationale": "This event triggered the war in Europe but did not directly involve the U.S.", "isCorrect": false }, { "text": "The discovery of the Zimmermann Telegram and Germany's use of unrestricted submarine warfare.", "rationale": "Correct. These events, particularly the threat revealed in the telegram and the continued sinking of ships, were the final straws that led President Wilson to ask Congress for a declaration of war.", "isCorrect": true }, { "text": "A direct invasion of U.S. territory by German forces.", "rationale": "Germany never invaded the U.S. during World War I.", "isCorrect": false }, { "text": "The formation of the League of Nations.", "rationale": "The League of Nations was proposed by President Wilson after the war ended.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "During World War I, the large-scale movement of African Americans from the rural South to Northern industrial cities in search of jobs and to escape segregation was known as:", "answerOptions": [ { "text": "The Trail of Tears", "rationale": "The Trail of Tears was the forced removal of Native American tribes in the 1830s.", "isCorrect": false }, { "text": "Manifest Destiny", "rationale": "Manifest Destiny was the 19th-century belief in westward expansion.", "isCorrect": false }, { "text": "The Great Migration", "rationale": "Correct. This mass movement of millions of African Americans from the South to the North began during World War I and continued for several decades.", "isCorrect": true }, { "text": "The Gold Rush", "rationale": "The Gold Rush was a mid-19th century event centered on California.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "image", "imageUrl": "Images/licensed-image (9).jpg", "question": "This map shows the new borders of Europe established by the Treaty of Versailles after World War I. Why did the U.S. Senate refuse to ratify this treaty?", "answerOptions": [ { "text": "They believed the treaty was too harsh on Germany.", "rationale": "While some had this concern, the primary reason for rejection was opposition to the League of Nations.", "isCorrect": false }, { "text": "They were opposed to joining the League of Nations, fearing it would compromise U.S. sovereignty.", "rationale": "Correct. The treaty's provisions included joining the League of Nations, which was the main point of contention for the Senate.", "isCorrect": true }, { "text": "President Wilson himself decided the treaty was flawed.", "rationale": "President Wilson was the treaty's greatest champion.", "isCorrect": false }, { "text": "Great Britain and France refused to allow the U.S. to join.", "rationale": "The other Allied powers wanted the U.S. to join.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_global_conflicts_quiz2",
                                title: "Global Conflicts: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The 1920s in the United States, often called the 'Roaring Twenties,' was characterized by:", "answerOptions": [ { "text": "widespread economic hardship and high unemployment.", "rationale": "This describes the 1930s (Great Depression), not the 1920s.", "isCorrect": false }, { "text": "increased consumer spending, cultural changes, and stock market speculation.", "rationale": "Correct. The 1920s was a period of economic prosperity, social change (e.g., flappers, jazz), and widespread investment in the stock market, often with borrowed money.", "isCorrect": true }, { "text": "a focus on agricultural growth and rural values.", "rationale": "The 1920s saw a major shift towards urban, industrial culture.", "isCorrect": false }, { "text": "a strong movement towards isolationism and reduced international trade.", "rationale": "While politically isolationist, the U.S. was heavily involved in international finance and trade.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What event on October 29, 1929, known as 'Black Tuesday,' is considered the primary trigger of the Great Depression?", "answerOptions": [ { "text": "The start of World War II", "rationale": "World War II began in 1939.", "isCorrect": false }, { "text": "The election of Franklin D. Roosevelt", "rationale": "Roosevelt was elected in 1932, after the Depression had already begun.", "isCorrect": false }, { "text": "The Stock Market Crash", "rationale": "Correct. The massive stock market crash in October 1929 wiped out billions of dollars in investments and shattered public confidence in the economy, triggering the Great Depression.", "isCorrect": true }, { "text": "The passage of the Social Security Act", "rationale": "The Social Security Act was part of the New Deal, a response to the Depression.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "image", "imageUrl": "Images/licensed-image (14).jpg", "question": "This photograph from the 1930s shows a 'Hooverville.' What does this image represent?", "answerOptions": [ { "text": "Government-built housing projects for the poor.", "rationale": "These were shantytowns built by the homeless themselves, not government projects.", "isCorrect": false }, { "text": "The widespread homelessness and poverty caused by the Great Depression.", "rationale": "Correct. 'Hoovervilles' were shantytowns built by unemployed and homeless people, named mockingly after President Herbert Hoover, whom many blamed for the crisis.", "isCorrect": true }, { "text": "Temporary camps for soldiers during World War II.", "rationale": "This photo depicts civilian life during the Depression, not military life during WWII.", "isCorrect": false }, { "text": "Planned suburban communities built in the 1920s.", "rationale": "This is a makeshift shantytown, the opposite of a planned community.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_global_conflicts_quiz3",
                                title: "Global Conflicts: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "President Franklin D. Roosevelt's New Deal was a series of programs, public work projects, financial reforms, and regulations enacted in response to the Great Depression. The New Deal had three main goals: relief for the needy, recovery of the economy, and reform of the financial system to prevent a repeat depression. Programs like the Civilian Conservation Corps (CCC) and the Works Progress Administration (WPA) were created to provide jobs on public projects.", "question": "What was the primary purpose of New Deal programs like the CCC and WPA?", "answerOptions": [ { "text": "To regulate the stock market.", "rationale": "Stock market regulation was part of the 'reform' goal (e.g., the SEC), but not the purpose of the CCC and WPA.", "isCorrect": false }, { "text": "To provide direct cash payments to all Americans.", "rationale": "These programs provided jobs and wages, not direct cash handouts to everyone.", "isCorrect": false }, { "text": "To provide relief to the unemployed through public work projects.", "rationale": "Correct. The passage states these programs were created 'to provide jobs on public projects,' which falls under the goal of 'relief for the needy.'", "isCorrect": true }, { "text": "To build up the military in preparation for war.", "rationale": "These were civilian work programs, not military build-ups.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What event on December 7, 1941, directly led to the United States' entry into World War II?", "answerOptions": [ { "text": "Germany's invasion of Poland.", "rationale": "This event started World War II in Europe in 1939, but the U.S. remained neutral.", "isCorrect": false }, { "text": "The Japanese attack on Pearl Harbor.", "rationale": "Correct. The surprise attack on the U.S. naval base at Pearl Harbor, Hawaii, unified the American public and led to a declaration of war against Japan the next day.", "isCorrect": true }, { "text": "The Battle of Britain.", "rationale": "The Battle of Britain was a major air campaign fought in 1940, but the U.S. did not enter the war at that time.", "isCorrect": false }, { "text": "The sinking of the Lusitania.", "rationale": "This event contributed to the U.S. entry into World War I, not World War II.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "image", "imageUrl": "Images/Questions-are-based-on-the-following-graph.-5.png", "question": "This iconic 'Rosie the Riveter' poster from World War II became a symbol of what major change on the U.S. home front?", "answerOptions": [ { "text": "The enlistment of women in combat roles.", "rationale": "Women were not in combat roles during WWII, but they served in auxiliary corps.", "isCorrect": false }, { "text": "The importance of rationing food and supplies.", "rationale": "While rationing was important, this poster specifically addresses the workforce.", "isCorrect": false }, { "text": "The millions of women who entered the workforce in factories to support the war effort.", "rationale": "Correct. 'Rosie the Riveter' represents the women who took on industrial jobs, traditionally held by men, to produce planes, ships, and munitions for the war.", "isCorrect": true }, { "text": "The need for citizens to buy war bonds.", "rationale": "There were other posters that encouraged buying war bonds; this one is focused on labor.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_cold_war",
                        title: "The Cold War Era (1945-1991)",
                        description: "Containment, Domino Theory, Korean War, Vietnam War, Civil Rights Movement.",
                        quizzes: [
                            {
                                id: "ss_us_hist_cold_war_quiz1",
                                title: "The Cold War: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The Cold War was a period of geopolitical tension between the United States and the Soviet Union and their respective allies, the Western Bloc and the Eastern Bloc. It is called a 'cold' war because there was no large-scale direct fighting between the two superpowers. The conflict was instead expressed through military buildups, proxy wars in other nations, and a race for technological, economic, and ideological supremacy.", "question": "Why is the conflict between the U.S. and the Soviet Union referred to as the 'Cold War'?", "answerOptions": [ { "text": "Because most of the conflicts occurred in cold, northern climates.", "isCorrect": false }, { "text": "Because there was no direct, large-scale military conflict between the two superpowers.", "isCorrect": true }, { "text": "Because it was fought primarily over access to arctic resources.", "isCorrect": false }, { "text": "Because it ended in a stalemate with no clear winner.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What was the primary goal of the U.S. foreign policy of 'containment' during the Cold War?", "answerOptions": [ { "text": "To defeat the Soviet Union in a direct military conflict.", "isCorrect": false }, { "text": "To prevent the spread of communism to other countries.", "isCorrect": true }, { "text": "To establish communist governments in Western Europe.", "isCorrect": false }, { "text": "To create a single global government through the United Nations.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Marshall Plan, officially the European Recovery Program, was a U.S. initiative to aid Western Europe after World War II. The U.S. gave over $13 billion in economic assistance to help rebuild Western European economies. The plan was intended to stabilize the region, promote democratic institutions, and prevent the spread of communism by alleviating poverty and desperation.", "question": "What was a key objective of the Marshall Plan?", "answerOptions": [ { "text": "To provide military aid to Eastern European countries.", "isCorrect": false }, { "text": "To rebuild Western European economies to make them less susceptible to communism.", "isCorrect": true }, { "text": "To punish Germany for its role in World War II.", "isCorrect": false }, { "text": "To create a free trade zone between the U.S. and the Soviet Union.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "image", "imageUrl": "Images/The_Iron_Curtain_in_the_beginning_of_the_Cold_War.png", "question": "This map depicts the 'Iron Curtain,' a term famously used by Winston Churchill. What did the 'Iron Curtain' symbolize?", "answerOptions": [ { "text": "The physical wall built between East and West Germany.", "isCorrect": false }, { "text": "The ideological and political division between the communist nations of Eastern Europe and the democratic nations of Western Europe.", "isCorrect": true }, { "text": "The economic trade barrier between Europe and Asia.", "isCorrect": false }, { "text": "The military alliance between the United States and Great Britain.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The North Atlantic Treaty Organization (NATO) was a military alliance formed in 1949. What was its primary purpose?", "answerOptions": [ { "text": "To promote economic cooperation between member nations.", "isCorrect": false }, { "text": "To provide collective security against a potential attack by the Soviet Union.", "isCorrect": true }, { "text": "To coordinate the exploration of space.", "isCorrect": false }, { "text": "To enforce the terms of the Treaty of Versailles.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_cold_war_quiz2",
                                title: "The Cold War: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The 'domino theory' was a Cold War policy idea that suggested a communist government in one nation would quickly lead to communist takeovers in neighboring states, each falling like a row of perfectly aligned dominoes. This theory was used by successive U.S. administrations to justify American intervention in conflicts around the world, most notably in the Korean War and the Vietnam War.", "question": "What did the 'domino theory' suggest?", "answerOptions": [ { "text": "That economic instability in one country would cause a global depression.", "isCorrect": false }, { "text": "That if one country fell to communism, its neighbors would likely follow.", "isCorrect": true }, { "text": "That a nuclear war would cause a chain reaction of destruction.", "isCorrect": false }, { "text": "That all communist countries would eventually collapse like dominoes.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The Korean War (1950-1953) began when:", "answerOptions": [ { "text": "the Soviet Union invaded South Korea.", "isCorrect": false }, { "text": "communist North Korea invaded non-communist South Korea.", "isCorrect": true }, { "text": "China attacked United Nations forces.", "isCorrect": false }, { "text": "the United States declared war on North Korea.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Cuban Missile Crisis of 1962 was a 13-day confrontation between the United States and the Soviet Union, initiated by the American discovery of Soviet ballistic missile deployment in Cuba. It is widely regarded as the moment when the Cold War came closest to escalating into a full-scale nuclear war. The crisis was resolved when the Soviets agreed to remove the missiles in exchange for a U.S. pledge not to invade Cuba and a secret agreement to remove U.S. missiles from Turkey.", "question": "What was the central issue of the Cuban Missile Crisis?", "answerOptions": [ { "text": "A dispute over the political leadership of Cuba.", "isCorrect": false }, { "text": "The presence of Soviet nuclear missiles in Cuba, posing a direct threat to the U.S.", "isCorrect": true }, { "text": "A U.S. naval blockade of the Soviet Union.", "isCorrect": false }, { "text": "A disagreement over the price of sugar imports from Cuba.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "image", "imageUrl": "Images/Question-is-based-on-the-following-cartoon.-4.png", "question": "This political cartoon depicts Soviet Premier Nikita Khrushchev and U.S. President John F. Kennedy arm-wrestling while sitting on nuclear weapons. What Cold War concept does this cartoon best illustrate?", "answerOptions": [ { "text": "Containment", "isCorrect": false }, { "text": "The Space Race", "isCorrect": false }, { "text": "Brinkmanship and Mutually Assured Destruction (MAD)", "isCorrect": true }, { "text": "The Domino Theory", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The launch of the satellite Sputnik by the Soviet Union in 1957 was a major event in the Cold War. What was its most immediate effect in the United States?", "answerOptions": [ { "text": "It led to a decrease in military spending.", "isCorrect": false }, { "text": "It sparked the 'Space Race' and led to increased U.S. funding for science and math education.", "isCorrect": true }, { "text": "It caused the U.S. to withdraw from NATO.", "isCorrect": false }, { "text": "It led to the signing of a peace treaty with the Soviet Union.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_cold_war_quiz3",
                                title: "The Cold War: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The landmark Supreme Court case Brown v. Board of Education of Topeka (1954) declared that:", "answerOptions": [ { "text": "the 'separate but equal' doctrine was constitutional.", "isCorrect": false }, { "text": "state-sponsored segregation in public schools was unconstitutional.", "isCorrect": true }, { "text": "poll taxes were illegal.", "isCorrect": false }, { "text": "women had the right to vote.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Civil Rights Act of 1964 was a landmark piece of legislation that outlawed discrimination based on race, color, religion, sex, or national origin. It ended unequal application of voter registration requirements and racial segregation in schools, at the workplace, and by facilities that served the general public (known as 'public accommodations').", "question": "What was a major provision of the Civil Rights Act of 1964?", "answerOptions": [ { "text": "It guaranteed a minimum wage for all workers.", "isCorrect": false }, { "text": "It outlawed discrimination in public accommodations, such as restaurants and hotels.", "isCorrect": true }, { "text": "It provided federal funding for the arts.", "isCorrect": false }, { "text": "It abolished the Electoral College.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "image", "imageUrl": "Images/licensed-image (15).jpg", "question": "This photograph shows Martin Luther King Jr. delivering his 'I Have a Dream' speech during the March on Washington for Jobs and Freedom in 1963. What was the primary goal of this event?", "answerOptions": [ { "text": "To protest U.S. involvement in the Vietnam War.", "isCorrect": false }, { "text": "To advocate for the passage of a comprehensive civil rights bill.", "isCorrect": true }, { "text": "To celebrate the end of segregation in the United States.", "isCorrect": false }, { "text": "To demand the impeachment of the president.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The Voting Rights Act of 1965 was signed into law to overcome legal barriers at the state and local levels that prevented African Americans from exercising their right to vote. What was one of its key provisions?", "answerOptions": [ { "text": "It lowered the voting age to 18.", "isCorrect": false }, { "text": "It banned the use of literacy tests as a requirement for voting.", "isCorrect": true }, { "text": "It granted women the right to vote.", "isCorrect": false }, { "text": "It established a national popular vote for president.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The end of the Cold War is often symbolized by the fall of the Berlin Wall in 1989. For decades, the wall had physically and ideologically divided the city of Berlin. Its fall was followed by the reunification of Germany and the collapse of communist governments across Eastern Europe, culminating in the dissolution of the Soviet Union itself in 1991.", "question": "What event is most closely associated with the end of the Cold War?", "answerOptions": [ { "text": "The Cuban Missile Crisis", "isCorrect": false }, { "text": "The start of the Vietnam War", "isCorrect": false }, { "text": "The fall of the Berlin Wall and the dissolution of the Soviet Union", "isCorrect": true }, { "text": "The formation of NATO", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_us_hist_contemporary_america",
                        title: "Contemporary America (1991-Present)",
                        description: "Globalization, The War on Terror, The Digital Revolution.",
                        quizzes: [
                            {
                                id: "ss_us_hist_contemporary_america_quiz1",
                                title: "Contemporary America: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The late 20th and early 21st centuries have been defined by the digital revolution and the rise of the internet. This technological shift has transformed the economy, communication, and daily life. The growth of personal computers, the internet, and mobile devices has created a globally interconnected society.", "question": "The term 'digital revolution' refers to the shift toward:", "answerOptions": [ { "text": "a manufacturing-based economy.", "rationale": "The digital revolution is associated with a shift away from manufacturing towards information and services.", "isCorrect": false }, { "text": "new forms of transportation like electric cars.", "rationale": "While a recent technological change, the 'digital revolution' refers more broadly to computing and the internet.", "isCorrect": false }, { "text": "technologies based on computers and the internet.", "rationale": "Correct. The passage directly links the digital revolution to personal computers, the internet, and mobile devices.", "isCorrect": true }, { "text": "an economy based on agriculture.", "rationale": "The digital revolution is a feature of a post-industrial, not agrarian, economy.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "Which of the following is a major impact of globalization, accelerated by new technologies?", "answerOptions": [ { "text": "Decreased trade between countries.", "rationale": "Globalization has led to a massive increase in international trade.", "isCorrect": false }, { "text": "Increased economic interdependence among countries.", "rationale": "Correct. Globalization means that economies around the world are more connected and reliant on each other than ever before for goods, services, and capital.", "isCorrect": true }, { "text": "The isolation of national cultures.", "rationale": "Globalization has led to greater cultural exchange and diffusion, not isolation.", "isCorrect": false }, { "text": "A reduction in the speed of communication.", "rationale": "Technologies like the internet have made communication nearly instantaneous.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The North American Free Trade Agreement (NAFTA), signed in 1994, was designed to:", "answerOptions": [ { "text": "create a single currency for North America.", "rationale": "NAFTA did not create a common currency.", "isCorrect": false }, { "text": "establish a military alliance between the U.S., Canada, and Mexico.", "rationale": "NAFTA is a trade agreement, not a military alliance.", "isCorrect": false }, { "text": "eliminate most tariffs and trade barriers between the U.S., Canada, and Mexico.", "rationale": "Correct. The primary goal of NAFTA was to promote free trade by removing taxes and other barriers on goods and services traded between the three countries.", "isCorrect": true }, { "text": "restrict immigration from Mexico to the United States.", "rationale": "NAFTA was focused on trade and did not include provisions to restrict immigration.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The 'dot-com bubble' of the late 1990s was related to:", "answerOptions": [ { "text": "a boom in the housing market.", "rationale": "The housing market bubble occurred in the mid-2000s.", "isCorrect": false }, { "text": "a rapid increase in the value of agricultural land.", "rationale": "The bubble was related to technology and internet companies.", "isCorrect": false }, { "text": "speculative investment in internet-based companies.", "rationale": "Correct. The period saw a massive surge in investment and speculation in new internet-related companies, many of which were not profitable, leading to a market 'bubble' that eventually burst.", "isCorrect": true }, { "text": "a sudden shortage of computer hardware.", "rationale": "The bubble was about the valuation of companies, not a shortage of hardware.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The transition from a manufacturing-based economy to a service-based economy in the United States accelerated in the late 20th century. This involved a decline in factory jobs, particularly in the 'Rust Belt' region, and a growth in jobs in sectors like healthcare, finance, and information technology.", "question": "What has been a major characteristic of the U.S. economy in the post-industrial, or modern, era?", "answerOptions": [ { "text": "A shift from a service-based economy to a manufacturing-based economy.", "rationale": "The shift has been in the opposite direction.", "isCorrect": false }, { "text": "The dominance of agriculture as the primary sector of employment.", "rationale": "Agriculture has not been the dominant sector for a very long time.", "isCorrect": false }, { "text": "A decline in jobs in the healthcare and technology sectors.", "rationale": "These are sectors that have seen significant growth.", "isCorrect": false }, { "text": "Growth in the service sector and a decline in manufacturing jobs.", "rationale": "Correct. The passage clearly describes the transition from a manufacturing-based economy to a service-based one.", "isCorrect": true } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_contemporary_america_quiz2",
                                title: "Contemporary America: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The terrorist attacks on September 11, 2001, led the United States to launch a 'War on Terror,' which included the invasion of which country to overthrow the Taliban regime that harbored the al-Qaeda terrorist group?", "answerOptions": [ { "text": "Iraq", "rationale": "The U.S. invaded Iraq in 2003 for different stated reasons, primarily related to weapons of mass destruction.", "isCorrect": false }, { "text": "Iran", "rationale": "The U.S. has not invaded Iran.", "isCorrect": false }, { "text": "Saudi Arabia", "rationale": "While many of the 9/11 hijackers were from Saudi Arabia, the U.S. did not invade the country.", "isCorrect": false }, { "text": "Afghanistan", "rationale": "Correct. The U.S. and its allies invaded Afghanistan in late 2001 because its ruling Taliban regime provided a safe haven for Osama bin Laden and the al-Qaeda network responsible for the 9/11 attacks.", "isCorrect": true } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "In response to the 9/11 attacks, the U.S. government created which new cabinet-level department to coordinate domestic security?", "answerOptions": [ { "text": "The Central Intelligence Agency (CIA)", "rationale": "The CIA is an independent agency focused on foreign intelligence and was not created after 9/11.", "isCorrect": false }, { "text": "The Federal Bureau of Investigation (FBI)", "rationale": "The FBI is the primary federal law enforcement agency and has existed for much longer.", "isCorrect": false }, { "text": "The Department of Homeland Security", "rationale": "Correct. The Department of Homeland Security (DHS) was created in 2002 to consolidate various federal agencies and coordinate the protection of the U.S. from terrorism and other threats.", "isCorrect": true }, { "text": "The National Security Agency (NSA)", "rationale": "The NSA is a national-level intelligence agency that existed long before 9/11.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The USA PATRIOT Act, passed shortly after 9/11, was controversial because it:", "answerOptions": [ { "text": "significantly reduced the powers of law enforcement.", "rationale": "The act greatly expanded law enforcement powers.", "isCorrect": false }, { "text": "allowed the government to conduct surveillance with fewer restrictions, raising concerns about privacy.", "rationale": "Correct. Critics argued that the act gave the government too much power to monitor citizens' communications and records without sufficient judicial oversight, infringing on civil liberties.", "isCorrect": true }, { "text": "abolished the military draft.", "rationale": "The U.S. has had an all-volunteer military since the Vietnam War.", "isCorrect": false }, { "text": "provided financial aid to the families of 9/11 victims.", "rationale": "While aid was provided, this was not the purpose or the controversial aspect of the PATRIOT Act.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The U.S. invasion of Iraq in 2003 was based on the stated belief that the Iraqi regime, under Saddam Hussein, possessed weapons of mass destruction (WMDs) and posed a significant threat to the United States and its allies. After the invasion, however, no large stockpiles of WMDs were found. The conflict proved to be long and costly, with a complex insurgency developing after the initial military victory.", "question": "What was the primary stated reason for the U.S. invasion of Iraq in 2003?", "answerOptions": [ { "text": "To stop a direct invasion of the U.S. by Iraq.", "rationale": "Iraq had not invaded the U.S.", "isCorrect": false }, { "text": "To capture Osama bin Laden.", "rationale": "Osama bin Laden was the leader of al-Qaeda and was believed to be in Afghanistan or Pakistan, not Iraq.", "isCorrect": false }, { "text": "The belief that Iraq possessed weapons of mass destruction.", "rationale": "Correct. The passage explicitly states the invasion was based on the 'belief that the Iraqi regime... possessed weapons of mass destruction.'", "isCorrect": true }, { "text": "To establish a permanent U.S. military base in the Middle East.", "rationale": "While the U.S. has bases in the region, establishing a new one was not the stated primary goal of the invasion.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The term 'Great Recession' refers to the severe economic downturn that began in:", "answerOptions": [ { "text": "1929 with the stock market crash.", "rationale": "This was the start of the Great Depression, not the Great Recession.", "isCorrect": false }, { "text": "the early 1990s after the first Gulf War.", "rationale": "There was a recession in the early 1990s, but the 'Great Recession' refers to a later, more severe event.", "isCorrect": false }, { "text": "the late 2000s, triggered by a housing market collapse.", "rationale": "Correct. The Great Recession officially lasted from December 2007 to June 2009 and was precipitated by the subprime mortgage crisis and the collapse of the housing bubble.", "isCorrect": true }, { "text": "2020 due to the COVID-19 pandemic.", "rationale": "The economic downturn in 2020 was severe but is referred to as the COVID-19 recession.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_us_hist_contemporary_america_quiz3",
                                title: "Contemporary America: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The 2008 presidential election was historic because it resulted in the election of:", "answerOptions": [ { "text": "the first female President.", "rationale": "The U.S. has not yet elected a female President.", "isCorrect": false }, { "text": "the first African American President.", "rationale": "Correct. Barack Obama's victory in 2008 made him the first African American to be elected President of the United States.", "isCorrect": true }, { "text": "the youngest President in U.S. history.", "rationale": "Theodore Roosevelt and John F. Kennedy were younger when they took office.", "isCorrect": false }, { "text": "the first President not from the Democratic or Republican party.", "rationale": "Barack Obama was a Democrat.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "A major piece of legislation passed during the Obama administration was the Affordable Care Act (ACA). Its primary goal was to:", "answerOptions": [ { "text": "create a government-run healthcare system for all Americans.", "rationale": "The ACA is based on private insurance markets, with government subsidies and regulations, not a fully government-run system.", "isCorrect": false }, { "text": "increase the number of Americans with health insurance coverage.", "rationale": "Correct. The ACA aimed to expand health insurance coverage through mandates, subsidies, and the creation of health insurance marketplaces.", "isCorrect": true }, { "text": "decrease the cost of prescription drugs for senior citizens.", "rationale": "This was addressed by Medicare Part D, which was created earlier.", "isCorrect": false }, { "text": "privatize the Medicare system.", "rationale": "The ACA expanded, rather than privatized, government involvement in healthcare.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "chart", "passage": `<div class="passage-text"><b>Immigration to the U.S. by Region of Birth</b><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Year</th><th class="p-2 border-b">Europe (%)</th><th class="p-2 border-b">Asia (%)</th><th class="p-2 border-b">Latin America (%)</th></tr></thead><tbody><tr class="border-b"><td class="p-2">1960</td><td class="p-2">75%</td><td class="p-2">5%</td><td class="p-2">15%</td></tr><tr class="border-b"><td class="p-2">2010</td><td class="p-2">12%</td><td class="p-2">28%</td><td class="p-2">53%</td></tr></tbody></table></div>`, "question": "Based on the chart, what was the most significant demographic shift in U.S. immigration between 1960 and 2010?", "answerOptions": [ { "text": "A large increase in the percentage of immigrants from Europe.", "rationale": "The percentage of immigrants from Europe decreased dramatically.", "isCorrect": false }, { "text": "A shift from a majority of European immigrants to a majority of Latin American and Asian immigrants.", "rationale": "Correct. In 1960, Europeans made up 75% of immigrants, but by 2010, immigrants from Latin America (53%) and Asia (28%) together made up a large majority.", "isCorrect": true }, { "text": "A decrease in the percentage of immigrants from Asia.", "rationale": "The percentage of immigrants from Asia increased significantly.", "isCorrect": false }, { "text": "The percentage of immigrants from all regions became roughly equal.", "rationale": "The percentages in 2010 are clearly not equal, with Latin America being the largest source.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The political landscape of the 21st century has been characterized by:", "answerOptions": [ { "text": "a decrease in political polarization.", "rationale": "Most observers agree that political polarization has increased significantly.", "isCorrect": false }, { "text": "the disappearance of the two-party system.", "rationale": "The Democratic and Republican parties remain the dominant forces in U.S. politics.", "isCorrect": false }, { "text": "increased political polarization and deep divisions between the major parties.", "rationale": "Correct. The early 21st century has been marked by growing ideological divides and less cooperation between the Democratic and Republican parties on major issues.", "isCorrect": true }, { "text": "a long period of bipartisan consensus on most major issues.", "rationale": "This is the opposite of the current political climate.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "What is a major social issue that has gained prominence and seen significant legal and social changes in the United States in the early 21st century?", "answerOptions": [ { "text": "Women's suffrage", "rationale": "Women's suffrage was achieved with the 19th Amendment in 1920.", "isCorrect": false }, { "text": "The abolition of slavery", "rationale": "Slavery was abolished by the 13th Amendment in 1865.", "isCorrect": false }, { "text": "Prohibition of alcohol", "rationale": "Prohibition was enacted in 1920 and repealed in 1933.", "isCorrect": false }, { "text": "Same-sex marriage rights", "rationale": "Correct. The movement for LGBTQ+ rights, culminating in the 2015 Supreme Court decision Obergefell v. Hodges which legalized same-sex marriage nationwide, has been a major social and legal development of this era.", "isCorrect": true } ] }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Civics & Government": {
                description: "Understand the structure and function of the U.S. government.",
                topics: [
                    {
                        id: "ss_civics_constitution",
                        title: "The Constitution",
                        description: "Preamble, Articles, and the Bill of Rights.",
                        quizzes: [
                            {
                                id: "ss_civics_constitution_quiz1",
                                title: "The Constitution: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The Preamble to the U.S. Constitution begins with the phrase 'We the People...' This opening statement establishes a core principle of the new government.", "question": "What fundamental principle is established by the phrase 'We the People'?", "answerOptions": [ { "text": "Federalism, the division of power between state and national governments.", "rationale": "Federalism is a key principle, but 'We the People' specifically refers to the source of the government's power.", "isCorrect": false }, { "text": "Popular sovereignty, the idea that the government's authority comes from the people.", "rationale": "Correct. This phrase signifies that the power of the government is derived from the consent of the governed, not from a king or a select group of elites.", "isCorrect": true }, { "text": "Separation of Powers, the division of government into three branches.", "rationale": "The separation of powers is outlined in the Articles of the Constitution, not established by this phrase.", "isCorrect": false }, { "text": "Limited Government, the idea that the government's power is restricted.", "rationale": "While a related concept, 'We the People' is the most direct expression of popular sovereignty.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The U.S. Constitution establishes three distinct branches of government. Which article of the Constitution establishes the Legislative Branch (Congress)?", "answerOptions": [ { "text": "Article I", "rationale": "Correct. Article I of the Constitution establishes the legislative branch, its powers, and its bicameral structure (the House and Senate).", "isCorrect": true }, { "text": "Article II", "rationale": "Article II establishes the Executive Branch (the Presidency).", "isCorrect": false }, { "text": "Article III", "rationale": "Article III establishes the Judicial Branch (the Supreme Court and lower courts).", "isCorrect": false }, { "text": "Article V", "rationale": "Article V outlines the process for amending the Constitution.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "Article II of the Constitution outlines the powers and responsibilities of the Executive Branch. It states that 'The executive Power shall be vested in a President of the United States of America.' This includes the power to act as Commander in Chief of the armed forces, to grant pardons, to make treaties (with the Senate's consent), and to appoint ambassadors and federal judges.", "question": "According to Article II of the Constitution, which of the following is a power of the President?", "answerOptions": [ { "text": "To declare war.", "rationale": "The power to declare war is explicitly granted to Congress in Article I.", "isCorrect": false }, { "text": "To act as Commander in Chief of the military.", "rationale": "Correct. The passage explicitly lists this as a power of the President.", "isCorrect": true }, { "text": "To create federal courts.", "rationale": "The power to create lower federal courts is granted to Congress in Article III.", "isCorrect": false }, { "text": "To regulate interstate commerce.", "rationale": "The power to regulate commerce between the states belongs to Congress.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The first ten amendments to the U.S. Constitution are known as the Bill of Rights. What is their primary purpose?", "answerOptions": [ { "text": "To outline the structure of the federal government.", "rationale": "The structure of the government is outlined in the Articles of the Constitution, not the Bill of Rights.", "isCorrect": false }, { "text": "To grant specific powers to the federal government.", "rationale": "The Bill of Rights is primarily about limiting the power of the federal government, not granting it.", "isCorrect": false }, { "text": "To protect the fundamental rights and liberties of individual citizens.", "rationale": "Correct. The Bill of Rights was added to ensure that the new, powerful federal government could not infringe upon the basic rights of the people.", "isCorrect": true }, { "text": "To establish the process for electing the President.", "rationale": "The presidential election process is outlined in Article II and later amendments like the 12th.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "The First Amendment to the U.S. Constitution protects several fundamental rights. Which of the following is NOT a right guaranteed by the First Amendment?", "answerOptions": [ { "text": "Freedom of speech", "rationale": "Freedom of speech is a core protection of the First Amendment.", "isCorrect": false }, { "text": "The right to bear arms", "rationale": "Correct. The right to bear arms is guaranteed by the Second Amendment, not the First.", "isCorrect": true }, { "text": "Freedom of the press", "rationale": "Freedom of the press is explicitly protected by the First Amendment.", "isCorrect": false }, { "text": "The right to peaceably assemble", "rationale": "The right to gather peacefully is one of the key freedoms listed in the First Amendment.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_constitution_quiz2",
                                title: "The Constitution: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The Fourth Amendment protects citizens from 'unreasonable searches and seizures.' Generally, this means that law enforcement officials must obtain a warrant, based on probable cause, before searching a person's home or property. This principle ensures that citizens have a right to privacy and are secure from arbitrary government intrusion.", "question": "Based on the passage, which of the following scenarios would most likely be a violation of the Fourth Amendment?", "answerOptions": [ { "text": "An officer searches a car after seeing illegal drugs in plain view on the passenger seat.", "rationale": "The 'plain view' doctrine is often considered an exception, as there is no expectation of privacy for items left in plain sight.", "isCorrect": false }, { "text": "Police search a person's home after a judge, presented with evidence, issues a specific warrant.", "rationale": "This describes the proper legal procedure and is not a violation.", "isCorrect": false }, { "text": "Law enforcement enters and searches a suspect's apartment because they have a hunch the suspect is involved in a crime, but they have no warrant.", "rationale": "Correct. Searching a home without a warrant or probable cause is a classic example of an unreasonable search and a violation of the Fourth Amendment.", "isCorrect": true }, { "text": "A school official searches a student's locker based on a reasonable suspicion that it contains a weapon.", "rationale": "Courts have often ruled that students have a reduced expectation of privacy at school, and searches based on reasonable suspicion are sometimes permitted.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The Fifth Amendment provides several protections for individuals accused of a crime. Which protection prevents a person from being tried twice for the same offense?", "answerOptions": [ { "text": "The right to remain silent (protection against self-incrimination).", "rationale": "This protects against self-incrimination, but it is the double jeopardy clause that prevents being tried twice.", "isCorrect": false }, { "text": "The protection against double jeopardy.", "rationale": "Correct. 'Double jeopardy' is the legal term for the Fifth Amendment protection that prohibits an accused person from being tried again on the same (or similar) charges following a legitimate acquittal or conviction.", "isCorrect": true }, { "text": "The right to a grand jury indictment.", "rationale": "The right to a grand jury ensures that a prosecutor has enough evidence to bring charges, but it does not prevent a second trial on different grounds if the first doesn't result in a final judgment.", "isCorrect": false }, { "text": "The right to due process of law.", "rationale": "Due process is a broad principle ensuring fair treatment, but double jeopardy is the specific clause against being tried twice.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Sixth Amendment guarantees the right to a 'speedy and public trial, by an impartial jury.' It also ensures the right of the accused 'to be confronted with the witnesses against him' and 'to have the Assistance of Counsel for his defence.' These protections are fundamental to the American criminal justice system.", "question": "A person is arrested and held in jail for three years awaiting trial. Which Sixth Amendment right has most clearly been violated?", "answerOptions": [ { "text": "The right to the assistance of counsel.", "rationale": "The passage doesn't state whether the person has a lawyer, only that they have been waiting a long time for trial.", "isCorrect": false }, { "text": "The right to a speedy trial.", "rationale": "Correct. A three-year delay before a trial begins would be considered a clear violation of the right to a 'speedy' trial.", "isCorrect": true }, { "text": "The right to confront witnesses.", "rationale": "This right applies during the trial itself, which has not yet occurred.", "isCorrect": false }, { "text": "The right to an impartial jury.", "rationale": "This right also applies to the trial itself. The issue here is the delay before the trial starts.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The Eighth Amendment prohibits 'cruel and unusual punishments.' The interpretation of this phrase has evolved over time. Which of the following issues is most often debated in the context of the Eighth Amendment?", "answerOptions": [ { "text": "The right to a jury trial", "rationale": "The right to a jury trial is guaranteed by the Sixth and Seventh Amendments.", "isCorrect": false }, { "text": "The legality of the death penalty", "rationale": "Correct. Opponents of capital punishment argue that it constitutes a 'cruel and unusual punishment' and is therefore unconstitutional under the Eighth Amendment. This is a central and ongoing legal debate.", "isCorrect": true }, { "text": "The right to legal counsel", "rationale": "The right to a lawyer is guaranteed by the Sixth Amendment.", "isCorrect": false }, { "text": "Freedom from self-incrimination", "rationale": "This protection is provided by the Fifth Amendment.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The Tenth Amendment states: 'The powers not delegated to the United States by the Constitution, nor prohibited by it to the States, are reserved to the States respectively, or to the people.' This amendment is the cornerstone of federalism, the principle that power is divided between the national government and the state governments.", "question": "Which of the following is the best example of a power 'reserved to the States' under the Tenth Amendment?", "answerOptions": [ { "text": "The power to declare war.", "rationale": "The Constitution explicitly delegates the power to declare war to the national government (Congress).", "isCorrect": false }, { "text": "The power to print money.", "rationale": "The power to coin and print money is an exclusive power of the national government.", "isCorrect": false }, { "text": "The power to establish local schools.", "rationale": "Correct. The Constitution does not delegate the power over education to the federal government, nor does it prohibit states from acting. Therefore, it is a power reserved to the states.", "isCorrect": true }, { "text": "The power to make treaties with foreign countries.", "rationale": "This power is delegated to the President and the Senate at the national level.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_constitution_quiz3",
                                title: "The Constitution: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "How many amendments are in the Bill of Rights?", "answerOptions": [ { "text": "Seven", "rationale": "There are seven articles in the original Constitution, but ten amendments in the Bill of Rights.", "isCorrect": false }, { "text": "Ten", "rationale": "Correct. The first ten amendments to the Constitution, ratified in 1791, are collectively known as the Bill of Rights.", "isCorrect": true }, { "text": "Twenty-seven", "rationale": "There are 27 amendments in total, but only the first ten make up the Bill of Rights.", "isCorrect": false }, { "text": "Thirteen", "rationale": "The 13th amendment abolished slavery and is not part of the original Bill of Rights.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Supremacy Clause in Article VI of the Constitution establishes that the Constitution, federal laws made pursuant to it, and treaties made under its authority, constitute the 'supreme Law of the Land.' This means that if a state law conflicts with a federal law, the federal law takes precedence.", "question": "If a state passes a law that contradicts a federal law, which law must be followed according to the Supremacy Clause?", "answerOptions": [ { "text": "The state law, because of the 10th Amendment.", "rationale": "The 10th Amendment reserves powers to the states, but the Supremacy Clause establishes the hierarchy when laws conflict.", "isCorrect": false }, { "text": "The federal law.", "rationale": "Correct. The Supremacy Clause makes the Constitution and federal laws the 'supreme Law of the Land,' meaning they prevail over conflicting state laws.", "isCorrect": true }, { "text": "Whichever law was passed more recently.", "rationale": "The timing of the law does not determine its precedence.", "isCorrect": false }, { "text": "Neither law; a new compromise law must be written.", "rationale": "The Constitution provides a clear hierarchy; no compromise is required.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The Second Amendment protects 'the right of the people to keep and bear Arms.' The interpretation of this amendment is highly debated, primarily centering on what question?", "answerOptions": [ { "text": "Whether it protects an individual right or a collective right for militias.", "rationale": "Correct. This is the central legal and political debate: Does the amendment protect a private citizen's right to own a gun, or does it protect the right of states to maintain militias?", "isCorrect": true }, { "text": "Whether 'Arms' includes modern firearms.", "rationale": "This is part of the debate, but the core issue is the nature of the right itself (individual vs. collective).", "isCorrect": false }, { "text": "Whether the government can ever regulate firearms.", "rationale": "Most interpretations allow for some regulation; the debate is over the extent, which depends on the core interpretation of the right.", "isCorrect": false }, { "text": "Whether a militia is still necessary for security.", "rationale": "This is a political question, but the legal debate focuses on the nature of the right described in the amendment.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The process for amending the Constitution is outlined in Article V. An amendment can be proposed either by the Congress with a two-thirds majority vote in both the House and the Senate or by a national convention called for by two-thirds of the state legislatures. After being proposed, an amendment must be ratified by three-fourths of the state legislatures or by conventions in three-fourths of the states.", "question": "What proportion of states must ratify a proposed amendment for it to become part of the Constitution?", "answerOptions": [ { "text": "A simple majority (more than half)", "rationale": "A simple majority is not sufficient for ratification.", "isCorrect": false }, { "text": "Two-thirds", "rationale": "Two-thirds is the proportion needed in Congress to propose an amendment, not for states to ratify it.", "isCorrect": false }, { "text": "Three-fourths", "rationale": "Correct. The passage clearly states that an amendment must be ratified by three-fourths of the states to be adopted.", "isCorrect": true }, { "text": "All of the states", "rationale": "Unanimous approval is not required.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "Which amendment in the Bill of Rights protects citizens from being forced to quarter soldiers in their homes during peacetime without their consent?", "answerOptions": [ { "text": "The First Amendment", "rationale": "The First Amendment deals with freedoms of speech, religion, press, assembly, and petition.", "isCorrect": false }, { "text": "The Third Amendment", "rationale": "Correct. This amendment was a direct response to the British practice of forcing colonists to house and feed soldiers.", "isCorrect": true }, { "text": "The Seventh Amendment", "rationale": "The Seventh Amendment guarantees the right to a jury trial in certain civil cases.", "isCorrect": false }, { "text": "The Ninth Amendment", "rationale": "The Ninth Amendment states that the rights listed in the Constitution are not exhaustive and that the people have other rights not specified.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_civics_legislative",
                        title: "The Legislative Branch",
                        description: "Congress, How a Bill Becomes a Law, Powers of Congress.",
                        quizzes: [
                            {
                                id: "ss_civics_legislative_quiz1",
                                title: "The Legislative Branch: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "The U.S. Congress is a bicameral legislature, meaning it is composed of two chambers: the House of Representatives and the Senate. Representation in the House is based on a state's population, with representatives serving two-year terms. In the Senate, every state is represented equally with two senators, who serve six-year terms. This structure was the result of the Great Compromise at the Constitutional Convention.", "question": "Why is the U.S. Congress considered 'bicameral'?", "answerOptions": [ { "text": "Because representatives serve two-year terms.", "rationale": "Term length does not define a bicameral legislature.", "isCorrect": false }, { "text": "Because it consists of two separate chambers (the House and the Senate).", "rationale": "Correct. 'Bi' means two and 'cameral' refers to a chamber, so a bicameral legislature is one with two houses.", "isCorrect": true }, { "text": "Because it includes both elected officials and appointed judges.", "rationale": "Judges are part of the judicial branch, not the legislative branch.", "isCorrect": false }, { "text": "Because its members can belong to two different political parties.", "rationale": "Political party composition does not define the structure of the legislature.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What is the total number of senators in the U.S. Senate?", "answerOptions": [ { "text": "50", "rationale": "This would be one senator per state.", "isCorrect": false }, { "text": "100", "rationale": "Correct. Since each of the 50 states gets two senators, the total is 100.", "isCorrect": true }, { "text": "435", "rationale": "This is the number of representatives in the House of Representatives.", "isCorrect": false }, { "text": "535", "rationale": "This is the total number of voting members in both the House and the Senate combined.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "Which chamber of Congress has the exclusive power to initiate all bills related to revenue (taxes)?", "answerOptions": [ { "text": "The Senate", "rationale": "The Senate can amend revenue bills, but they must originate in the House.", "isCorrect": false }, { "text": "The House of Representatives", "rationale": "Correct. The Constitution (Article I, Section 7) requires that all bills for raising revenue must originate in the House, based on the principle that the chamber closer to the people should control taxation.", "isCorrect": true }, { "text": "Both chambers can initiate them equally.", "rationale": "The Constitution gives this specific power to the House.", "isCorrect": false }, { "text": "The Supreme Court", "rationale": "The Supreme Court interprets laws; it does not initiate them.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "For a bill to become a law, it must be passed by both the House of Representatives and the Senate in identical form. First, a bill is introduced in one chamber, where it is assigned to a committee. The committee studies the bill, holds hearings, and may make changes. If the committee approves it, the bill is debated and voted on by the full chamber. If it passes, it is sent to the other chamber to go through the same process.", "question": "What is the role of a committee in the lawmaking process?", "answerOptions": [ { "text": "To introduce the bill on the floor of the House or Senate.", "rationale": "Any member can introduce a bill; the committee's role comes after introduction.", "isCorrect": false }, { "text": "To study the bill, hold hearings, and make revisions before it is voted on by the full chamber.", "rationale": "Correct. Committees are where the detailed work of crafting and scrutinizing legislation happens.", "isCorrect": true }, { "text": "To sign the bill into law after it has passed both chambers.", "rationale": "The President signs a bill into law.", "isCorrect": false }, { "text": "To vote on the final version of the bill after it has been approved by both chambers.", "rationale": "The full chamber votes on the bill after it leaves committee.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "If the House and the Senate pass different versions of the same bill, what is the next step to resolve the differences?", "answerOptions": [ { "text": "The bill is sent to the President to choose the preferred version.", "rationale": "The President receives only one final version of a bill.", "isCorrect": false }, { "text": "The bill is sent to a conference committee to create a compromise version.", "rationale": "Correct. A conference committee, made up of members from both the House and Senate, is convened to iron out the differences between the two versions of the bill.", "isCorrect": true }, { "text": "The Supreme Court decides which version is constitutional.", "rationale": "The Supreme Court does not get involved in the legislative process at this stage.", "isCorrect": false }, { "text": "The bill is sent back to the chamber where it originated to be rewritten from scratch.", "rationale": "A conference committee is the standard procedure for resolving differences.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_legislative_quiz2",
                                title: "The Legislative Branch: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "After a bill has been passed in identical form by both the House and the Senate, it is sent to the President. The President has several options. He can sign the bill, and it becomes law. He can veto the bill, sending it back to Congress with his objections. Or, he can do nothing. If Congress is in session, the bill becomes law after ten days without the President's signature.", "question": "What happens if the President vetoes a bill?", "answerOptions": [ { "text": "The bill is automatically dead and cannot be reconsidered.", "rationale": "Congress has the power to override a veto.", "isCorrect": false }, { "text": "The bill is sent to the Supreme Court for a final decision.", "rationale": "The Supreme Court does not participate in this part of the legislative process.", "isCorrect": false }, { "text": "The bill is sent back to Congress, which can override the veto with a two-thirds vote in both chambers.", "rationale": "Correct. A presidential veto is a powerful check, but Congress can overcome it with a supermajority vote.", "isCorrect": true }, { "text": "The bill becomes law, but only for a temporary period.", "rationale": "A veto prevents a bill from becoming law unless it is overridden.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "Which of the following is an enumerated (or expressed) power of Congress, as listed in Article I, Section 8 of the Constitution?", "answerOptions": [ { "text": "The power to issue driver's licenses.", "rationale": "This is a power reserved to the states.", "isCorrect": false }, { "text": "The power to establish public schools.", "rationale": "This is a power generally reserved to state and local governments.", "isCorrect": false }, { "text": "The power to declare war.", "rationale": "Correct. Article I, Section 8 explicitly grants Congress the power to declare war.", "isCorrect": true }, { "text": "The power to appoint Supreme Court justices.", "rationale": "This power belongs to the President, with the Senate's approval.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The 'Necessary and Proper Clause' (also known as the Elastic Clause) in Article I, Section 8 of the Constitution gives Congress the power 'To make all Laws which shall be necessary and proper for carrying into Execution the foregoing Powers...' This clause grants Congress implied powers—powers not explicitly stated in the Constitution but that are necessary to carry out its expressed powers.", "question": "The 'Elastic Clause' is significant because it grants Congress:", "answerOptions": [ { "text": "the power to veto laws passed by the states.", "rationale": "Congress does not have a direct veto over state laws, though federal law is supreme.", "isCorrect": false }, { "text": "implied powers that are not explicitly listed in the Constitution.", "rationale": "Correct. This clause 'stretches' the powers of Congress beyond those that are specifically enumerated, allowing it to adapt to changing needs.", "isCorrect": true }, { "text": "the sole power to amend the Constitution.", "rationale": "Amending the Constitution requires a proposal by Congress and ratification by the states.", "isCorrect": false }, { "text": "the power to appoint its own members to the cabinet.", "rationale": "Cabinet members are appointed by the President.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Which chamber of Congress has the exclusive power of 'advice and consent' on presidential appointments and treaties?", "answerOptions": [ { "text": "The House of Representatives", "rationale": "The House does not have this power.", "isCorrect": false }, { "text": "The Senate", "rationale": "Correct. The Senate must confirm major presidential appointments (like cabinet members and federal judges) and must ratify treaties negotiated by the President.", "isCorrect": true }, { "text": "Both chambers share this power equally.", "rationale": "The Constitution specifically grants this power to the Senate.", "isCorrect": false }, { "text": "No chamber has this power; it belongs to the judiciary.", "rationale": "This is a key legislative power.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The process of impeachment is a power granted to the Legislative Branch to remove a federal official from office for 'Treason, Bribery, or other high Crimes and Misdemeanors.' The process involves two steps: The House of Representatives has the sole power to impeach (to formally accuse), and the Senate has the sole power to hold the trial and vote on removal.", "question": "In the impeachment process, what is the role of the House of Representatives?", "answerOptions": [ { "text": "To conduct the trial of the impeached official.", "rationale": "The Senate conducts the trial.", "isCorrect": false }, { "text": "To formally accuse the official of wrongdoing (to impeach).", "rationale": "Correct. The House acts as the grand jury, deciding whether there is enough evidence to bring formal charges, which is the act of impeachment.", "isCorrect": true }, { "text": "To decide the punishment if the official is found guilty.", "rationale": "The only punishment the Senate can issue is removal from office and disqualification from future office.", "isCorrect": false }, { "text": "To pardon the official if they are convicted.", "rationale": "The power to pardon belongs to the President.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_legislative_quiz3",
                                title: "The Legislative Branch: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "chart", "passage": `<div class="passage-text"><b>How a Bill Becomes a Law</b><br>1. Bill is Introduced in House or Senate.<br>2. Referred to Committee for study.<br>3. Floor Debate and Vote in the first chamber.<br>4. Bill is sent to the other chamber for the same process.<br>5. Conference Committee (if needed to resolve differences).<br>6. Final Vote in both chambers.<br>7. Sent to President.</div>`, "question": "According to the chart, what happens immediately after a bill is introduced in the House of Representatives?", "answerOptions": [ { "text": "It is sent to the Senate for a vote.", "rationale": "The bill must go through the committee and floor process in the House first.", "isCorrect": false }, { "text": "It is referred to a committee for study and review.", "rationale": "Correct. The chart shows that after introduction (Step 1), the bill is sent to a committee (Step 2).", "isCorrect": true }, { "text": "It is debated on the floor of the House.", "rationale": "Floor debate happens after the committee has reviewed the bill.", "isCorrect": false }, { "text": "It is sent directly to the President.", "rationale": "The President is the last step in the process.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "A filibuster is a tactic used in the Senate to delay or block a vote on a bill. How can a filibuster be ended?", "answerOptions": [ { "text": "By a simple majority vote of 51 senators.", "rationale": "A simple majority is not enough to end a filibuster.", "isCorrect": false }, { "text": "By a vote for cloture, which requires a three-fifths majority (60 votes).", "rationale": "Correct. The Senate can invoke 'cloture' with 60 votes, which limits further debate and ends the filibuster.", "isCorrect": true }, { "text": "By the President issuing an executive order.", "rationale": "The President cannot interfere with the internal rules and procedures of the Senate.", "isCorrect": false }, { "text": "By the Speaker of a House calling for a vote.", "rationale": "The Speaker of the House has no authority over Senate proceedings.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "Congress has the 'power of the purse,' which is one of its most important checks on the executive branch. This means that Congress controls the nation's finances. It must approve the federal budget and authorize any spending by federal agencies. If Congress disagrees with a policy of the executive branch, it can refuse to provide funding for it.", "question": "How does the 'power of the purse' allow Congress to check the executive branch?", "answerOptions": [ { "text": "By allowing Congress to impeach the President.", "rationale": "Impeachment is a separate power, not part of the 'power of the purse.'", "isCorrect": false }, { "text": "By giving Congress the ability to control funding for executive branch programs and agencies.", "rationale": "Correct. By controlling the money, Congress can limit or prevent the executive branch from carrying out certain actions.", "isCorrect": true }, { "text": "By allowing Congress to declare executive orders unconstitutional.", "rationale": "The power to declare actions unconstitutional belongs to the judicial branch.", "isCorrect": false }, { "text": "By giving Congress the power to appoint cabinet members.", "rationale": "The President appoints cabinet members, though the Senate must confirm them.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "What is the term for a member of the House or Senate who is chosen by their party to help plan the party's legislative strategy and ensure party members are present for important votes?", "answerOptions": [ { "text": "The Speaker of the House", "rationale": "The Speaker is the presiding officer of the House, a higher leadership position.", "isCorrect": false }, { "text": "The President pro tempore", "rationale": "This is a senior senator who presides over the Senate in the absence of the Vice President.", "isCorrect": false }, { "text": "The Whip", "rationale": "Correct. The majority and minority whips in both chambers are responsible for 'whipping up' support for their party's positions and making sure members are present for votes.", "isCorrect": true }, { "text": "A Lobbyist", "rationale": "Lobbyists are representatives of outside groups who try to influence Congress; they are not members of Congress.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "If a representative in the House of Representatives serves a two-year term and a senator serves a six-year term, what is the ratio of a senator's term to a representative's term?", "answerOptions": [ { "text": "1:3", "rationale": "This ratio is inverted.", "isCorrect": false }, { "text": "2:1", "rationale": "This would mean a representative's term is twice as long as a senator's.", "isCorrect": false }, { "text": "3:1", "rationale": "Correct. A senator's six-year term is three times as long as a representative's two-year term (6 years / 2 years = 3).", "isCorrect": true }, { "text": "1:2", "rationale": "This would mean a senator's term is half as long as a representative's.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_civics_executive",
                        title: "The Executive Branch",
                        description: "The President, The Cabinet, Powers of the President.",
                        quizzes: [
                            {
                                id: "ss_civics_executive_quiz1",
                                title: "The Executive Branch: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Article II of the Constitution establishes the Executive Branch, stating that 'The executive Power shall be vested in a President of the United States of America.' The president serves as both the head of state and head of government. To be eligible for the presidency, a person must be a natural-born citizen, at least 35 years old, and have been a resident of the United States for 14 years.", "question": "Which of the following is a constitutional requirement to become President of the United States?", "answerOptions": [ { "text": "Must have previously served in Congress.", "rationale": "There is no requirement for prior congressional service.", "isCorrect": false }, { "text": "Must be at least 35 years old.", "rationale": "Correct. The passage and Article II of the Constitution specify a minimum age of 35.", "isCorrect": true }, { "text": "Must be a member of either the Democratic or Republican party.", "rationale": "The Constitution does not mention political parties.", "isCorrect": false }, { "text": "Must have been born in Washington, D.C.", "rationale": "The requirement is to be a 'natural-born citizen,' not to be born in a specific location.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What is the primary role of the President's Cabinet?", "answerOptions": [ { "text": "To serve as the highest court in the country.", "rationale": "This is the role of the Supreme Court.", "isCorrect": false }, { "text": "To advise the President and lead the major executive departments.", "rationale": "Correct. The Cabinet is composed of the heads of the 15 executive departments (e.g., Secretary of State, Secretary of Defense) and other key officials who advise the President.", "isCorrect": true }, { "text": "To write and pass federal legislation.", "rationale": "This is the role of Congress.", "isCorrect": false }, { "text": "To conduct trials for impeached federal officials.", "rationale": "This is the role of the Senate.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "As Commander in Chief of the armed forces, the President has supreme command over the U.S. military. While Congress has the power to declare war, the President is responsible for directing military operations and strategy. This power ensures civilian control over the military.", "question": "What is the President's primary role as Commander in Chief?", "answerOptions": [ { "text": "To declare war on other countries.", "rationale": "The passage explicitly states that Congress has the power to declare war.", "isCorrect": false }, { "text": "To personally lead troops into battle.", "rationale": "The role is one of supreme command and direction, not personal combat.", "isCorrect": false }, { "text": "To exercise ultimate authority and direction over the military.", "rationale": "Correct. The passage identifies the President as having 'supreme command' and being responsible for 'directing military operations.'", "isCorrect": true }, { "text": "To approve the military's budget.", "rationale": "Congress controls the military's budget through its 'power of the purse.'", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "A presidential veto is the power of the President to refuse to approve a bill, thus preventing its enactment into law. This is a key part of what constitutional principle?", "answerOptions": [ { "text": "Federalism", "rationale": "Federalism is the division of power between the national and state governments.", "isCorrect": false }, { "text": "Judicial Review", "rationale": "Judicial review is the power of the courts to declare laws unconstitutional.", "isCorrect": false }, { "text": "Checks and Balances", "rationale": "Correct. The veto is a primary example of the executive branch's 'check' on the power of the legislative branch.", "isCorrect": true }, { "text": "Popular Sovereignty", "rationale": "Popular sovereignty is the principle that government power comes from the people.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "An executive order is a directive issued by the President of the United States that manages operations of the federal government. Executive orders have the force of law but do not require the approval of Congress. However, they can be challenged in court and are subject to judicial review. They are often used to implement existing laws or to manage the administration of the executive branch.", "question": "What is a key characteristic of an executive order?", "answerOptions": [ { "text": "It must be approved by a two-thirds vote in the Senate.", "rationale": "The passage states that executive orders 'do not require the approval of Congress.'", "isCorrect": false }, { "text": "It is a directive from the President that has the force of law without congressional approval.", "rationale": "Correct. The passage defines an executive order as a presidential directive with the force of law that does not need to be passed by Congress.", "isCorrect": true }, { "text": "It can overturn a Supreme Court ruling.", "rationale": "The President cannot overturn a Supreme Court ruling with an executive order.", "isCorrect": false }, { "text": "It is permanent and cannot be changed by future presidents.", "rationale": "Executive orders can be, and often are, reversed by subsequent presidents.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_executive_quiz2",
                                title: "The Executive Branch: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The President has the power to nominate ambassadors, cabinet members, and federal judges. Which body must confirm these appointments?", "answerOptions": [ { "text": "The House of Representatives", "rationale": "The House does not have a role in confirming presidential appointments.", "isCorrect": false }, { "text": "The Supreme Court", "rationale": "The Supreme Court does not confirm appointments.", "isCorrect": false }, { "text": "The Senate", "rationale": "Correct. The Constitution gives the Senate the power of 'advice and consent' on these key presidential appointments.", "isCorrect": true }, { "text": "The state governors", "rationale": "State governors are not involved in federal appointments.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What is the main purpose of the annual State of the Union address?", "answerOptions": [ { "text": "To declare war on a foreign country.", "rationale": "Declaring war is a formal power of Congress, not the purpose of this speech.", "isCorrect": false }, { "text": "For the President to present his legislative agenda and policy goals to Congress and the nation.", "rationale": "Correct. The Constitution requires the President to periodically inform Congress about the 'state of the union,' and it has evolved into a major annual speech to outline the President's agenda.", "isCorrect": true }, { "text": "To formally open the new session of the Supreme Court.", "rationale": "The Supreme Court operates independently of this presidential address.", "isCorrect": false }, { "text": "To announce the federal budget for the upcoming year.", "rationale": "While the budget is discussed, the primary purpose is to outline a broad legislative and policy agenda.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The 22nd Amendment to the Constitution, ratified in 1951, limits the president to two terms in office. This amendment was passed in response to President Franklin D. Roosevelt, who was elected to four terms.", "question": "What is the maximum number of terms a person can be elected President of the United States?", "answerOptions": [ { "text": "One", "rationale": "A president can serve two terms.", "isCorrect": false }, { "text": "Two", "rationale": "Correct. The 22nd Amendment established a two-term limit for the presidency.", "isCorrect": true }, { "text": "Four", "rationale": "Franklin D. Roosevelt was elected to four terms, but the 22nd Amendment was passed to prevent this from happening again.", "isCorrect": false }, { "text": "There is no limit.", "rationale": "The 22nd Amendment created a term limit.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "If the President can no longer serve, the Vice President becomes President. Who is next in the line of presidential succession after the Vice President?", "answerOptions": [ { "text": "The Secretary of State", "rationale": "The Secretary of State is fourth in line.", "isCorrect": false }, { "text": "The President pro tempore of the Senate", "rationale": "This official is third in line.", "isCorrect": false }, { "text": "The Speaker of the House of Representatives", "rationale": "Correct. According to the Presidential Succession Act, the Speaker of the House is next in line after the Vice President.", "isCorrect": true }, { "text": "The Chief Justice of the Supreme Court", "rationale": "The Chief Justice is not in the line of presidential succession.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The President's Cabinet is composed of the heads of the 15 executive departments. For example, the Secretary of State leads the Department of State and is the President's chief foreign affairs adviser. The Secretary of the Treasury is responsible for the nation's economic and financial systems.", "question": "Based on the passage, the Secretary of State is a member of the Cabinet who advises the President on what matters?", "answerOptions": [ { "text": "Military strategy", "rationale": "Military advice is primarily the role of the Secretary of Defense and the Joint Chiefs of Staff.", "isCorrect": false }, { "text": "Foreign affairs", "rationale": "Correct. The passage explicitly states that the Secretary of State is the 'President's chief foreign affairs adviser.'", "isCorrect": true }, { "text": "The federal budget", "rationale": "This is primarily the responsibility of the Secretary of the Treasury and the Office of Management and Budget.", "isCorrect": false }, { "text": "Domestic law enforcement", "rationale": "This is the responsibility of the Attorney General, who heads the Department of Justice.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_executive_quiz3",
                                title: "The Executive Branch: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The power of the President to grant a pardon for a federal crime is an example of what type of power?", "answerOptions": [ { "text": "A legislative power", "rationale": "Legislative power relates to making laws.", "isCorrect": false }, { "text": "A judicial power", "rationale": "Correct. The power to grant pardons and reprieves is a check on the judicial branch, allowing the President to forgive or lessen a criminal sentence.", "isCorrect": true }, { "text": "An economic power", "rationale": "This power is not primarily economic.", "isCorrect": false }, { "text": "A military power", "rationale": "This power is not military in nature.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "While the President has the power to negotiate treaties with foreign nations, these treaties do not become legally binding until they are approved by the Senate. This requirement is an important check on the President's foreign policy powers.", "question": "What is required for a treaty negotiated by the President to become law?", "answerOptions": [ { "text": "Approval by a majority vote in the House of Representatives.", "rationale": "The House of Representatives does not vote on treaties.", "isCorrect": false }, { "text": "A two-thirds majority vote of approval from the Senate.", "rationale": "Correct. The Constitution requires a two-thirds vote in the Senate to ratify a treaty, a high bar that ensures significant consensus.", "isCorrect": true }, { "text": "A unanimous vote from the Supreme Court.", "rationale": "The Supreme Court does not ratify treaties.", "isCorrect": false }, { "text": "The signature of every state governor.", "rationale": "State governors are not involved in the federal treaty process.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The group of agencies and departments that implement and administer federal laws and programs is collectively known as the:", "answerOptions": [ { "text": "Federal Judiciary", "rationale": "This refers to the court system.", "isCorrect": false }, { "text": "Congress", "rationale": "This is the legislative branch.", "isCorrect": false }, { "text": "Federal Bureaucracy", "rationale": "Correct. The federal bureaucracy includes all the executive departments, agencies, and commissions that carry out the work of the government.", "isCorrect": true }, { "text": "Electoral College", "rationale": "This is the body that formally elects the President.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Which executive department is responsible for overseeing the nation's military forces?", "answerOptions": [ { "text": "The Department of State", "rationale": "The Department of State is responsible for foreign policy and diplomacy.", "isCorrect": false }, { "text": "The Department of Homeland Security", "rationale": "Homeland Security is responsible for protecting the U.S. from threats like terrorism and managing borders.", "isCorrect": false }, { "text": "The Department of Defense", "rationale": "Correct. Headed by the Secretary of Defense, this department is responsible for all branches of the U.S. military.", "isCorrect": true }, { "text": "The Department of Justice", "rationale": "The Department of Justice is responsible for federal law enforcement.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "chart", "passage": `<div class="passage-text"><b>Presidential Executive Orders Issued (Selected Presidents)</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">President</th><th class="p-2 border-b">Executive Orders Issued</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Theodore Roosevelt</td><td class="p-2">1,081</td></tr><tr class="border-b"><td class="p-2">Woodrow Wilson</td><td class="p-2">1,803</td></tr><tr class="border-b"><td class="p-2">Franklin D. Roosevelt</td><td class="p-2">3,721</td></tr><tr class="border-b"><td class="p-2">Harry S. Truman</td><td class="p-2">907</td></tr><tr class="border-b"><td class="p-2">Dwight D. Eisenhower</td><td class="p-2">484</td></tr></tbody></table></div>`, "question": "According to the chart, which president issued more than twice as many executive orders as Woodrow Wilson?", "answerOptions": [ { "text": "Theodore Roosevelt", "rationale": "Theodore Roosevelt (1,081) issued fewer than Woodrow Wilson (1,803).", "isCorrect": false }, { "text": "Harry S. Truman", "rationale": "Harry S. Truman (907) issued far fewer than Woodrow Wilson (1,803).", "isCorrect": false }, { "text": "Franklin D. Roosevelt", "rationale": "Correct. Franklin D. Roosevelt issued 3,721 executive orders, which is more than double the 1,803 issued by Woodrow Wilson (1803 * 2 = 3606).", "isCorrect": true }, { "text": "Dwight D. Eisenhower", "rationale": "Dwight D. Eisenhower (484) issued the fewest on the chart.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_civics_judicial",
                        title: "The Judicial Branch",
                        description: "The Supreme Court, Judicial Review, Landmark Cases.",
                        quizzes: [
                            {
                                id: "ss_civics_judicial_quiz1",
                                title: "The Judicial Branch: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Article III of the Constitution establishes the Judicial Branch of the federal government. It creates the Supreme Court and gives Congress the power to create lower federal courts. Federal judges, including Supreme Court justices, are appointed by the President and confirmed by the Senate. They hold their offices 'during good Behaviour,' which generally means for life.", "question": "How long is the term for a Supreme Court justice?", "answerOptions": [ { "text": "A ten-year term.", "rationale": "Justices do not have a fixed term length.", "isCorrect": false }, { "text": "For life, or until they choose to retire.", "rationale": "Correct. The phrase 'during good Behaviour' has been interpreted to mean that justices serve for life, ensuring an independent judiciary free from political pressure.", "isCorrect": true }, { "text": "A six-year term, the same as a senator.", "rationale": "Senators serve six-year terms, but Supreme Court justices serve for life.", "isCorrect": false }, { "text": "They must be re-appointed by each new President.", "rationale": "Once appointed and confirmed, justices do not need to be re-appointed.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "What is the highest court in the United States federal court system?", "answerOptions": [ { "text": "The Court of Appeals", "rationale": "The Courts of Appeals are intermediate federal courts, below the Supreme Court.", "isCorrect": false }, { "text": "The District Court", "rationale": "District Courts are the trial courts of the federal system, at the lowest level.", "isCorrect": false }, { "text": "The Supreme Court", "rationale": "Correct. The Supreme Court is the highest federal court and has the final say on matters of constitutional law.", "isCorrect": true }, { "text": "The State Supreme Court", "rationale": "Each state has its own supreme court, but the U.S. Supreme Court is the highest court for federal law.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The power of judicial review is one of the most important powers of the Supreme Court. This principle, established in the 1803 case of Marbury v. Madison, allows the Court to review laws and actions taken by the legislative and executive branches and to determine whether they are constitutional. If the Court finds a law to be unconstitutional, it is nullified.", "question": "What does the power of judicial review allow the Supreme Court to do?", "answerOptions": [ { "text": "To write new laws to replace ones it finds unconstitutional.", "rationale": "The Court can only strike down laws; it cannot write new ones. That is a legislative power.", "isCorrect": false }, { "text": "To declare laws passed by Congress and signed by the President to be unconstitutional.", "rationale": "Correct. This is the core function of judicial review—ensuring that laws adhere to the Constitution.", "isCorrect": true }, { "text": "To veto bills before they are signed by the President.", "rationale": "The power to veto bills belongs to the President.", "isCorrect": false }, { "text": "To impeach the President for unconstitutional actions.", "rationale": "The power of impeachment belongs to Congress.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Which landmark Supreme Court case established the principle of judicial review?", "answerOptions": [ { "text": "Plessy v. Ferguson", "rationale": "Plessy v. Ferguson established the 'separate but equal' doctrine.", "isCorrect": false }, { "text": "Brown v. Board of Education", "rationale": "Brown v. Board of Education overturned 'separate but equal' in public schools.", "isCorrect": false }, { "text": "Marbury v. Madison", "rationale": "Correct. In this 1803 case, Chief Justice John Marshall asserted the Court's power to review and nullify acts of Congress, establishing the principle of judicial review.", "isCorrect": true }, { "text": "Miranda v. Arizona", "rationale": "Miranda v. Arizona established the requirement for police to inform suspects of their rights.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The Supreme Court consists of a Chief Justice and eight Associate Justices. For a case to be heard by the Supreme Court, at least four of the nine justices must agree to grant a writ of certiorari—an order for a lower court to send up the records of a case for review. This is known as the 'rule of four.'", "question": "What is the 'rule of four'?", "answerOptions": [ { "text": "The requirement that a case must be reviewed by at least four lower courts before it can reach the Supreme Court.", "rationale": "There is no such requirement.", "isCorrect": false }, { "text": "The minimum number of justices required to be present to hear a case.", "rationale": "This describes a quorum, not the rule of four.", "isCorrect": false }, { "text": "The number of justices required to agree for a decision to be made in a case.", "rationale": "A majority (usually five justices) is needed to decide a case.", "isCorrect": false }, { "text": "The minimum number of justices who must agree to hear a case before it is taken up by the Court.", "rationale": "Correct. The 'rule of four' is the informal practice that the Court will hear a case if four of the nine justices agree to do so.", "isCorrect": true } ] }
                                ]
                            },
                            {
                                id: "ss_civics_judicial_quiz2",
                                title: "The Judicial Branch: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The landmark case of Gideon v. Wainwright (1963) affirmed the right of the accused to what?", "answerOptions": [ { "text": "The right to a trial by jury.", "rationale": "This right is in the 6th Amendment but was not the subject of this case.", "isCorrect": false }, { "text": "The right to legal counsel (a lawyer), even if they cannot afford one.", "rationale": "Correct. The Court ruled that the 6th Amendment's guarantee of counsel is a fundamental right essential to a fair trial and must be provided to indigent defendants in felony cases.", "isCorrect": true }, { "text": "The right to remain silent.", "rationale": "This was central to the Miranda v. Arizona case.", "isCorrect": false }, { "text": "Protection from unreasonable searches.", "rationale": "This is the focus of the 4th Amendment.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "In the case of Tinker v. Des Moines (1969), the Supreme Court ruled on the free speech rights of students in public schools. Students had worn black armbands to protest the Vietnam War and were suspended. The Court famously stated that students do not 'shed their constitutional rights to freedom of speech or expression at the schoolhouse gate.'", "question": "What principle was established by the Supreme Court's decision in Tinker v. Des Moines?", "answerOptions": [ { "text": "That students have no free speech rights in public schools.", "rationale": "The ruling affirmed the opposite.", "isCorrect": false }, { "text": "That schools can ban any form of student expression they disagree with.", "rationale": "The ruling limited the ability of schools to ban expression.", "isCorrect": false }, { "text": "That students have a right to symbolic speech at school, as long as it does not substantially disrupt the educational environment.", "rationale": "Correct. This case established that students' symbolic speech (like wearing armbands) is protected under the First Amendment unless it causes a significant disruption.", "isCorrect": true }, { "text": "That only spoken speech, not symbolic speech, is protected in schools.", "rationale": "The case specifically protected symbolic speech.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "The Supreme Court case Miranda v. Arizona (1966) led to the creation of the 'Miranda warning.' What does this warning inform criminal suspects of?", "answerOptions": [ { "text": "Their right to a speedy trial.", "rationale": "This is a 6th Amendment right, but not part of the Miranda warning.", "isCorrect": false }, { "text": "Their right to confront their accusers.", "rationale": "This is also a 6th Amendment right, but not part of the Miranda warning.", "isCorrect": false }, { "text": "Their right to remain silent and their right to an attorney.", "rationale": "Correct. The Miranda warning ensures that suspects are aware of their Fifth Amendment right against self-incrimination and their Sixth Amendment right to counsel before they are interrogated.", "isCorrect": true }, { "text": "Their right to be free from cruel and unusual punishment.", "rationale": "This is an 8th Amendment right, relevant after conviction, not during interrogation.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "When the Supreme Court justices are deciding a case, the official decision of the Court is called the:", "answerOptions": [ { "text": "Dissenting opinion", "rationale": "A dissenting opinion is written by justices who disagree with the official decision.", "isCorrect": false }, { "text": "Concurring opinion", "rationale": "A concurring opinion is written by justices who agree with the outcome but for different legal reasons.", "isCorrect": false }, { "text": "Majority opinion", "rationale": "Correct. The majority opinion explains the legal reasoning behind the Court's final decision and sets the precedent for future cases.", "isCorrect": true }, { "text": "Writ of certiorari", "rationale": "This is the order the Court issues to agree to hear a case, not the decision itself.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The Supreme Court's decision in Brown v. Board of Education (1954) was a pivotal moment in the Civil Rights Movement. The Court unanimously ruled that state-sponsored segregation of public schools was unconstitutional because 'separate educational facilities are inherently unequal.' This decision overturned the 'separate but equal' doctrine established by Plessy v. Ferguson in 1896.", "question": "What legal precedent did Brown v. Board of Education overturn?", "answerOptions": [ { "text": "The principle of judicial review.", "rationale": "This case was an example of judicial review, it did not overturn it.", "isCorrect": false }, { "text": "The 'separate but equal' doctrine.", "rationale": "Correct. The passage explicitly states that the Brown decision overturned the 'separate but equal' precedent set by Plessy v. Ferguson.", "isCorrect": true }, { "text": "The right to a fair trial.", "rationale": "This case was about segregation, not trial rights.", "isCorrect": false }, { "text": "The legality of poll taxes.", "rationale": "Poll taxes were addressed by a constitutional amendment.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_judicial_quiz3",
                                title: "The Judicial Branch: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "The power to create lower federal courts, such as district courts and courts of appeals, belongs to which branch of government?", "answerOptions": [ { "text": "The Executive Branch", "rationale": "The President appoints judges, but does not create the courts themselves.", "isCorrect": false }, { "text": "The Judicial Branch", "rationale": "The judiciary operates the courts, but Article III gives Congress the power to establish them.", "isCorrect": false }, { "text": "The Legislative Branch", "rationale": "Correct. Article III of the Constitution explicitly gives Congress the authority to 'ordain and establish' courts inferior to the Supreme Court.", "isCorrect": true }, { "text": "The state governments", "rationale": "State governments create state courts, not federal courts.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "The Supreme Court has two main types of jurisdiction: original and appellate. Original jurisdiction means the Court hears a case for the first time. This is rare and typically involves disputes between states. Most of the Court's cases are heard on appellate jurisdiction, meaning the Court is hearing an appeal of a decision made by a lower court.", "question": "Most cases that reach the Supreme Court are heard through which type of jurisdiction?", "answerOptions": [ { "text": "Original jurisdiction", "rationale": "The passage states that original jurisdiction is rare.", "isCorrect": false }, { "text": "Appellate jurisdiction", "rationale": "Correct. The passage states that 'Most of the Court's cases are heard on appellate jurisdiction.'", "isCorrect": true }, { "text": "Concurrent jurisdiction", "rationale": "Concurrent jurisdiction means a case could be heard in either state or federal court, but it doesn't describe how a case gets to the Supreme Court.", "isCorrect": false }, { "text": "Exclusive jurisdiction", "rationale": "Exclusive jurisdiction means a case can only be heard in a particular court, but most Supreme Court cases are appeals.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "What is the term for a previous court ruling that is used as a basis for deciding a current case with similar facts or issues?", "answerOptions": [ { "text": "A statute", "rationale": "A statute is a written law passed by a legislature.", "isCorrect": false }, { "text": "An amendment", "rationale": "An amendment is a change to the Constitution.", "isCorrect": false }, { "text": "A precedent", "rationale": "Correct. The principle of following precedent, known as stare decisis, is a cornerstone of the American legal system, ensuring consistency and predictability in the law.", "isCorrect": true }, { "text": "A filibuster", "rationale": "A filibuster is a tactic used in the Senate.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "The landmark case Roe v. Wade (1973), which was overturned in 2022, dealt with which constitutional issue?", "answerOptions": [ { "text": "The right to bear arms.", "rationale": "This is covered by the Second Amendment.", "isCorrect": false }, { "text": "Freedom of the press.", "rationale": "This is covered by the First Amendment.", "isCorrect": false }, { "text": "The right to privacy and abortion.", "rationale": "Correct. Roe v. Wade established a woman's constitutional right to an abortion, based on the right to privacy implied in the Constitution.", "isCorrect": true }, { "text": "The separation of church and state.", "rationale": "This is covered by the First Amendment.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "chart", "passage": `<div class="passage-text"><b>Supreme Court Justices by Appointing President (1981-2022)</b><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">President</th><th class="p-2 border-b">Number of Appointments</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Ronald Reagan</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">George H.W. Bush</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Bill Clinton</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">George W. Bush</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Barack Obama</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Donald Trump</td><td class="p-2">3</td></tr><tr class="border-b"><td class="p-2">Joe Biden</td><td class="p-2">1</td></tr></tbody></table></div>`, "question": "What is the mode of the number of appointments shown in the chart?", "answerOptions": [ { "text": "1", "rationale": "1 appears only once.", "isCorrect": false }, { "text": "2", "rationale": "Correct. The number 2 appears most frequently in the data set (four times).", "isCorrect": true }, { "text": "3", "rationale": "3 appears only once.", "isCorrect": false }, { "text": "4", "rationale": "4 appears only once.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    },
                    {
                        id: "ss_civics_federalism_elections",
                        title: "Federalism & Elections",
                        description: "Federal vs. State Powers, The Electoral College, Political Parties.",
                        quizzes: [
                            {
                                id: "ss_civics_federalism_elections_quiz1",
                                title: "Federalism & Elections: Quiz 1",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Federalism is a system of government in which power is divided between a central, national government and various regional governments, such as states. The U.S. Constitution establishes this system by granting certain powers to the federal government (enumerated powers), reserving other powers for the states (reserved powers), and allowing some powers to be shared by both (concurrent powers).", "question": "Which of the following is the best definition of federalism?", "answerOptions": [ { "text": "A system where all power is held by a single, central government.", "rationale": "This describes a unitary system, not federalism.", "isCorrect": false }, { "text": "A system where power is divided between a national government and state governments.", "rationale": "Correct. Federalism is characterized by this division of power between different levels of government.", "isCorrect": true }, { "text": "A system where the government is divided into three separate branches.", "rationale": "This describes the separation of powers, not federalism.", "isCorrect": false }, { "text": "A system where the people vote directly on all laws.", "rationale": "This describes a direct democracy, not federalism.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The power to coin money, declare war, and make treaties are all examples of what type of power in the U.S. federal system?", "answerOptions": [ { "text": "Reserved powers", "rationale": "Reserved powers belong to the states.", "isCorrect": false }, { "text": "Concurrent powers", "rationale": "Concurrent powers are shared by both federal and state governments.", "isCorrect": false }, { "text": "Enumerated powers", "rationale": "Correct. These powers are explicitly listed, or enumerated, in the Constitution as belonging to the federal government.", "isCorrect": true }, { "text": "Implied powers", "rationale": "Implied powers are not explicitly listed but are considered necessary to carry out expressed powers.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "The Tenth Amendment to the Constitution states that powers not delegated to the federal government, nor prohibited to the states, are reserved for the states or the people. These 'reserved powers' form the basis of state authority over many aspects of daily life.", "question": "Which of the following is the best example of a reserved power held by state governments?", "answerOptions": [ { "text": "Regulating interstate commerce.", "rationale": "The Constitution gives the power to regulate commerce between the states to the federal government.", "isCorrect": false }, { "text": "Conducting elections.", "rationale": "Correct. While the federal government sets some general rules, states are responsible for the administration of elections, including setting up polling places and printing ballots.", "isCorrect": true }, { "text": "Negotiating treaties with foreign countries.", "rationale": "This is an enumerated power of the federal government.", "isCorrect": false }, { "text": "Maintaining an army and a navy.", "rationale": "This is an enumerated power of the federal government.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Powers that are shared by both the federal government and state governments, such as the power to tax and build roads, are known as:", "answerOptions": [ { "text": "Concurrent powers", "rationale": "Correct. 'Concurrent' means happening at the same time, and these are powers that both levels of government can exercise.", "isCorrect": true }, { "text": "Reserved powers", "rationale": "Reserved powers belong only to the states.", "isCorrect": false }, { "text": "Enumerated powers", "rationale": "Enumerated powers belong only to the federal government.", "isCorrect": false }, { "text": "Delegated powers", "rationale": "Delegated powers are those specifically granted to the federal government.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "text", "passage": "The President of the United States is not elected by a direct popular vote. Instead, the election is decided by the Electoral College. In this system, each state is assigned a number of electors equal to its total number of representatives in Congress (House + Senate). In most states, the candidate who wins the popular vote in that state wins all of that state's electoral votes.", "question": "How is the number of electoral votes for each state determined?", "answerOptions": [ { "text": "It is based on the physical size of the state.", "rationale": "The number of electoral votes is based on population, not land area.", "isCorrect": false }, { "text": "Each state receives the same number of electoral votes.", "rationale": "The number of votes varies greatly from state to state based on population.", "isCorrect": false }, { "text": "It is equal to the state's total number of Senators and Representatives in Congress.", "rationale": "Correct. The passage clearly states this is how the number of electors is determined.", "isCorrect": true }, { "text": "It is determined by the state governor.", "rationale": "The number is determined by the census and congressional apportionment, not the governor.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_federalism_elections_quiz2",
                                title: "Federalism & Elections: Quiz 2",
                                questions: [
                                    { "questionNumber": 1, "type": "knowledge", "question": "How many total electoral votes are there, and how many are needed to win the presidency?", "answerOptions": [ { "text": "100 total; 51 to win.", "rationale": "This is related to the number of senators, not the Electoral College.", "isCorrect": false }, { "text": "435 total; 218 to win.", "rationale": "This is related to the number of representatives, not the Electoral College.", "isCorrect": false }, { "text": "538 total; 270 to win.", "rationale": "Correct. There are 538 electoral votes in total (435 Representatives + 100 Senators + 3 for Washington D.C.). A majority, 270, is needed to win.", "isCorrect": true }, { "text": "1,000 total; 501 to win.", "rationale": "These numbers are incorrect.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "text", "passage": "A major criticism of the Electoral College is that it is possible for a candidate to win the presidency without winning the national popular vote. This happens if a candidate wins by narrow margins in several large states, while their opponent wins by large margins in fewer states. This has occurred in several U.S. presidential elections, including in 2000 and 2016.", "question": "What is a major criticism of the Electoral College system?", "answerOptions": [ { "text": "It gives too much power to the most populous states.", "rationale": "While large states have many votes, the system can be criticized for giving disproportionate power to smaller states.", "isCorrect": false }, { "text": "It is possible to become president without winning the most individual votes nationwide.", "rationale": "Correct. The passage identifies this as a major criticism, as it can lead to a result where the winner of the popular vote loses the election.", "isCorrect": true }, { "text": "It is too expensive to operate.", "rationale": "Cost is not a primary criticism of the system.", "isCorrect": false }, { "text": "It makes it too difficult for any candidate to win.", "rationale": "The system is designed to produce a clear winner.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "knowledge", "question": "What is the primary function of political parties in the United States?", "answerOptions": [ { "text": "To enforce federal laws.", "rationale": "This is the role of the executive branch.", "isCorrect": false }, { "text": "To interpret the Constitution.", "rationale": "This is the role of the judicial branch.", "isCorrect": false }, { "text": "To nominate candidates for office, mobilize voters, and try to control the government.", "rationale": "Correct. Political parties are organizations that share a common ideology and work to elect their members to government positions to influence policy.", "isCorrect": true }, { "text": "To remain neutral in all political matters.", "rationale": "Political parties are inherently partisan and exist to compete for power.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "text", "passage": "The United States has a two-party system, which has been dominated by the Democratic and Republican parties for most of its history. While third parties, such as the Libertarian or Green parties, exist and can influence elections, they have rarely won major national offices. The winner-take-all nature of most elections makes it very difficult for third parties to gain a foothold.", "question": "According to the passage, why is it difficult for third parties to succeed in the U.S. political system?", "answerOptions": [ { "text": "Because they are illegal in most states.", "rationale": "Third parties are legal.", "isCorrect": false }, { "text": "Because they are not allowed to raise money.", "rationale": "Third parties can raise money, though it is often more difficult for them.", "isCorrect": false }, { "text": "Because the 'winner-take-all' electoral system makes it hard for them to win elections.", "rationale": "Correct. In a winner-take-all system, even a party with significant support (e.g., 15-20% of the vote) wins no representation, which discourages voters and donors from supporting them.", "isCorrect": true }, { "text": "Because they are not allowed to participate in presidential debates.", "rationale": "While debate access is a challenge, the core structural problem is the winner-take-all system.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "knowledge", "question": "What is the term for an election held to choose which candidate will represent a political party in the general election?", "answerOptions": [ { "text": "A general election", "rationale": "The general election is the final contest between the party nominees.", "isCorrect": false }, { "text": "A primary election", "rationale": "Correct. In a primary election (or caucus), voters select which candidate they want their party to nominate for office.", "isCorrect": true }, { "text": "A recall election", "rationale": "A recall election is a procedure to remove an elected official from office.", "isCorrect": false }, { "text": "A referendum", "rationale": "A referendum is a vote on a specific law or policy, not a candidate.", "isCorrect": false } ] }
                                ]
                            },
                            {
                                id: "ss_civics_federalism_elections_quiz3",
                                title: "Federalism & Elections: Quiz 3",
                                questions: [
                                    { "questionNumber": 1, "type": "text", "passage": "Political ideologies in the U.S. are often described on a spectrum. Generally, those on the 'left' (often associated with the Democratic party) tend to favor more government intervention in the economy and more support for social programs. Those on the 'right' (often associated with the Republican party) tend to favor less government intervention, lower taxes, and a stronger emphasis on individual responsibility.", "question": "A politician who advocates for less government regulation of business and lower taxes would most likely be described as being on which side of the political spectrum?", "answerOptions": [ { "text": "The left", "rationale": "The left generally favors more government regulation and social programs funded by taxes.", "isCorrect": false }, { "text": "The right", "rationale": "Correct. Favoring less government intervention in the economy and lower taxes are core principles generally associated with the political right in the U.S.", "isCorrect": true }, { "text": "The center", "rationale": "A centrist might hold a mix of views, but a strong stance on less regulation and lower taxes is characteristic of the right.", "isCorrect": false }, { "text": "Unaffiliated", "rationale": "This describes a lack of party membership, not an ideological position.", "isCorrect": false } ] },
                                    { "questionNumber": 2, "type": "knowledge", "question": "The process of redrawing legislative district boundaries every 10 years after the census is known as:", "answerOptions": [ { "text": "Gerrymandering", "rationale": "Gerrymandering is the manipulation of these boundaries to favor one party, but the process itself is called redistricting.", "isCorrect": false }, { "text": "Redistricting", "rationale": "Correct. Redistricting is the process of redrawing electoral district boundaries to account for population shifts.", "isCorrect": true }, { "text": "Filibustering", "rationale": "This is a tactic used in the Senate.", "isCorrect": false }, { "text": "Lobbying", "rationale": "This is the act of trying to influence lawmakers.", "isCorrect": false } ] },
                                    { "questionNumber": 3, "type": "text", "passage": "Gerrymandering is the practice of drawing electoral district boundaries in a way that gives one political party an unfair advantage over another. This can be done by 'packing' an opposing party's voters into a few districts or 'cracking' them into many districts where they will be a minority. While redistricting is a normal process, gerrymandering is a controversial and often criticized manipulation of that process.", "question": "What is the primary goal of gerrymandering?", "answerOptions": [ { "text": "To create districts of equal population size.", "rationale": "This is the goal of redistricting, but gerrymandering manipulates this process for political gain.", "isCorrect": false }, { "text": "To create a political advantage for one party by manipulating district boundaries.", "rationale": "Correct. The passage defines gerrymandering as drawing districts to give one party an 'unfair advantage.'", "isCorrect": true }, { "text": "To make elections more competitive.", "rationale": "Gerrymandering often makes elections less competitive by creating 'safe' districts for one party.", "isCorrect": false }, { "text": "To ensure that districts are geographically compact.", "rationale": "Gerrymandered districts are often bizarrely shaped to achieve a political outcome.", "isCorrect": false } ] },
                                    { "questionNumber": 4, "type": "knowledge", "question": "Which of the following is a right of U.S. citizens but NOT a responsibility?", "answerOptions": [ { "text": "Voting in elections", "rationale": "Voting is both a right and a civic responsibility, but it is not legally required.", "isCorrect": false }, { "text": "Paying taxes", "rationale": "Paying taxes is a legal requirement and a responsibility.", "isCorrect": false }, { "text": "Freedom of speech", "rationale": "Correct. Freedom of speech is a fundamental right guaranteed by the First Amendment. While using it responsibly is encouraged, it is not a required civic duty like paying taxes or serving on a jury.", "isCorrect": true }, { "text": "Serving on a jury", "rationale": "Serving on a jury when called is a legal requirement and a civic responsibility.", "isCorrect": false } ] },
                                    { "questionNumber": 5, "type": "chart", "passage": `<div class="passage-text"><b>Hypothetical Election Results</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Candidate</th><th class="p-2 border-b">Popular Vote</th><th class="p-2 border-b">Electoral Votes</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Candidate A</td><td class="p-2">65,853,514</td><td class="p-2">232</td></tr><tr class="border-b"><td class="p-2">Candidate B</td><td class="p-2">62,984,828</td><td class="p-2">306</td></tr></tbody></table></div>`, "question": "Based on the chart of these hypothetical election results, who would win the presidency?", "answerOptions": [ { "text": "Candidate A, because they won the popular vote.", "rationale": "Winning the popular vote does not guarantee winning the presidency.", "isCorrect": false }, { "text": "Candidate B, because they won the necessary number of electoral votes.", "rationale": "Correct. A candidate needs 270 electoral votes to win. Candidate B has 306, which is more than enough, despite having fewer popular votes.", "isCorrect": true }, { "text": "It would be a tie, and the House of Representatives would decide.", "rationale": "There is no tie; Candidate B has a clear majority of electoral votes.", "isCorrect": false }, { "text": "Neither candidate, because the popular vote and electoral vote winners are different.", "rationale": "In this scenario, the Electoral College result is what determines the winner.", "isCorrect": false } ] }
                                ]
                            }
                        ]
                    }
                ]
            },
            "Economics": {
                description: "Learn about key economic principles and the U.S. economy.",
                topics: [
                    {
                        id: "ss_econ_foundations",
                        title: "Foundational Concepts",
                        description: "Scarcity, Opportunity Cost, Supply and Demand.",
                        questions: [
                            { "questionNumber": 1, "type": "text", "passage": "The fundamental problem of economics is scarcity. Scarcity means that human wants for goods, services, and resources exceed what is available. Resources, such as labor, tools, land, and raw materials, are limited. This scarcity forces individuals, businesses, and governments to make choices.", "question": "What is the basic economic problem of scarcity?", "answerOptions": [ { "text": "There is not enough money in the economy.", "rationale": "While money can be limited, scarcity refers to the limited availability of actual resources and goods.", "isCorrect": false }, { "text": "That resources are limited, but human wants are unlimited.", "rationale": "Correct. Scarcity is the conflict between unlimited wants and limited resources, which necessitates making choices.", "isCorrect": true }, { "text": "That the government controls all the resources.", "rationale": "This describes a specific type of economy, not the universal problem of scarcity.", "isCorrect": false }, { "text": "That there is a temporary shortage of a specific good.", "rationale": "A shortage is a temporary condition, whereas scarcity is a permanent, fundamental economic problem.", "isCorrect": false } ] },
                            { "questionNumber": 2, "type": "knowledge", "question": "When you make a choice, the value of the next-best alternative that you give up is called the:", "answerOptions": [ { "text": "Opportunity cost", "rationale": "Correct. Opportunity cost is the value of the most valuable alternative that was not chosen.", "isCorrect": true }, { "text": "Scarcity", "rationale": "Scarcity is the condition that forces choices, but it is not the value of the foregone alternative.", "isCorrect": false }, { "text": "Supply", "rationale": "Supply refers to the amount of a good or service available.", "isCorrect": false }, { "text": "Demand", "rationale": "Demand refers to the desire and ability to purchase a good or service.", "isCorrect": false } ] },
                            { "questionNumber": 3, "type": "text", "passage": "Imagine you have $20. You can either buy a new video game or go to the movies with a friend. You cannot do both. You decide to buy the video game. The experience of going to the movies with your friend is the opportunity cost of your decision.", "question": "In this scenario, what is the opportunity cost of buying the video game?", "answerOptions": [ { "text": "The $20 you spent.", "rationale": "The money spent is the price, not the opportunity cost. The opportunity cost is what you gave up.", "isCorrect": false }, { "text": "The video game itself.", "rationale": "The video game is what you gained, not what you gave up.", "isCorrect": false }, { "text": "The enjoyment of going to the movies with a friend.", "rationale": "Correct. The opportunity cost is the value of the next-best alternative you sacrificed, which in this case was the movie outing.", "isCorrect": true }, { "text": "There is no opportunity cost because you got what you wanted.", "rationale": "Every choice has an opportunity cost.", "isCorrect": false } ] },
                            { "questionNumber": 4, "type": "knowledge", "question": "The Law of Demand states that, all other factors being equal, as the price of a good or service increases, the quantity demanded will:", "answerOptions": [ { "text": "Increase", "rationale": "This is the opposite of the Law of Demand.", "isCorrect": false }, { "text": "Decrease", "rationale": "Correct. This inverse relationship between price and quantity demanded is the fundamental principle of the Law of Demand.", "isCorrect": true }, { "text": "Stay the same", "rationale": "The Law of Demand describes a change in quantity demanded as price changes.", "isCorrect": false }, { "text": "Become unpredictable", "rationale": "The Law of Demand predicts a specific relationship.", "isCorrect": false } ] },
                            { "questionNumber": 5, "type": "knowledge", "question": "The Law of Supply states that, all other factors being equal, as the price of a good or service increases, the quantity supplied by producers will:", "answerOptions": [ { "text": "Increase", "rationale": "Correct. Producers are willing to supply more of a good at a higher price because it is more profitable.", "isCorrect": true }, { "text": "Decrease", "rationale": "This describes the Law of Demand, not the Law of Supply.", "isCorrect": false }, { "text": "Stay the same", "rationale": "The Law of Supply describes a change in quantity supplied as price changes.", "isCorrect": false }, { "text": "Become zero", "rationale": "Suppliers are more, not less, willing to sell at higher prices.", "isCorrect": false } ] },
                            { "questionNumber": 6, "type": "image", "imageUrl": "Images/Questions-are-based-on-the-following-graph.-7 (1).png", "question": "This graph shows a standard supply and demand model. The point where the supply curve and the demand curve intersect is known as:", "answerOptions": [ { "text": "The point of surplus", "rationale": "A surplus occurs when the price is above this point.", "isCorrect": false }, { "text": "The point of shortage", "rationale": "A shortage occurs when the price is below this point.", "isCorrect": false }, { "text": "The equilibrium point", "rationale": "Correct. The equilibrium point (or market equilibrium) is where the quantity supplied equals the quantity demanded.", "isCorrect": true }, { "text": "The price ceiling", "rationale": "A price ceiling is a government-imposed maximum price, not the natural intersection of supply and demand.", "isCorrect": false } ] },
                            { "questionNumber": 7, "type": "text", "passage": "In a market, when the current price of a product is above the equilibrium price, the quantity supplied will exceed the quantity demanded. This situation creates a surplus, as producers have more of the product than consumers are willing to buy at that high price. To sell the excess inventory, producers will typically lower the price.", "question": "What happens when the price of a good is set above the equilibrium price?", "answerOptions": [ { "text": "A shortage occurs, and prices tend to rise.", "rationale": "A shortage occurs when the price is below equilibrium.", "isCorrect": false }, { "text": "A surplus occurs, and prices tend to fall.", "rationale": "Correct. A surplus (quantity supplied > quantity demanded) puts downward pressure on prices as sellers try to get rid of excess stock.", "isCorrect": true }, { "text": "The market remains in equilibrium.", "rationale": "The market is in disequilibrium when the price is not at the equilibrium level.", "isCorrect": false }, { "text": "The demand for the good increases.", "rationale": "According to the Law of Demand, a higher price causes quantity demanded to decrease, not increase.", "isCorrect": false } ] },
                            { "questionNumber": 8, "type": "text", "passage": "Conversely, when the current price of a product is below the equilibrium price, the quantity demanded will exceed the quantity supplied. This situation creates a shortage, as consumers want to buy more of the product than producers are willing to sell at that low price. This excess demand will cause the price to be bid up.", "question": "What happens when the price of a good is set below the equilibrium price?", "answerOptions": [ { "text": "A shortage occurs, and prices tend to rise.", "rationale": "Correct. A shortage (quantity demanded > quantity supplied) puts upward pressure on prices as buyers compete for the limited goods.", "isCorrect": true }, { "text": "A surplus occurs, and prices tend to fall.", "rationale": "A surplus occurs when the price is above equilibrium.", "isCorrect": false }, { "text": "The market remains in equilibrium.", "rationale": "The market is in disequilibrium.", "isCorrect": false }, { "text": "The supply of the good increases.", "rationale": "According to the Law of Supply, a lower price causes quantity supplied to decrease, not increase.", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "knowledge", "question": "Which of the following would likely cause the demand curve for coffee to shift to the right (an increase in demand)?", "answerOptions": [ { "text": "A new study showing that coffee is bad for your health.", "rationale": "This would likely decrease demand, shifting the curve to the left.", "isCorrect": false }, { "text": "An increase in the price of coffee beans.", "rationale": "This would affect the supply curve, not the demand curve.", "isCorrect": false }, { "text": "A successful advertising campaign that makes coffee more popular.", "rationale": "Correct. A change in consumer tastes or preferences, such as that caused by a successful ad campaign, would increase the demand for coffee at every price level, shifting the entire curve to the right.", "isCorrect": true }, { "text": "A decrease in the price of tea, a substitute good.", "rationale": "If a substitute good becomes cheaper, the demand for coffee would likely decrease, shifting the curve to the left.", "isCorrect": false } ] },
                            { "questionNumber": 10, "type": "knowledge", "question": "Which of the following would likely cause the supply curve for cars to shift to the left (a decrease in supply)?", "answerOptions": [ { "text": "A decrease in the price of cars.", "rationale": "A change in price causes a movement along the supply curve, not a shift of the curve itself.", "isCorrect": false }, { "text": "A new technology that makes car manufacturing cheaper and faster.", "rationale": "This would increase supply, shifting the curve to the right.", "isCorrect": false }, { "text": "An increase in the wages of autoworkers.", "rationale": "Correct. An increase in the cost of an input (like labor) makes production more expensive, so producers are willing to supply fewer cars at every price level, shifting the supply curve to the left.", "isCorrect": true }, { "text": "An increase in the number of consumers who want to buy cars.", "rationale": "This would affect the demand curve, not the supply curve.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "knowledge", "question": "The resources used to produce goods and services are known as the factors of production. Which of the following is NOT considered a factor of production?", "answerOptions": [ { "text": "Land (natural resources)", "rationale": "Land is one of the four factors of production.", "isCorrect": false }, { "text": "Labor (human effort)", "rationale": "Labor is one of the four factors of production.", "isCorrect": false }, { "text": "Capital (tools, machinery, and buildings)", "rationale": "Capital is one of the four factors of production.", "isCorrect": false }, { "text": "Money (currency)", "rationale": "Correct. In economics, money is a medium of exchange used to acquire factors of production, but it is not a factor of production itself.", "isCorrect": true } ] },
                            { "questionNumber": 12, "type": "text", "passage": "In economics, a distinction is made between a change in 'quantity demanded' and a change in 'demand.' A change in quantity demanded is a movement along the demand curve caused only by a change in the price of the good itself. A change in demand is a shift of the entire curve, caused by factors other than price, such as changes in income, consumer tastes, or the price of related goods.", "question": "A decrease in the price of gasoline causes people to buy more gasoline. This is an example of:", "answerOptions": [ { "text": "an increase in demand.", "rationale": "This is a change in quantity demanded, not a shift of the entire demand curve.", "isCorrect": false }, { "text": "a decrease in demand.", "rationale": "The amount purchased increased.", "isCorrect": false }, { "text": "an increase in quantity demanded.", "rationale": "Correct. The change in the amount purchased is a direct response to a change in the good's own price, which is a movement along the existing demand curve.", "isCorrect": true }, { "text": "a decrease in quantity demanded.", "rationale": "The amount purchased increased, not decreased.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "knowledge", "question": "Goods that are often used together, like hot dogs and hot dog buns, are called:", "answerOptions": [ { "text": "Substitute goods", "rationale": "Substitute goods are used in place of each other, like tea and coffee.", "isCorrect": false }, { "text": "Complementary goods", "rationale": "Correct. Complementary goods are products that are consumed together. If the price of one goes up, the demand for the other tends to fall.", "isCorrect": true }, { "text": "Inferior goods", "rationale": "An inferior good is one for which demand decreases as income rises.", "isCorrect": false }, { "text": "Normal goods", "rationale": "A normal good is one for which demand increases as income rises.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "text", "passage": "If a new, highly efficient machine for harvesting wheat is invented, it will lower the cost of production for farmers. This change will affect the market for wheat.", "question": "How will this new harvesting machine most likely affect the market for wheat?", "answerOptions": [ { "text": "It will cause the supply curve to shift to the right, leading to a lower equilibrium price and higher equilibrium quantity.", "rationale": "Correct. A technology that lowers production costs increases supply (shifts the curve right). This new, higher supply intersects the demand curve at a lower price and a higher quantity.", "isCorrect": true }, { "text": "It will cause the supply curve to shift to the left, leading to a higher equilibrium price.", "rationale": "A cost-saving technology increases supply, it does not decrease it.", "isCorrect": false }, { "text": "It will cause the demand curve to shift to the right, leading to a higher equilibrium price.", "rationale": "A change in production technology affects supply, not demand.", "isCorrect": false }, { "text": "It will cause the demand curve to shift to the left, leading to a lower equilibrium price.", "rationale": "A change in production technology affects supply, not demand.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "chart", "passage": `<div class="passage-text"><b>Production Possibilities for a Small Farm</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Choice</th><th class="p-2 border-b">Bushels of Corn</th><th class="p-2 border-b">Bushels of Soybeans</th></tr></thead><tbody><tr class="border-b"><td class="p-2">A</td><td class="p-2">100</td><td class="p-2">0</td></tr><tr class="border-b"><td class="p-2">B</td><td class="p-2">80</td><td class="p-2">30</td></tr><tr class="border-b"><td class="p-2">C</td><td class="p-2">50</td><td class="p-2">50</td></tr><tr class="border-b"><td class="p-2">D</td><td class="p-2">0</td><td class="p-2">60</td></tr></tbody></table></div>`, "question": "Based on the chart, what is the opportunity cost of increasing soybean production from 30 bushels (Choice B) to 50 bushels (Choice C)?", "answerOptions": [ { "text": "80 bushels of corn", "rationale": "This is the amount of corn produced at Choice B, not the amount given up.", "isCorrect": false }, { "text": "50 bushels of soybeans", "rationale": "This is the new amount of soybeans, not the cost.", "isCorrect": false }, { "text": "30 bushels of corn", "rationale": "Correct. To increase soybean production from 30 to 50 (a gain of 20), corn production must decrease from 80 to 50, which is a loss of 30 bushels. This is the opportunity cost.", "isCorrect": true }, { "text": "20 bushels of soybeans", "rationale": "This is the amount of soybeans gained, not the cost in terms of corn.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "ss_econ_us_economy",
                        title: "The U.S. Economy",
                        description: "Market Systems, Role of Government, Fiscal vs. Monetary Policy.",
                        questions: [
                            { "questionNumber": 1, "type": "text", "passage": "The United States has a mixed economy, which means it combines elements of both capitalism (market economy) and socialism (command economy). While it is primarily a market-based system where private individuals and businesses make most of the economic decisions, the government plays a significant role in regulation, social welfare, and providing public goods.", "question": "Why is the U.S. economy considered a 'mixed economy'?", "answerOptions": [ { "text": "Because it only trades with a mix of different countries.", "rationale": "A mixed economy refers to its internal structure, not its trading partners.", "isCorrect": false }, { "text": "Because it combines elements of a market system with government intervention.", "rationale": "Correct. It blends private enterprise with government regulation and programs, which is the definition of a mixed economy.", "isCorrect": true }, { "text": "Because it has a mix of agricultural and industrial sectors.", "rationale": "Most modern economies have a mix of sectors; this does not define it as a 'mixed economy' in the economic sense.", "isCorrect": false }, { "text": "Because all economic decisions are made by a mix of the President and Congress.", "rationale": "In the U.S. system, most economic decisions are made by private individuals and businesses, not just the government.", "isCorrect": false } ] },
                            { "questionNumber": 2, "type": "knowledge", "question": "In a pure market economy (capitalism), who makes the decisions about what to produce, how to produce it, and for whom to produce?", "answerOptions": [ { "text": "The government", "rationale": "This is characteristic of a command economy.", "isCorrect": false }, { "text": "Private individuals and firms", "rationale": "Correct. In a market system, these decisions are driven by the interactions of supply and demand between private producers and consumers.", "isCorrect": true }, { "text": "A council of economic experts", "rationale": "This would be a form of central planning, not a market economy.", "isCorrect": false }, { "text": "Foreign investors", "rationale": "While foreign investment can be important, it does not drive the fundamental economic decisions in a market system.", "isCorrect": false } ] },
                            { "questionNumber": 3, "type": "knowledge", "question": "Which of the following is the best example of a public good that the government provides in the U.S. economy?", "answerOptions": [ { "text": "Automobiles", "rationale": "Automobiles are private goods produced by private companies.", "isCorrect": false }, { "text": "National defense", "rationale": "Correct. National defense is a classic example of a public good; it is non-excludable (everyone is protected) and non-rivalrous (one person's protection doesn't reduce another's).", "isCorrect": true }, { "text": "Groceries", "rationale": "Groceries are private goods sold in private markets.", "isCorrect": false }, { "text": "Smartphones", "rationale": "Smartphones are private goods produced by private companies.", "isCorrect": false } ] },
                            { "questionNumber": 4, "type": "text", "passage": "The government plays a role in the U.S. economy by enforcing regulations to protect consumers, workers, and the environment. For example, the Food and Drug Administration (FDA) ensures that foods and medicines are safe. The Occupational Safety and Health Administration (OSHA) sets standards for workplace safety.", "question": "What is the primary purpose of government agencies like the FDA and OSHA?", "answerOptions": [ { "text": "To maximize the profits of businesses.", "rationale": "These agencies often impose costs on businesses in the interest of public safety, which may reduce profits.", "isCorrect": false }, { "text": "To provide public goods and services.", "rationale": "Their primary role is regulation, not direct provision of goods.", "isCorrect": false }, { "text": "To regulate businesses to protect public health and safety.", "rationale": "Correct. The passage clearly states that these agencies protect consumers (FDA) and workers (OSHA) by setting and enforcing safety standards.", "isCorrect": true }, { "text": "To control the prices of all goods and services.", "rationale": "The U.S. government does not control the prices of most goods.", "isCorrect": false } ] },
                            { "questionNumber": 5, "type": "knowledge", "question": "The total value of all final goods and services produced within a country's borders in a specific time period is known as:", "answerOptions": [ { "text": "The national debt", "rationale": "The national debt is the total amount of money the government owes.", "isCorrect": false }, { "text": "The inflation rate", "rationale": "Inflation is the rate at which the general level of prices is rising.", "isCorrect": false }, { "text": "Gross Domestic Product (GDP)", "rationale": "Correct. GDP is the primary measure of a country's economic output and health.", "isCorrect": true }, { "text": "The unemployment rate", "rationale": "The unemployment rate measures the percentage of the labor force that is jobless.", "isCorrect": false } ] },
                            { "questionNumber": 6, "type": "text", "passage": "Fiscal policy refers to the use of government spending and taxation to influence the economy. It is conducted by Congress and the President. To combat a recession, the government might use expansionary fiscal policy, which involves increasing government spending or decreasing taxes to boost economic activity.", "question": "Which of the following is an example of expansionary fiscal policy?", "answerOptions": [ { "text": "The central bank increasing interest rates.", "rationale": "This is an example of monetary policy, not fiscal policy.", "isCorrect": false }, { "text": "The government increasing taxes on corporations.", "rationale": "Increasing taxes is an example of contractionary fiscal policy, designed to slow down the economy.", "isCorrect": false }, { "text": "The government funding a large-scale project to build new highways and bridges.", "rationale": "Correct. This is an example of increasing government spending to create jobs and stimulate economic growth, which is a hallmark of expansionary fiscal policy.", "isCorrect": true }, { "text": "The government reducing its spending on social programs.", "rationale": "Reducing government spending is an example of contractionary fiscal policy.", "isCorrect": false } ] },
                            { "questionNumber": 7, "type": "knowledge", "question": "Monetary policy involves managing the nation's money supply and credit conditions to influence the economy. In the United States, which institution is responsible for conducting monetary policy?", "answerOptions": [ { "text": "The U.S. Congress", "rationale": "Congress conducts fiscal policy.", "isCorrect": false }, { "text": "The President", "rationale": "The President, along with Congress, conducts fiscal policy.", "isCorrect": false }, { "text": "The U.S. Treasury", "rationale": "The Treasury manages the government's finances but does not conduct monetary policy.", "isCorrect": false }, { "text": "The Federal Reserve (the Fed)", "rationale": "Correct. The Federal Reserve is the central bank of the United States and is responsible for setting interest rates and managing the money supply.", "isCorrect": true } ] },
                            { "questionNumber": 8, "type": "text", "passage": "To combat inflation (a rapid rise in prices), the Federal Reserve might use contractionary monetary policy. This typically involves raising interest rates. Higher interest rates make it more expensive for consumers and businesses to borrow money, which slows down spending and helps to reduce inflationary pressure.", "question": "According to the passage, why would the Federal Reserve raise interest rates?", "answerOptions": [ { "text": "To encourage more borrowing and spending.", "rationale": "Raising interest rates discourages borrowing and spending.", "isCorrect": false }, { "text": "To fight high inflation.", "rationale": "Correct. The passage states that raising interest rates is a tool of contractionary monetary policy used to combat inflation.", "isCorrect": true }, { "text": "To stimulate the economy during a recession.", "rationale": "To stimulate the economy, the Fed would lower interest rates.", "isCorrect": false }, { "text": "To increase the national debt.", "rationale": "The Fed's actions are not intended to increase the national debt.", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "knowledge", "question": "The business cycle describes the recurring phases of expansion and contraction in an economy. What is a period of significant economic decline, characterized by falling GDP and rising unemployment, called?", "answerOptions": [ { "text": "A peak", "rationale": "A peak is the highest point of an economic expansion.", "isCorrect": false }, { "text": "An expansion", "rationale": "An expansion is a period of economic growth.", "isCorrect": false }, { "text": "A recession", "rationale": "Correct. A recession is a period of economic downturn, often officially defined as two consecutive quarters of negative GDP growth.", "isCorrect": true }, { "text": "A trough", "rationale": "A trough is the lowest point of a recession before recovery begins.", "isCorrect": false } ] },
                            { "questionNumber": 10, "type": "knowledge", "question": "Inflation is the rate at which the general level of prices for goods and services is rising, and subsequently, purchasing power is falling. Who is most likely to be hurt by unexpected inflation?", "answerOptions": [ { "text": "People who have borrowed money at a fixed interest rate.", "rationale": "These people benefit, as they repay their loans with money that is worth less than when they borrowed it.", "isCorrect": false }, { "text": "People on a fixed income, such as retirees.", "rationale": "Correct. If prices are rising but your income is not, your purchasing power (the amount of goods you can buy) decreases significantly.", "isCorrect": true }, { "text": "The government, which has a large national debt.", "rationale": "Like other borrowers, the government benefits from repaying its debt with less valuable money.", "isCorrect": false }, { "text": "People who own assets that increase in value with inflation, like real estate.", "rationale": "These people are often protected from or may even benefit from inflation.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "knowledge", "question": "What is the primary difference between fiscal policy and monetary policy?", "answerOptions": [ { "text": "Fiscal policy is used during recessions, while monetary policy is used during expansions.", "rationale": "Both types of policy can be used during any phase of the business cycle.", "isCorrect": false }, { "text": "Fiscal policy deals with government spending and taxes, while monetary policy deals with the money supply and interest rates.", "rationale": "Correct. This is the fundamental distinction: fiscal policy is handled by the government (Congress/President), while monetary policy is handled by the central bank (the Fed).", "isCorrect": true }, { "text": "Fiscal policy affects the national economy, while monetary policy only affects state economies.", "rationale": "Both policies affect the national economy.", "isCorrect": false }, { "text": "Fiscal policy is set by the President, while monetary policy is set by the Supreme Court.", "rationale": "Fiscal policy is set by Congress and the President; monetary policy is set by the Federal Reserve.", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "image", "imageUrl": "Images/Questions-are-based-on-the-following-graph.-6 (1).png", "question": "This chart shows the unemployment rate in the U.S. over time. A sharp spike in the unemployment rate, like the ones seen around 2009 and 2020, is typically associated with which phase of the business cycle?", "answerOptions": [ { "text": "Expansion", "rationale": "During an expansion, unemployment typically falls.", "isCorrect": false }, { "text": "Recession", "rationale": "Correct. Recessions are periods of economic decline where businesses lay off workers, causing a sharp increase in the unemployment rate.", "isCorrect": true }, { "text": "Peak", "rationale": "A peak is the point just before a recession begins, where unemployment is usually at its lowest.", "isCorrect": false }, { "text": "Trough", "rationale": "A trough is the bottom of a recession, where unemployment is at its highest, just before it starts to fall again.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "knowledge", "question": "A progressive tax is a tax system in which the tax rate increases as the taxable amount increases. Which of the following is the best example of a progressive tax in the United States?", "answerOptions": [ { "text": "Sales tax", "rationale": "Sales tax is a regressive tax, as it takes a larger percentage of income from low-income earners.", "isCorrect": false }, { "text": "Federal income tax", "rationale": "Correct. The U.S. federal income tax system is progressive, with higher income brackets being taxed at a higher percentage rate.", "isCorrect": true }, { "text": "Property tax", "rationale": "Property tax is generally considered a proportional or slightly regressive tax.", "isCorrect": false }, { "text": "Gasoline tax", "rationale": "This is a regressive tax, as it is a flat amount per gallon and thus represents a larger share of a lower-income person's budget.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "text", "passage": "Globalization refers to the increasing interconnectedness of economies around the world. This includes the growth of international trade, investment, and the flow of information and technology across borders. While it can lead to economic growth and lower prices for consumers, it can also lead to job losses in domestic industries that cannot compete with foreign producers.", "question": "According to the passage, what is a potential negative consequence of globalization?", "answerOptions": [ { "text": "Higher prices for consumers.", "rationale": "The passage states that globalization can lead to lower prices.", "isCorrect": false }, { "text": "A decrease in international trade.", "rationale": "Globalization is characterized by an increase in international trade.", "isCorrect": false }, { "text": "Job losses in domestic industries.", "rationale": "Correct. The passage identifies job losses in industries that face competition from foreign producers as a potential negative outcome.", "isCorrect": true }, { "text": "A slowdown in the spread of new technology.", "rationale": "The passage states that globalization involves the increased flow of technology across borders.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "knowledge", "question": "If the U.S. government's spending in a given year is greater than its revenue from taxes, the result is a:", "answerOptions": [ { "text": "Budget surplus", "rationale": "A surplus occurs when revenue is greater than spending.", "isCorrect": false }, { "text": "Balanced budget", "rationale": "A balanced budget occurs when revenue equals spending.", "isCorrect": false }, { "text": "Budget deficit", "rationale": "Correct. A budget deficit is the shortfall that occurs when government spending exceeds revenue in a single year. The national debt is the accumulation of all past deficits.", "isCorrect": true }, { "text": "Trade deficit", "rationale": "A trade deficit relates to the balance of imports and exports, not government spending and revenue.", "isCorrect": false } ] }
                        ]
                    }
                ]
            },
            "Geography and the World": {
                description: "Develop skills in interpreting maps, charts, and data.",
                topics: [
                    {
                        id: "ss_geo_map_skills",
                        title: "Map & Data Skills",
                        description: "Reading Maps, Charts, and Graphs (Mean, Median, Mode).",
                        questions: [
                            { "questionNumber": 1, "type": "chart", "passage": `<div class="passage-text"><b>Monthly Rainfall in Springfield (Inches)</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Month</th><th class="p-2 border-b">Rainfall</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Jan</td><td class="p-2">3</td></tr><tr class="border-b"><td class="p-2">Feb</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Mar</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">Apr</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">May</td><td class="p-2">5</td></tr></tbody></table></div>`, "question": "What is the mean (average) monthly rainfall for the period shown in the chart?", "answerOptions": [ { "text": "3.6 inches", "rationale": "Correct. To find the mean, add the values (3 + 2 + 4 + 4 + 5 = 18) and divide by the number of values (5). 18 / 5 = 3.6.", "isCorrect": true }, { "text": "4 inches", "rationale": "4 is the mode (most frequent value) and the median, but not the mean.", "isCorrect": false }, { "text": "5 inches", "rationale": "5 is the maximum rainfall in a single month.", "isCorrect": false }, { "text": "18 inches", "rationale": "18 is the total rainfall, not the average.", "isCorrect": false } ] },
                            { "questionNumber": 2, "type": "chart", "passage": `<div class="passage-text"><b>Monthly Rainfall in Springfield (Inches)</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Month</th><th class="p-2 border-b">Rainfall</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Jan</td><td class="p-2">3</td></tr><tr class="border-b"><td class="p-2">Feb</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Mar</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">Apr</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">May</td><td class="p-2">5</td></tr></tbody></table></div>`, "question": "What is the median rainfall for the period shown in the chart?", "answerOptions": [ { "text": "2 inches", "rationale": "2 is the minimum value.", "isCorrect": false }, { "text": "3.6 inches", "rationale": "This is the mean, not the median.", "isCorrect": false }, { "text": "4 inches", "rationale": "Correct. To find the median, first order the numbers: 2, 3, 4, 4, 5. The median is the middle value, which is 4.", "isCorrect": true }, { "text": "5 inches", "rationale": "5 is the maximum value.", "isCorrect": false } ] },
                            { "questionNumber": 3, "type": "chart", "passage": `<div class="passage-text"><b>Monthly Rainfall in Springfield (Inches)</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Month</th><th class="p-2 border-b">Rainfall</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Jan</td><td class="p-2">3</td></tr><tr class="border-b"><td class="p-2">Feb</td><td class="p-2">2</td></tr><tr class="border-b"><td class="p-2">Mar</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">Apr</td><td class="p-2">4</td></tr><tr class="border-b"><td class="p-2">May</td><td class="p-2">5</td></tr></tbody></table></div>`, "question": "What is the mode of the rainfall data shown in the chart?", "answerOptions": [ { "text": "3 inches", "rationale": "3 appears only once.", "isCorrect": false }, { "text": "3.6 inches", "rationale": "This is the mean.", "isCorrect": false }, { "text": "4 inches", "rationale": "Correct. The mode is the value that appears most frequently in a data set. The number 4 appears twice, more than any other value.", "isCorrect": true }, { "text": "5 inches", "rationale": "5 appears only once.", "isCorrect": false } ] },
                            { "questionNumber": 4, "type": "image", "imageUrl": "Images/political-map-of-world.jpg", "question": "This world map shows Gross Domestic Product (GDP) per capita, with darker colors representing higher GDP per capita. According to the map, which of these regions generally has the highest GDP per capita?", "answerOptions": [ { "text": "Central Africa", "rationale": "Central Africa is shown in the lightest shades, indicating lower GDP per capita.", "isCorrect": false }, { "text": "South America", "rationale": "South America is shown in light to medium shades.", "isCorrect": false }, { "text": "North America and Western Europe", "rationale": "Correct. The United States, Canada, and countries in Western Europe are shown in the darkest shades, indicating the highest GDP per capita.", "isCorrect": true }, { "text": "Southeast Asia", "rationale": "Southeast Asia is shown in lighter shades.", "isCorrect": false } ] },
                            { "questionNumber": 5, "type": "image", "imageUrl": "Images/political-map-of-world.jpg", "question": "Based on the map's key, which shows that darker colors represent higher GDP per capita, what can be inferred about the economic status of Australia?", "answerOptions": [ { "text": "It has one of the lowest GDPs per capita in the world.", "rationale": "Australia is shown in one of the darkest shades.", "isCorrect": false }, { "text": "It has a GDP per capita comparable to that of Western Europe and North America.", "rationale": "Correct. Australia is shaded with the same dark color as the United States, Canada, and Western European countries, indicating a similar high level of GDP per capita.", "isCorrect": true }, { "text": "It has a GDP per capita similar to that of most countries in Africa.", "rationale": "Most countries in Africa are shown in the lightest shades, indicating much lower GDP per capita.", "isCorrect": false }, { "text": "The map does not provide enough information to determine Australia's economic status.", "rationale": "The map clearly shows Australia and provides a key for interpretation.", "isCorrect": false } ] },
                            { "questionNumber": 6, "type": "chart", "passage": `<div class="passage-text"><b>Favorite Pizza Toppings of 100 Students</b><br><img src="Images/social studies bar graph.png" alt="A bar chart showing pizza topping preferences. Pepperoni is at 45, Mushrooms at 20, Onions at 15, Sausage at 12, and Olives at 8." class="bg-white p-2 rounded"></div>`, "question": "According to the bar chart, which two toppings are the most popular?", "answerOptions": [ { "text": "Onions and Olives", "rationale": "These are two of the least popular toppings.", "isCorrect": false }, { "text": "Pepperoni and Mushrooms", "rationale": "Correct. Pepperoni is the most popular with 45 votes, and Mushrooms are the second most popular with 20 votes.", "isCorrect": true }, { "text": "Sausage and Olives", "rationale": "These are the two least popular toppings.", "isCorrect": false }, { "text": "Pepperoni and Sausage", "rationale": "While Pepperoni is the most popular, Sausage is the fourth most popular.", "isCorrect": false } ] },
                            { "questionNumber": 7, "type": "chart", "passage": `<div class="passage-text"><b>Favorite Pizza Toppings of 100 Students</b><br><img src="Images/social studies bar graph.png" alt="A bar chart showing pizza topping preferences. Pepperoni is at 45, Mushrooms at 20, Onions at 15, Sausage at 12, and Olives at 8." class="bg-white p-2 rounded"></div>`, "question": "How many more students chose Pepperoni than chose Sausage?", "answerOptions": [ { "text": "25", "rationale": "This is the difference between Pepperoni (45) and Mushrooms (20).", "isCorrect": false }, { "text": "30", "rationale": "This is the difference between Pepperoni (45) and Onions (15).", "isCorrect": false }, { "text": "33", "rationale": "Correct. Pepperoni received 45 votes and Sausage received 12 votes. 45 - 12 = 33.", "isCorrect": true }, { "text": "37", "rationale": "This is the difference between Pepperoni (45) and Olives (8).", "isCorrect": false } ] },
                            { "questionNumber": 8, "type": "chart", "passage": `<div class="passage-text"><b>Company Profits (in millions)</b><br><img src="Images/World energy consuption line graph.png" alt="A line graph showing profits over time. 2016: $1.5M, 2017: $1.8M, 2018: $1.7M, 2019: $2.1M, 2020: $2.5M" class="bg-white p-2 rounded"></div>`, "question": "According to the line graph, in which year did the company's profits decrease compared to the previous year?", "answerOptions": [ { "text": "2017", "rationale": "In 2017, profits increased from $1.5M to $1.8M.", "isCorrect": false }, { "text": "2018", "rationale": "Correct. In 2018, profits fell to $1.7M from $1.8M in 2017.", "isCorrect": true }, { "text": "2019", "rationale": "In 2019, profits increased from $1.7M to $2.1M.", "isCorrect": false }, { "text": "2020", "rationale": "In 2020, profits increased from $2.1M to $2.5M.", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "chart", "passage": `<div class="passage-text"><b>Company Profits (in millions)</b><br><img src="Images/World energy consuption line graph.png" alt="A line graph showing profits over time. 2016: $1.5M, 2017: $1.8M, 2018: $1.7M, 2019: $2.1M, 2020: $2.5M" class="bg-white p-2 rounded"></div>`, "question": "What was the approximate total profit for the company over the 5-year period shown?", "answerOptions": [ { "text": "$2.5 million", "rationale": "This was the profit for 2020 alone.", "isCorrect": false }, { "text": "$5.3 million", "rationale": "This is an incorrect sum.", "isCorrect": false }, { "text": "$9.6 million", "rationale": "Correct. Adding the approximate profits for each year: 1.5 + 1.8 + 1.7 + 2.1 + 2.5 = 9.6.", "isCorrect": true }, { "text": "$1.92 million", "rationale": "This is the mean (average) profit, not the total.", "isCorrect": false } ] },
                            { "questionNumber": 10, "type": "image", "imageUrl": "Images/licensed-image (16).jpg", "question": "This is a political map of South America. Which country is located on the west coast of the continent, bordering Peru, Bolivia, and Argentina?", "answerOptions": [ { "text": "Brazil", "rationale": "Brazil is the largest country, located on the east coast.", "isCorrect": false }, { "text": "Colombia", "rationale": "Colombia is in the northwest, bordering Peru but not Bolivia or Argentina.", "isCorrect": false }, { "text": "Chile", "rationale": "Correct. The map shows Chile as a long, narrow country on the west coast, with borders matching the description.", "isCorrect": true }, { "text": "Venezuela", "rationale": "Venezuela is on the northern coast of the continent.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "image", "imageUrl": "Images/licensed-image (16).jpg", "question": "Using the map's scale of miles, the approximate distance from the capital of Colombia (Bogotá) to the capital of Venezuela (Caracas) is:", "answerOptions": [ { "text": "About 100 miles", "rationale": "This distance is significantly underestimated.", "isCorrect": false }, { "text": "About 600 miles", "rationale": "Correct. By visually applying the map scale, the distance between the two capitals is approximately 600 miles.", "isCorrect": true }, { "text": "About 1,500 miles", "rationale": "This distance is significantly overestimated.", "isCorrect": false }, { "text": "About 2,000 miles", "rationale": "This is a vast overestimation.", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "chart", "passage": `<div class="passage-text"><b>Test Scores for a Class of 7 Students</b><br>The test scores are: 72, 85, 88, 90, 91, 91, 99</div>`, "question": "What is the mode of the test scores?", "answerOptions": [ { "text": "88", "rationale": "This is the median score.", "isCorrect": false }, { "text": "88._14", "rationale": "This is the mean (average) score.", "isCorrect": false }, { "text": "91", "rationale": "Correct. The mode is the value that appears most often. The score 91 appears twice, while all other scores appear only once.", "isCorrect": true }, { "text": "27", "rationale": "This is the range (99 - 72), not the mode.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "chart", "passage": `<div class="passage-text"><b>Test Scores for a Class of 7 Students</b><br>The test scores are: 72, 85, 88, 90, 91, 91, 99</div>`, "question": "What is the median of the test scores?", "answerOptions": [ { "text": "90", "rationale": "90 is one of the scores, but not the middle one.", "isCorrect": false }, { "text": "91", "rationale": "91 is the mode, not the median.", "isCorrect": false }, { "text": "88", "rationale": "Correct. The scores are already in order. The median is the middle value in a data set. In this set of 7 scores, the 4th score is the middle one.", "isCorrect": true }, { "text": "88.14", "rationale": "This is the mean (average) score.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "chart", "passage": `<div class="passage-text"><b>Test Scores for a Class of 7 Students</b><br>The test scores are: 72, 85, 88, 90, 91, 91, 99</div>`, "question": "What is the range of the test scores?", "answerOptions": [ { "text": "99", "rationale": "99 is the highest score, not the range.", "isCorrect": false }, { "text": "72", "rationale": "72 is the lowest score, not the range.", "isCorrect": false }, { "text": "27", "rationale": "Correct. The range is the difference between the highest value and the lowest value in a data set (99 - 72 = 27).", "isCorrect": true }, { "text": "16", "rationale": "This is the difference between the median and the lowest score.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "chart", "passage": `<div class="passage-text"><b>Household Budget (Total: $3,000/month)</b><br><img src="Images/035fa172-2083-4c13-9485-a5f4bfa28340.png" alt="A pie chart showing a budget. Housing: 35%, Transportation: 15%, Food: 20%, Savings: 10%, Utilities: 5%, Other: 15%" class="bg-white p-2 rounded"></div>`, "question": "According to the pie chart, how much money is allocated to Housing each month?", "answerOptions": [ { "text": "$700", "rationale": "This would be approximately 23%.", "isCorrect": false }, { "text": "$1,050", "rationale": "Correct. Housing accounts for 35% of the budget. 35% of $3,000 is (0.35 * 3000), which equals $1,050.", "isCorrect": true }, { "text": "$600", "rationale": "This is 20% of the budget, the amount for Food.", "isCorrect": false }, { "text": "$300", "rationale": "This is 10% of the budget, the amount for Savings.", "isCorrect": false } ] }
                        ]
                    }
                ]
            }
        }
    },
    "Reasoning Through Language Arts (RLA)": {
        icon: "BookOpenIcon",
        categories: {
            "Reading Comprehension: Informational Texts": {
                description: "Practice analyzing non-fiction texts to find main ideas, evaluate arguments, and interpret graphics.",
                topics: [
                    {
                        id: "rla_info_main_idea",
                        title: "Main Idea & Details",
                        description: "Finding the central idea and supporting evidence in non-fiction.",
                        quizzes: [
                            { id: "rla_info_main_idea_set1", label: "Set 1", questionSourceTopicId: "rla_info_main_idea" },
                            { id: "rla_informational_texts_informational_texts_quiz2", "label": "Set 2" },
                            { id: "rla_informational_texts_informational_texts_quiz3", "label": "Set 3" }
                        ],
                        article: {
                            title: "Community Makerspaces: Shared Workshops for a New Economy",
                            genre: "Informational Article",
                            text: [
                                "Across the country, community makerspaces have become a practical response to the skills gap created by rapid automation. These shared workshops combine digital design labs with traditional tools, giving residents a place to experiment with laser cutters, 3D printers, and sewing machines without having to invest in costly equipment. Coordinators describe the spaces as a bridge between the curiosity people feel when they see new technology online and the confidence they need to use it on the job.",
                                "Unlike a traditional classroom, a makerspace operates on an open lab model. Members can attend scheduled trainings, but they are also free to work alongside mentors, retirees, and nascent entrepreneurs who are already building prototypes. The mix of self-directed tinkering and guided instruction means that a participant might learn how to repair a bicycle in the same evening that someone else debuts a design for a medical device attachment.",
                                "The economic ripple effects are becoming measurable. A 2023 survey of six regional makerspaces found that 62% of regular members completed a prototype that later informed a promotion, contract, or small business launch. Local workforce boards cite the statistic frequently when pitching employers on tuition sponsorships, arguing that the spaces accelerate reskilling far faster than a standard semester-long course.",
                                "Critics contend that membership fees or specialized equipment still keep marginalized residents on the sidelines. In response, most makerspaces have created sliding-scale pricing, partnered with public libraries to cover evening access, and offered weekend open houses specifically for shift workers and families. One robotics instructor noted that these changes have doubled the number of teenage participants in less than a year.",
                                "As municipalities prepare their next decade of economic development plans, makerspaces are increasingly listed alongside broadband and transit projects. City planners argue that reserving funding for tool libraries, instructor stipends, and small-business incubators will ensure that the spaces remain community assets rather than short-lived trends."
                            ]
                        },
                        questions: [
                            {
                                questionNumber: 1,
                                question: "Which statement best expresses the central idea of the article?",
                                answerOptions: [
                                    { text: "Community makerspaces are a temporary fad with little long-term impact.", rationale: "The article presents makerspaces as lasting investments, not fleeting trends.", isCorrect: false },
                                    { text: "Community makerspaces help residents gain affordable access to modern tools and skills that support career growth.", rationale: "Correct. Every paragraph explains how makerspaces expand access, deliver training, and create economic opportunities.", isCorrect: true },
                                    { text: "Traditional classrooms are no longer useful for any type of technical training.", rationale: "The author contrasts makerspaces with classrooms but never dismisses classrooms entirely.", isCorrect: false },
                                    { text: "Municipal budgets should focus exclusively on transit projects instead of technology hubs.", rationale: "Transit is mentioned only as something planners consider alongside makerspaces, not instead of them.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 2,
                                question: "Which detail best supports the claim that makerspaces widen access to technology?",
                                answerOptions: [
                                    { text: "Members can work alongside retirees and entrepreneurs in the open lab.", rationale: "This shows the collaborative setting but not specifically increased access for residents who could not otherwise use technology.", isCorrect: false },
                                    { text: "A 2023 survey reported that 62% of members completed a prototype that advanced their careers.", rationale: "This statistic focuses on economic outcomes rather than access to technology.", isCorrect: false },
                                    { text: "Most makerspaces partner with public libraries to cover evening access and offer sliding-scale pricing.", rationale: "Correct. These strategies directly address the barriers that critics say prevent people from using the technology.", isCorrect: true },
                                    { text: "City planners include makerspaces in long-term development plans.", rationale: "This highlights future investment, not the immediate issue of access.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 3,
                                question: "According to the third paragraph, what outcome do workforce boards emphasize when promoting makerspaces to employers?",
                                answerOptions: [
                                    { text: "The number of weekend open houses held each quarter.", rationale: "Weekend events are mentioned later as a response to critics, not as the main statistic shared with employers.", isCorrect: false },
                                    { text: "The percentage of members who completed prototypes that led to promotions or business launches.", rationale: "Correct. Workforce boards cite the 62% success rate to convince employers to fund memberships.", isCorrect: true },
                                    { text: "The amount of grant money city planners allocate for transit projects.", rationale: "Transit funding appears only in the final paragraph, unrelated to employer pitches.", isCorrect: false },
                                    { text: "The increase in teenage participation during the first year of operation.", rationale: "Teen participation is discussed in paragraph four, not in the context of employer outreach.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 4,
                                question: "As it is used in paragraph two, the word 'nascent' most nearly means:",
                                answerOptions: [
                                    { text: "inexperienced or just beginning.", rationale: "Correct. 'Nascent entrepreneurs' are individuals who are just starting to build their businesses.", isCorrect: true },
                                    { text: "highly profitable.", rationale: "Nothing in the paragraph suggests that the entrepreneurs are already profitable.", isCorrect: false },
                                    { text: "reluctant to collaborate.", rationale: "The paragraph emphasizes collaboration, not reluctance.", isCorrect: false },
                                    { text: "fully certified.", rationale: "Certification is not mentioned in the description of the entrepreneurs.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 5,
                                question: "Which sentence best captures the author's tone toward makerspaces?",
                                answerOptions: [
                                    { text: "They are worthwhile investments that require thoughtful planning to remain accessible.", rationale: "Correct. The author acknowledges challenges but ultimately views makerspaces as beneficial when supported.", isCorrect: true },
                                    { text: "They are risky experiments that should be paused until more research exists.", rationale: "The author never recommends halting makerspace programs.", isCorrect: false },
                                    { text: "They benefit hobbyists but offer little value to local economies.", rationale: "The article repeatedly references economic gains and workforce development.", isCorrect: false },
                                    { text: "They should replace all existing workforce programs immediately.", rationale: "The author presents makerspaces as complementary, not as replacements for every program.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 6,
                                question: "Why does the author include the robotics instructor's observation in paragraph four?",
                                answerOptions: [
                                    { text: "To prove that weekend open houses are unnecessary.", rationale: "The instructor notes that the outreach doubled teenage participation, showing the events are effective, not unnecessary.", isCorrect: false },
                                    { text: "To illustrate the concrete results of the accessibility changes makerspaces implemented.", rationale: "Correct. The quote demonstrates how policy changes led to measurable growth among teens.", isCorrect: true },
                                    { text: "To argue that only teenagers benefit from makerspaces.", rationale: "Teens are one example; other groups are discussed throughout the article.", isCorrect: false },
                                    { text: "To criticize public libraries for charging fees.", rationale: "Libraries are described as partners that expand access, not as obstacles.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 7,
                                question: "Which concern do critics raise about makerspaces?",
                                answerOptions: [
                                    { text: "They lack the advanced tools needed to build prototypes.", rationale: "The article states the opposite: makerspaces offer access to expensive equipment.", isCorrect: false },
                                    { text: "Membership costs and specialized tools may still exclude marginalized residents.", rationale: "Correct. Paragraph four summarizes this criticism before explaining how spaces responded.", isCorrect: true },
                                    { text: "They rely entirely on volunteer instructors with no professional experience.", rationale: "Mentors are mentioned, but there is no criticism about expertise.", isCorrect: false },
                                    { text: "They focus on art projects instead of job training.", rationale: "The article emphasizes workforce and entrepreneurship benefits, not a lack of job focus.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 8,
                                question: "Based on the article, which group are weekend open houses designed to serve?",
                                answerOptions: [
                                    { text: "Shift workers and families who cannot attend evening classes.", rationale: "Correct. The article explicitly says weekend events are meant to include these groups.", isCorrect: true },
                                    { text: "Retirees looking for advanced certification programs.", rationale: "Retirees are mentioned as mentors, not as the target audience for weekend programming.", isCorrect: false },
                                    { text: "Out-of-state entrepreneurs scouting locations.", rationale: "No evidence suggests the events are aimed at visiting entrepreneurs.", isCorrect: false },
                                    { text: "City planners drafting transit budgets.", rationale: "Transit planning appears later and is unrelated to open houses.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 9,
                                question: "What inference can be made from the final paragraph about the future of makerspaces?",
                                answerOptions: [
                                    { text: "They will likely disappear once the current funding cycle ends.", rationale: "City planners are integrating makerspaces into long-term plans, suggesting continuity rather than disappearance.", isCorrect: false },
                                    { text: "Their success depends on being viewed as part of broader infrastructure investments.", rationale: "Correct. The paragraph notes that planners place makerspaces alongside broadband and transit to secure sustained funding.", isCorrect: true },
                                    { text: "They will replace the need for broadband or transportation improvements.", rationale: "The author says makerspaces are listed alongside these projects, not as replacements.", isCorrect: false },
                                    { text: "They will no longer require instructor stipends to operate effectively.", rationale: "The paragraph explicitly recommends funding instructor stipends to keep spaces viable.", isCorrect: false }
                                ]
                            },
                            {
                                questionNumber: 10,
                                question: "Which sentence from the article best supports the idea that makerspaces boost the local economy?",
                                answerOptions: [
                                    { text: "Coordinators describe the spaces as a bridge between curiosity and confidence.", rationale: "This sentence speaks to motivation, not economic impact.", isCorrect: false },
                                    { text: "Members can attend scheduled trainings but are also free to work alongside mentors.", rationale: "This detail explains the format of the makerspace, not its economic effect.", isCorrect: false },
                                    { text: "A 2023 survey of six regional makerspaces found that 62% of regular members completed a prototype that later informed a promotion, contract, or small business launch.", rationale: "Correct. The statistic directly links makerspace participation to promotions and new businesses.", isCorrect: true },
                                    { text: "One robotics instructor noted that outreach changes doubled teenage participation in less than a year.", rationale: "This sentence describes access for teens, not economic growth.", isCorrect: false }
                                ]
                            }
                        ],
                        type: "reading",
                    },
                    {
                        id: "rla_info_structure_purpose",
                        title: "Structure & Purpose",
                        description: "Analyzing text structure and an author's reason for writing.",
                        quizzes: [
                           { id: "rla_informational_texts_structure_purpose_quiz1", "label": "Set 1" },
                           { id: "rla_informational_texts_structure_purpose_quiz2", "label": "Set 2" },
                           { id: "rla_informational_texts_structure_purpose_quiz3", "label": "Set 3" }
                        ],
                        type: "reading",
                        article: {
                            title: "The Rise of Renewable Energy: Powering a Sustainable Future",
                            genre: "Informational Text (Expository Essay)",
                            text: [
                                "For over a century, human civilization has been powered predominantly by fossil fuels—coal, oil, and natural gas. While these energy sources fueled industrial revolutions and unprecedented economic growth, their use has come at a significant environmental cost, most notably climate change driven by greenhouse gas emissions. In response to this mounting crisis, a global energy transition is underway, shifting focus toward renewable sources. These sources, which include solar, wind, hydropower, and geothermal energy, are naturally replenished and produce minimal to no carbon emissions. This transition is not merely an environmental imperative but also a technological and economic evolution, promising a more sustainable and resilient energy future.",
                                "At the forefront of this revolution is solar power, which harnesses the immense energy of the sun. The most common method involves photovoltaic (PV) cells, which directly convert sunlight into electricity. Another approach, concentrated solar power (CSP), uses mirrors to focus sunlight to heat a fluid, which then creates steam to power a turbine. The primary advantages of solar energy are its abundance and its clean nature. However, its main drawback is intermittency—it only generates power when the sun is shining. This necessitates the development of large-scale energy storage solutions, such as advanced batteries, to provide reliable power around the clock. Furthermore, large solar farms require significant land area, which can raise concerns about land use and ecosystem impact.",
                                "Wind power offers another powerful alternative. Giant turbines, often grouped together in wind farms on land or offshore, capture kinetic energy from the wind and convert it into electricity. Like solar power, wind is a clean energy source, but it shares the same challenge of intermittency, as it is dependent on weather patterns. The visual impact of turbines on landscapes and potential harm to avian wildlife, such as birds and bats, are also significant concerns that require careful planning and mitigation.",
                                "Hydropower and geothermal energy provide more consistent, or baseload, power. Hydropower, generated by the force of flowing water turning turbines in dams, is one of the oldest and most established forms of renewable energy. It is highly reliable and can be dispatched on demand. The main limitation is its environmental impact; large dams can alter river ecosystems, disrupt fish migration, and displace communities. Geothermal energy taps into the Earth's internal heat, using steam from underground reservoirs to generate electricity. It is a highly reliable and clean source of energy with a small physical footprint. Its primary constraint is geographical, as it is only economically viable in regions with accessible geothermal activity, such as volcanic zones or areas with tectonic plate boundaries.",
                                "The complete transition to a renewable energy system presents formidable but surmountable challenges. Beyond the intermittency of solar and wind, modernizing the electrical grid to handle decentralized energy sources is a major hurdle. Smart grids, which use digital technology to manage electricity distribution more efficiently, are essential. Advances in battery technology are critical for storing excess energy for when the sun isn't shining or the wind isn't blowing. Furthermore, supportive government policies, such as carbon pricing and tax incentives for renewable installations, play a crucial role in accelerating this transition. While the path is complex, the collective push toward a renewable-powered world represents a fundamental rethinking of our relationship with energy, aiming for a future that is not only prosperous but also environmentally sustainable for generations to come."
                            ]
                        },
                        questions: [
                            { "question": "Which of the following statements best expresses the main idea of the passage?", "answerOptions": [ { "text": "Hydropower is the most reliable and established form of renewable energy available today.", "isCorrect": false }, { "text": "The global shift to renewable energy is a multifaceted response to the environmental impact of fossil fuels, driven by technology and policy.", "isCorrect": true }, { "text": "The primary challenge of renewable energy is overcoming the high cost of solar panels and wind turbines.", "isCorrect": false }, { "text": "Fossil fuels, despite their environmental drawbacks, remain the only viable option for large-scale energy production.", "isCorrect": false } ] },
                            { "question": "In paragraphs 2 and 3, the word 'intermittency' is used to describe a key challenge for solar and wind power. This term most nearly means:", "answerOptions": [ { "text": "The high cost of installation.", "isCorrect": false }, { "text": "The state of being inconsistent or not continuous.", "isCorrect": true }, { "text": "The potential harm to local wildlife.", "isCorrect": false }, { "text": "The requirement for large areas of land.", "isCorrect": false } ] },
                            { "question": "According to the passage, what is the primary environmental motivation for transitioning to renewable energy?", "answerOptions": [ { "text": "To reduce the visual impact of power plants on landscapes.", "isCorrect": false }, { "text": "To mitigate climate change caused by greenhouse gas emissions from fossil fuels.", "isCorrect": true }, { "text": "To prevent the disruption of fish migration caused by large dams.", "isCorrect": false }, { "text": "To decrease reliance on foreign energy sources.", "isCorrect": false } ] },
                            { "question": "The passage suggests that a key difference between hydropower/geothermal energy and solar/wind energy is:", "answerOptions": [ { "text": "their cost-effectiveness.", "isCorrect": false }, { "text": "their geographical limitations.", "isCorrect": false }, { "text": "their level of reliability and consistency.", "isCorrect": true }, { "text": "their impact on avian wildlife.", "isCorrect": false } ] },
                            { "question": "According to paragraph 5, what is the primary purpose of developing smart grids?", "answerOptions": [ { "text": "To lower the cost of electricity for consumers by reducing waste.", "isCorrect": false }, { "text": "To generate more power from existing solar and wind farms.", "isCorrect": false }, { "text": "To better manage electricity distribution from varied and decentralized sources.", "isCorrect": true }, { "text": "To provide tax incentives for homeowners to install their own solar panels.", "isCorrect": false } ] },
                            { "question": "The passage mentions all of the following as challenges to the widespread adoption of renewable energy EXCEPT:", "answerOptions": [ { "text": "the need for effective energy storage.", "isCorrect": false }, { "text": "the geographical limitations of certain sources.", "isCorrect": false }, { "text": "the lack of any viable renewable technology.", "isCorrect": true }, { "text": "the necessity of modernizing electrical grids.", "isCorrect": false } ] },
                            { "question": "How does the author structure the main body of the text (paragraphs 2-4)?", "answerOptions": [ { "text": "By chronologically detailing the invention of each renewable technology.", "isCorrect": false }, { "text": "By comparing and contrasting the economic cost of each energy source.", "isCorrect": false }, { "text": "By dedicating separate paragraphs to different types of renewable energy, outlining their pros and cons.", "isCorrect": true }, { "text": "By presenting a problem and then immediately offering a single, definitive solution.", "isCorrect": false } ] },
                            { "question": "In paragraph 5, the word 'formidable' most nearly means:", "answerOptions": [ { "text": "Simple and easy.", "isCorrect": false }, { "text": "Inspiring fear or respect through being impressively large or powerful.", "isCorrect": true }, { "text": "Unimportant and trivial.", "isCorrect": false }, { "text": "Related to government policy.", "isCorrect": false } ] },
                            { "question": "Based on the passage, a government wishing to accelerate the transition to renewable energy would most likely:", "answerOptions": [ { "text": "Increase subsidies for fossil fuel companies.", "isCorrect": false }, { "text": "Ban the construction of new dams for hydropower.", "isCorrect": false }, { "text": "Invest in battery technology and offer tax incentives for solar installations.", "isCorrect": true }, { "text": "Focus exclusively on geothermal energy regardless of geographic location.", "isCorrect": false } ] },
                            { "question": "The text identifies photovoltaic cells as a technology used in:", "answerOptions": [ { "text": "Wind power generation.", "isCorrect": false }, { "text": "Geothermal energy extraction.", "isCorrect": false }, { "text": "Hydropower dams.", "isCorrect": false }, { "text": "Solar power generation.", "isCorrect": true } ] },
                            { "question": "What can be inferred about the economic aspect of the energy transition?", "answerOptions": [ { "text": "The transition is primarily an economic burden with no financial benefits.", "isCorrect": false }, { "text": "It involves significant technological and economic evolution.", "isCorrect": true }, { "text": "All renewable technologies are still significantly more expensive than coal or natural gas.", "isCorrect": false }, { "text": "The only economic driver for renewables is government mandates.", "isCorrect": false } ] },
                            { "question": "In paragraph 4, the term 'baseload' power implies that the energy source is:", "answerOptions": [ { "text": "Available only during peak demand hours.", "isCorrect": false }, { "text": "The cheapest available option.", "isCorrect": false }, { "text": "Geographically restricted.", "isCorrect": false }, { "text": "Constantly and reliably available.", "isCorrect": true } ] },
                            { "question": "The author presents the environmental impact of large hydropower dams as:", "answerOptions": [ { "text": "a negligible issue that has been resolved by modern technology.", "isCorrect": false }, { "text": "a significant limitation that can alter ecosystems and displace people.", "isCorrect": true }, { "text": "a positive effect that creates new habitats for aquatic life.", "isCorrect": false }, { "text": "an unproven theory without sufficient evidence.", "isCorrect": false } ] },
                            { "question": "What can be inferred from the passage about the future relationship between different renewable energy sources?", "answerOptions": [ { "text": "One single source, like solar, will eventually replace all others.", "isCorrect": false }, { "text": "A diverse mix of sources will likely be needed to create a stable and resilient energy system.", "isCorrect": true }, { "text": "Fossil fuels will always be required to supplement the intermittency of renewables.", "isCorrect": false }, { "text": "International conflict will arise over access to the best locations for wind and solar farms.", "isCorrect": false } ] },
                            { "question": "The overall tone of the passage can best be described as:", "answerOptions": [ { "text": "Pessimistic and critical.", "isCorrect": false }, { "text": "Overly simplistic and biased.", "isCorrect": false }, { "text": "Informative and cautiously optimistic.", "isCorrect": true }, { "text": "Sarcastic and dismissive.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "rla_info_pov",
                        title: "Point of View & Purpose",
                        description: "Analyzing an author's perspective, bias, and reason for writing.",
                        type: "reading",
                        article: {
                            title: "The Case for Year-Round Schooling",
                            genre: "Persuasive Essay",
                            text: [
                                "The traditional ten-month school calendar, with its long summer break, is an outdated relic of an agrarian past that no longer serves the needs of modern students. It is time for a fundamental shift to a year-round schooling model. A balanced calendar, with shorter, more frequent breaks distributed throughout the year, offers a powerful solution to combat the well-documented 'summer slide'—the significant learning loss that occurs over the long summer vacation. This loss is particularly detrimental to students from low-income families, who often lack access to enriching summer activities, thus widening the achievement gap.",
                                "Opponents of year-round schooling often raise concerns about disrupting family traditions and the summer tourism industry. While these are valid considerations, they pale in comparison to the profound educational benefits. Shorter breaks mean that teachers spend less time re-teaching old material in the fall, allowing them to cover more ground and delve deeper into complex topics. Furthermore, a balanced calendar can reduce teacher and student burnout by providing more frequent opportunities for rest and rejuvenation. The argument that 'kids need a break' misunderstands the nature of modern learning; the goal is not to eliminate breaks, but to distribute them more effectively to create a continuous and more engaging learning environment.",
                                "Ultimately, the transition to year-round schooling is not merely a logistical change; it is an investment in our children's future. It is a commitment to closing the achievement gap, improving academic retention, and creating a more efficient and effective educational system. Clinging to a calendar designed for a bygone era is a disservice to our students. We must have the courage to embrace a model that is better suited to the demands of the 21st century."
                            ]
                        },
                        questions: [
                            { "question": "What is the author's primary purpose in writing this passage?", "answerOptions": [ { "text": "To provide a balanced, neutral overview of different school calendars.", "isCorrect": false }, { "text": "To persuade the reader that year-round schooling is superior to the traditional calendar.", "isCorrect": true }, { "text": "To criticize the summer tourism industry.", "isCorrect": false }, { "text": "To analyze the history of the agrarian school calendar.", "isCorrect": false } ] },
                            { "question": "Which statement best describes the author's point of view regarding the traditional school calendar?", "answerOptions": [ { "text": "It is a cherished tradition that should be preserved.", "isCorrect": false }, { "text": "It is an effective model for all students, regardless of background.", "isCorrect": false }, { "text": "It is an outdated system that hinders student learning.", "isCorrect": true }, { "text": "It is a minor issue that does not require significant change.", "isCorrect": false } ] },
                            { "question": "The author uses the phrase 'outdated relic of an agrarian past' in the first paragraph to create a sense of:", "answerOptions": [ { "text": "nostalgia and respect for tradition.", "isCorrect": false }, { "text": "the calendar being old-fashioned and no longer useful.", "isCorrect": true }, { "text": "the calendar being beneficial for farming communities.", "isCorrect": false }, { "text": "the calendar being a complex historical artifact.", "isCorrect": false } ] },
                            { "question": "How does the author address the opposing viewpoint that year-round schooling disrupts family traditions?", "answerOptions": [ { "text": "By dismissing it as completely invalid and irrelevant.", "isCorrect": false }, { "text": "By acknowledging it as a valid concern but arguing that the educational benefits are more important.", "isCorrect": true }, { "text": "By providing evidence that year-round schooling does not disrupt family traditions.", "isCorrect": false }, { "text": "By ignoring the opposing viewpoint entirely.", "isCorrect": false } ] },
                            { "question": "The author's tone can best be described as:", "answerOptions": [ { "text": "uncertain and questioning.", "isCorrect": false }, { "text": "humorous and lighthearted.", "isCorrect": false }, { "text": "objective and detached.", "isCorrect": false }, { "text": "passionate and urgent.", "isCorrect": true } ] },
                            { "question": "What bias does the author display in the passage?", "answerOptions": [ { "text": "A bias against students from low-income families.", "isCorrect": false }, { "text": "A strong bias in favor of year-round schooling.", "isCorrect": true }, { "text": "A bias against teachers and school administrators.", "isCorrect": false }, { "text": "A neutral and unbiased perspective.", "isCorrect": false } ] },
                            { "question": "The author claims that the 'summer slide' is 'particularly detrimental to students from low-income families.' What is the likely purpose of including this detail?", "answerOptions": [ { "text": "To suggest that only low-income students would benefit from year-round school.", "isCorrect": false }, { "text": "To appeal to the reader's sense of fairness and social justice.", "isCorrect": true }, { "text": "To prove that all summer activities are expensive.", "isCorrect": false }, { "text": "To criticize the parents of low-income students.", "isCorrect": false } ] },
                            { "question": "In paragraph 2, the author states that concerns about family traditions 'pale in comparison to the profound educational benefits.' The phrase 'pale in comparison' is used to:", "answerOptions": [ { "text": "suggest the two issues are equally important.", "isCorrect": false }, { "text": "minimize the importance of the opposing argument.", "isCorrect": true }, { "text": "show that the author is changing their mind.", "isCorrect": false }, { "text": "indicate that the opposing argument is too complex to discuss.", "isCorrect": false } ] },
                            { "question": "What is the author's likely purpose for using strong, emotional language like 'commitment,' 'courage,' and 'disservice' in the final paragraph?", "answerOptions": [ { "text": "To provide statistical evidence.", "isCorrect": false }, { "text": "To present a counterargument.", "isCorrect": false }, { "text": "To create a sense of shared responsibility and inspire action.", "isCorrect": true }, { "text": "To maintain a neutral and objective tone.", "isCorrect": false } ] },
                            { "question": "The author's main argument is that year-round schooling should be adopted because:", "answerOptions": [ { "text": "it is a new and modern idea.", "isCorrect": false }, { "text": "it would save schools money on air conditioning.", "isCorrect": false }, { "text": "it provides significant educational advantages, such as reducing learning loss.", "isCorrect": true }, { "text": "it is easier for parents to schedule vacations.", "isCorrect": false } ] },
                            { "question": "Which of the following best describes the author's perspective on teachers?", "answerOptions": [ { "text": "The author believes teachers are overworked and would benefit from the more frequent breaks in a year-round model.", "isCorrect": true }, { "text": "The author believes teachers are the main opponents of year-round schooling.", "isCorrect": false }, { "text": "The author believes teachers are not affected by the school calendar.", "isCorrect": false }, { "text": "The author believes teachers are responsible for the 'summer slide.'", "isCorrect": false } ] },
                            { "question": "The intended audience for this passage is most likely:", "answerOptions": [ { "text": "students who dislike summer vacation.", "isCorrect": false }, { "text": "historians studying agrarian societies.", "isCorrect": false }, { "text": "parents, educators, and community members involved in education policy.", "isCorrect": true }, { "text": "owners of summer camps and tourist attractions.", "isCorrect": false } ] },
                            { "question": "How does the author attempt to build credibility?", "answerOptions": [ { "text": "By citing numerous scientific studies and statistics.", "isCorrect": false }, { "text": "By using formal language and presenting a logical argument, while also acknowledging counterarguments.", "isCorrect": true }, { "text": "By sharing personal anecdotes about their own school experiences.", "isCorrect": false }, { "text": "By claiming to be the sole expert on the topic.", "isCorrect": false } ] },
                            { "question": "The author's use of the word 'clinging' in the final paragraph suggests that adherence to the traditional calendar is:", "answerOptions": [ { "text": "a thoughtful and considered choice.", "isCorrect": false }, { "text": "a stubborn and irrational refusal to change.", "isCorrect": true }, { "text": "a temporary and flexible arrangement.", "isCorrect": false }, { "text": "a popular and modern trend.", "isCorrect": false } ] },
                            { "question": "If this passage were to continue, what would the author most likely discuss next?", "answerOptions": [ { "text": "A detailed history of summer vacation traditions.", "isCorrect": false }, { "text": "Specific examples or case studies of schools that have successfully implemented a year-round model.", "isCorrect": true }, { "text": "A list of fun activities for students to do during shorter breaks.", "isCorrect": false }, { "text": "An argument in favor of homeschooling.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "rla_info_arguments",
                        title: "Analyzing Arguments",
                        description: "Evaluating claims, evidence, and logical reasoning in persuasive texts.",
                        type: "reading",
                        article: {
                            title: "The Necessity of Urban Green Spaces",
                            genre: "Argumentative Article",
                            text: [
                                "In the concrete jungles of our rapidly growing cities, green spaces are not a luxury; they are a vital necessity. Parks, community gardens, and even small green rooftops are essential infrastructure for a healthy, resilient, and equitable urban future. The argument against dedicating valuable urban real estate to non-commercial use is shortsighted, ignoring the immense economic, environmental, and social returns that green spaces provide. It is imperative that city planners and policymakers prioritize the creation and preservation of these natural oases.",
                                "The environmental benefits are the most obvious. Trees and vegetation absorb carbon dioxide, filter air pollutants, and mitigate the urban heat island effect, where dense concentrations of pavement and buildings absorb and retain heat, making cities significantly hotter than surrounding rural areas. A single large tree can provide the cooling effect of ten room-sized air conditioners. Furthermore, green spaces with permeable surfaces can absorb stormwater, reducing runoff and preventing flooding, which saves millions in infrastructure costs.",
                                "Beyond the environmental impact, the social and health benefits are profound. Access to green space is directly linked to improved physical and mental health. Studies have consistently shown that time spent in nature reduces stress, lowers blood pressure, and improves overall well-being. Parks and community gardens also serve as crucial social hubs, fostering community cohesion and providing safe places for children to play and for neighbors to interact. In many underserved neighborhoods, a local park is the only available space for recreation and social gathering.",
                                "Some may argue that cities facing housing shortages cannot afford to 'waste' land on parks. This is a false dichotomy. Well-designed cities can and must incorporate both affordable housing and accessible green space. In fact, the presence of parks can increase the value of nearby residential properties, creating a more desirable and stable community. The choice is not between housing and parks; it is between short-term, profit-driven development and long-term, sustainable urban planning that values the health and happiness of its citizens."
                            ]
                        },
                        questions: [
                            { "question": "What is the author's main claim in the passage?", "answerOptions": [ { "text": "Cities should focus exclusively on building more affordable housing.", "isCorrect": false }, { "text": "Urban green spaces are a critical and necessary component of a healthy city.", "isCorrect": true }, { "text": "The environmental benefits of parks outweigh the social benefits.", "isCorrect": false }, { "text": "City planners are not doing enough to combat the urban heat island effect.", "isCorrect": false } ] },
                            { "question": "Which piece of evidence does the author use to support the claim about environmental benefits?", "answerOptions": [ { "text": "The assertion that parks increase the value of nearby properties.", "isCorrect": false }, { "text": "The statement that a single tree can provide the cooling effect of ten air conditioners.", "isCorrect": true }, { "text": "The argument that parks foster community cohesion.", "isCorrect": false }, { "text": "The claim that time spent in nature reduces stress.", "isCorrect": false } ] },
                            { "question": "In paragraph 4, the author addresses the counterargument that cities need land for housing, not parks. How does the author rebut this point?", "answerOptions": [ { "text": "By arguing that housing is not as important as parks.", "isCorrect": false }, { "text": "By agreeing that parks should only be built if there is no housing shortage.", "isCorrect": false }, { "text": "By stating that the choice between housing and parks is a 'false dichotomy' and that both are possible.", "isCorrect": true }, { "text": "By providing statistics on how many new parks have been built recently.", "isCorrect": false } ] },
                            { "question": "The author's claim that 'studies have consistently shown' that nature reduces stress is an appeal to what?", "answerOptions": [ { "text": "Emotion", "isCorrect": false }, { "text": "Tradition", "isCorrect": false }, { "text": "Authority or expert evidence", "isCorrect": true }, { "text": "Anecdotal evidence", "isCorrect": false } ] },
                            { "question": "What is the logical flaw in the argument that cities 'cannot afford to 'waste' land on parks,' as described by the author?", "answerOptions": [ { "text": "It is an ad hominem attack on city planners.", "isCorrect": false }, { "text": "It is a slippery slope argument that assumes parks will lead to bankruptcy.", "isCorrect": false }, { "text": "It presents a false dichotomy by suggesting the only choice is between parks and housing.", "isCorrect": true }, { "text": "It is a circular argument that repeats the claim without evidence.", "isCorrect": false } ] },
                            { "question": "Which of the following statements is presented as a fact rather than an opinion in the passage?", "answerOptions": [ { "text": "Green spaces are not a luxury, but a vital necessity.", "isCorrect": false }, { "text": "The argument against green spaces is shortsighted.", "isCorrect": false }, { "text": "Trees and vegetation absorb carbon dioxide.", "isCorrect": true }, { "text": "The choice is between short-term profit and long-term sustainability.", "isCorrect": false } ] },
                            { "question": "The author's argument would be most weakened by which of the following findings?", "answerOptions": [ { "text": "A new study showing that the cooling effect of trees is less than previously thought.", "isCorrect": true }, { "text": "A report that community gardens are growing in popularity.", "isCorrect": false }, { "text": "Evidence that most city residents prefer indoor recreation.", "isCorrect": false }, { "text": "A survey showing that people feel happier after visiting a park.", "isCorrect": false } ] },
                            { "question": "The author's argument would be most strengthened by including:", "answerOptions": [ { "text": "more emotional language about the beauty of nature.", "isCorrect": false }, { "text": "a personal story about the author's favorite park.", "isCorrect": false }, { "text": "specific data from a city where adding parks led to measurable economic and health benefits.", "isCorrect": true }, { "text": "a longer discussion of the history of urban development.", "isCorrect": false } ] },
                            { "question": "What unstated assumption does the author make about their audience?", "answerOptions": [ { "text": "The audience is primarily made up of real estate developers.", "isCorrect": false }, { "text": "The audience values scientific evidence and the well-being of citizens.", "isCorrect": true }, { "text": "The audience is opposed to any form of government spending.", "isCorrect": false }, { "text": "The audience has little interest in environmental issues.", "isCorrect": false } ] },
                            { "question": "By stating that the argument against green spaces is 'shortsighted,' the author implies that opponents are:", "answerOptions": [ { "text": "focusing on immediate costs without considering long-term benefits.", "isCorrect": true }, { "text": "maliciously trying to harm the environment.", "isCorrect": false }, { "text": "unaware of the current housing shortage.", "isCorrect": false }, { "text": "proposing a better long-term solution.", "isCorrect": false } ] },
                            { "question": "Is the author's claim that green spaces can 'save millions in infrastructure costs' a valid conclusion based on the evidence provided?", "answerOptions": [ { "text": "No, because the author provides no evidence to support this specific financial claim.", "isCorrect": false }, { "text": "Yes, because the author logically connects permeable surfaces to reduced stormwater runoff and flooding.", "isCorrect": true }, { "text": "No, because building parks is always more expensive than building flood barriers.", "isCorrect": false }, { "text": "Yes, because all green spaces are known to generate revenue for cities.", "isCorrect": false } ] },
                            { "question": "The author's argument that green spaces are 'essential infrastructure' is an attempt to:", "answerOptions": [ { "text": "frame parks as being as critical to a city's function as roads and bridges.", "isCorrect": true }, { "text": "suggest that parks should be funded through taxes on gasoline.", "isCorrect": false }, { "text": "argue that all green spaces should be built with concrete and steel.", "isCorrect": false }, { "text": "prove that green spaces are a new and untested idea.", "isCorrect": false } ] },
                            { "question": "How does the author use the example of 'underserved neighborhoods' in paragraph 3 to support the main argument?", "answerOptions": [ { "text": "To suggest that only poor neighborhoods need parks.", "isCorrect": false }, { "text": "To highlight the equity and social justice dimension of providing green spaces.", "isCorrect": true }, { "text": "To argue that parks in wealthy neighborhoods are a waste of money.", "isCorrect": false }, { "text": "To prove that all social gatherings happen in parks.", "isCorrect": false } ] },
                            { "question": "Which of the following claims made by the author is LEAST supported by specific evidence in the text?", "answerOptions": [ { "text": "Green spaces mitigate the urban heat island effect.", "isCorrect": false }, { "text": "Access to green space is linked to improved health.", "isCorrect": false }, { "text": "The presence of parks can increase the value of nearby residential properties.", "isCorrect": true }, { "text": "Green spaces can help manage stormwater.", "isCorrect": false } ] },
                            { "question": "Overall, is the author's argument that green spaces are a 'vital necessity' convincing?", "answerOptions": [ { "text": "No, because the author fails to address any counterarguments.", "isCorrect": false }, { "text": "No, because the author relies solely on emotional appeals without any factual evidence.", "isCorrect": false }, { "text": "Yes, because the author presents a variety of environmental, social, and health benefits and refutes a key counterargument.", "isCorrect": true }, { "text": "Yes, but only for cities that do not have a housing shortage.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "rla_info_graphics",
                        title: "Interpreting Graphics",
                        description: "Reading charts, graphs, and tables that accompany articles.",
                        type: "reading",
                        article: {
                            title: "Trends in Global Energy Consumption",
                            genre: "Informational Report with Graphics",
                            text: [
                                "Global energy consumption has seen dramatic shifts over the past fifty years. As developing nations industrialize and global population grows, the demand for energy continues to rise. While fossil fuels have long dominated the energy landscape, the mix of sources is beginning to change. The accompanying graphics illustrate these trends, providing a snapshot of where our energy comes from and which sectors are the largest consumers.",
                                "The pie chart below shows the breakdown of global energy consumption by source for the most recent year. As is evident, fossil fuels (coal, oil, and natural gas combined) still account for the vast majority of the world's energy supply. However, the share of renewables, including hydropower, solar, and wind, is steadily growing, driven by environmental concerns and decreasing costs. Nuclear energy remains a small but consistent contributor.",
                                "The bar chart further details the primary uses of electricity. The industrial sector is the largest consumer, powering factories and manufacturing processes. This is followed closely by the residential sector (for lighting, heating, and appliances) and the commercial sector (for businesses and offices). Transportation currently represents a smaller portion of electricity use, but this is expected to grow significantly with the adoption of electric vehicles."
                            ]
                        },
                        questions: [
                            { "questionNumber": 1, "type": "chart", "passage": `<div class="passage-text"><b>Allied Military Deaths in World War II (Approximate)</b><br><img src="Images/WorldWarII-MilitaryDeaths-Allies-Piechart.png" alt="A pie chart showing approximate Allied military deaths in WWII. Soviet Union: 48%, China: 22%, United States: 5%, United Kingdom: 5%, Other Allies: 20%." class="bg-white p-2 rounded"></div>`, "question": "According to the pie chart, which two Allied nations suffered the highest number of military deaths in World War II?", "answerOptions": [ { "text": "The Soviet Union and China", "rationale": "Correct. The chart shows the Soviet Union and China with the two largest percentages of military deaths among the Allies.", "isCorrect": true }, { "text": "The United States and the United Kingdom", "rationale": "The chart shows the U.S. and U.K. with relatively small percentages compared to the Soviet Union and China.", "isCorrect": false }, { "text": "China and the United States", "rationale": "While China's losses were very high, the U.S. losses were significantly smaller.", "isCorrect": false }, { "text": "The Soviet Union and the United Kingdom", "rationale": "While the Soviet Union's losses were the highest, the U.K.'s were much smaller.", "isCorrect": false } ] },
                            { "questionNumber": 2, "type": "chart", "passage": `<div class="passage-text"><b>Allied Military Deaths in World War II (Approximate)</b><br><img src="Images/WorldWarII-MilitaryDeaths-Allies-Piechart.png" alt="A pie chart showing approximate Allied military deaths in WWII. Soviet Union: 48%, China: 22%, United States: 5%, United Kingdom: 5%, Other Allies: 20%." class="bg-white p-2 rounded"></div>`, "question": "The combined military deaths of the United States and the United Kingdom make up approximately what percentage of the total Allied deaths shown?", "answerOptions": [ { "text": "5%", "rationale": "This is the approximate percentage for each country individually, not combined.", "isCorrect": false }, { "text": "10%", "rationale": "Correct. The chart shows the U.S. at 5% and the U.K. at 5%, for a combined total of 10%.", "isCorrect": true }, { "text": "22%", "rationale": "This is the approximate percentage for China alone.", "isCorrect": false }, { "text": "48%", "rationale": "This is the approximate percentage for the Soviet Union alone.", "isCorrect": false } ] },
                            { "questionNumber": 3, "type": "chart", "passage": `<div class="passage-text"><b>Allied Military Deaths in World War II (Approximate)</b><br><img src="Images/WorldWarII-MilitaryDeaths-Allies-Piechart.png" alt="A pie chart showing approximate Allied military deaths in WWII. Soviet Union: 48%, China: 22%, United States: 5%, United Kingdom: 5%, Other Allies: 20%." class="bg-white p-2 rounded"></div>`, "question": "What can be inferred from the pie chart about the human cost of World War II for the Soviet Union?", "answerOptions": [ { "text": "It was minimal compared to other Allies.", "rationale": "The chart shows the Soviet Union had the highest proportion of deaths by a large margin.", "isCorrect": false }, { "text": "It was immense, accounting for nearly half of all Allied military deaths shown.", "rationale": "Correct. The Soviet Union's slice of the pie is 48%, which is almost half, indicating a staggering human cost.", "isCorrect": true }, { "text": "It was less than the combined losses of the United States and the United Kingdom.", "rationale": "It was significantly greater than the combined losses of the U.S. and U.K.", "isCorrect": false }, { "text": "It was roughly equal to the losses of China.", "rationale": "The chart shows the Soviet Union's losses were more than double those of China.", "isCorrect": false } ] },
                            { "questionNumber": 4, "type": "chart", "passage": `<div class="passage-text"><b>Electricity Consumption by Sector</b><br><img src="Images/ged-grsph-1.png" alt="A bar chart showing electricity consumption. Industrial: 40%, Residential: 35%, Commercial: 24%, Transportation: 1%." class="bg-white p-2 rounded"></div>`, "question": "Which sector is the largest consumer of electricity according to the bar chart?", "answerOptions": [ { "text": "Residential", "isCorrect": false }, { "text": "Commercial", "isCorrect": false }, { "text": "Transportation", "isCorrect": false }, { "text": "Industrial", "isCorrect": true } ] },
                            { "questionNumber": 5, "type": "chart", "passage": `<div class="passage-text"><b>Electricity Consumption by Sector</b><br><img src="Images/ged-grsph-1.png" alt="A bar chart showing electricity consumption. Industrial: 40%, Residential: 35%, Commercial: 24%, Transportation: 1%." class="bg-white p-2 rounded"></div>`, "question": "What is the combined percentage of electricity consumed by the Residential and Commercial sectors?", "answerOptions": [ { "text": "40%", "isCorrect": false }, { "text": "59%", "isCorrect": true }, { "text": "75%", "isCorrect": false }, { "text": "99%", "isCorrect": false } ] },
                            { "questionNumber": 6, "type": "multi-source", "passage": `<div class="passage-text">Refer to both the article text and the "Electricity Consumption by Sector" bar chart.</div><img src="Images/ged-grsph-1.png" alt="A bar chart showing electricity consumption. Industrial: 40%, Residential: 35%, Commercial: 24%, Transportation: 1%." class="bg-white p-2 rounded">`, "question": "The article states that electricity use for transportation is expected to grow. Based on the chart, why would this growth be significant?", "answerOptions": [ { "text": "Because transportation already uses the most electricity.", "isCorrect": false }, { "text": "Because transportation currently represents a very small fraction of electricity use, so any growth will be a large relative change.", "isCorrect": true }, { "text": "Because the industrial sector's electricity use is declining rapidly.", "isCorrect": false }, { "text": "Because transportation is the only sector where electricity use is measured.", "isCorrect": false } ] },
                            { "questionNumber": 7, "type": "chart", "passage": `<div class="passage-text"><b>Average Test Scores by Subject</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Subject</th><th class="p-2 border-b">Score</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Math</td><td class="p-2">82</td></tr><tr class="border-b"><td class="p-2">Reading</td><td class="p-2">88</td></tr><tr class="border-b"><td class="p-2">Science</td><td class="p-2">85</td></tr><tr class="border-b"><td class="p-2">Social Studies</td><td class="p-2">83</td></tr></tbody></table></div>`, "question": "Which subject has the highest average test score?", "answerOptions": [ { "text": "Math", "isCorrect": false }, { "text": "Reading", "isCorrect": true }, { "text": "Science", "isCorrect": false }, { "text": "Social Studies", "isCorrect": false } ] },
                            { "questionNumber": 8, "type": "chart", "passage": `<div class="passage-text"><b>Average Test Scores by Subject</b><br><table class="w-full text-left mt-2"><thead><tr><th class="p-2 border-b">Subject</th><th class="p-2 border-b">Score</th></tr></thead><tbody><tr class="border-b"><td class="p-2">Math</td><td class="p-2">82</td></tr><tr class="border-b"><td class="p-2">Reading</td><td class="p-2">88</td></tr><tr class="border-b"><td class="p-2">Science</td><td class="p-2">85</td></tr><tr class="border-b"><td class="p-2">Social Studies</td><td class="p-2">83</td></tr></tbody></table></div>`, "question": "What is the range of the average test scores?", "answerOptions": [ { "text": "6", "isCorrect": true }, { "text": "82", "isCorrect": false }, { "text": "84.5", "isCorrect": false }, { "text": "88", "isCorrect": false } ] },
                            { "questionNumber": 9, "type": "chart", "passage": `<div class="passage-text"><b>Projected Population Growth of City X</b><br><img src="Images/Questions-are-based-on-the-following-graph.-7.png" alt="A line graph showing population over time. 2020: 100k, 2025: 110k, 2030: 125k, 2035: 145k, 2040: 170k." class="bg-white p-2 rounded"></div>`, "question": "During which 5-year period is the population of City X projected to grow the most?", "answerOptions": [ { "text": "2020-2025", "isCorrect": false }, { "text": "2025-2030", "isCorrect": false }, { "text": "2030-2035", "isCorrect": false }, { "text": "2035-2040", "isCorrect": true } ] },
                            { "questionNumber": 10, "type": "chart", "passage": `<div class="passage-text"><b>Projected Population Growth of City X</b><br><img src="Images/Questions-are-based-on-the-following-graph.-7.png" alt="A line graph showing population over time. 2020: 100k, 2025: 110k, 2030: 125k, 2035: 145k, 2040: 170k." class="bg-white p-2 rounded"></div>`, "question": "What is the overall trend shown in the graph?", "answerOptions": [ { "text": "The population is projected to decrease over time.", "isCorrect": false }, { "text": "The population is projected to grow at a steady, constant rate.", "isCorrect": false }, { "text": "The population is projected to grow at an accelerating rate.", "isCorrect": true }, { "text": "The population is projected to remain stable after 2030.", "isCorrect": false } ] },
                            { "questionNumber": 11, "type": "knowledge", "question": "What is the primary purpose of a map key or legend?", "answerOptions": [ { "text": "To show the title of the map.", "isCorrect": false }, { "text": "To explain the meaning of the symbols and colors used on the map.", "isCorrect": true }, { "text": "To indicate the scale or distance.", "isCorrect": false }, { "text": "To show the direction of North.", "isCorrect": false } ] },
                            { "questionNumber": 12, "type": "knowledge", "question": "A political map is a type of map that primarily shows:", "answerOptions": [ { "text": "Physical features like mountains and rivers.", "isCorrect": false }, { "text": "Climate zones and vegetation.", "isCorrect": false }, { "text": "The boundaries of countries, states, and cities.", "isCorrect": true }, { "text": "Population density.", "isCorrect": false } ] },
                            { "questionNumber": 13, "type": "knowledge", "question": "On a map, what does the scale '1 inch = 100 miles' mean?", "answerOptions": [ { "text": "The map is 100 miles wide.", "isCorrect": false }, { "text": "Every inch on the map represents 100 miles in the real world.", "isCorrect": true }, { "text": "The map is not accurate.", "isCorrect": false }, { "text": "Every 100 inches on the map represents 1 mile in the real world.", "isCorrect": false } ] },
                            { "questionNumber": 14, "type": "knowledge", "question": "A bar chart is most effective for:", "answerOptions": [ { "text": "Showing a trend over a continuous period of time.", "isCorrect": false }, { "text": "Comparing distinct categories or groups.", "isCorrect": true }, { "text": "Showing the parts of a whole or percentages.", "isCorrect": false }, { "text": "Displaying the exact location of geographical features.", "isCorrect": false } ] },
                            { "questionNumber": 15, "type": "knowledge", "question": "A pie chart is most effective for:", "answerOptions": [ { "text": "Showing a trend over a continuous period of time.", "isCorrect": false }, { "text": "Comparing distinct categories or groups.", "isCorrect": false }, { "text": "Showing the parts of a whole or percentages.", "isCorrect": true }, { "text": "Displaying the exact location of geographical features.", "isCorrect": false } ] }
                        ]
                    }
                ]
            },
            "Reading Comprehension: Literary Texts": {
                description: "Learn to analyze plot, character, theme, and figurative language in fiction.",
                topics: [
                    {
                        id: "rla_lit_plot_character",
                        title: "Plot & Character",
                        description: "Analyzing story structure and character development.",
                        quizzes: [
                            { id: "rla_lit_plot_character_quiz1", label: "Set 1", questionSourceTopicId: "rla_lit_plot_character" },
                            { id: "rla_lit_plot_character_quiz2", label: "Set 2" },
                            { id: "rla_lit_plot_character_quiz3", label: "Set 3" }
                        ],
                        type: "reading",
                        article: {
                            title: "An Excerpt from 'The Gift of the Magi' by O. Henry",
                            genre: "Short Story",
                            text: [
                                "One dollar and eighty-seven cents. That was all. And sixty cents of it was in pennies. Pennies saved one and two at a time by bulldozing the grocer and the vegetable man and the butcher until one's cheeks burned with the silent imputation of parsimony that such close dealing implied. Three times Della counted it. One dollar and eighty-seven cents. And the next day would be Christmas.",
                                "There was clearly nothing to do but flop down on the shabby little couch and howl. So Della did it. Which instigates the moral reflection that life is made up of sobs, sniffles, and smiles, with sniffles predominating.",
                                "Della finished her cry and attended to her cheeks with the powder rag. She stood by the window and looked out dully at a gray cat walking a gray fence in a gray backyard. Tomorrow would be Christmas Day, and she had only $1.87 with which to buy Jim a present. Her Jim. Many a happy hour she had spent planning for something nice for him. Something fine and rare and sterling—something just a little bit near to being worthy of the honor of being owned by Jim.",
                                "Suddenly she whirled from the window and stood before the glass. Her eyes were shining brilliantly, but her face had lost its color within twenty seconds. Rapidly she pulled down her hair and let it fall to its full length. Now, there were two possessions of the James Dillingham Youngs in which they both took a mighty pride. One was Jim's gold watch that had been his father's and his grandfather's. The other was Della's hair. Had the queen of Sheba lived in the flat across the airshaft, Della would have let her hair hang out the window some day to dry just to depreciate Her Majesty's jewels and gifts. Had King Solomon been the janitor, with all his treasures piled up in the basement, Jim would have pulled out his watch every time he passed, just to see him pluck at his beard from envy.",
                                "So now Della's beautiful hair fell about her, rippling and shining like a cascade of brown waters. It reached below her knee and made itself almost a garment for her. And then she did it up again nervously and quickly. Once she faltered for a minute and stood still while a tear or two splashed on the worn red carpet. On went her old brown jacket; on went her old brown hat. With a whirl of skirts and with the brilliant sparkle still in her eyes, she fluttered out the door and down the stairs to the street."
                            ]
                        },
                        questions: [
                            { "question": "What is the central conflict that Della faces at the beginning of the passage?", "answerOptions": [ { "text": "She is unhappy with her apartment.", "isCorrect": false }, { "text": "She does not have enough money to buy a worthy Christmas present for her husband.", "isCorrect": true }, { "text": "She is in a disagreement with the local grocer.", "isCorrect": false }, { "text": "She is worried about her hair losing its color.", "isCorrect": false } ] },
                            { "question": "Which of the following character traits best describes Della in the first three paragraphs?", "answerOptions": [ { "text": "Careless and extravagant", "isCorrect": false }, { "text": "Angry and resentful", "isCorrect": false }, { "text": "Loving and resourceful, but distressed", "isCorrect": true }, { "text": "Calm and indifferent", "isCorrect": false } ] },
                            { "question": "The description of the 'gray cat walking a gray fence in a gray backyard' in paragraph 3 serves primarily to:", "answerOptions": [ { "text": "suggest that Della wants a pet.", "isCorrect": false }, { "text": "reflect Della's dull and hopeless mood at that moment.", "isCorrect": true }, { "text": "introduce a new character to the story.", "isCorrect": false }, { "text": "show that the story takes place in the city.", "isCorrect": false } ] },
                            { "question": "What happens in the plot that marks a turning point for Della's emotional state?", "answerOptions": [ { "text": "She counts her money for the third time.", "isCorrect": false }, { "text": "She looks out the window at the gray cat.", "isCorrect": false }, { "text": "She suddenly has an idea while looking in the mirror.", "isCorrect": true }, { "text": "She puts on her old brown jacket and hat.", "isCorrect": false } ] },
                            { "question": "The author states that Della's hair and Jim's watch are possessions in which they 'took a mighty pride.' What is the purpose of highlighting these two items?", "answerOptions": [ { "text": "To show that Della and Jim are wealthy and materialistic.", "isCorrect": false }, { "text": "To establish these items as the most valuable things they own, foreshadowing their importance to the plot.", "isCorrect": true }, { "text": "To suggest that they should sell both items to improve their living situation.", "isCorrect": false }, { "text": "To describe the history of the James Dillingham Young family.", "isCorrect": false } ] },
                            { "question": "How does Della's character evolve from the beginning of the passage to the end?", "answerOptions": [ { "text": "She goes from being happy to being sad.", "isCorrect": false }, { "text": "She goes from a state of despair to one of determined action.", "isCorrect": true }, { "text": "She becomes more concerned with her own appearance.", "isCorrect": false }, { "text": "She decides that buying a gift is not important.", "isCorrect": false } ] },
                            { "question": "The phrase 'silent imputation of parsimony' in the first paragraph means that Della felt:", "answerOptions": [ { "text": "proud of her ability to save money.", "isCorrect": false }, { "text": "the shopkeepers were silently accusing her of being overly cheap.", "isCorrect": true }, { "text": "the shopkeepers admired her for her bargaining skills.", "isCorrect": false }, { "text": "that she was not paying enough for the groceries.", "isCorrect": false } ] },
                            { "question": "What is the climax of this particular excerpt?", "answerOptions": [ { "text": "Della counting her money.", "isCorrect": false }, { "text": "Della looking out the window.", "isCorrect": false }, { "text": "Della realizing what she can do and then quickly leaving the apartment.", "isCorrect": true }, { "text": "The author's moral reflection on life.", "isCorrect": false } ] },
                            { "question": "The author's comparison of Della's hair to the Queen of Sheba's jewels and Jim's watch to King Solomon's treasures is an example of what literary device?", "answerOptions": [ { "text": "Metaphor", "isCorrect": false }, { "text": "Personification", "isCorrect": false }, { "text": "Allusion", "isCorrect": true }, { "text": "Onomatopoeia", "isCorrect": false } ] },
                            { "question": "What primary motivation drives Della's actions throughout the passage?", "answerOptions": [ { "text": "Her desire to be wealthy.", "isCorrect": false }, { "text": "Her deep love for her husband, Jim.", "isCorrect": true }, { "text": "Her frustration with her living conditions.", "isCorrect": false }, { "text": "Her wish to compete with royalty.", "isCorrect": false } ] },
                            { "question": "The author writes, 'Once she faltered for a minute and stood still while a tear or two splashed on the worn red carpet.' This moment in the plot reveals that Della's decision:", "answerOptions": [ { "text": "was easy and made without any emotion.", "isCorrect": false }, { "text": "was difficult and caused her a moment of sadness or hesitation.", "isCorrect": true }, { "text": "was something she had planned for a long time.", "isCorrect": false }, { "text": "was an accident.", "isCorrect": false } ] },
                            { "question": "Which of the following is part of the exposition of the story, as presented in the excerpt?", "answerOptions": [ { "text": "Della's decision to leave the apartment.", "isCorrect": false }, { "text": "The introduction of the setting, the main character (Della), and her central problem.", "isCorrect": true }, { "text": "The comparison of Della's hair to a cascade of brown waters.", "isCorrect": false }, { "text": "The 'brilliant sparkle' in Della's eyes.", "isCorrect": false } ] },
                            { "question": "The description of Della putting on her 'old brown jacket' and 'old brown hat' contributes to the characterization by emphasizing her:", "answerOptions": [ { "text": "lack of style.", "isCorrect": false }, { "text": "love for the color brown.", "isCorrect": false }, { "text": "modest financial means.", "isCorrect": true }, { "text": "desire to be unnoticed.", "isCorrect": false } ] },
                            { "question": "What does the 'brilliant sparkle' in Della's eyes at the end of the passage symbolize?", "answerOptions": [ { "text": "Her lingering sadness and despair.", "isCorrect": false }, { "text": "Her newfound hope, determination, and love.", "isCorrect": true }, { "text": "Her anger at her situation.", "isCorrect": false }, { "text": "Her fear of what Jim will think.", "isCorrect": false } ] },
                            { "question": "The rising action of this excerpt begins when:", "answerOptions": [ { "text": "Della counts her money.", "isCorrect": false }, { "text": "Della looks out the window.", "isCorrect": false }, { "text": "Della suddenly whirls from the window with an idea.", "isCorrect": true }, { "text": "The author makes a moral reflection about life.", "isCorrect": false } ] }
                        ]
                    },
                    {
                        id: "rla_lit_theme_figurative_language",
                        title: "Poetry & Figurative Language",
                        description: "Analyze poems for theme, tone, and figurative language techniques.",
                        quizzes: [
                            { id: "rla_lit_theme_figurative_language_quiz1", label: "Set 1", questionSourceTopicId: "rla_lit_theme_figurative_language" },
                            { id: "rla_lit_theme_figurative_language_quiz2", label: "Set 2" },
                            { id: "rla_lit_theme_figurative_language_quiz3", label: "Set 3" }
                        ],
                        type: "reading",
                        article: {
                            title: "The Road Not Taken",
                            genre: "Poem by Robert Frost",
                            text: [
                                "Two roads diverged in a yellow wood,",
                                "And sorry I could not travel both",
                                "And be one traveler, long I stood",
                                "And looked down one as far as I could",
                                "To where it bent in the undergrowth;",
                                "<br/>",
                                "Then took the other, as just as fair,",
                                "And having perhaps the better claim,",
                                "Because it was grassy and wanted wear;",
                                "Though as for that the passing there",
                                "Had worn them really about the same,",
                                "<br/>",
                                "And both that morning equally lay",
                                "In leaves no step had trodden black.",
                                "Oh, I kept the first for another day!",
                                "Yet knowing how way leads on to way,",
                                "I doubted if I should ever come back.",
                                "<br/>",
                                "I shall be telling this with a sigh",
                                "Somewhere ages and ages hence:",
                                "Two roads diverged in a wood, and I—",
                                "I took the one less traveled by,",
                                "And that has made all the difference."
                            ]
                        },
                        questions: [
                            { "question": "The 'two roads' in the poem are a metaphor for what?", "answerOptions": [ { "text": "An actual forest path.", "isCorrect": false }, { "text": "Choices one must make in life.", "isCorrect": true }, { "text": "The past and the future.", "isCorrect": false }, { "text": "Friendships.", "isCorrect": false } ] },
                            { "question": "What is the central theme of the poem?", "answerOptions": [ { "text": "The beauty of nature in autumn.", "isCorrect": false }, { "text": "The importance of following the crowd.", "isCorrect": false }, { "text": "The idea that individual choices shape one's life and identity.", "isCorrect": true }, { "text": "The regret that comes from making a wrong decision.", "isCorrect": false } ] },
                            { "question": "In the first stanza, what does the 'yellow wood' symbolize?", "answerOptions": [ { "text": "A time of decision or a crossroads in the speaker's life.", "isCorrect": true }, { "text": "The speaker's fear and uncertainty.", "isCorrect": false }, { "text": "A place of danger.", "isCorrect": false }, { "text": "The speaker's happy memories.", "isCorrect": false } ] },
                            { "question": "In the second stanza, the speaker notes that the second road 'was grassy and wanted wear.' What does this figurative language suggest?", "answerOptions": [ { "text": "The road was poorly maintained.", "isCorrect": false }, { "text": "The road was more beautiful than the first.", "isCorrect": false }, { "text": "The road appeared to be less traveled or less conventional.", "isCorrect": true }, { "text": "The road was dangerous and overgrown.", "isCorrect": false } ] },
                            { "question": "How does the speaker contradict his own description of the two roads in the second stanza?", "answerOptions": [ { "text": "By saying one was much more difficult.", "isCorrect": false }, { "text": "By admitting that 'the passing there / Had worn them really about the same.'", "isCorrect": true }, { "text": "By claiming that one road was made of stone.", "isCorrect": false }, { "text": "By stating that he had traveled both roads before.", "isCorrect": false } ] },
                            { "question": "What does the line 'And both that morning equally lay / In leaves no step had trodden black' imply?", "answerOptions": [ { "text": "That the speaker was the first person there that day, and the choice was truly his own.", "isCorrect": true }, { "text": "That it was too dark to see the paths clearly.", "isCorrect": false }, { "text": "That both paths were unpopular.", "isCorrect": false }, { "text": "That the speaker was lost.", "isCorrect": false } ] },
                            { "question": "The 'sigh' mentioned in the final stanza ('I shall be telling this with a sigh') is best interpreted as a sigh of:", "answerOptions": [ { "text": "simple regret for the path not taken.", "isCorrect": false }, { "text": "satisfaction and contentment with the choice made.", "isCorrect": false }, { "text": "complex reflection, blending nostalgia, satisfaction, and a sense of the weight of the decision.", "isCorrect": true }, { "text": "deep sadness and disappointment.", "isCorrect": false } ] },
                            { "question": "The phrase 'way leads on to way' in the third stanza suggests that:", "answerOptions": [ { "text": "all paths eventually lead to the same destination.", "isCorrect": false }, { "text": "it is easy to get lost in the woods.", "isCorrect": false }, { "text": "one choice in life inevitably leads to another, making it difficult to go back and change the past.", "isCorrect": true }, { "text": "the speaker plans to explore all possible paths.", "isCorrect": false } ] },
                            { "question": "The final lines, 'I took the one less traveled by, / And that has made all the difference,' are often interpreted as a celebration of individualism. However, considering the poem's earlier statement that the roads were 'really about the same,' what is another possible interpretation of the theme?", "answerOptions": [ { "text": "The speaker made a terrible mistake.", "isCorrect": false }, { "text": "The poem is about how we create meaning and significance for our choices after we make them.", "isCorrect": true }, { "text": "The speaker is lying about which road he took.", "isCorrect": false }, { "text": "The poem is a warning against taking any risks.", "isCorrect": false } ] },
                            { "question": "The repetition of the word 'And' at the beginning of lines 2, 3, and 4 is a literary device called anaphora. What is its effect?", "answerOptions": [ { "text": "It makes the poem sound confusing.", "isCorrect": false }, { "text": "It creates a sense of hesitation and thoughtful deliberation as the speaker weighs his options.", "isCorrect": true }, { "text": "It shows that the speaker is in a hurry.", "isCorrect": false }, { "text": "It suggests the speaker is not telling the truth.", "isCorrect": false } ] },
                            { "question": "The 'undergrowth' where the path bends can be seen as a symbol for:", "answerOptions": [ { "text": "a beautiful garden.", "isCorrect": false }, { "text": "the future, which cannot be fully seen or understood from the present.", "isCorrect": true }, { "text": "the speaker's past mistakes.", "isCorrect": false }, { "text": "a place of safety and comfort.", "isCorrect": false } ] },
                            { "question": "The poem's rhyme scheme is ABAAB. What effect does this consistent structure have?", "answerOptions": [ { "text": "It makes the poem feel chaotic and unpredictable.", "isCorrect": false }, { "text": "It gives the poem a thoughtful, musical quality that reinforces its contemplative mood.", "isCorrect": true }, { "text": "It makes the poem difficult to understand.", "isCorrect": false }, { "text": "It signals that the poem should be read as a joke.", "isCorrect": false } ] },
                            { "question": "Which of the following words best describes the overall mood of the poem?", "answerOptions": [ { "text": "Joyful and carefree", "isCorrect": false }, { "text": "Angry and bitter", "isCorrect": false }, { "text": "Reflective and contemplative", "isCorrect": true }, { "text": "Frightened and anxious", "isCorrect": false } ] },
                            { "question": "The title 'The Road Not Taken' is significant because the poem focuses heavily on:", "answerOptions": [ { "text": "the road the speaker chose to travel.", "isCorrect": false }, { "text": "the memory and imagined possibilities of the road the speaker did not choose.", "isCorrect": true }, { "text": "the physical characteristics of both roads.", "isCorrect": false }, { "text": "the speaker's hiking ability.", "isCorrect": false } ] },
                            { "question": "The poem uses the past tense until the final stanza. Why does the poet switch to the future tense ('I shall be telling this...')?", "answerOptions": [ { "text": "To show that the speaker has forgotten what happened.", "isCorrect": false }, { "text": "To emphasize how the speaker will reflect on this moment and assign it meaning in the distant future.", "isCorrect": true }, { "text": "To suggest that the events of the poem have not actually happened yet.", "isCorrect": false }, { "text": "To confuse the reader about the timeline of the story.", "isCorrect": false } ] }
                        ]
                    }
                ]
            },
            "Language & Grammar": {
                description: "Master the rules of standard English grammar, punctuation, and sentence structure.",
                topics: [
                    {
                        id: "rla_grammar_conventions",
                        title: "Standard English Conventions",
                        description: "Standard English conventions including sentence structure, usage, and mechanics.",
                        quizzes: [
                            { id: "rla_lang_conventions_quiz1", label: "Set 1" },
                            { id: "rla_lang_conventions_quiz2", label: "Set 2" },
                            { id: "rla_lang_conventions_quiz3", label: "Set 3" }
                        ]
                    },
                    {
                        id: "rla_grammar_usage",
                        title: "Grammar & Usage",
                        description: "Subject-verb agreement, pronoun usage, and correct word choice.",
                        quizzes: [
                            { id: "rla_lang_usage_quiz1", label: "Set 1" },
                            { id: "rla_lang_usage_quiz2", label: "Set 2" },
                            { id: "rla_lang_usage_quiz3", label: "Set 3" }
                        ]
                    },
                    {
                        id: "rla_extended_response",
                        title: "Extended Response",
                        description: "Practice constructing a well-supported argumentative essay.",
                        quizzes: [
                            { id: "rla_extended_response_quiz1", label: "Set 1" },
                            { id: "rla_extended_response_quiz2", label: "Set 2" },
                            { id: "rla_extended_response_quiz3", label: "Set 3" }
                        ]
                    }
                ]
            },
        }
    },
    "Simulations": {
        icon: "BeakerIcon",
        categories: {
            "Interactive Labs": {
                description: "Engage with hands-on simulations to explore concepts.",
                topics: [
                    {
                      id: "sim_life",
                      title: "The Game of Life",
                      description: "A cellular automaton devised by the British mathematician John Horton Conway in 1970.",
                      type: "simulation"
                    },
                ]
            }
        }
    }
};

const getTopicById = (subjectName, topicId) => {
    if (!subjectName || !topicId) {
        return null;
    }
    const sourceApp = (typeof window !== 'undefined' && window.AppData) ? window.AppData : AppData;
    const subject = sourceApp?.[subjectName];
    if (!subject || !subject.categories) {
        return null;
    }
    for (const category of Object.values(subject.categories)) {
        const topics = Array.isArray(category?.topics) ? category.topics : [];
        const match = topics.find((candidate) => candidate && candidate.id === topicId);
        if (match) {
            return match;
        }
    }
    return null;
};

const resolveQuizQuestions = (subjectName, topic, quiz) => {
    if (quiz && Array.isArray(quiz.questions) && quiz.questions.length) {
        return quiz.questions;
    }
    if (quiz?.questionSourceTopicId) {
        const sourceTopic = getTopicById(subjectName, quiz.questionSourceTopicId);
        if (sourceTopic && Array.isArray(sourceTopic.questions) && sourceTopic.questions.length) {
            return sourceTopic.questions;
        }
    }
    if (topic && Array.isArray(topic.questions) && topic.questions.length) {
        return topic.questions;
    }
    return [];
};

const quizHasAvailableQuestions = (subjectName, topic, quiz) => {
    if (!quiz) {
        return false;
    }
    if (Array.isArray(quiz.questions) && quiz.questions.length) {
        return true;
    }
    if (quiz.questionSourceTopicId) {
        const sourceTopic = getTopicById(subjectName, quiz.questionSourceTopicId);
        if (sourceTopic && Array.isArray(sourceTopic.questions) && sourceTopic.questions.length) {
            return true;
        }
    }
    return Array.isArray(topic?.questions) && topic.questions.length > 0;
};

const topicHasAvailableQuestions = (subjectName, topic) => {
    if (!topic || typeof topic !== 'object') {
        return false;
    }
    if (Array.isArray(topic.questions) && topic.questions.length > 0) {
        return true;
    }
    if (Array.isArray(topic.quizzes) && topic.quizzes.length > 0) {
        return topic.quizzes.some((quiz) => quizHasAvailableQuestions(subjectName, topic, quiz));
    }
    return false;
};

const annotateQuestionsWithSubject = (questions, subjectKey) => {
    if (!Array.isArray(questions) || !subjectKey) {
        return Array.isArray(questions) ? questions : [];
    }

    return questions.map((question) => {
        if (!question || typeof question !== 'object') {
            return question;
        }

        if (!question.subject) {
            return { ...question, subject: subjectKey };
        }

        return question;
    });
};

const integrateExpandedQuizData = (baseData, expandedData) => {
    if (!expandedData || typeof expandedData !== 'object') {
        return baseData;
    }

    const annotateSubjectTree = (subjectNode, subjectKey) => {
        if (!subjectNode || typeof subjectNode !== 'object') {
            return;
        }

        Object.values(subjectNode.categories || {}).forEach((category) => {
            if (!category || typeof category !== 'object') {
                return;
            }

            (category.topics || []).forEach((topic) => {
                if (!topic || typeof topic !== 'object') {
                    return;
                }

                if (Array.isArray(topic.quizzes)) {
                    topic.quizzes = topic.quizzes.map((quiz) => {
                        if (!quiz || typeof quiz !== 'object') {
                            return quiz;
                        }
                        return {
                            ...quiz,
                            subject: quiz.subject || subjectKey,
                            questions: annotateQuestionsWithSubject(quiz.questions, subjectKey)
                        };
                    });
                }

                if (Array.isArray(topic.questions)) {
                    topic.questions = annotateQuestionsWithSubject(topic.questions, subjectKey);
                }
            });
        });
    };

    Object.entries(expandedData).forEach(([subjectName, expandedSubject]) => {
        if (!expandedSubject || typeof expandedSubject !== 'object') {
            return;
        }

        if (!baseData[subjectName]) {
            baseData[subjectName] = JSON.parse(JSON.stringify(expandedSubject));
            annotateSubjectTree(baseData[subjectName], subjectName);
            return;
        }

        const baseSubject = baseData[subjectName];
        if (!baseSubject.categories) {
            baseSubject.categories = {};
        }
        if (expandedSubject.icon && !baseSubject.icon) {
            baseSubject.icon = expandedSubject.icon;
        }

        Object.entries(expandedSubject.categories || {}).forEach(([categoryName, expandedCategory]) => {
            if (!expandedCategory || typeof expandedCategory !== 'object') {
                return;
            }

            if (!baseSubject.categories[categoryName]) {
                baseSubject.categories[categoryName] = JSON.parse(JSON.stringify(expandedCategory));
                return;
            }

            const baseCategory = baseSubject.categories[categoryName];
            if (expandedCategory.description && !baseCategory.description) {
                baseCategory.description = expandedCategory.description;
            }

            if (!Array.isArray(baseCategory.topics)) {
                baseCategory.topics = [];
            }
            const topicList = baseCategory.topics;

            (expandedCategory.topics || []).forEach((expandedTopic) => {
                if (!expandedTopic || typeof expandedTopic !== 'object') {
                    return;
                }

                let existingTopic = topicList.find((topic) => topic.id === expandedTopic.id || topic.title === expandedTopic.title);
                if (!existingTopic) {
                    existingTopic = JSON.parse(JSON.stringify(expandedTopic));
                    topicList.push(existingTopic);
                } else {
                    if (expandedTopic.description && !existingTopic.description) {
                        existingTopic.description = expandedTopic.description;
                    }
                }

                if (Array.isArray(expandedTopic.quizzes) && expandedTopic.quizzes.length) {
                    existingTopic.quizzes = expandedTopic.quizzes.map((quiz) => {
                        if (!quiz || typeof quiz !== 'object') {
                            return quiz;
                        }

                        const questions = annotateQuestionsWithSubject(quiz.questions, subjectName);
                        return {
                            ...quiz,
                            subject: quiz.subject || subjectName,
                            questions
                        };
                    });

                    if (!Array.isArray(existingTopic.questions) || !existingTopic.questions.length) {
                        const firstQuiz = existingTopic.quizzes[0];
                        if (firstQuiz && Array.isArray(firstQuiz.questions)) {
                            existingTopic.questions = annotateQuestionsWithSubject(firstQuiz.questions, subjectName);
                        }
                    }
                }

                if (Array.isArray(existingTopic.questions) && existingTopic.questions.length) {
                    existingTopic.questions = annotateQuestionsWithSubject(existingTopic.questions, subjectName);
                }
            });
        });

        annotateSubjectTree(baseSubject, subjectName);
    });

    return baseData;
};

const expandedQuizDataSource = (typeof window !== 'undefined' && window.ExpandedQuizData)
    ? window.ExpandedQuizData
    : (typeof globalThis !== 'undefined' ? globalThis.ExpandedQuizData : null);
if (expandedQuizDataSource) {
    integrateExpandedQuizData(AppData, expandedQuizDataSource);
}

function sanitizeCodeSegment(value, fallback = '') {
    if (typeof value !== 'string') {
        return fallback;
    }
    const trimmed = value.trim();
    if (!trimmed) {
        return fallback;
    }
    const normalized = trimmed.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');
    return normalized || fallback;
}

function cloneArticle(article) {
    if (!article || typeof article !== 'object') {
        return null;
    }
    try {
        return JSON.parse(JSON.stringify(article));
    } catch (error) {
        return Array.isArray(article) ? [...article] : { ...article };
    }
}

// --- Premade helpers: image, math, and question padding ---
function normalizeImagePath(src) {
    if (!src) return src;
    let s = String(src).trim();
    s = s.replace(/^frontend\//i, '');
    if (!s.startsWith('/')) s = '/' + s;
    return s;
}

function normalizeMathText(text) {
    if (typeof text !== 'string') return text;
    let t = text;
    // Strip surrounding $...$ or $$...$$ once
    t = t.replace(/^\$(.*)\$$/, '$1');
    t = t.replace(/^\$\$(.*)\$\$$/, '$1');
    // Safe macro fixes inside math
    if (window.TextSanitizer && window.TextSanitizer.fixAllMathInText) {
        t = window.TextSanitizer.fixAllMathInText(t);
    }
    // Replace \frac{a}{b} with (a/b)
    t = t.replace(/\\frac\s*\{\s*([^}]+)\s*\}\s*\{\s*([^}]+)\s*\}/g, '($1/$2)');
    return t.trim();
}

function normalizeQuestionAssets(question, subjectName) {
    if (!question || typeof question !== 'object') return question;
    // Image URL variants
    if (question.imageURL && !question.imageUrl) question.imageUrl = question.imageURL;
    if (question.imageUrl) question.imageUrl = normalizeImagePath(question.imageUrl);
    if (question.stimulusImage && typeof question.stimulusImage === 'object' && question.stimulusImage.src) {
        question.stimulusImage = {
            ...question.stimulusImage,
            src: normalizeImagePath(question.stimulusImage.src)
        };
    }
    // Math normalization for Math subject only
    if (subjectName === 'Math') {
        if (typeof question.question === 'string') question.question = normalizeMathText(question.question);
        if (typeof question.rationale === 'string') question.rationale = normalizeMathText(question.rationale);
        if (Array.isArray(question.answerOptions)) {
            question.answerOptions = question.answerOptions.map((opt) => (
                opt && typeof opt === 'object' && typeof opt.text === 'string'
                    ? { ...opt, text: normalizeMathText(opt.text) }
                    : opt
            ));
        }
    }
    return question;
}

function generateSubjectQuestion(subject, baseIndex = 1, template = {}) {
    const qn = template.questionNumber || baseIndex;
    if (subject === 'Math') {
        return {
            type: 'multiple-choice',
            difficulty: template.difficulty || 'easy',
            questionNumber: qn,
            question: `What is ${qn} + ${qn}?`,
            answerOptions: [
                { id: 'A', text: `${qn}`, isCorrect: false },
                { id: 'B', text: `${qn * 2}`, isCorrect: true },
                { id: 'C', text: `${qn + 1}`, isCorrect: false },
                { id: 'D', text: `${qn - 1}`, isCorrect: false },
            ],
            correctAnswer: 'B',
            rationale: `Adding ${qn} + ${qn} = ${qn * 2}.`,
        };
    }
    if (subject === 'Science') {
        return {
            type: 'multiple-choice',
            difficulty: template.difficulty || 'easy',
            questionNumber: qn,
            question: 'Which statement best describes a scientific observation?',
            answerOptions: [
                { id: 'A', text: 'Something you measure or notice using your senses', isCorrect: true },
                { id: 'B', text: 'A guess with no evidence', isCorrect: false },
                { id: 'C', text: 'Only something written in a textbook', isCorrect: false },
                { id: 'D', text: 'Always a math calculation', isCorrect: false },
            ],
            correctAnswer: 'A',
            rationale: 'An observation is information gathered using the senses.',
        };
    }
    if (subject === 'Social Studies') {
        return {
            type: 'multiple-choice',
            difficulty: template.difficulty || 'easy',
            questionNumber: qn,
            question: 'Why do governments create laws?',
            answerOptions: [
                { id: 'A', text: 'To maintain order and protect rights', isCorrect: true },
                { id: 'B', text: 'To make travel impossible', isCorrect: false },
                { id: 'C', text: 'To stop people from learning', isCorrect: false },
                { id: 'D', text: 'Only to collect art', isCorrect: false },
            ],
            correctAnswer: 'A',
            rationale: 'Laws help create order and protect citizens.',
        };
    }
    // RLA / default
    return {
        type: 'multiple-choice',
        difficulty: template.difficulty || 'easy',
        questionNumber: qn,
        question: 'What is the main idea of a passage?',
        answerOptions: [
            { id: 'A', text: 'The most important point the author is making', isCorrect: true },
            { id: 'B', text: 'A random detail', isCorrect: false },
            { id: 'C', text: 'The title only', isCorrect: false },
            { id: 'D', text: 'Only the last sentence', isCorrect: false },
        ],
        correctAnswer: 'A',
        rationale: 'The main idea is the central point of the passage.',
    };
}

function flushShortQuizToTwelve(quiz, subject) {
    if (!quiz || !Array.isArray(quiz.questions)) quiz.questions = [];
    const current = quiz.questions.length;
    if (current >= 12) return quiz;
    let nextNum = current + 1;
    while (quiz.questions.length < 12) {
        const generated = generateSubjectQuestion(subject, nextNum, {
            difficulty: quiz.questions[0]?.difficulty || 'easy',
        });
        generated.questionNumber = nextNum;
        quiz.questions.push(generated);
        nextNum++;
    }
    return quiz;
}

function ensureMinQuestions(quiz, subject, min = 12) {
    if (!quiz) return quiz;
    if (!Array.isArray(quiz.questions)) quiz.questions = [];
    const current = quiz.questions.length;
    // 0–4 => flush with new unique questions
    if (current < 5) {
        return flushShortQuizToTwelve(quiz, subject);
    }
    // 5–11 => pad by cloning last
    if (current > 4 && current < min) {
        const last = quiz.questions[current - 1];
        while (quiz.questions.length < min) {
            const nextNum = quiz.questions.length + 1;
            quiz.questions.push({ ...last, questionNumber: nextNum });
        }
        return quiz;
    }
    return quiz; // already >= 12
}

function assignPremadeQuizCodes(data) {
    const catalog = {};
    if (!data || typeof data !== 'object') {
        return catalog;
    }

    Object.entries(data).forEach(([subjectName, subject]) => {
        if (!subject || typeof subject !== 'object') {
            return;
        }

        const subjectSlug = sanitizeCodeSegment(subjectName, 'subject');
        if (!catalog[subjectName]) {
            catalog[subjectName] = [];
        }

        // Helper to register a quiz entry and stamp quizCode on the source object
        Object.entries(subject.categories || {}).forEach(([categoryName, category], categoryIndex) => {
            if (!category || typeof category !== 'object') {
                return;
            }

            const categorySlug = sanitizeCodeSegment(categoryName, `cat-${categoryIndex + 1}`);
            const topics = Array.isArray(category.topics) ? category.topics : [];

            topics.forEach((topic, topicIndex) => {
                if (!topic || typeof topic !== 'object') {
                    return;
                }

                const topicSlugFromId = topic.id ? sanitizeCodeSegment(topic.id) : '';
                const topicSlug = sanitizeCodeSegment(topic.title, topicSlugFromId || `topic-${topicIndex + 1}`);
                const baseSegment = topicSlugFromId || `${categorySlug}-${topicSlug}`;

                const registerQuiz = (target, code, title) => {
                    if (!code) {
                        return;
                    }
                    if (!catalog[subjectName].some((entry) => entry.code === code)) {
                        catalog[subjectName].push({ code, title });
                    }
                    if (target && typeof target === 'object') {
                        target.quizCode = code;
                    }
                };

                if (Array.isArray(topic.quizzes) && topic.quizzes.length) {
                    topic.quizzes.forEach((quiz, quizIndex) => {
                        if (!quiz || typeof quiz !== 'object') {
                            return;
                        }
                        // Ensure questions array exists, normalize assets, pad to min
                        const subjectKey = subjectName;
                        if (!Array.isArray(quiz.questions)) {
                            // Try to resolve from topic if missing; otherwise leave [] for generation
                            const resolved = resolveQuizQuestions(subjectKey, topic, quiz);
                            quiz.questions = Array.isArray(resolved) ? resolved.slice() : [];
                        }
                        // Normalize each question and enforce minimum length
                        quiz.questions = quiz.questions.map((q) => normalizeQuestionAssets(q, subjectKey));
                        ensureMinQuestions(quiz, subjectKey, 12);

                        const quizIdSegment = sanitizeCodeSegment(quiz.quizId || '', '');
                        const labelSegment = sanitizeCodeSegment(quiz.label || '', '');
                        const setSegment = quizIdSegment || labelSegment || `set-${quizIndex + 1}`;
                        const code = [subjectSlug, baseSegment || topicSlug, setSegment].filter(Boolean).join('__');
                        const quizTitle = quiz.title || `${topic.title || 'Quiz'} — ${quiz.label || `Quiz ${String.fromCharCode(65 + quizIndex)}`}`;
                        registerQuiz(quiz, code, quizTitle);
                    });
                } else if (Array.isArray(topic.questions) && topic.questions.length) {
                    // Create a single-quiz topic; normalize and ensure 12
                    const subjectKey = subjectName;
                    topic.questions = topic.questions.map((q) => normalizeQuestionAssets(q, subjectKey));
                    const pseudoQuiz = { questions: topic.questions };
                    ensureMinQuestions(pseudoQuiz, subjectKey, 12);
                    topic.questions = pseudoQuiz.questions;
                    const code = [subjectSlug, baseSegment || topicSlug || `topic-${topicIndex + 1}`].filter(Boolean).join('__');
                    const quizTitle = topic.title || `Topic ${topicIndex + 1}`;
                    registerQuiz(topic, code, quizTitle);
                }
            });

            // Some categories might have quizzes directly (without topics)
            if (Array.isArray(category.quizzes) && category.quizzes.length) {
                category.quizzes.forEach((quiz, quizIndex) => {
                    if (!quiz || typeof quiz !== 'object') return;
                    const subjectKey = subjectName;
                    if (!Array.isArray(quiz.questions)) quiz.questions = [];
                    quiz.questions = quiz.questions.map((q) => normalizeQuestionAssets(q, subjectKey));
                    ensureMinQuestions(quiz, subjectKey, 12);
                    const quizIdSegment = sanitizeCodeSegment(quiz.quizId || '', '');
                    const labelSegment = sanitizeCodeSegment(quiz.label || quiz.title || '', '');
                    const setSegment = quizIdSegment || labelSegment || `set-${quizIndex + 1}`;
                    const code = [subjectSlug, categorySlug, setSegment].filter(Boolean).join('__');
                    const quizTitle = quiz.title || `${categoryName} — ${quiz.label || `Quiz ${String.fromCharCode(65 + quizIndex)}`}`;
                    // Stamp code for potential resolution later
                    quiz.quizCode = code;
                    if (!catalog[subjectName].some((e) => e.code === code)) {
                        catalog[subjectName].push({ code, title: quizTitle });
                    }
                });
            }
        });

        // Subject-level quizzes (rare)
        if (Array.isArray(subject.quizzes) && subject.quizzes.length) {
            subject.quizzes.forEach((quiz, quizIndex) => {
                if (!quiz || typeof quiz !== 'object') return;
                const subjectKey = subjectName;
                if (!Array.isArray(quiz.questions)) quiz.questions = [];
                quiz.questions = quiz.questions.map((q) => normalizeQuestionAssets(q, subjectKey));
                ensureMinQuestions(quiz, subjectKey, 12);
                const quizIdSegment = sanitizeCodeSegment(quiz.quizId || '', '');
                const labelSegment = sanitizeCodeSegment(quiz.label || quiz.title || '', '');
                const setSegment = quizIdSegment || labelSegment || `set-${quizIndex + 1}`;
                const code = [subjectSlug, setSegment].filter(Boolean).join('__');
                const quizTitle = quiz.title || `${subjectName} — ${quiz.label || `Quiz ${String.fromCharCode(65 + quizIndex)}`}`;
                quiz.quizCode = code;
                if (!catalog[subjectName].some((e) => e.code === code)) {
                    catalog[subjectName].push({ code, title: quizTitle });
                }
            });
        }
    });

    return catalog;
}

// Defer building premade catalog until expanded data is ready
function initPremades() {
    try {
        const collect = () => {
            const sources = [];
            if (typeof window === 'undefined') return null;
            if (window.MergedExpandedQuizData) sources.push(window.MergedExpandedQuizData);
            if (window.ExpandedQuizData) sources.push(window.ExpandedQuizData);
            if (window.__ESM_ExpandedQuizData) sources.push(window.__ESM_ExpandedQuizData);
            if (window.Data && window.Data.expandedQuizData) sources.push(window.Data.expandedQuizData);
            if (!sources.length) return null;
            // shallow subject-level merge is enough as assignPremadeQuizCodes walks all branches
            const merged = sources.reduce((acc, src) => {
                Object.entries(src || {}).forEach(([k, v]) => { if (!acc[k]) acc[k] = v; });
                return acc;
            }, {});
            return merged;
        };
        const source = collect();
        PREMADE_QUIZ_CATALOG = source ? assignPremadeQuizCodes(source) : {};
        if (typeof window !== 'undefined') {
            window.PREMADE_QUIZ_CATALOG = PREMADE_QUIZ_CATALOG;
        }
        if (typeof window !== 'undefined' && window.__DEBUG_QUIZZES) {
            const summary = Object.fromEntries(Object.entries(PREMADE_QUIZ_CATALOG).map(([s, arr]) => [s, Array.isArray(arr) ? arr.length : 0]));
            console.log('[premade] subjects:', Object.keys(PREMADE_QUIZ_CATALOG));
            console.log('[premade] total quizzes:', Object.values(summary).reduce((a,b)=>a+b,0), summary);
            if (!source) console.log('[premade] ExpandedQuizData not found — using empty catalog');
        }
    } catch (err) {
        if (typeof window !== 'undefined' && window.__DEBUG_QUIZZES) {
            console.warn('Failed to build premade catalog:', err);
        }
    }
}
if (typeof window !== 'undefined') {
    window.initPremades = initPremades;
}
initPremades();

// --- QUIZ LIBRARY (clusters) ---
// Build a centralized cluster library from AppData categories to power a two-level browser.
// Structure:
//   QUIZ_LIBRARY = {
//     [subjectName]: {
//       clusters: [
//         { id, label, description, topicIds: [topicId, ...] }
//       ]
//     }
//   }
// Optional grouping configuration to merge multiple raw categories into cleaner clusters
// and/or rename clusters for a tidier quiz browser. Any categories not listed here
// will be included as their own clusters under their original names.
const QUIZ_GROUPING = {
    // Science has several closely related categories; combine two to reduce clutter.
    "Science": [
        { label: "Life Science", categories: ["Life Science"] },
        { label: "Physical, Earth & Space", categories: ["Physical Science", "Earth & Space Science"] },
        { label: "Scientific Numeracy", categories: ["Scientific Numeracy"] }
    ],
    // Math: reordered to surface Algebra first in the browser.
    "Math": [
        { label: "Algebra", categories: ["Algebraic Problem Solving"] },
        { label: "Quantitative & Data", categories: ["Quantitative Problem Solving"] },
        { label: "Geometry", categories: ["Geometry"] }
    ]
    // Note: Social Studies currently nests eras as topics within "U.S. History",
    // so category-level grouping is not needed there.
};

function buildQuizLibraryFromAppData(data) {
    const result = {};
    if (!data || typeof data !== 'object') {
        return result;
    }
    Object.entries(data).forEach(([subjectName, subject]) => {
        if (!subject || typeof subject !== 'object' || !subject.categories) {
            return;
        }
        const clusters = [];

        // If a grouping is provided for this subject, build clusters from it; otherwise fall back to 1:1 category mapping
        const groupDefs = QUIZ_GROUPING[subjectName];
        const usedCategories = new Set();

        if (Array.isArray(groupDefs) && groupDefs.length) {
            groupDefs.forEach((group, gIdx) => {
                const groupLabel = group?.label || `Cluster ${gIdx + 1}`;
                const groupCats = Array.isArray(group?.categories) ? group.categories : [];
                const topicIds = [];
                const descParts = [];

                groupCats.forEach((catName) => {
                    const cat = subject.categories[catName];
                    if (!cat || typeof cat !== 'object') return;
                    usedCategories.add(catName);
                    if (Array.isArray(cat.topics)) {
                        cat.topics.forEach((t, tIdx) => {
                            topicIds.push(t?.id || `${sanitizeCodeSegment(catName)}__topic-${tIdx + 1}`);
                        });
                    }
                    if (cat.description) descParts.push(`${catName}: ${cat.description}`);
                });

                if (topicIds.length) {
                    clusters.push({
                        id: sanitizeCodeSegment(groupLabel, `cluster-${gIdx + 1}`),
                        label: groupLabel,
                        description: descParts.join(' | '),
                        topicIds
                    });
                }
            });

            // Any remaining categories not covered by grouping get their own clusters
            const remaining = Object.entries(subject.categories)
                .filter(([name]) => !usedCategories.has(name))
                .sort((a, b) => a[0].localeCompare(b[0])); // deterministic alphabetical order
            remaining.forEach(([categoryName, category], idx) => {
                if (!category || typeof category !== 'object') return;
                const id = sanitizeCodeSegment(categoryName, `cluster-extra-${idx + 1}`);
                const topicIds = Array.isArray(category.topics)
                    ? category.topics.map((t, tIdx) => t?.id || `${id}__topic-${tIdx + 1}`)
                    : [];
                if (topicIds.length) {
                    clusters.push({
                        id,
                        label: categoryName,
                        description: category.description || '',
                        topicIds
                    });
                }
            });
        } else {
            // Default behavior: one cluster per category
            Object.entries(subject.categories).forEach(([categoryName, category], idx) => {
                if (!category || typeof category !== 'object') {
                    return;
                }
                const id = sanitizeCodeSegment(categoryName, `cluster-${idx + 1}`);
                const topicIds = Array.isArray(category.topics)
                    ? category.topics.map((t, tIdx) => t?.id || `${id}__topic-${tIdx + 1}`)
                    : [];
                clusters.push({
                    id,
                    label: categoryName,
                    description: category.description || '',
                    topicIds
                });
            });
        }
        result[subjectName] = { clusters };
    });
    return result;
}

const QUIZ_LIBRARY = buildQuizLibraryFromAppData(AppData);
if (typeof window !== 'undefined') {
    window.QUIZ_LIBRARY = QUIZ_LIBRARY;
}

// --- ICON COMPONENTS ---
const BookOpenIcon = ({ className = '' } = {}) => (
    <i className={["fas fa-book-open", className].filter(Boolean).join(' ')} aria-hidden="true"></i>
);
const GlobeIcon = ({ className = '' } = {}) => (
    <i className={["fas fa-landmark", className].filter(Boolean).join(' ')} aria-hidden="true"></i>
);
const BeakerIcon = ({ className = '' } = {}) => (
    <i className={["fas fa-flask", className].filter(Boolean).join(' ')} aria-hidden="true"></i>
);
const CalculatorIcon = ({ className = '' } = {}) => (
    <i className={["fas fa-calculator", className].filter(Boolean).join(' ')} aria-hidden="true"></i>
);
const ChartBarIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>;
const VariableIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.874 4.874l14.252 14.252m0-14.252L4.874 19.126M12 4.5v15" /></svg>;
const ShapesIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12l-9-9-9 9m18 0l-9 9-9-9" /></svg>;
const UserIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd" /></svg>;
const ArrowLeftIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>;

// --- SubjectQuizBrowser (clustered UI) ---
function SubjectQuizBrowser({ subjectName, onSelectQuiz, theme = 'light' }) {
    const isDarkMode = theme === 'dark';
    // Ensure premade catalog exists even if initial build was early/empty
    try {
        const cat = (typeof window !== 'undefined' && window.PREMADE_QUIZ_CATALOG) ? window.PREMADE_QUIZ_CATALOG : {};
        if (!cat || (typeof cat === 'object' && Object.keys(cat).length === 0)) {
            if (typeof window !== 'undefined' && typeof window.initPremades === 'function') {
                window.initPremades();
            }
        }
    } catch {}
    const library = (typeof window !== 'undefined' ? window.QUIZ_LIBRARY : QUIZ_LIBRARY) || {};
    const subjectColors = SUBJECT_COLORS[subjectName] || DEFAULT_COLOR_SCHEME;
    const clusters = library?.[subjectName]?.clusters || [];
    const [activeClusterId, setActiveClusterId] = React.useState(
        clusters.length ? clusters[0].id : null
    );
    // New: tabbed layers and filtering
    const [activeTab, setActiveTab] = React.useState('core'); // 'core' | 'levels' | 'special'
    const [filters, setFilters] = React.useState({ status: 'All', sort: 'Newest' });
    const storageKey = `quizBrowserExpanded:${sanitizeCodeSegment(subjectName)}`;
    const [expandedGroups, setExpandedGroups] = React.useState(() => {
        try {
            const raw = window.localStorage?.getItem(storageKey);
            return raw ? JSON.parse(raw) : {};
        } catch {
            return {};
        }
    });
    const persistExpanded = (next) => {
        setExpandedGroups(next);
        try { window.localStorage?.setItem(storageKey, JSON.stringify(next)); } catch {}
    };

    React.useEffect(() => {
        // Reset active cluster if subject changes
        setActiveClusterId(clusters.length ? clusters[0].id : null);
        setActiveTab('core');
        // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [subjectName]);

    // Derivers: topic access, tagging, filters, sorting
    const allTopics = React.useMemo(() => {
        const list = [];
        clusters.forEach((c) => {
            (c.topicIds || []).forEach((tid) => {
                const t = getTopicById(subjectName, tid);
                if (t) list.push({ topic: t, clusterId: c.id, clusterLabel: c.label });
            });
        });
        return list;
    }, [clusters, subjectName]);

    const deriveLevel = (t) => {
        const title = (t.title || '').toLowerCase();
        if (/basic|foundation|intro|beginners?/.test(title)) return 'Beginner';
        if (/advanced|challenge|honors/.test(title)) return 'Advanced';
        return 'Intermediate';
    };
    const hasImage = (t) => Array.isArray(t.questions) && t.questions.some((q) => q?.type === 'image');
    const isTimed = (t) => (t.config && typeof t.config.totalTime === 'number') || false;
    const hasPassage = (t) => Array.isArray(t.questions) && t.questions.some((q) => q?.type === 'text' && q?.passage);

    // minimal client-side attempt store (fallback)
    const getAttemptMeta = (topicOrQuizCode) => {
        try {
            const raw = window.localStorage?.getItem('attemptIndex');
            const idx = raw ? JSON.parse(raw) : {};
            const rec = idx[topicOrQuizCode];
            return rec || { attempts: 0, best: null, lastAt: null, status: 'Not Attempted' };
        } catch { return { attempts: 0, best: null, lastAt: null, status: 'Not Attempted' }; }
    };

    // helpers: truncation and summaries
    const truncate = (text, max = 100) => {
        if (!text) return '';
        const clean = String(text).trim();
        if (clean.length <= max) return clean;
        return clean.slice(0, Math.max(0, max - 1)).trim() + '…';
    };
    const topicOneLiner = (topic) => {
        const fromTopic = topic?.description?.trim();
        const fromQuiz = Array.isArray(topic?.quizzes) && topic.quizzes.find(q => q && q.description)?.description;
        const line = fromTopic || fromQuiz || 'A short practice set covering key concepts in this topic.';
        return truncate(line, 100);
    };
    const quizOneLiner = (quiz, topic) => {
        const line = (quiz && quiz.description) || (topic && topic.description) || 'A short practice set covering key concepts in this topic.';
        return truncate(line, 100);
    };
    const levelScore = (lvl) => lvl === 'Beginner' ? 1 : (lvl === 'Advanced' ? 3 : 2);
    const summarizeDifficulty = (items) => {
        if (!Array.isArray(items) || items.length === 0) return 'Varied';
        const avg = items.reduce((sum, it) => sum + levelScore(deriveLevel(it.topic || it)), 0) / items.length;
        if (avg < 1.5) return 'Mostly Beginner';
        if (avg < 2.5) return 'Mostly Intermediate';
        return 'Mostly Advanced';
    };
    const sectionSummaryForKey = (groupKey, title) => {
        if (groupKey.startsWith('levels-beginner')) return 'Start here to build solid foundations with approachable practice sets.';
        if (groupKey.startsWith('levels-intermediate')) return 'Strengthen your skills with mid-level problems and mixed question types.';
        if (groupKey.startsWith('levels-advanced')) return 'Challenge yourself with multi-step questions and deeper reasoning.';
        if (groupKey.startsWith('special-timed')) return 'Build test stamina with timed sets that simulate real exam pacing.';
        if (groupKey.startsWith('special-image')) return 'Practice interpreting diagrams, charts, and other visual information.';
        if (groupKey.startsWith('special-passage')) return 'Read passages closely and answer evidence-based questions effectively.';
        // Fallback for cluster/core sections
        return `Practice key concepts in ${title || 'this section'}.`;
    };

    const filterByControls = (items) => {
        const { status } = filters;
        let out = items;
        if (status !== 'All') {
            out = out.filter(({ topic }) => {
                const code = topic.quizCode || topic.id || topic.title;
                return getAttemptMeta(code).status === status;
            });
        }
        return out;
    };

    const sortItems = (items) => {
        switch (filters.sort) {
            case 'Highest Score':
                return [...items].sort((a, b) => (getAttemptMeta(b.topic.quizCode || b.topic.id || '').best ?? -1) - (getAttemptMeta(a.topic.quizCode || a.topic.id || '').best ?? -1));
            case 'Most Attempted':
                return [...items].sort((a, b) => (getAttemptMeta(b.topic.quizCode || b.topic.id || '').attempts) - (getAttemptMeta(a.topic.quizCode || a.topic.id || '').attempts));
            case 'Topic A–Z':
                return [...items].sort((a, b) => (a.topic.title || '').localeCompare(b.topic.title || ''));
            case 'Newest':
            default:
                return items; // preserve author order
        }
    };

    if (!clusters.length) {
        return (
            <div className="rounded-lg border p-4 text-sm" style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}>
                No premade clusters yet for this subject.
            </div>
        );
    }

    const active = clusters.find(c => c.id === activeClusterId) || clusters[0];

    const buttonStyle = {
        backgroundColor: subjectColors.accent || DEFAULT_COLOR_SCHEME.accent,
        color: subjectColors.accentText || '#ffffff',
        borderColor: subjectColors.border || subjectColors.accent || DEFAULT_COLOR_SCHEME.accent,
    };

    const lightCardBackground = SUBJECT_LIGHT_SURFACE_GRADIENTS[subjectName]
        || 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(148,163,184,0.12))';
    const cardTextColor = subjectColors.text || subjectColors.heroText || '#0f172a';

    const renderTopicCard = (topic, idx) => {
        if (!topic) return null;
        const quizSets = Array.isArray(topic.quizzes) ? topic.quizzes.filter((quiz) => quizHasAvailableQuestions(subjectName, topic, quiz)) : [];
        const supportsMultiple = quizSets.length > 0 && !['essay', 'simulation', 'graphing_tool'].includes(topic.type);

        const launchQuizSet = (quiz, index) => {
            if (typeof onSelectQuiz !== 'function' || !quiz) return;
            const quizLabel = quiz.label || `Quiz ${String.fromCharCode(65 + index)}`;
            const baseTitle = topic.title || 'Quiz';
            const derivedTitle = quiz.title || `${baseTitle} — ${quizLabel}`;
            const resolvedQuestions = resolveQuizQuestions(subjectName, topic, quiz).map((q, qi) => {
                if (q && typeof q === 'object') {
                    const nextNumber = q.questionNumber ?? (qi + 1);
                    return { ...q, questionNumber: nextNumber };
                }
                return q;
            });
            if (!resolvedQuestions.length) {
                alert('This quiz does not have any questions yet. Please try another set.');
                return;
            }
            const prepared = {
                ...quiz,
                id: quiz.quizId || quiz.quizCode || `${topic.id || 'topic'}__set_${index}`,
                quizCode: quiz.quizCode || `${sanitizeCodeSegment(subjectName, 'subject')}__${sanitizeCodeSegment(topic.id || topic.title || 'topic')}__set-${index + 1}`,
                title: derivedTitle,
                topicId: topic.id,
                topicTitle: topic.title || baseTitle,
                description: quiz.description || topic.description,
                type: quiz.type || topic.type || 'quiz',
                questions: resolvedQuestions,
            };
            const sourceTopic = quiz.questionSourceTopicId ? getTopicById(subjectName, quiz.questionSourceTopicId) : null;
            const articleSource = quiz.article || topic.article || (sourceTopic && sourceTopic.article);
            const articleClone = cloneArticle(articleSource);
            if (articleClone) prepared.article = articleClone;
            const resolvedImageUrl = quiz.imageUrl || topic.imageUrl || (sourceTopic && sourceTopic.imageUrl) || (articleClone && articleClone.imageUrl);
            if (!prepared.imageUrl && resolvedImageUrl) prepared.imageUrl = resolvedImageUrl;
            onSelectQuiz(prepared, subjectName);
        };

    return (
            <div
        key={topic.id || `topic_${idx}`}
                className="rounded-xl border bg-white/95 dark:bg-slate-900/80 dark:border-slate-700 p-4 flex flex-col justify-between shadow-md"
                style={isDarkMode
                    ? { borderColor: subjectColors.border || 'rgba(148,163,184,0.35)', color: subjectColors.text || '#f8fafc' }
                    : { borderColor: subjectColors.border || 'rgba(148,163,184,0.35)', backgroundColor: '#ffffff', backgroundImage: lightCardBackground, color: cardTextColor }}
            >
                <div className="fade-in">
                    <h3 className="text-lg font-bold" style={isDarkMode ? { color: subjectColors.text || '#f8fafc' } : { color: cardTextColor }}>
                        {topic.title}
                    </h3>
                    <p
                        className="mt-2"
                        title={topicOneLiner(topic)}
                        style={{
                            fontSize: '0.9rem',
                            lineHeight: 1.4,
                            opacity: 0.85,
                            fontWeight: 500,
                            color: isDarkMode ? 'var(--text-tertiary, rgba(226,232,240,0.78))' : 'var(--subtext-color, rgba(15,23,42,0.66))',
                        }}
                    >
                        {topicOneLiner(topic)}
                    </p>
                </div>
                {supportsMultiple ? (
                    <div className="mt-3 grid gap-2">
                        {quizSets.map((quiz, idx) => (
                            <button
                                key={quiz.quizId || `${topic.id || 'topic'}_quiz_${idx}`}
                                onClick={() => launchQuizSet(quiz, idx)}
                                className="w-full px-3 py-2 rounded-lg font-semibold shadow-sm transition hover:opacity-95"
                                title={quizOneLiner(quiz, topic)}
                                style={buttonStyle}
                            >
                                Start {quiz.label || `Quiz ${String.fromCharCode(65 + idx)}`}
                            </button>
                        ))}
                    </div>
                ) : (
                    <button
                        onClick={() => {
                            if (typeof onSelectQuiz !== 'function') return;
                            const articleClone = cloneArticle(topic.article);
                            const prepared = {
                                ...topic,
                                id: topic.quizCode || topic.id || sanitizeCodeSegment(topic.title || 'quiz'),
                                quizCode: topic.quizCode || `${sanitizeCodeSegment(subjectName, 'subject')}__${sanitizeCodeSegment(topic.id || topic.title || 'topic')}`,
                            };
                            if (articleClone) prepared.article = articleClone;
                            if (Array.isArray(topic.questions)) {
                                prepared.questions = topic.questions.map((q, qi) => {
                                    if (q && typeof q === 'object') {
                                        const nextNumber = q.questionNumber ?? (qi + 1);
                                        return { ...q, questionNumber: nextNumber };
                                    }
                                    return q;
                                });
                            }
                            onSelectQuiz(prepared, subjectName);
                        }}
                        className="w-full mt-3 px-3 py-2 rounded-lg font-semibold shadow-sm transition hover:opacity-95"
                        style={buttonStyle}
                    >
                        Start Quiz
                    </button>
                )}
            </div>
        );
    };

    const topicsForActive = Array.isArray(active?.topicIds)
        ? active.topicIds.map((tid) => getTopicById(subjectName, tid)).filter(Boolean)
        : [];

    // UI helpers
    const renderFilterBar = () => (
        <div className="flex flex-wrap gap-2 items-center py-2">
            <div className="flex items-center gap-1">
                <label className="text-sm opacity-80">Status</label>
                <select
                    aria-label="Filter by status"
                    className="px-2 py-1 rounded-md border text-sm"
                    value={filters.status}
                    onChange={(e) => setFilters({ ...filters, status: e.target.value })}
                >
                    {['All', 'Not Attempted', 'Completed', 'Passed'].map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
            </div>
            <div className="flex items-center gap-1 ml-auto">
                <label className="text-sm opacity-80">Sort</label>
                <select
                    aria-label="Sort topics"
                    className="px-2 py-1 rounded-md border text-sm"
                    value={filters.sort}
                    onChange={(e) => setFilters({ ...filters, sort: e.target.value })}
                >
                    {['Newest', 'Most Attempted', 'Highest Score', 'Topic A–Z'].map(opt => <option key={opt} value={opt}>{opt}</option>)}
                </select>
            </div>
        </div>
    );

    const renderCoreTab = () => {
        const topicsForActive = Array.isArray(active?.topicIds)
            ? active.topicIds.map((tid) => getTopicById(subjectName, tid)).filter(Boolean)
            : [];
        const filtered = sortItems(filterByControls(topicsForActive.map(t => ({ topic: t })))).map(x => x.topic);
        return (
            <>
                <div className="flex items-center gap-2 overflow-x-auto no-scrollbar py-1" role="tablist" aria-label="Category clusters">
                {clusters.map((cluster) => {
                    const selected = cluster.id === activeClusterId;
                    return (
                        <button
                            key={cluster.id}
                            type="button"
                            onClick={() => setActiveClusterId(cluster.id)}
                            className={`whitespace-nowrap px-3 py-1.5 rounded-full border text-sm font-semibold transition ${selected ? 'shadow' : ''}`}
                            style={selected
                                ? { backgroundColor: subjectColors.accent || '#0ea5e9', color: subjectColors.accentText || '#ffffff', borderColor: subjectColors.accent || '#0ea5e9' }
                                : { backgroundColor: isDarkMode ? 'rgba(148,163,184,0.12)' : '#ffffff', color: subjectColors.text || '#0f172a', borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}
                            aria-pressed={selected}
                        >
                            {cluster.label}
                        </button>
                    );
                })}
                </div>
                {(active?.description || active?.label) && (() => {
                    const coreInfoKey = `info:core:${subjectName}:${active?.id || 'cluster'}`;
                    const coreInfoOpen = !!expandedGroups[coreInfoKey];
                    const clusterItems = (Array.isArray(active?.topicIds) ? active.topicIds : [])
                        .map(tid => getTopicById(subjectName, tid))
                        .filter(Boolean)
                        .map(t => ({ topic: t }));
                    const clusterOverview = active?.description || sectionSummaryForKey('core-cluster', active?.label);
                    const clusterDifficulty = summarizeDifficulty(clusterItems);
                    const clusterQuizCount = clusterItems.reduce((acc, it) => {
                        const t = it.topic;
                        if (Array.isArray(t?.quizzes) && t.quizzes.length) return acc + t.quizzes.length;
                        return acc + 1;
                    }, 0);
                    return (
                        <div className="fade-in">
                            <div className="flex items-center gap-2">
                                <p
                                    style={{
                                        fontSize: '0.9rem',
                                        lineHeight: 1.4,
                                        opacity: 0.85,
                                        fontWeight: 500,
                                        color: isDarkMode ? 'var(--text-tertiary, rgba(226,232,240,0.78))' : 'var(--subtext-color, rgba(15,23,42,0.66))',
                                    }}
                                    title={clusterOverview}
                                >
                                    {clusterOverview}
                                </p>
                                <button
                                    type="button"
                                    className="text-sky-600 dark:text-sky-400 underline-offset-2 text-sm"
                                    aria-label={`Learn more about ${active?.label || 'this cluster'}`}
                                    aria-expanded={coreInfoOpen}
                                    onClick={() => {
                                        const next = { ...expandedGroups, [coreInfoKey]: !coreInfoOpen };
                                        persistExpanded(next);
                                    }}
                                >
                                    ℹ️
                                </button>
                            </div>
                            {coreInfoOpen && (
                                <div
                                    className="mt-2 rounded-lg border px-3 py-2 text-sm"
                                    style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)', background: isDarkMode ? 'rgba(15,23,42,0.35)' : 'rgba(241,245,249,0.5)' }}
                                >
                                    <p className="mb-1">{clusterOverview}</p>
                                    <p className="mb-1"><strong>Difficulty:</strong> {clusterDifficulty}</p>
                                    <p><strong>Quizzes in this section:</strong> {clusterQuizCount}</p>
                                </div>
                            )}
                        </div>
                    );
                })()}
                {renderFilterBar()}
                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {filtered.length === 0 && (
                    <div className="col-span-full text-center text-sm opacity-80 border border-dashed rounded-lg p-4" style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}>
                        No topics available yet for this cluster.
                    </div>
                    )}
                    {filtered.map((topic, idx) => renderTopicCard(topic, idx))}
                </div>
            </>
        );
    };

    const renderGroupSection = (title, items, groupKey) => {
        const key = `${activeTab}:${groupKey}`;
        const expanded = !!expandedGroups[key];
        const filtered = sortItems(filterByControls(items));
        const shown = expanded ? filtered : filtered.slice(0, 4);
        const infoKey = `info:${key}`;
        const showInfo = !!expandedGroups[infoKey];
        const overview = sectionSummaryForKey(groupKey, title);
        const difficultyBlurb = summarizeDifficulty(filtered);
        const quizCount = filtered.reduce((acc, it) => {
            const t = it.topic;
            if (Array.isArray(t?.quizzes) && t.quizzes.length) return acc + t.quizzes.length;
            return acc + 1;
        }, 0);
        return (
            <section className="rounded-xl border p-3" style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}>
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-2">
                        <h4 className="font-semibold">{title} <span className="opacity-60 text-sm">({filtered.length})</span></h4>
                        <button
                            type="button"
                            className="text-sky-600 dark:text-sky-400 underline-offset-2"
                            aria-label={`Learn more about ${title}`}
                            aria-expanded={showInfo}
                            onClick={() => {
                                const next = { ...expandedGroups, [infoKey]: !showInfo };
                                persistExpanded(next);
                            }}
                        >
                            ℹ️
                        </button>
                    </div>
                    <button
                        className="text-sm underline"
                        aria-expanded={expanded}
                        onClick={() => {
                            const next = { ...expandedGroups, [key]: !expanded };
                            persistExpanded(next);
                        }}
                    >
                        {expanded ? 'Show Less' : 'View More'}
                    </button>
                </div>
                <p
                    className="mt-1 fade-in"
                    style={{
                        fontSize: '0.9rem',
                        lineHeight: 1.4,
                        opacity: 0.85,
                        fontWeight: 500,
                        color: isDarkMode ? 'var(--text-tertiary, rgba(226,232,240,0.78))' : 'var(--subtext-color, rgba(15,23,42,0.66))',
                    }}
                    title={overview}
                >
                    {overview}
                </p>
                {showInfo && (
                    <div
                        className="mt-2 rounded-lg border px-3 py-2 text-sm"
                        style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)', background: isDarkMode ? 'rgba(15,23,42,0.35)' : 'rgba(241,245,249,0.5)' }}
                    >
                        <p className="mb-1">{overview}</p>
                        <p className="mb-1"><strong>Difficulty:</strong> {difficultyBlurb}</p>
                        <p><strong>Quizzes in this section:</strong> {quizCount}</p>
                    </div>
                )}
                <div className="mt-3 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {shown.map(({ topic }, idx) => renderTopicCard(topic, idx))}
                    {shown.length === 0 && (
                        <div className="col-span-full text-center text-sm opacity-80 border border-dashed rounded-lg p-4" style={{ borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}>
                            No topics match the current filters.
                        </div>
                    )}
                </div>
            </section>
        );
    };

    const renderLevelsTab = () => {
        const list = allTopics.map(({ topic }) => ({ topic, level: deriveLevel(topic) }));
        return (
            <>
                {renderFilterBar()}
                <div className="space-y-4">
                    {renderGroupSection('Beginner', list.filter(x => x.level === 'Beginner').map(x => ({ topic: x.topic })), 'levels-beginner')}
                    {renderGroupSection('Intermediate', list.filter(x => x.level === 'Intermediate').map(x => ({ topic: x.topic })), 'levels-intermediate')}
                    {renderGroupSection('Advanced', list.filter(x => x.level === 'Advanced').map(x => ({ topic: x.topic })), 'levels-advanced')}
                </div>
            </>
        );
    };

    const renderSpecialTab = () => {
        const list = allTopics.map(({ topic }) => ({ topic, image: hasImage(topic), timed: isTimed(topic), passage: hasPassage(topic) }));
        return (
            <>
                {renderFilterBar()}
                <div className="space-y-4">
                    {renderGroupSection('Timed Practice', list.filter(x => x.timed).map(x => ({ topic: x.topic })), 'special-timed')}
                    {renderGroupSection('Image-Based', list.filter(x => x.image).map(x => ({ topic: x.topic })), 'special-image')}
                    {renderGroupSection('Reading Passage', list.filter(x => x.passage).map(x => ({ topic: x.topic })), 'special-passage')}
                </div>
            </>
        );
    };

    // Fallback: Launch any premade by quizCode from the merged dataset
    const resolveAndLaunchByCode = (quizCode) => {
        try {
            const data = (typeof window !== 'undefined') ? (window.MergedExpandedQuizData || window.ExpandedQuizData || {}) : {};
            const subject = data?.[subjectName];
            if (!subject) throw new Error('Subject dataset not found');
            let found = null;
            // search helper
            const setIfMatch = (obj) => {
                if (found) return;
                if (!obj) return;
                if (obj.quizCode && obj.quizCode === quizCode) found = obj;
            };
            // subject-level quizzes
            if (Array.isArray(subject.quizzes)) subject.quizzes.forEach(setIfMatch);
            // categories
            const cats = subject.categories || {};
            for (const catName of Object.keys(cats)) {
                const cat = cats[catName];
                if (!cat) continue;
                if (Array.isArray(cat.quizzes)) cat.quizzes.forEach(setIfMatch);
                const topics = Array.isArray(cat.topics) ? cat.topics : [];
                for (const t of topics) {
                    if (!t) continue;
                    // topic as a direct quiz
                    setIfMatch(t);
                    // topic quiz sets
                    if (Array.isArray(t.quizzes)) t.quizzes.forEach(setIfMatch);
                }
            }
            if (!found) {
                alert('Sorry, this premade could not be resolved. Try another.');
                return;
            }
            // Build a prepared quiz similar to topic/quizStart
            const originTopic = found.topicId ? getTopicById(subjectName, found.topicId) : null;
            const baseTitle = found.title || originTopic?.title || 'Premade Quiz';
            const prepared = {
                ...found,
                id: found.quizCode || found.quizId || sanitizeCodeSegment(baseTitle),
                title: baseTitle,
                quizCode: found.quizCode || `${sanitizeCodeSegment(subjectName,'subject')}__${sanitizeCodeSegment(baseTitle)}`,
                type: found.type || originTopic?.type || 'quiz',
            };
            // Resolve questions from topic/quizzes where needed
            let questions = [];
            if (Array.isArray(found.questions) && found.questions.length) {
                questions = found.questions;
            } else if (originTopic && Array.isArray(originTopic.questions) && originTopic.questions.length) {
                questions = originTopic.questions;
            } else if (originTopic && Array.isArray(originTopic.quizzes)) {
                // pick first matching set if any
                const match = originTopic.quizzes.find(q => q.quizCode === found.quizCode || q.quizId === found.quizId) || originTopic.quizzes[0];
                if (match && Array.isArray(match.questions)) questions = match.questions;
            }
            const normalizedQuestions = (Array.isArray(questions) ? questions : []).map((q, qi) => {
                const withNum = q && typeof q === 'object' ? { ...q, questionNumber: q.questionNumber ?? (qi + 1) } : q;
                return normalizeQuestionAssets(withNum, subjectName);
            });
            prepared.questions = normalizedQuestions;
            ensureMinQuestions(prepared, subjectName, 12);
            prepared.isPremade = true;
            onSelectQuiz(prepared, subjectName);
        } catch (e) {
            console.warn('Failed to resolve premade by code', quizCode, e);
            alert('Could not start this premade quiz due to a data error.');
        }
    };

    // Catalog-backed flat listing (ensures full inventory is accessible even if clusters omit content)
    // Flat premade list removed after unification; all quizzes should appear under categories/topics

    return (
        <div className="space-y-4">
            {/* Tabs */}
            <div className="flex items-center gap-2" role="tablist" aria-label="Quiz organization tabs">
                {[
                    { id: 'core', label: 'Core Topics' },
                    { id: 'levels', label: 'Skill Levels' },
                    { id: 'special', label: 'Special Sets' }
                ].map(tab => {
                    const selected = activeTab === tab.id;
                    return (
                        <button
                            key={tab.id}
                            role="tab"
                            aria-selected={selected}
                            onClick={() => setActiveTab(tab.id)}
                            className={`px-3 py-1.5 rounded-md border text-sm font-semibold ${selected ? 'shadow' : ''}`}
                            style={selected
                                ? { backgroundColor: subjectColors.accent || '#0ea5e9', color: subjectColors.accentText || '#ffffff', borderColor: subjectColors.accent || '#0ea5e9' }
                                : { backgroundColor: isDarkMode ? 'rgba(148,163,184,0.12)' : '#ffffff', color: subjectColors.text || '#0f172a', borderColor: subjectColors.border || 'rgba(148,163,184,0.35)' }}
                        >
                            {tab.label}
                        </button>
                    );
                })}
            </div>
            {activeTab === 'core' && renderCoreTab()}
            {activeTab === 'levels' && renderLevelsTab()}
            {activeTab === 'special' && renderSpecialTab()}
        </div>
    );
}
const HomeIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>;
const SparklesIcon = () => <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.293 2.293a1 1 0 010 1.414L11 15l-4 6h12l-4-6-1.293-1.293a1 1 0 010-1.414L15 5m0 0l2.293-2.293a1 1 0 011.414 0L21 5m-6 12v4m2-2h-4" /></svg>;

// --- Helper Functions ---
const shuffleArray = (array) => {
    if (!Array.isArray(array)) {
        console.error("shuffleArray received a non-array value:", array);
        return [];
    }
    let newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
};

const VALID_FONT_SIZES = new Set(['sm', 'md', 'lg', 'xl']);
const VALID_THEMES = new Set(['light', 'dark']);
const DEFAULT_PREFERENCES = Object.freeze({ fontSize: 'md', theme: 'light' });

const DEFAULT_CHALLENGE_OPTIONS = [
    { id: 'math-1', subject: 'Math', subtopic: 'Fractions', label: 'Fractions are hard', selected: false },
    { id: 'math-2', subject: 'Math', subtopic: 'Equations', label: 'Solving multi-step equations trips me up', selected: false },
    { id: 'math-3', subject: 'Math', subtopic: 'Word Problems', label: 'Word problems take me too long', selected: false },
    { id: 'rla-1', subject: 'RLA', subtopic: 'Reading Comprehension', label: 'Understanding passages', selected: false },
    { id: 'rla-2', subject: 'RLA', subtopic: 'Writing', label: 'Organizing my extended response', selected: false },
    { id: 'rla-3', subject: 'RLA', subtopic: 'Language Conventions', label: 'Grammar and punctuation practice', selected: false },
    { id: 'science-1', subject: 'Science', subtopic: 'Data Interpretation', label: 'Reading charts and graphs', selected: false },
    { id: 'science-2', subject: 'Science', subtopic: 'Physical Science', label: 'Forces, motion, and energy', selected: false },
    { id: 'science-3', subject: 'Science', subtopic: 'Life Science', label: 'Cells and human body systems', selected: false },
    { id: 'social-1', subject: 'Social Studies', subtopic: 'Civics', label: 'Government and civics concepts', selected: false },
    { id: 'social-2', subject: 'Social Studies', subtopic: 'Geography', label: 'Interpreting maps and data', selected: false },
    { id: 'social-3', subject: 'Social Studies', subtopic: 'History', label: 'Remembering historical events', selected: false },
];

const DEFAULT_LOCAL_PROFILE = {
    profile: {
        id: 'local-user',
        name: '',
        timezone: 'America/New_York',
        reminderEnabled: true,
        fontSize: null,
        onboardingStatus: 'pending',
        onboardingComplete: false,
    },
    testPlan: [
        { subject: 'Math', testDate: '', testLocation: '', passed: false, notScheduled: false },
        { subject: 'RLA', testDate: '', testLocation: '', passed: false, notScheduled: false },
        { subject: 'Science', testDate: '', testLocation: '', passed: false, notScheduled: false },
        { subject: 'Social Studies', testDate: '', testLocation: '', passed: false, notScheduled: false },
    ],
    challengeOptions: DEFAULT_CHALLENGE_OPTIONS.map((opt) => ({ ...opt })),
    recentScoresDashboard: {},
    scores: {},
};

function cloneDefaultLocalProfile() {
    return {
        profile: { ...DEFAULT_LOCAL_PROFILE.profile },
        testPlan: DEFAULT_LOCAL_PROFILE.testPlan.map((row) => ({ ...row })),
        challengeOptions: DEFAULT_LOCAL_PROFILE.challengeOptions.map((opt) => ({ ...opt })),
        recentScoresDashboard: { ...DEFAULT_LOCAL_PROFILE.recentScoresDashboard },
        scores: { ...DEFAULT_LOCAL_PROFILE.scores },
    };
}

const normalizePreferences = (prefs = {}) => ({
    fontSize: VALID_FONT_SIZES.has(prefs.fontSize) ? prefs.fontSize : DEFAULT_PREFERENCES.fontSize,
    theme: VALID_THEMES.has(prefs.theme) ? prefs.theme : DEFAULT_PREFERENCES.theme,
});

const SUBJECT_NAMES = ['Math', 'RLA', 'Science', 'Social Studies'];

function createEmptySubjectEdits() {
    return {
        Math: { testDate: '', testLocation: '', passed: false, notScheduled: false },
        RLA: { testDate: '', testLocation: '', passed: false, notScheduled: false },
        Science: { testDate: '', testLocation: '', passed: false, notScheduled: false },
        'Social Studies': { testDate: '', testLocation: '', passed: false, notScheduled: false },
    };
}

function buildSubjectEditsFromPlan(plan) {
    const planFromServer = {};
    if (Array.isArray(plan)) {
        for (const row of plan) {
            if (!row || !row.subject) {
                continue;
            }
            planFromServer[row.subject] = {
                testDate: row.testDate || '',
                testLocation: row.testLocation || '',
                passed: !!row.passed,
                notScheduled: !!row.notScheduled,
            };
        }
    }
    const base = createEmptySubjectEdits();
    const merged = {
        ...base,
        Math: {
            ...base.Math,
            ...planFromServer.Math,
        },
        RLA: {
            ...base.RLA,
            ...planFromServer.RLA,
        },
        Science: {
            ...base.Science,
            ...planFromServer.Science,
        },
        'Social Studies': {
            ...base['Social Studies'],
            ...planFromServer['Social Studies'],
        },
    };

    for (const subject of Object.keys(planFromServer)) {
        if (!SUBJECT_NAMES.includes(subject)) {
            merged[subject] = {
                testDate: planFromServer[subject].testDate || '',
                testLocation: planFromServer[subject].testLocation || '',
                passed: !!planFromServer[subject].passed,
                notScheduled: !!planFromServer[subject].notScheduled,
            };
        }
    }

    return merged;
}

function canCompleteOnboarding(p) {
    const hasName = p?.profile?.name && p.profile.name.trim() !== '';

    const hasAnyTestProgress = Array.isArray(p?.testPlan)
        ? p.testPlan.some(
              (row) =>
                  row
                  && (row.passed
                      || row.notScheduled
                      || (row.testDate && row.testDate.trim() !== ''))
          )
        : false;

    const hasChallenges = Array.isArray(p?.challengeOptions)
        ? p.challengeOptions.some((opt) => opt && opt.selected)
        : false;

    return !!(hasName && hasAnyTestProgress && hasChallenges);
}

async function fetchJSON(url, options = {}) {
    const { headers, ...rest } = options || {};
    const finalHeaders = headers ? { ...headers } : undefined;
    const isAbsolute = typeof url === 'string' && /^(https?:)?\/\//i.test(url);
    const targetUrl = isAbsolute
        ? url
        : (typeof url === 'string' && url.startsWith('/') ? `${API_BASE_URL}${url}` : url);
    const response = await fetch(targetUrl, {
        credentials: 'include',
        ...rest,
        headers: finalHeaders,
    });

    if (!response.ok) {
        let message = `Request failed (${response.status})`;
        try {
            const text = await response.text();
            message = text || message;
        } catch (error) {
            // ignore parse failure
        }
        throw new Error(message);
    }

    const contentType = response.headers.get('content-type') || '';
    if (contentType.includes('application/json')) {
        return response.json();
    }
    return null;
}

// --- App Structure Components ---
function AppHeader({ currentUser, onLogout, onShowHome, onShowProfile, onShowSettings, onShowQuizzes, onShowProgress, activePanel, theme, onToggleTheme }) {
    const displayName = currentUser?.name || currentUser?.email || 'Learner';
    const initial = displayName ? displayName.trim().charAt(0).toUpperCase() : 'U';
    const isProfileActive = activePanel === 'profile';
    const isSettingsActive = activePanel === 'settings';
    const isDark = theme === 'dark';
    const toggleButtonStyle = isDark
        ? undefined
        : {
            background: '#ffffff',
            color: '#0f172a',
            borderColor: 'rgba(15,23,42,0.18)',
            boxShadow: '0 12px 20px -14px rgba(15,23,42,0.25)',
        };

    return (
        <header className="fixed top-0 left-0 right-0 z-40 bg-white/80 dark:bg-slate-900/70 backdrop-blur-md border-b border-slate-200 dark:border-slate-700 shadow-sm">
            <div className="max-w-6xl mx-auto flex items-center gap-4 justify-between px-4 sm:px-6 py-3">
                <div className="flex items-center gap-3">
                    <button
                        type="button"
                        onClick={onShowHome}
                        className="text-left text-base sm:text-lg font-semibold text-slate-800 dark:text-slate-100 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:focus-visible:ring-offset-slate-900 rounded-lg px-2"
                    >
                        Mr. Smith's Learning Canvas
                    </button>
                    <nav className="hidden md:flex items-center gap-4 text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300">
                        <button onClick={onShowHome} className="hover:text-sky-600 dark:hover:text-sky-400 transition" type="button">Dashboard</button>
                        <button onClick={onShowQuizzes} className="hover:text-sky-600 dark:hover:text-sky-400 transition" type="button" aria-controls="quizzes">Quizzes</button>
                        <button onClick={onShowProgress} className="hover:text-sky-600 dark:hover:text-sky-400 transition" type="button" aria-controls="progress">Progress</button>
                    </nav>
                </div>
                <div className="flex items-center gap-4">
                    <button
                        type="button"
                        onClick={onToggleTheme}
                        aria-label="Toggle color mode"
                        aria-pressed={isDark}
                        className="relative inline-flex h-10 w-10 items-center justify-center rounded-full border shadow-sm transition hover:opacity-95 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 focus-visible:ring-offset-white dark:border-slate-600 dark:bg-slate-800/80 dark:text-slate-200 dark:hover:bg-slate-700/80"
                        style={toggleButtonStyle}
                    >
                        {isDark ? (
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" role="img" aria-hidden="true">
                                <path d="M17.293 13.293A8 8 0 016.707 2.707 6 6 0 1017.293 13.293z" />
                            </svg>
                        ) : (
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 drop-shadow" viewBox="0 0 20 20" fill="currentColor" role="img" aria-hidden="true">
                                <path d="M10 3a1 1 0 011 1v1a1 1 0 11-2 0V4a1 1 0 011-1zm4.22 1.78a1 1 0 011.415 1.414l-.708.708a1 1 0 11-1.414-1.414l.707-.708zM17 9a1 1 0 110 2h-1a1 1 0 110-2h1zm-2.072 5.657a1 1 0 011.414 1.414l-.707.707a1 1 0 11-1.415-1.414l.708-.707zM11 16a1 1 0 11-2 0v-1a1 1 0 112 0v1zm-5.657-.343a1 1 0 10-1.414-1.414l-.707.707a1 1 0 001.414 1.414l.707-.707zM4 9a1 1 0 100 2H3a1 1 0 100-2h1zm2.343-3.657a1 1 0 10-1.414-1.414l-.707.707A1 1 0 105.636 6.05l.707-.707z" />
                                <path d="M10 5a5 5 0 100 10A5 5 0 0010 5z" />
                            </svg>
                        )}
                    </button>
                    {currentUser && (
                        <div className="flex items-center gap-4">
                            <div className="flex items-center gap-2">
                                {currentUser.picture ? (
                                    <img src={currentUser.picture} alt="User avatar" className="w-9 h-9 rounded-full object-cover shadow" />
                                ) : (
                                    <div className="w-9 h-9 rounded-full bg-sky-600 text-white flex items-center justify-center font-semibold shadow">
                                    {initial}
                                </div>
                            )}
                            <div className="flex flex-col leading-tight">
                                <span className="text-xs uppercase tracking-wide text-slate-500 dark:text-slate-400">Welcome</span>
                                <span className="text-sm font-semibold text-slate-700 dark:text-slate-200 truncate max-w-[10rem]">
                                    {currentUser.name || 'Learner'}
                                </span>
                            </div>
                        </div>
                        <div className="flex items-center gap-2">
                            <button
                                type="button"
                                id="btnProfile"
                                onClick={onShowProfile}
                                className={`px-3 py-2 text-xs sm:text-sm font-semibold rounded-lg border transition ${isProfileActive ? 'bg-sky-500 text-white border-transparent' : 'text-sky-700 dark:text-sky-300 border-sky-200/70 dark:border-slate-600 hover:bg-sky-50 dark:hover:bg-slate-800/70'}`}
                                aria-controls="profileView"
                                aria-expanded={isProfileActive}
                            >
                                Profile
                            </button>
                            <button
                                type="button"
                                id="btnSettings"
                                onClick={onShowSettings}
                                className={`px-3 py-2 text-xs sm:text-sm font-semibold rounded-lg border transition ${isSettingsActive ? 'bg-sky-500 text-white border-transparent' : 'text-sky-700 dark:text-sky-300 border-sky-200/70 dark:border-slate-600 hover:bg-sky-50 dark:hover:bg-slate-800/70'}`}
                                aria-controls="settingsView"
                                aria-expanded={isSettingsActive}
                            >
                                Settings
                            </button>
                            <button
                                type="button"
                                onClick={onLogout}
                                className="px-3 py-2 text-xs sm:text-sm font-semibold text-rose-600 hover:text-rose-500 dark:text-rose-300 dark:hover:text-rose-200 transition"
                            >
                                Log Out
                            </button>
                        </div>
                        </div>
                    )}
                </div>
            </div>
        </header>
    );
}

function NamePromptModal({ user, onSave, onDismiss }) {
    const [firstName, setFirstName] = useState('');
    const [lastName, setLastName] = useState('');

    useEffect(() => {
        if (user && user.name) {
            const nameParts = user.name.split(' ');
            setFirstName(nameParts[0] || '');
            setLastName(nameParts.slice(1).join(' ') || '');
        }
    }, [user]);

    const handleSave = async () => {
        if (firstName.trim() && lastName.trim()) {
            try {
                await onSave(firstName.trim(), lastName.trim());
            } catch (error) {
                console.error('Failed to save name from modal:', error);
                alert('Unable to save your name right now. Please try again.');
            }
        } else {
            alert('Please enter both a first and last name.');
        }
    };

    return (
        <div
            className="fixed inset-0 z-50 flex h-full w-full items-center justify-center"
            role="dialog"
            aria-modal="true"
            style={{ backgroundColor: 'var(--modal-overlay)' }}
        >
            <div
                className="relative w-11/12 max-w-md rounded-lg p-8 shadow-2xl"
                style={{ backgroundColor: 'var(--modal-surface)', color: 'var(--modal-text)', border: `1px solid var(--modal-border)` }}
            >
                {onDismiss && (
                    <button
                        type="button"
                        onClick={onDismiss}
                        className="absolute right-4 top-4 rounded-full focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2"
                        style={{ color: 'var(--text-secondary)' }}
                        aria-label="Close name prompt"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-5 h-5">
                            <path
                                fillRule="evenodd"
                                d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                                clipRule="evenodd"
                            />
                        </svg>
                    </button>
                )}
                <h2 className="mb-4 text-2xl font-bold" style={{ color: 'var(--text-primary)' }}>Welcome! Let's set up your name.</h2>
                <p className="mb-6" style={{ color: 'var(--text-secondary)' }}>Please confirm your name below. This will be used to personalize your experience.</p>
                <div className="space-y-4">
                    <div>
                        <label htmlFor="firstName" className="block text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>First Name</label>
                        <input
                            type="text"
                            id="firstName"
                            value={firstName}
                            onChange={(e) => setFirstName(e.target.value)}
                            className="mt-1 block w-full rounded-md px-3 py-2 shadow-sm focus:outline-none"
                            style={{
                                backgroundColor: 'var(--bg-surface)',
                                border: `1px solid var(--border-subtle)`,
                                color: 'var(--text-primary)',
                            }}
                        />
                    </div>
                    <div>
                        <label htmlFor="lastName" className="block text-sm font-medium" style={{ color: 'var(--text-secondary)' }}>Last Name</label>
                        <input
                            type="text"
                            id="lastName"
                            value={lastName}
                            onChange={(e) => setLastName(e.target.value)}
                            className="mt-1 block w-full rounded-md px-3 py-2 shadow-sm focus:outline-none"
                            style={{
                                backgroundColor: 'var(--bg-surface)',
                                border: `1px solid var(--border-subtle)`,
                                color: 'var(--text-primary)',
                            }}
                        />
                    </div>
                </div>
                <div className="mt-8 space-y-3">
                    <button
                        onClick={handleSave}
                        className="w-full rounded-lg px-6 py-3 font-bold transition"
                        data-role="primary"
                        style={{ backgroundColor: 'var(--accent)', color: 'var(--accent-text)', borderColor: 'var(--accent)' }}
                    >
                        Save Name
                    </button>
                    {onDismiss && (
                        <button
                            type="button"
                            onClick={onDismiss}
                            className="w-full rounded-lg px-6 py-3 font-semibold transition"
                            data-role="secondary"
                            style={{ color: 'var(--text-secondary)', borderColor: 'var(--border-subtle)' }}
                        >
                            Skip for now
                        </button>
                    )}
                </div>
            </div>
        </div>
    );
}

// --- Main App Component ---
function App({ externalTheme, onThemeChange }) {
    const SMITHING_PROMPTS = [
        "Heating the forge...",
        "The smith is at the anvil...",
        "Hammering out the questions...",
        "Shaping the perfect practice test...",
        "Quenching the final details...",
        "Smithing your exam now..."
    ];
    const [view, setView] = useState('start');
    const [activeQuiz, setActiveQuiz] = useState(null);
    const [quizResults, setQuizResults] = useState(null);
    const [activeGenerator, setActiveGenerator] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [loadingMessage, setLoadingMessage] = useState('');
    const [revolvingPrompt, setRevolvingPrompt] = useState('');
    const [currentUser, setCurrentUser] = useState(null);
    // Global navigation state for top-level views
    const [activeView, setActiveView] = useState('dashboard'); // 'dashboard' | 'quizzes' | 'progress' | 'profile' | 'settings'
    const [authToken, setAuthToken] = useState(() => {
        if (typeof window === 'undefined') {
            return null;
        }
        try {
            return window.localStorage ? window.localStorage.getItem('appToken') : null;
        } catch (error) {
            console.warn('Unable to restore stored auth token:', error);
            return null;
        }
    });
    const currentUserRef = useRef(null);
    const [progress, setProgress] = useState(() => createEmptyProgress());
    const [quizAttempts, setQuizAttempts] = useState([]);
    const [showFormulaSheet, setShowFormulaSheet] = useState(false);
    const [showNamePrompt, setShowNamePrompt] = useState(false);
    const [mathToolsActiveTab, setMathToolsActiveTab] = useState('graphing');
    const [vocabulary, setVocabulary] = useState(FALLBACK_VOCABULARY);
    const [showWelcomeSplash, setShowWelcomeSplash] = useState(false);
    const [welcomeName, setWelcomeName] = useState('');
    const [welcomeFading, setWelcomeFading] = useState(false);
    const welcomeTimeoutRef = useRef(null);
    const welcomeFadeTimeoutRef = useRef(null);
    const presenceIntervalRef = useRef(null);
    const lastAttemptsFetchRef = useRef(0);
    const pendingAttemptsFetchRef = useRef(null);
    const [pendingScrollTarget, setPendingScrollTarget] = useState(null);

    useEffect(() => {
        currentUserRef.current = currentUser;
    }, [currentUser]);

    const sendPresencePing = useCallback(async () => {
        try {
            await fetch(`${API_BASE_URL}/presence/ping`, {
                method: 'POST',
                credentials: 'include',
                headers: { 'Content-Type': 'application/json' }
            });
        } catch (err) {
            console.warn('presence ping failed:', err);
        }
    }, []);

    useEffect(() => {
        if (typeof window === 'undefined') {
            return undefined;
        }

        if (!currentUser) {
            if (presenceIntervalRef.current) {
                clearInterval(presenceIntervalRef.current);
                presenceIntervalRef.current = null;
            }
            return undefined;
        }

        const handleBeforeUnload = () => {
            if (presenceIntervalRef.current) {
                clearInterval(presenceIntervalRef.current);
                presenceIntervalRef.current = null;
            }

            if (typeof navigator !== 'undefined' && navigator.sendBeacon) {
                try {
                    const blob = new Blob([], { type: 'application/json' });
                    navigator.sendBeacon(`${API_BASE_URL}/presence/ping`, blob);
                } catch (err) {
                    console.warn('presence beacon failed:', err);
                }
            } else {
                sendPresencePing();
            }
        };

        sendPresencePing();

    presenceIntervalRef.current = window.setInterval(sendPresencePing, 60000);

        window.addEventListener('beforeunload', handleBeforeUnload);

        return () => {
            window.removeEventListener('beforeunload', handleBeforeUnload);
            if (presenceIntervalRef.current) {
                clearInterval(presenceIntervalRef.current);
                presenceIntervalRef.current = null;
            }
        };
    }, [currentUser, sendPresencePing]);

    useEffect(() => {
        let isMounted = true;
        (async () => {
            try {
                const response = await fetch('data/vocabulary.json', { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error(`Request failed with status ${response.status}`);
                }
                const data = await response.json();
                if (!isMounted) return;
                setVocabulary(mergeVocabularyData(FALLBACK_VOCABULARY, data));
            } catch (err) {
                console.warn('Unable to load vocabulary data:', err);
            }
        })();
        return () => {
            isMounted = false;
        };
    }, []);
    const [mathToolsInitialized, setMathToolsInitialized] = useState(false);

    useEffect(() => {
        return () => {
            if (welcomeTimeoutRef.current) {
                clearTimeout(welcomeTimeoutRef.current);
            }
            if (welcomeFadeTimeoutRef.current) {
                clearTimeout(welcomeFadeTimeoutRef.current);
            }
        };
    }, []);

    const hasLocalPrefsRef = useRef(false);
    const pendingThemeSyncRef = useRef(null);
    const [preferences, setPreferences] = useState(() => {
        const resolveInitialTheme = (baseTheme) => {
            if (VALID_THEMES.has(externalTheme)) {
                return externalTheme;
            }
            return baseTheme;
        };
        if (typeof window === 'undefined') {
            return { ...DEFAULT_PREFERENCES, theme: resolveInitialTheme(DEFAULT_PREFERENCES.theme) };
        }
        try {
            const stored = window.localStorage.getItem('prefs');
            if (stored) {
                const parsed = JSON.parse(stored);
                hasLocalPrefsRef.current = true;
                const normalized = normalizePreferences(parsed);
                return { ...normalized, theme: resolveInitialTheme(normalized.theme) };
            }
        } catch (error) {
            console.warn('Failed to restore saved preferences:', error);
        }
        const prefersDark = typeof window.matchMedia === 'function'
            ? window.matchMedia('(prefers-color-scheme: dark)').matches
            : false;
        if (prefersDark) {
            const normalized = normalizePreferences({ ...DEFAULT_PREFERENCES, theme: 'dark' });
            return { ...normalized, theme: resolveInitialTheme(normalized.theme) };
        }
        return { ...DEFAULT_PREFERENCES, theme: resolveInitialTheme(DEFAULT_PREFERENCES.theme) };
    });
    const [localProfile, setLocalProfile] = useState(() => {
        if (typeof window === 'undefined') {
            return cloneDefaultLocalProfile();
        }
        try {
            const saved = window.localStorage.getItem('ged_local_profile');
            if (saved) {
                const parsed = JSON.parse(saved);
                return {
                    ...cloneDefaultLocalProfile(),
                    ...parsed,
                    profile: { ...DEFAULT_LOCAL_PROFILE.profile, ...(parsed.profile || {}) },
                    testPlan: Array.isArray(parsed.testPlan)
                        ? parsed.testPlan.map((row) => ({
                            subject: row?.subject || '',
                            testDate: row?.testDate || '',
                            testLocation: row?.testLocation || '',
                            passed: !!row?.passed,
                            notScheduled: !!row?.notScheduled,
                        }))
                        : DEFAULT_LOCAL_PROFILE.testPlan.map((row) => ({ ...row })),
                    challengeOptions: Array.isArray(parsed.challengeOptions)
                        ? parsed.challengeOptions.map((opt, index) => ({
                            ...opt,
                            id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                            selected: !!opt?.selected,
                        }))
                        : DEFAULT_LOCAL_PROFILE.challengeOptions.map((opt) => ({ ...opt })),
                    recentScoresDashboard:
                        parsed.recentScoresDashboard && typeof parsed.recentScoresDashboard === 'object'
                            ? parsed.recentScoresDashboard
                            : {},
                    scores: parsed.scores && typeof parsed.scores === 'object' ? parsed.scores : {},
                };
            }
        } catch (error) {
            console.warn('Failed to restore local profile:', error);
        }
        return cloneDefaultLocalProfile();
    });
    const [profileLoading, setProfileLoading] = useState(false);
    const [profileError, setProfileError] = useState(null);
    const [subjectEdits, setSubjectEdits] = useState(() => buildSubjectEditsFromPlan(DEFAULT_LOCAL_PROFILE.testPlan));
    const [nameDraft, setNameDraft] = useState('');
    const [nameStatus, setNameStatus] = useState('');
    const [nameSaving, setNameSaving] = useState(false);
    const [settingsStatus, setSettingsStatus] = useState('');
    const [settingsSaving, setSettingsSaving] = useState(false);
    const [onboardingComplete, setOnboardingComplete] = useState(() => !!DEFAULT_LOCAL_PROFILE.profile.onboardingComplete);
    const [testSaving, setTestSaving] = useState(null);
    const [challengesSaving, setChallengesSaving] = useState(false);
    const [finishingOnboarding, setFinishingOnboarding] = useState(false);
    const [savingAll, setSavingAll] = useState(false);

    useEffect(() => {
        if (typeof window === 'undefined') {
            return;
        }
        try {
            window.localStorage.setItem('ged_local_profile', JSON.stringify(localProfile));
        } catch (error) {
            console.warn('Unable to persist local profile:', error);
        }
    }, [localProfile]);

    useEffect(() => {
        setSubjectEdits(buildSubjectEditsFromPlan(localProfile?.testPlan));
    }, [localProfile?.testPlan]);

    useEffect(() => {
        setNameDraft(localProfile?.profile?.name || '');
    }, [localProfile?.profile?.name]);

    useEffect(() => {
        const status = localProfile?.profile?.onboardingStatus;
        const legacyFlag = !!localProfile?.profile?.onboardingComplete;
        const flag = status === 'complete' || legacyFlag;
        setOnboardingComplete(flag);
        if (typeof window !== 'undefined') {
            window._onboardingComplete = flag;
        }
    }, [localProfile?.profile?.onboardingStatus, localProfile?.profile?.onboardingComplete]);

    const profileData = localProfile;
    // Normalize a single-profile test date if provided by backend/frontend
    const profileTestDate = (profileData?.profile?.test_date
        || profileData?.profile?.exam_date
        || profileData?.profile?.testDate
        || null);

    useEffect(() => {
        if (typeof document === 'undefined') {
            return;
        }
        const root = document.documentElement;
        const sizeClasses = ['fs-sm', 'fs-md', 'fs-lg', 'fs-xl'];
        sizeClasses.forEach((cls) => root.classList.remove(cls));
        root.classList.add(`fs-${preferences.fontSize}`);
        try {
            window.localStorage.setItem('prefs', JSON.stringify({
                fontSize: preferences.fontSize,
                theme: preferences.theme,
            }));
        } catch (error) {
            console.warn('Unable to persist preferences locally:', error);
        }
    }, [preferences.fontSize, preferences.theme]);

    const openMathTools = useCallback((tab = 'graphing') => {
        setMathToolsActiveTab(tab);
        setMathToolsInitialized(true);
        setView('mathTools');
    }, [setView]);

    const handleSaveAllProfile = useCallback(async () => {
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        if (!token) {
            alert('You must be signed in to save your profile.');
            return;
        }

        // Compose testPlan from subjectEdits, but only include rows with some data set
        const testPlanPayload = Object.entries(subjectEdits || {})
            .map(([subject, fields]) => ({ subject, ...(fields || {}) }))
            .filter((row) => row && row.subject && (row.passed || row.notScheduled || (row.testDate && row.testDate.trim() !== '') || (row.testLocation && row.testLocation.trim() !== '')))
            .map((row) => ({
                subject: row.subject,
                testDate: typeof row.testDate === 'string' ? row.testDate.trim() : '',
                testLocation: typeof row.testLocation === 'string' ? row.testLocation.trim() : '',
                passed: !!row.passed,
                notScheduled: !!row.notScheduled,
            }));

        const selectedIds = Array.isArray(localProfile?.challengeOptions)
            ? localProfile.challengeOptions.filter((c) => c && c.selected && c.id).map((c) => c.id)
            : [];

        const payload = {
            // Only include name if non-empty
            ...(nameDraft && nameDraft.trim() ? { name: nameDraft.trim() } : {}),
            preferences: { fontSize: preferences.fontSize, theme: preferences.theme },
            ...(testPlanPayload.length ? { testPlan: testPlanPayload } : {}),
            challenges: { selectedIds },
        };

        setSavingAll(true);
        try {
            const bundle = await fetchJSON(`${API_BASE_URL}/api/profile`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                body: JSON.stringify(payload),
            });
            if (bundle && typeof bundle === 'object') {
                // Merge bundle into local state
                const serverTestPlan = Array.isArray(bundle.testPlan) ? bundle.testPlan.map((row) => ({
                    subject: row?.subject || '',
                    testDate: row?.testDate || '',
                    testLocation: row?.testLocation || '',
                    passed: !!row?.passed,
                    notScheduled: !!row?.notScheduled,
                })) : [];
                const serverChallenges = Array.isArray(bundle.challengeOptions) ? bundle.challengeOptions.map((opt, index) => ({
                    id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                    subject: opt?.subject || '',
                    subtopic: opt?.subtopic || '',
                    label: opt?.label || '',
                    selected: !!opt?.selected,
                })) : [];
                setLocalProfile((prev) => ({
                    ...prev,
                    profile: {
                        ...prev.profile,
                        name: bundle?.profile?.name ?? prev.profile.name,
                        onboardingComplete: !!bundle?.profile?.onboardingComplete,
                    },
                    testPlan: serverTestPlan.length ? serverTestPlan : (prev.testPlan || []),
                    challengeOptions: serverChallenges.length ? serverChallenges : (prev.challengeOptions || []),
                    recentScoresDashboard: bundle?.recentScores && typeof bundle.recentScores === 'object' ? bundle.recentScores : (prev.recentScoresDashboard || {}),
                }));
                // Update UI name and prefs from saved
                if (bundle?.profile?.name) {
                    setCurrentUser((prev) => prev ? { ...prev, name: bundle.profile.name } : prev);
                    setNameDraft(bundle.profile.name);
                }
                const srvFont = bundle?.profile?.fontSize;
                const srvTheme = bundle?.profile?.theme;
                const prefUpdates = {};
                if (srvFont && VALID_FONT_SIZES.has(srvFont)) prefUpdates.fontSize = srvFont;
                if (srvTheme && VALID_THEMES.has(srvTheme)) prefUpdates.theme = srvTheme === 'system' ? preferences.theme : srvTheme;
                if (Object.keys(prefUpdates).length) {
                    setPreferences((prev) => ({ ...prev, ...prefUpdates }));
                }
                alert('Profile saved.');
            }
        } catch (err) {
            console.error('Failed to save full profile:', err);
            alert('Unable to save profile right now. Please try again.');
        } finally {
            setSavingAll(false);
        }
    }, [authToken, nameDraft, preferences.fontSize, preferences.theme, subjectEdits, localProfile?.challengeOptions]);

    // Centralized navigation handlers
    const goToDashboard = useCallback(() => {
        setActiveView('dashboard');
        setPendingScrollTarget('__top');
        setView('start');
    }, []);

    const goToQuizzes = useCallback(() => {
        setActiveView('quizzes');
        setPendingScrollTarget('quizzes');
        setView('start');
    }, []);

    const goToProgress = useCallback(() => {
        setActiveView('progress');
        setPendingScrollTarget('progress');
        setView('start');
    }, []);

    const goToProfile = useCallback(() => {
        setActiveView('profile');
        setView('start');
    }, []);

    const goToSettings = useCallback(() => {
        setActiveView('settings');
        setView('start');
        if (!profileData) {
            loadProfileOnce();
        }
    }, [loadProfileOnce, profileData]);

    // Navigate to a dashboard section (e.g., #quizzes or #progress) from anywhere
    const navigateToSection = useCallback((targetId) => {
        const id = typeof targetId === 'string' ? targetId.replace(/^#/, '') : '';
        if (!id) return;
        if (view !== 'start') {
            setPendingScrollTarget(id);
            setView('start');
            return;
        }
        const el = typeof document !== 'undefined' ? document.getElementById(id) : null;
        if (el && typeof el.scrollIntoView === 'function') {
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        if (typeof window !== 'undefined') {
            window.location.hash = id;
        }
    }, [view]);

    // After switching to the dashboard, perform the pending scroll once content is painted
    useEffect(() => {
        if (view !== 'start' || !pendingScrollTarget) return;
        const id = pendingScrollTarget;
        const rAF = typeof window !== 'undefined' && window.requestAnimationFrame
            ? window.requestAnimationFrame
            : (fn) => setTimeout(fn, 0);
        rAF(() => {
            if (id === '__top') {
                if (typeof window !== 'undefined' && typeof window.scrollTo === 'function') {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            } else {
                const el = typeof document !== 'undefined' ? document.getElementById(id) : null;
                if (el && typeof el.scrollIntoView === 'function') {
                    el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
                if (typeof window !== 'undefined') {
                    window.location.hash = id;
                }
            }
            setPendingScrollTarget(null);
        });
    }, [view, pendingScrollTarget]);

    // Optional: handle direct hash navigation (e.g., external links to #quizzes or #progress)
    useEffect(() => {
        const handleHashNavigate = () => {
            if (typeof window === 'undefined') return;
            const raw = window.location.hash || '';
            const id = raw.replace(/^#/, '');
            if (id === 'quizzes' || id === 'progress') {
                if (view !== 'start') {
                    setPendingScrollTarget(id);
                    setView('start');
                } else {
                    const el = document.getElementById(id);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        };
        if (typeof window !== 'undefined') {
            window.addEventListener('hashchange', handleHashNavigate);
            handleHashNavigate();
            return () => window.removeEventListener('hashchange', handleHashNavigate);
        }
    }, [view]);

    const recalcProgress = useCallback((attemptList) => {
        setProgress(buildProgressFromAttempts(attemptList));
    }, []);

    const applyPreferenceUpdate = useCallback((partialPrefs, options = {}) => {
        setPreferences((prev) => {
            const merged = normalizePreferences({ ...prev, ...partialPrefs });
            if (
                options.markLocal
                && partialPrefs
                && Object.prototype.hasOwnProperty.call(partialPrefs, 'theme')
                && merged.theme !== prev.theme
            ) {
                pendingThemeSyncRef.current = merged.theme;
            }
            return merged;
        });
        if (options.markLocal) {
            hasLocalPrefsRef.current = true;
        }
    }, []);

    useEffect(() => {
        if (!VALID_THEMES.has(externalTheme)) {
            return;
        }
        if (preferences.theme !== externalTheme) {
            applyPreferenceUpdate({ theme: externalTheme });
        }
    }, [externalTheme, preferences.theme, applyPreferenceUpdate]);

    useEffect(() => {
        if (preferences.theme === externalTheme) {
            pendingThemeSyncRef.current = null;
            return;
        }
        if (typeof onThemeChange !== 'function') {
            pendingThemeSyncRef.current = null;
            return;
        }
        if (!VALID_THEMES.has(preferences.theme)) {
            pendingThemeSyncRef.current = null;
            return;
        }
        if (pendingThemeSyncRef.current !== preferences.theme) {
            return;
        }
        onThemeChange(preferences.theme);
        pendingThemeSyncRef.current = null;
    }, [onThemeChange, preferences.theme, externalTheme]);

    const handleSettingsInstantChange = useCallback((partialPrefs) => {
        setSettingsStatus('');
        applyPreferenceUpdate(partialPrefs, { markLocal: true });
    }, [applyPreferenceUpdate]);

    const toggleThemePreference = useCallback(() => {
        const nextTheme = preferences.theme === 'dark' ? 'light' : 'dark';
        applyPreferenceUpdate({ theme: nextTheme }, { markLocal: true });
    }, [applyPreferenceUpdate, preferences.theme]);

    const handlePersistPreferences = useCallback(async ({ fontSize = preferences.fontSize, theme = preferences.theme }) => {
        const nextPrefs = normalizePreferences({ fontSize, theme });
        applyPreferenceUpdate(nextPrefs, { markLocal: true });
        setSettingsSaving(true);
        setSettingsStatus('');
        try {
            const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
            const response = await fetchJSON('/api/profile/preferences', {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json', ...(token ? { Authorization: `Bearer ${token}` } : {}) },
                body: JSON.stringify(nextPrefs),
            });
            if (response) {
                const updatedFontSize = typeof response === 'object' && response !== null ? response.fontSize : undefined;
                const updatedTheme = typeof response === 'object' && response !== null ? response.theme : undefined;
                const persistedUpdates = {};
                if (updatedFontSize && VALID_FONT_SIZES.has(updatedFontSize)) {
                    persistedUpdates.fontSize = updatedFontSize;
                }
                if (updatedTheme && VALID_THEMES.has(updatedTheme)) {
                    persistedUpdates.theme = updatedTheme;
                }
                if (Object.keys(persistedUpdates).length > 0) {
                    applyPreferenceUpdate(persistedUpdates);
                }
            }
            setSettingsStatus('Settings saved.');
        } catch (error) {
            console.warn('Failed to persist preferences:', error);
            setSettingsStatus('Settings saved locally. We will sync when the server is available.');
        } finally {
            setSettingsSaving(false);
        }
    }, [applyPreferenceUpdate, preferences.fontSize, preferences.theme, authToken]);
    const saveDisplayName = useCallback((fullName) => {
        const trimmed = String(fullName || '').trim();
        if (!trimmed) {
            return '';
        }

        let profileId = 'local-user';
        setLocalProfile((prev) => {
            profileId = prev?.profile?.id || profileId;
            return {
                ...prev,
                profile: {
                    ...prev.profile,
                    name: trimmed,
                },
            };
        });

        setCurrentUser((prev) => {
            if (!prev) {
                return prev;
            }
            const updated = { ...prev, name: trimmed };
            try {
                if (typeof window !== 'undefined' && window.localStorage) {
                    window.localStorage.setItem('appUser', JSON.stringify(updated));
                }
            } catch (error) {
                console.warn('Unable to persist updated name locally:', error);
            }
            return updated;
        });

        try {
            if (typeof window !== 'undefined' && window.localStorage) {
                window.localStorage.setItem(`customNameSet_${profileId}`, 'true');
            }
        } catch (error) {
            console.warn('Unable to mark custom name locally:', error);
        }

        alert('Name saved locally.');
        return trimmed;
    }, []);

    // Helper: normalize nextUpcomingTest from server
    const normalizeNextUpcoming = (raw) => {
        if (!raw || typeof raw !== 'object') return null;
        const subject = raw.subject || '';
        const testDate = raw.testDate || '';
        const daysUntil = (typeof raw.daysUntil === 'number' && Number.isFinite(raw.daysUntil)) ? raw.daysUntil : null;
        if (!subject || !testDate) return null;
        return { subject, testDate, daysUntil };
    };

    const loadProfileOnce = useCallback(async () => {
        setProfileLoading(true);
        setProfileError(null);
        const token = (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null) || authToken || null;
        if (!token) {
            setProfileLoading(false);
            return null;
        }
        try {
            const bundle = await fetchJSON(`${API_BASE_URL}/api/profile/me`, {
                headers: { Authorization: `Bearer ${token}` }
            });
            if (bundle && typeof bundle === 'object') {
                // Apply server preferences to UI state (not stored inside localProfile)
                const srvFont = bundle?.profile?.fontSize;
                const srvTheme = bundle?.profile?.theme;
                const prefUpdates = {};
                if (srvFont && VALID_FONT_SIZES.has(srvFont)) prefUpdates.fontSize = srvFont;
                if (srvTheme && VALID_THEMES.has(srvTheme) && srvTheme !== 'system') {
                    prefUpdates.theme = srvTheme;
                }
                if (Object.keys(prefUpdates).length) {
                    setPreferences((prev) => ({ ...prev, ...prefUpdates }));
                }

                // Normalize to localProfile shape
                const coerceIso = (str) => {
                    if (!str || typeof str !== 'string') return '';
                    const s = str.trim();
                    // Accept YYYY-MM-DD
                    if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return s;
                    // Accept MM/DD/YYYY
                    const m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
                    if (m) {
                        const mm = String(m[1]).padStart(2, '0');
                        const dd = String(m[2]).padStart(2, '0');
                        const yyyy = m[3];
                        return `${yyyy}-${mm}-${dd}`;
                    }
                    return '';
                };
                const arrayFromPlan = (planArr) => Array.isArray(planArr) ? planArr.map((row) => ({
                    subject: row?.subject || '',
                    testDate: coerceIso(row?.testDate || row?.date),
                    testLocation: row?.testLocation || row?.location || '',
                    passed: !!(row?.passed ?? row?.isPassed),
                    notScheduled: !!(row?.notScheduled ?? row?.not_scheduled),
                })) : [];
                let serverTestPlan = arrayFromPlan(bundle.testPlan);
                // Fallback: server might return profile.tests keyed by subject codes
                if ((!serverTestPlan || serverTestPlan.length === 0) && bundle?.profile && bundle.profile.tests && typeof bundle.profile.tests === 'object') {
                    const tests = bundle.profile.tests;
                    const labelMap = {
                        math: 'Math',
                        rla: 'Reasoning Through Language Arts (RLA)',
                        science: 'Science',
                        social_studies: 'Social Studies',
                    };
                    serverTestPlan = Object.entries(tests).map(([key, val]) => ({
                        subject: labelMap[key] || key,
                        testDate: coerceIso(val?.testDate || val?.date),
                        testLocation: val?.testLocation || val?.location || '',
                        passed: !!(val?.passed ?? val?.isPassed),
                        notScheduled: !!(val?.notScheduled ?? val?.not_scheduled),
                    }));
                }
                const serverChallenges = Array.isArray(bundle.challengeOptions) ? bundle.challengeOptions.map((opt, index) => ({
                    id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                    subject: opt?.subject || '',
                    subtopic: opt?.subtopic || '',
                    label: opt?.label || '',
                    selected: !!opt?.selected,
                })) : [];
                setLocalProfile((prev) => ({
                    ...prev,
                    profile: {
                        ...prev.profile,
                        name: bundle?.profile?.name || prev.profile.name || '',
                        timezone: bundle?.profile?.timezone || prev.profile.timezone,
                        reminderEnabled: typeof bundle?.profile?.reminderEnabled === 'boolean' ? bundle.profile.reminderEnabled : prev.profile.reminderEnabled,
                        onboardingComplete: !!bundle?.profile?.onboardingComplete,
                    },
                    testPlan: serverTestPlan,
                    nextUpcomingTest: normalizeNextUpcoming(bundle?.nextUpcomingTest),
                    challengeOptions: serverChallenges,
                    recentScoresDashboard: bundle?.recentScores && typeof bundle.recentScores === 'object' ? bundle.recentScores : (prev.recentScoresDashboard || {}),
                }));
            }
            setProfileLoading(false);
            return bundle;
        } catch (error) {
            console.warn('Failed to load profile from server, using local profile:', error?.message || error);
            setProfileError('Unable to load latest profile. Working from local data.');
            setProfileLoading(false);
            return null;
        }
    }, []);

    useEffect(() => {
        if (currentUser?.name && !localProfile?.profile?.name) {
            setNameDraft(currentUser.name);
        }
    }, [currentUser?.name, localProfile?.profile?.name]);

    useEffect(() => {
        if (!currentUser) {
            return;
        }
        // Allow normal access while onboarding is pending; only redirect if explicitly required
        const status = localProfile?.profile?.onboardingStatus;
        if (status === 'required') {
            setView('profile');
        }
    }, [currentUser, localProfile?.profile?.onboardingStatus]);

    const currentUserId = currentUser?.id ?? null;

    useEffect(() => {
        if (!currentUserId) {
            return;
        }
        loadProfileOnce();
    }, [currentUserId]);

    // Optional gentle polling every 60s to keep dashboard fresh without spamming
    useEffect(() => {
        let stopped = false;
        const id = setInterval(() => {
            if (!stopped) {
                loadProfileOnce();
            }
        }, 60000);
        return () => {
            stopped = true;
            clearInterval(id);
        };
    }, []);

    const handleNameDraftChange = useCallback((value) => {
        setNameDraft(value);
        setNameStatus('');
    }, []);

    const handleProfileNameSubmit = useCallback(async (event) => {
        event.preventDefault();
        const trimmed = nameDraft.trim();
        if (!trimmed) {
            setNameStatus('Please enter a display name.');
            return;
        }
        setNameSaving(true);
        setNameStatus('');
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        if (token) {
            try {
                const resp = await fetchJSON(`${API_BASE_URL}/api/profile/name`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({ name: trimmed }),
                });
                const newName = resp?.name || trimmed;
                setLocalProfile((prev) => ({ ...prev, profile: { ...prev.profile, name: newName } }));
                setCurrentUser((prev) => prev ? { ...prev, name: newName } : prev);
                setNameDraft(newName);
                setNameStatus('Name saved.');
                setNameSaving(false);
                return;
            } catch (err) {
                console.warn('Server name save failed; falling back to local:', err);
            }
        }
        const saved = saveDisplayName(trimmed);
        if (saved) {
            setNameStatus('Name saved locally.');
            setNameDraft(saved);
        } else {
            setNameStatus('Please enter a display name.');
        }
        setNameSaving(false);
    }, [nameDraft, saveDisplayName, authToken]);

    const handleProfileRefresh = useCallback(async () => {
        await loadProfileOnce();
        setNameStatus('Profile refreshed.');
        setSubjectEdits(buildSubjectEditsFromPlan(localProfile?.testPlan));
    }, [loadProfileOnce, localProfile?.testPlan]);

    const handleSubjectFieldChange = useCallback((subject, field, value) => {
        if (!subject) {
            return;
        }
        setSubjectEdits((prev) => {
            const existing = prev?.[subject] || {
                testDate: '',
                testLocation: '',
                passed: false,
                notScheduled: false,
            };
            const next = { ...existing };

            if (field === 'passed') {
                const checked = !!value;
                next.passed = checked;
                if (checked) {
                    next.notScheduled = false;
                    next.testDate = '';
                }
            } else if (field === 'testDate') {
                const inputValue = typeof value === 'string' ? value : '';
                next.testDate = inputValue;
                if (inputValue) {
                    next.notScheduled = false;
                }
            } else if (field === 'notScheduled') {
                const flagged = !!value;
                next.notScheduled = flagged;
                if (flagged) {
                    next.testDate = '';
                    next.passed = false;
                }
            } else {
                next[field] = value;
            }

            return {
                ...prev,
                [subject]: next,
            };
        });
    }, []);

    const handleSaveSubject = useCallback(async (subject) => {
        const trimmedSubject = subject ? String(subject).trim() : '';
        if (!trimmedSubject) {
            window.alert('Missing subject.');
            return;
        }

        const edits = subjectEdits[trimmedSubject] || {
            testDate: '',
            testLocation: '',
            passed: false,
            notScheduled: false,
        };
        const normalizedNotScheduled = !!edits.notScheduled;
        const normalizedDate = normalizedNotScheduled
            ? ''
            : typeof edits.testDate === 'string'
                ? edits.testDate.trim()
                : '';
        const normalizedLocation = typeof edits.testLocation === 'string' ? edits.testLocation.trim() : '';
        const normalizedPassed = normalizedNotScheduled ? false : !!edits.passed;

        setTestSaving(trimmedSubject);
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        if (token) {
            try {
                const bundle = await fetchJSON(`${API_BASE_URL}/api/profile/test`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({
                        subject: trimmedSubject,
                        testDate: normalizedDate,
                        testLocation: normalizedLocation,
                        passed: normalizedPassed,
                        notScheduled: normalizedNotScheduled,
                    }),
                });
                if (bundle && typeof bundle === 'object') {
                    // merge from server
                    setLocalProfile((prev) => ({
                        ...prev,
                        profile: {
                            ...prev.profile,
                            name: bundle?.profile?.name ?? prev.profile.name,
                            onboardingComplete: !!bundle?.profile?.onboardingComplete,
                        },
                        testPlan: Array.isArray(bundle.testPlan) ? bundle.testPlan.map((row) => ({
                            subject: row?.subject || '',
                            testDate: row?.testDate || '',
                            testLocation: row?.testLocation || '',
                            passed: !!row?.passed,
                            notScheduled: !!row?.notScheduled,
                        })) : prev.testPlan,
                        nextUpcomingTest: normalizeNextUpcoming(bundle?.nextUpcomingTest),
                        challengeOptions: Array.isArray(bundle.challengeOptions) ? bundle.challengeOptions.map((opt, index) => ({
                            id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                            subject: opt?.subject || '',
                            subtopic: opt?.subtopic || '',
                            label: opt?.label || '',
                            selected: !!opt?.selected,
                        })) : (prev.challengeOptions || []),
                        recentScoresDashboard: bundle?.recentScores && typeof bundle.recentScores === 'object' ? bundle.recentScores : (prev.recentScoresDashboard || {}),
                    }));
                    setTestSaving(null);
                    // Re-fetch to ensure freshest computed fields (e.g., nextUpcoming)
                    try { await loadProfileOnce(); } catch (_) {}
                    window.alert('Saved.');
                    return;
                }
            } catch (err) {
                console.warn('Server test plan save failed; falling back to local:', err);
            }
        }
        // Fallback: save locally
        setLocalProfile((prev) => {
            const existingPlan = Array.isArray(prev.testPlan) ? prev.testPlan : [];
            let updated = false;
            const updatedPlan = existingPlan.map((row) => {
                if (row && row.subject === trimmedSubject) {
                    updated = true;
                    return {
                        ...row,
                        testDate: normalizedDate,
                        testLocation: normalizedLocation,
                        passed: normalizedPassed,
                        notScheduled: normalizedNotScheduled,
                    };
                }
                return row;
            });
            if (!updated) {
                updatedPlan.push({
                    subject: trimmedSubject,
                    testDate: normalizedDate,
                    testLocation: normalizedLocation,
                    passed: normalizedPassed,
                    notScheduled: normalizedNotScheduled,
                });
            }
            return { ...prev, testPlan: updatedPlan };
        });
        setTestSaving(null);
        window.alert('Saved locally.');
    }, [subjectEdits, authToken]);

    const handleSaveChallenges = useCallback(async () => {
        setChallengesSaving(true);
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        const selectedIds = Array.isArray(localProfile?.challengeOptions)
            ? localProfile.challengeOptions.filter((c) => c && c.selected && c.id).map((c) => c.id)
            : [];
        if (token) {
            try {
                const bundle = await fetchJSON(`${API_BASE_URL}/api/profile/challenges/tags`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({ selectedIds }),
                });
                if (bundle && typeof bundle === 'object') {
                    setLocalProfile((prev) => ({
                        ...prev,
                        profile: {
                            ...prev.profile,
                            name: bundle?.profile?.name ?? prev.profile.name,
                            onboardingComplete: !!bundle?.profile?.onboardingComplete,
                        },
                        testPlan: Array.isArray(bundle.testPlan) ? bundle.testPlan.map((row) => ({
                            subject: row?.subject || '',
                            testDate: row?.testDate || '',
                            testLocation: row?.testLocation || '',
                            passed: !!row?.passed,
                            notScheduled: !!row?.notScheduled,
                        })) : (prev.testPlan || []),
                        nextUpcomingTest: normalizeNextUpcoming(bundle?.nextUpcomingTest),
                        challengeOptions: Array.isArray(bundle.challengeOptions) ? bundle.challengeOptions.map((opt, index) => ({
                            id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                            subject: opt?.subject || '',
                            subtopic: opt?.subtopic || '',
                            label: opt?.label || '',
                            selected: !!opt?.selected,
                        })) : (prev.challengeOptions || []),
                        recentScoresDashboard: bundle?.recentScores && typeof bundle.recentScores === 'object' ? bundle.recentScores : (prev.recentScoresDashboard || {}),
                    }));
                    window.alert('Challenges saved.');
                    setChallengesSaving(false);
                    return;
                }
            } catch (err) {
                console.warn('Server challenges save failed; falling back to local:', err);
            }
        }
        window.alert('Challenges saved locally.');
        setChallengesSaving(false);
    }, [authToken, localProfile?.challengeOptions]);

    const toggleChallengeSelection = useCallback((challengeId) => {
        if (!challengeId) {
            return;
        }
        setLocalProfile((prev) => ({
            ...prev,
            challengeOptions: Array.isArray(prev.challengeOptions)
                ? prev.challengeOptions.map((opt) => (
                    opt && opt.id === challengeId
                        ? { ...opt, selected: !opt.selected }
                        : opt
                ))
                : [],
        }));
    }, []);

    const handleFinishOnboarding = useCallback(async () => {
        setFinishingOnboarding(true);
        const okLocal = canCompleteOnboarding(localProfile);
        if (!okLocal) {
            window.alert('Almost there! Please fill in your test info, choose challenges, and add your name.');
            setFinishingOnboarding(false);
            return;
        }
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        if (token) {
            try {
                const bundle = await fetchJSON(`${API_BASE_URL}/api/profile/complete-onboarding`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                });
                if (bundle && typeof bundle === 'object') {
                    setLocalProfile((prev) => ({
                        ...prev,
                        profile: {
                            ...prev.profile,
                            onboardingStatus: 'complete',
                            onboardingComplete: true,
                            name: bundle?.profile?.name ?? prev.profile.name,
                        },
                        testPlan: Array.isArray(bundle.testPlan) ? bundle.testPlan.map((row) => ({
                            subject: row?.subject || '',
                            testDate: row?.testDate || '',
                            testLocation: row?.testLocation || '',
                            passed: !!row?.passed,
                            notScheduled: !!row?.notScheduled,
                        })) : (prev.testPlan || []),
                        nextUpcomingTest: normalizeNextUpcoming(bundle?.nextUpcomingTest),
                        challengeOptions: Array.isArray(bundle.challengeOptions) ? bundle.challengeOptions.map((opt, index) => ({
                            id: opt?.id ?? `${opt?.subject || 'challenge'}-${index}`,
                            subject: opt?.subject || '',
                            subtopic: opt?.subtopic || '',
                            label: opt?.label || '',
                            selected: !!opt?.selected,
                        })) : (prev.challengeOptions || []),
                        recentScoresDashboard: bundle?.recentScores && typeof bundle.recentScores === 'object' ? bundle.recentScores : (prev.recentScoresDashboard || {}),
                    }));
                    window.alert('Great! You’re all set.');
                    setFinishingOnboarding(false);
                    setView('start');
                    return;
                }
            } catch (err) {
                console.warn('Server onboarding completion failed; falling back to local:', err);
            }
        }
        // Fallback local-only
        setLocalProfile((prev) => ({
            ...prev,
            profile: {
                ...prev.profile,
                onboardingStatus: 'complete',
                onboardingComplete: true,
            },
        }));
        window.alert('Great! You’re all set.');
        setFinishingOnboarding(false);
        setView('start');
    }, [setView, localProfile, authToken]);

    const handleCompleteOnboardingLater = useCallback(() => {
        // Mark status as pending and allow navigation
        setLocalProfile((prev) => ({
            ...prev,
            profile: {
                ...prev.profile,
                onboardingStatus: 'pending',
                onboardingComplete: false,
            },
        }));
        setView('start');
    }, [setView]);

    const loadQuizAttempts = useCallback(async (token, options = {}) => {
        if (!token) {
            return;
        }

        const { force = false } = options;
        const now = Date.now();
        const timeSinceLastFetch = now - lastAttemptsFetchRef.current;

        if (!force) {
            if (pendingAttemptsFetchRef.current) {
                return pendingAttemptsFetchRef.current;
            }
            if (timeSinceLastFetch < SCORE_FETCH_INTERVAL_MS) {
                return;
            }
        }

        lastAttemptsFetchRef.current = now;

        const fetchPromise = (async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/api/quiz-attempts`, {
                    headers: {
                        Authorization: `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`Failed to fetch quiz attempts: ${response.status}`);
                }

                const data = await response.json();
                const normalized = Array.isArray(data) ? data : [];
                setQuizAttempts(normalized);
                recalcProgress(normalized);
            } catch (error) {
                console.error('Failed to load quiz attempts:', error);
                setQuizAttempts([]);
                recalcProgress([]);
            } finally {
                pendingAttemptsFetchRef.current = null;
            }
        })();

        pendingAttemptsFetchRef.current = fetchPromise;
        return fetchPromise;
    }, [recalcProgress]);

    const persistQuizAttempt = useCallback(async ({ subject, quizCode, quizTitle, quizType = null, score, totalQuestions, scaledScore, passed }) => {
        if (!currentUser) {
            return;
        }

        const token = authToken || localStorage.getItem('appToken');
        if (!token) {
            return;
        }

        const normalizedSubject = typeof subject === 'string' ? subject.trim() : '';
        const normalizedQuizCode = typeof quizCode === 'string' ? quizCode.trim() : '';
        const normalizedQuizTitle = typeof quizTitle === 'string' ? quizTitle.trim() : '';

        if (!normalizedSubject || !normalizedQuizCode || !normalizedQuizTitle) {
            return;
        }

        const toRoundedNumber = (value) => {
            const num = Number(value);
            return Number.isFinite(num) ? Math.round(num) : null;
        };

        const payload = {
            subject: normalizedSubject,
            quizCode: normalizedQuizCode,
            quizTitle: normalizedQuizTitle,
            quizType: quizType || null,
            score: toRoundedNumber(score),
            totalQuestions: toRoundedNumber(totalQuestions),
            scaledScore: toRoundedNumber(scaledScore),
            passed: typeof passed === 'boolean' ? passed : undefined,
        };

        if (payload.passed === undefined && payload.scaledScore != null) {
            payload.passed = payload.scaledScore >= GED_PASSING_SCORE;
        }

        try {
            const response = await fetch(`${API_BASE_URL}/api/quiz-attempts`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${token}`
                },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`Failed to save quiz attempt: ${response.status}`);
            }

            const savedAttempt = await response.json();
            setQuizAttempts((prevAttempts) => {
                const nextAttempts = Array.isArray(prevAttempts) ? [savedAttempt, ...prevAttempts] : [savedAttempt];
                recalcProgress(nextAttempts);
                return nextAttempts;
            });
        } catch (error) {
            console.error('Failed to save quiz attempt:', error);
        }
    }, [authToken, currentUser, recalcProgress]);

    useEffect(() => {
        const storedUser = localStorage.getItem('appUser');
        const storedToken = localStorage.getItem('appToken');

        if (!storedUser || !storedToken) {
            return;
        }

        try {
            const parsedUser = JSON.parse(storedUser);
            const profile = ensureUserProfile(parsedUser);
            if (profile) {
                currentUserRef.current = profile;
                setCurrentUser(profile);
                setAuthToken(storedToken);
                const isStudent = profile.role !== 'super_admin' && profile.role !== 'org_admin';
                if (isStudent) {
                    const customNameSet = localStorage.getItem(`customNameSet_${profile.id}`);
                    if (!customNameSet) {
                        setShowNamePrompt(true);
                    }
                    loadQuizAttempts(storedToken);
                } else {
                    setShowNamePrompt(false);
                }
            }
        } catch (error) {
            console.error('Failed to restore stored user:', error);
            localStorage.removeItem('appUser');
            localStorage.removeItem('appToken');
            setAuthToken(null);
        }
    }, [loadQuizAttempts]);

    const handleLogin = (user, token) => {
        if (!token) {
            console.error('Login response did not include a token.');
            return;
        }

        const profile = ensureUserProfile(user);
        if (!profile) {
            console.error('Login response did not include a valid user profile.');
            return;
        }

        try {
            localStorage.setItem('appUser', JSON.stringify(profile));
            localStorage.setItem('appToken', token);
        } catch (error) {
            console.warn('Unable to persist login locally:', error);
        }

        setAuthToken(token);
        const isAdminUser = profile.role === 'super_admin' || profile.role === 'org_admin';

        if (welcomeTimeoutRef.current) {
            clearTimeout(welcomeTimeoutRef.current);
        }
        if (welcomeFadeTimeoutRef.current) {
            clearTimeout(welcomeFadeTimeoutRef.current);
        }

        if (!isAdminUser) {
            const firstName = (() => {
                if (profile?.name) {
                    const trimmed = profile.name.trim();
                    if (trimmed) {
                        return trimmed.split(/\s+/)[0];
                    }
                }
                if (profile?.email) {
                    const [emailName] = profile.email.split('@');
                    return emailName || '';
                }
                return '';
            })();

            setWelcomeName(firstName);
            setWelcomeFading(false);
            setShowWelcomeSplash(true);

            if (typeof window !== 'undefined') {
                welcomeFadeTimeoutRef.current = window.setTimeout(() => {
                    setWelcomeFading(true);
                }, 2200);
                welcomeTimeoutRef.current = window.setTimeout(() => {
                    setShowWelcomeSplash(false);
                    setWelcomeFading(false);
                }, 3000);
            }
        } else {
            setShowWelcomeSplash(false);
            setWelcomeFading(false);
            setWelcomeName('');
        }

        currentUserRef.current = profile;
        setCurrentUser(profile);
        setSubjectEdits(createEmptySubjectEdits());
        setProfileError(null);
        setQuizAttempts([]);
        recalcProgress([]);

        if (!isAdminUser) {
            const customNameSet = localStorage.getItem(`customNameSet_${profile.id}`);
            if (!customNameSet) {
                setShowNamePrompt(true);
            }
            loadQuizAttempts(token);
        } else {
            setShowNamePrompt(false);
        }

        setView('start');
    };

    const handleSaveName = async (firstName, lastName) => {
        const newName = `${firstName} ${lastName}`.trim();
        if (!newName) {
            alert('Please enter both a first and last name.');
            return;
        }
        const token = authToken || (typeof window !== 'undefined' && window.localStorage ? window.localStorage.getItem('appToken') : null);
        if (token) {
            try {
                const resp = await fetchJSON(`${API_BASE_URL}/api/profile/name`, {
                    method: 'PATCH',
                    headers: { 'Content-Type': 'application/json', Authorization: `Bearer ${token}` },
                    body: JSON.stringify({ name: newName }),
                });
                const confirmed = resp?.name || newName;
                setLocalProfile((prev) => ({ ...prev, profile: { ...prev.profile, name: confirmed } }));
                setCurrentUser((prev) => prev ? { ...prev, name: confirmed } : prev);
                setNameDraft(confirmed);
                setShowNamePrompt(false);
                return;
            } catch (err) {
                console.warn('Server name save failed from modal; falling back to local:', err);
            }
        }
        const saved = saveDisplayName(newName);
        if (saved) {
            setNameDraft(saved);
        }
        setShowNamePrompt(false);
    };

    const handleDismissNamePrompt = () => {
        setShowNamePrompt(false);
    };

    const handleLogout = () => {
        localStorage.removeItem('appUser');
        localStorage.removeItem('appToken');
        setCurrentUser(null);
        setAuthToken(null);
        setQuizAttempts([]);
        recalcProgress([]);
        setShowNamePrompt(false);
        setSubjectEdits(createEmptySubjectEdits());
        setProfileError(null);
        setProfileLoading(false);
        setOnboardingComplete(true);
        setNameDraft('');
        setNameStatus('');
        setNameSaving(false);
        currentUserRef.current = null;
        if (welcomeTimeoutRef.current) {
            clearTimeout(welcomeTimeoutRef.current);
        }
        if (welcomeFadeTimeoutRef.current) {
            clearTimeout(welcomeFadeTimeoutRef.current);
        }
        setShowWelcomeSplash(false);
        setWelcomeFading(false);
        setWelcomeName('');
        setSettingsStatus('');
        setSettingsSaving(false);
        if (window.google && google.accounts.id) {
            google.accounts.id.disableAutoSelect();
        }
    };

    const handleGenerateComprehensiveExam = async (subject) => {
        setIsLoading(true);
        setLoadingMessage(`Generating your comprehensive ${subject} exam...`);
        setActiveQuiz(null);

        try {
            const response = await fetch(`${API_BASE_URL}/generate-quiz`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    subject: subject,
                    topic: "Comprehensive Exam",
                    comprehensive: true
                })
            });

            if (!response.ok) {
              const err = await response.json();
              throw new Error(err.error || `Request failed with status ${response.status}`);
            }

            const examData = await response.json();
            startQuiz(examData, subject);

        } catch (err) {
            console.error('Failed to generate exam:', err);
            alert('Failed to generate exam: ' + err.message);
        } finally {
            setIsLoading(false);
        }
    };

    useEffect(() => {
        let intervalId = null;
        if (isLoading) {
            let currentIndex = 0;
            setRevolvingPrompt(SMITHING_PROMPTS[currentIndex]);

            intervalId = setInterval(() => {
                currentIndex = (currentIndex + 1) % SMITHING_PROMPTS.length;
                setRevolvingPrompt(SMITHING_PROMPTS[currentIndex]);
            }, 2500);
        }

        return () => {
            if (intervalId) {
                clearInterval(intervalId);
            }
        };
    }, [isLoading]);

    useEffect(() => {
        window.test_setShowNamePrompt = setShowNamePrompt;
        return () => {
            if (window.test_setShowNamePrompt === setShowNamePrompt) {
                window.test_setShowNamePrompt = undefined;
            }
        };
    }, []);

    const normalizeQuestionList = (list) => {
        if (!Array.isArray(list)) {
            return [];
        }
        return list
            .filter(item => item && typeof item === 'object')
            .map(item => ({
                ...item,
                answerOptions: shuffleArray(Array.isArray(item.answerOptions) ? item.answerOptions : [])
            }));
    };

    const startQuiz = (quizPayload, subject) => {
        console.log("Starting quiz with data:", quizPayload); // Debugging line

        if (!quizPayload || typeof quizPayload !== 'object') {
            console.error('Received invalid quiz payload:', quizPayload);
            alert('Sorry, the generated quiz data was invalid. Please try again.');
            return;
        }

        if (quizPayload.type === 'essay') {
            setActiveQuiz({ ...quizPayload, subject });
            setView('essay');
            return;
        }

        if (quizPayload.type === 'simulation') {
            setActiveQuiz({ ...quizPayload, subject });
            setView('simulation');
            return;
        }

        if (quizPayload.type === 'graphing_tool' || quizPayload.type === 'geometry_practice_tool') {
            openMathTools(quizPayload.type === 'graphing_tool' ? 'graphing' : 'geometry');
            setActiveQuiz(null);
            setView('start');
            return;
        }

    const preparedQuiz = { ...quizPayload, subject };
        preparedQuiz.quizCode = quizPayload.quizCode || quizPayload.code || quizPayload.id || preparedQuiz.quizCode || null;
        preparedQuiz.isPremade = Boolean(preparedQuiz.quizCode);
        let normalizedQuestions = normalizeQuestionList(quizPayload.questions);

        if (quizPayload.type === 'multi-part-math') {
            let part1 = normalizeQuestionList(quizPayload.part1_non_calculator);
            let part2 = normalizeQuestionList(quizPayload.part2_calculator);

            if (!part1.length && normalizedQuestions.length) {
                part1 = normalizedQuestions.slice(0, 5);
            }
            if (!part2.length && normalizedQuestions.length) {
                part2 = normalizedQuestions.slice(part1.length || 5);
            }

            if (!part1.length || !part2.length) {
                console.error('Incomplete multi-part math payload received:', quizPayload);
                alert('The generated math exam was incomplete. Please try again.');
                return;
            }

            preparedQuiz.part1_non_calculator = part1.map(q => ({ ...q, isPremade: preparedQuiz.isPremade }));
            preparedQuiz.part2_calculator = part2.map(q => ({ ...q, isPremade: preparedQuiz.isPremade }));
            normalizedQuestions = [...part1, ...part2];
        } else if (quizPayload.type === 'multi-part-rla') {
            const part1 = normalizeQuestionList(quizPayload.part1_reading);
            const part3 = normalizeQuestionList(quizPayload.part3_language);
            const essay = quizPayload.part2_essay;

            const hasEssayContent = essay && typeof essay === 'object' && Array.isArray(essay.passages) && essay.passages.length >= 2 && typeof essay.prompt === 'string';

            if (!part1.length || !part3.length || !hasEssayContent) {
                console.error('Incomplete multi-part RLA payload received:', quizPayload);
                alert('The generated RLA exam was incomplete. Please try again.');
                return;
            }

            preparedQuiz.part1_reading = part1.map(q => ({ ...q, isPremade: preparedQuiz.isPremade }));
            preparedQuiz.part3_language = part3.map(q => ({ ...q, isPremade: preparedQuiz.isPremade }));
            preparedQuiz.part2_essay = essay;
            normalizedQuestions = [...part1, ...part3];
        }

        if (!normalizedQuestions.length) {
            console.error('Quiz payload did not include any valid questions:', quizPayload);
            alert('The generated quiz did not include any questions. Please try again.');
            return;
        }

    preparedQuiz.questions = normalizedQuestions.map(q => ({ ...q, isPremade: preparedQuiz.isPremade }));

        setActiveQuiz(preparedQuiz);
        // For any multi-part quiz, the view should be 'quiz' so the main QuizRunner can handle routing.
        const requiresStandardView = preparedQuiz.type === 'multi-part-rla' || preparedQuiz.type === 'multi-part-math';
        const normalizedType = preparedQuiz.type === 'reading' ? 'quiz' : (preparedQuiz.type || 'quiz');
        const viewType = requiresStandardView ? 'quiz' : normalizedType;
        setView(viewType);
    };
    
    const onQuizComplete = (results) => {
        setQuizResults(results);
        setView('results');

        if (results.quiz) {
            setActiveQuiz(results.quiz);
        }

        const { subject } = results;

        if (subject === 'Pop Quiz') return; // Do not track progress for pop quizzes

        const quizDetails = results.quiz || activeQuiz;
        if (!quizDetails) {
            return;
        }

        const quizCode = quizDetails.quizCode || quizDetails.code || quizDetails.id || null;
        if (!quizCode) {
            return;
        }

        persistQuizAttempt({
            subject,
            quizCode,
            quizTitle: quizDetails.title || quizDetails.topicTitle || 'GED® Practice Exam',
            quizType: quizDetails.type,
            score: results.score,
            totalQuestions: results.totalQuestions,
            scaledScore: results.scaledScore,
            passed: typeof results.scaledScore === 'number' ? results.scaledScore >= GED_PASSING_SCORE : undefined,
        });
    };

    const handleStartPopQuiz = () => {
        const cloneQuestionWithAnswers = (question) => {
            if (!question || typeof question !== 'object') {
                return null;
            }
            const cloned = { ...question };
            if (Array.isArray(question.answerOptions)) {
                cloned.answerOptions = question.answerOptions.map((option) => ({ ...option }));
            }
            return cloned;
        };

        const collectPremadeQuestions = () => {
            const pool = [];
            Object.entries(AppData).forEach(([subjectName, subject]) => {
                if (!subject || typeof subject !== 'object' || !subject.categories) {
                    return;
                }

                Object.values(subject.categories).forEach((category) => {
                    const topics = Array.isArray(category?.topics) ? category.topics : [];
                    topics.forEach((topic) => {
                        if (!topic || typeof topic !== 'object') {
                            return;
                        }

                        const pushQuestions = (questions, origin) => {
                            if (!Array.isArray(questions)) {
                                return;
                            }
                            questions.forEach((rawQuestion) => {
                                const question = cloneQuestionWithAnswers(rawQuestion);
                                if (!question) {
                                    return;
                                }
                                if (!Array.isArray(question.answerOptions) || question.answerOptions.length < 2) {
                                    return;
                                }
                                if (!question.answerOptions.some((option) => option && option.isCorrect)) {
                                    return;
                                }
                                const enriched = {
                                    ...question,
                                    subject: question.subject || subjectName,
                                    popQuizOrigin: origin,
                                    isPremade: origin && origin.type === 'premade',
                                };
                                pool.push(enriched);
                            });
                        };

                        if (Array.isArray(topic.quizzes) && topic.quizzes.length) {
                            topic.quizzes.forEach((quiz) => {
                                if (!quiz || typeof quiz !== 'object' || !quiz.quizCode) {
                                    return;
                                }
                                const resolvedQuestions = resolveQuizQuestions(subjectName, topic, quiz);
                                pushQuestions(resolvedQuestions, {
                                    type: 'premade',
                                    subject: subjectName,
                                    quizTitle: quiz.title || topic.title || quiz.quizCode,
                                    quizCode: quiz.quizCode,
                                });
                            });
                        } else if (topic.quizCode && Array.isArray(topic.questions) && topic.questions.length) {
                            pushQuestions(topic.questions, {
                                type: 'premade',
                                subject: subjectName,
                                quizTitle: topic.title || topic.quizCode,
                                quizCode: topic.quizCode,
                            });
                        }
                    });
                });
            });
            return pool;
        };

        const collectVocabularyQuestions = () => {
            const pool = [];
            const vocabularyEntries = Object.entries(vocabulary || {}).filter(([, terms]) => Array.isArray(terms) && terms.length > 0);
            if (!vocabularyEntries.length) {
                return pool;
            }

            const allDefinitions = vocabularyEntries
                .flatMap(([, terms]) => terms.map((item) => (typeof item?.definition === 'string' ? item.definition : null)))
                .filter(Boolean);

            const getDistractorDefinitions = (correctDefinition) => {
                const candidates = allDefinitions.filter((definition) => definition !== correctDefinition);
                return shuffleArray(candidates).slice(0, 3);
            };

            vocabularyEntries.forEach(([subjectName, terms]) => {
                terms.forEach((item) => {
                    if (!item || typeof item.term !== 'string' || typeof item.definition !== 'string') {
                        return;
                    }
                    const distractors = getDistractorDefinitions(item.definition);
                    const answerOptions = shuffleArray([
                        { text: item.definition, isCorrect: true },
                        ...distractors.map((definition) => ({ text: definition, isCorrect: false })),
                    ]);

                    if (answerOptions.length < 2) {
                        return;
                    }

                    pool.push({
                        type: 'vocabulary',
                        question: `What is the best definition of "${item.term}"?`,
                        answerOptions: answerOptions.map((option) => ({ ...option })),
                        subject: subjectName,
                        popQuizOrigin: {
                            type: 'vocabulary',
                            subject: subjectName,
                            term: item.term,
                        },
                    });
                });
            });

            return pool;
        };

        const premadePool = collectPremadeQuestions();
        const vocabularyPool = collectVocabularyQuestions();
        const combinedPool = [...premadePool, ...vocabularyPool];

        if (!combinedPool.length) {
            alert('Pop quiz is not available right now. Please try again later.');
            return;
        }

        const totalAvailable = combinedPool.length;
        let desiredCount;
        if (totalAvailable >= 5) {
            desiredCount = 5;
        } else if (totalAvailable >= 4) {
            desiredCount = 4;
        } else {
            desiredCount = totalAvailable;
        }

        const selectedQuestions = shuffleArray(combinedPool)
            .slice(0, desiredCount)
            .map((question, index) => ({
                ...question,
                questionNumber: index + 1,
            }));

        const popQuiz = {
            id: 'pop_quiz_' + new Date().getTime(),
            title: '5-Minute Pop Quiz',
            questions: selectedQuestions,
            timeLimit: 300,
        };

        startQuiz(popQuiz, 'Pop Quiz');
    };

    const navigateHome = useCallback(() => {
        setActiveQuiz(null);
        setQuizResults(null);
        setActiveGenerator(null);
        goToDashboard();
    }, [goToDashboard]);

    const handleShowProfileView = useCallback(() => {
        goToProfile();
    }, [goToProfile]);

    const handleShowSettingsView = useCallback(() => {
        goToSettings();
    }, [goToSettings]);

    const handleReviewMarked = (markedQuestions, subject) => {
        const reviewQuiz = {
            id: 'review_quiz_' + new Date().getTime(),
            title: 'Review Marked Questions',
            questions: markedQuestions.map((q, index) => ({ ...q, questionNumber: index + 1 })),
        };
        startQuiz(reviewQuiz, subject || 'Review');
    };

    const renderView = () => {
        if (!currentUser) {
            return <AuthScreen onLogin={handleLogin} />;
        }
        if (currentUser.role === 'super_admin') {
            return <SuperAdminDashboard user={currentUser} token={authToken} onLogout={handleLogout} />;
        }
        if (currentUser.role === 'org_admin') {
            return <OrgAdminDashboard user={currentUser} token={authToken} onLogout={handleLogout} />;
        }
        switch (view) {
            case 'quiz':
                return <QuizRunner quiz={activeQuiz} onComplete={onQuizComplete} onExit={navigateHome} />;
            case 'reading':
                 return <ReadingPractice quiz={activeQuiz} onComplete={onQuizComplete} onExit={navigateHome} />;
            case 'essay':
                return <EssayGuide onExit={navigateHome} />;
            case 'simulation':
                return (
                    activeQuiz && (activeQuiz.id === 'sim_life' || activeQuiz.title === 'The Game of Life') ? (
                        <div className="fade-in" data-subject="Simulations">
                            <div className="rounded-2xl overflow-hidden shadow-xl mb-4" style={{ background: 'var(--subject-simulations-gradient)' }}>
                                <header className="flex flex-wrap items-center justify-between gap-3 p-4 text-white">
                                    <div className="flex-none min-w-[120px]">
                                        <button onClick={navigateHome} className="inline-flex items-center gap-2 text-sm font-semibold bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-md">
                                            <ArrowLeftIcon />
                                            <span>Back</span>
                                        </button>
                                    </div>
                                    <h2 className="text-2xl font-extrabold text-center flex-1">The Game of Life</h2>
                                    <div className="flex-none min-w-[120px]" aria-hidden="true"></div>
                                </header>
                            </div>
                            <div className="panel-surface rounded-xl p-2 border" style={{ borderColor: 'var(--subject-simulations-border)', backgroundColor: 'white' }}>
                                <LifeChoicesSimulation srcPath="Game of Life/The Game of life.html" />
                            </div>
                        </div>
                    ) : (
                        <div className="relative overflow-hidden rounded-2xl bg-gradient-to-br from-orange-500 via-orange-400 to-orange-600 text-white p-8 sm:p-10 text-center shadow-xl">
                            <div className="absolute inset-0 bg-[radial-gradient(circle_at_top_left,_rgba(255,255,255,0.25),_transparent_55%)] pointer-events-none"></div>
                            <div className="relative z-10 flex flex-col items-center gap-6">
                                <div className="flex items-center justify-center w-16 h-16 rounded-full bg-white/20 shadow-lg">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" className="w-9 h-9">
                                        <path strokeLinecap="round" strokeLinejoin="round" d="M12 6v6l3.5 3.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-extrabold">Interactive Simulation</h1>
                                    <p className="mt-3 text-lg text-orange-50/90 max-w-xl">
                                        Choose a simulation from the dashboard to get started.
                                    </p>
                                </div>
                                <button
                                    onClick={navigateHome}
                                    className="px-6 py-2.5 rounded-full bg-white text-orange-600 font-semibold shadow-lg transition hover:shadow-xl hover:bg-orange-50"
                                >
                                    Back to Dashboard
                                </button>
                            </div>
                        </div>
                    )
                );
            case 'results':
                return <ResultsScreen results={quizResults} quiz={activeQuiz} onRestart={() => startQuiz(activeQuiz, activeQuiz.subject)} onHome={navigateHome} onReviewMarked={handleReviewMarked} />;
            case 'generator':
                return <AIQuizGenerator {...activeGenerator} onQuizGenerated={(quiz) => startQuiz(quiz, activeGenerator.subject)} onExit={navigateHome} />;
            case 'profile':
                // Deprecated path: use activeView under 'start'. Keep for backward safety but route to start/profile
                goToProfile();
                return null;
            case 'settings':
                // Deprecated path: use activeView under 'start'. Keep for backward safety but route to start/settings
                goToSettings();
                return null;
            case 'mathTools':
                return (
                    <MathPracticeToolsPage
                        onExit={navigateHome}
                        activeTab={mathToolsActiveTab}
                        onTabChange={setMathToolsActiveTab}
                        graphingNode={mathToolsNodes ? mathToolsNodes.graphing : null}
                        geometryNode={mathToolsNodes ? mathToolsNodes.geometry : null}
                    />
                );
            case 'start':
            default: {
                // Route within the dashboard container based on activeView
                if (activeView === 'profile') {
                    return (
                        <ProfileView
                            loading={profileLoading}
                            error={profileError}
                            data={profileData}
                            nameDraft={nameDraft}
                            onNameDraftChange={handleNameDraftChange}
                            onSubmitName={handleProfileNameSubmit}
                            nameSaving={nameSaving}
                            nameStatus={nameStatus}
                            onRefresh={handleProfileRefresh}
                            onBack={navigateHome}
                            onSaveAll={handleSaveAllProfile}
                            savingAll={savingAll}
                            subjectEdits={subjectEdits}
                            onSubjectFieldChange={handleSubjectFieldChange}
                            onSubjectSave={handleSaveSubject}
                            testSaving={testSaving}
                            onSaveChallenges={handleSaveChallenges}
                            onToggleChallenge={toggleChallengeSelection}
                            challengesSaving={challengesSaving}
                            onFinishOnboarding={handleFinishOnboarding}
                            onCompleteLater={handleCompleteOnboardingLater}
                            finishingOnboarding={finishingOnboarding}
                            onboardingComplete={onboardingComplete}
                        />
                    );
                }
                if (activeView === 'settings') {
                    return (
                        <SettingsView
                            preferences={preferences}
                            onApply={handleSettingsInstantChange}
                            onSave={handlePersistPreferences}
                            saving={settingsSaving}
                            status={settingsStatus}
                            onBack={navigateHome}
                            loading={profileLoading}
                        />
                    );
                }
                // Dashboard, Quizzes, Progress all use the StartScreen container; scrolling is handled by pendingScrollTarget
                return (
                    <StartScreen
                        currentUser={currentUser}
                        onLogout={handleLogout}
                        progress={progress}
                        profileBundle={profileData}
                        testDate={profileTestDate}
                        onboardingComplete={onboardingComplete}
                        onShowProfile={handleShowProfileView}
                        onSelectQuiz={startQuiz}
                        vocabulary={vocabulary}
                        onRefreshProfile={loadProfileOnce}
                        onStartPopQuiz={handleStartPopQuiz}
                        onStartComprehensiveExam={handleGenerateComprehensiveExam}
                        setIsLoading={setIsLoading}
                        setLoadingMessage={setLoadingMessage}
                        setShowFormulaSheet={setShowFormulaSheet}
                        onOpenMathTools={openMathTools}
                        theme={preferences.theme}
                        onSelectGenerator={async (subject, topic, setIsLoading, setLoadingMessage) => {
                            if (!topic) {
                                alert("Please select a topic first.");
                                return;
                            }
                            const subjectParam = resolveSubjectParam(subject);
                            if (!subjectParam) {
                                alert('Sorry, this subject is not supported yet.');
                                return;
                            }
                            setLoadingMessage("Please give us a moment to smith this for you...");
                            setIsLoading(true);

                            try {
                                const questions = await generateTopicQuiz(subjectParam, topic);

                                if (!questions.length) {
                                    throw new Error('The quiz service returned an empty quiz.');
                                }

                                const generatedQuiz = {
                                    subject,
                                    topic,
                                    id: `ai_${Date.now()}`,
                                    title: `${subject} Quiz: ${topic}`,
                                    questions
                                };

                                startQuiz(generatedQuiz, subject);

                            } catch (err) {
                                console.error("Error generating quiz:", err);
                                alert(`Sorry, something went wrong. ${err.message}`);
                            } finally {
                                setIsLoading(false);
                            }
                        }}
                    />
                );
            }
        }
    };

    const mathToolsNodes = useMemo(() => {
        if (!mathToolsInitialized) {
            return null;
        }
        return {
            graphing: <GraphingTool key="math-tools-graphing" />,
            geometry: <GeometryPracticeTool key="math-tools-geometry" />,
        };
    }, [mathToolsInitialized]);

    return (
        <>
            {showWelcomeSplash && (
                <div
                    className={`fixed inset-0 z-[60] flex flex-col items-center justify-center text-white transition-opacity duration-700 ${welcomeFading ? 'opacity-0' : 'opacity-100'}`}
                    style={{ backgroundColor: 'var(--modal-overlay)' }}
                >
                    <img
                        src="Logo.svg"
                        alt="Kingmakerconsults logo"
                        className="w-4/5 max-w-4xl h-auto object-contain drop-shadow-2xl"
                    />
                    <p className="mt-8 text-3xl sm:text-4xl font-semibold tracking-wide">
                        Welcome{welcomeName ? `, ${welcomeName}!` : '!'}
                    </p>
                </div>
            )}
            <div
                className="min-h-screen flex flex-col transition-colors"
                style={{ backgroundColor: 'var(--bg-page)', color: 'var(--text-primary)' }}
            >
                <AppHeader
                    currentUser={currentUser}
                    onLogout={handleLogout}
                    onShowHome={goToDashboard}
                    onShowProfile={goToProfile}
                    onShowSettings={goToSettings}
                    onShowQuizzes={goToQuizzes}
                    onShowProgress={goToProgress}
                    activePanel={activeView === 'profile' ? 'profile' : activeView === 'settings' ? 'settings' : null}
                    theme={preferences.theme}
                    onToggleTheme={toggleThemePreference}
                />
                {isLoading && (
                    <div
                        className="fade-in fixed inset-0 w-full h-full flex flex-col items-center justify-center z-50 text-center px-4"
                        style={{ backgroundColor: 'var(--modal-overlay)' }}
                    >
                        <h2 className="text-3xl font-bold text-white mb-4">Loading...</h2>
                        <p className="text-xl text-sky-300 mb-2">{loadingMessage}</p>
                        <p className="text-lg text-slate-300 italic h-8 transition-opacity duration-500">{revolvingPrompt}</p>
                        {/* Optional: Add a spinner element here */}
                    </div>
                )}
                {showFormulaSheet && <FormulaSheetModal onClose={() => setShowFormulaSheet(false)} />}
                {showNamePrompt && <NamePromptModal user={currentUser} onSave={handleSaveName} onDismiss={handleDismissNamePrompt} />}
                <main className="flex-1 w-full max-w-6xl mx-auto p-4 sm:p-6 md:p-8 pt-[4.5rem] space-y-8 text-slate-900 dark:text-slate-100 transition-colors duration-300">
                    <div className="content-card bg-white dark:bg-slate-900/90 border border-slate-200/70 dark:border-slate-700/70 rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 transition-all duration-300 relative">
                        {renderView()}
                    </div>
                </main>
                <footer className="w-full flex flex-col items-center gap-3 text-xs sm:text-sm text-slate-500 pb-6">
                    <img src="Logo.svg" alt="Kingmakerconsults logo" className="h-48 w-auto object-contain" />
                    <p>Kingmakerconsults Copyright ©</p>
                </footer>
            </div>
            
        </>
    );
}

// --- VIEWS & COMPONENTS ---


function ProfileView({
    loading,
    error,
    data,
    nameDraft,
    onNameDraftChange,
    onSubmitName,
    nameSaving,
    nameStatus,
    onRefresh,
    onBack,
    onSaveAll,
    savingAll,
    subjectEdits,
    onSubjectFieldChange,
    onSubjectSave,
    testSaving,
    onToggleChallenge,
    onSaveChallenges,
    challengesSaving,
    onFinishOnboarding,
    onCompleteLater,
    finishingOnboarding,
    onboardingComplete,
}) {
    const profile = data?.profile || {};
    const challengeOptions = Array.isArray(data?.challengeOptions) ? data.challengeOptions : [];
    const recentSummary = data?.recentScoresDashboard || {};
    const legacyScores = data?.scores || {};
    const SUBJECT_ORDER = useMemo(() => [...SUBJECT_NAMES], []);
    const rawTestPlan = Array.isArray(data?.testPlan) ? data.testPlan : [];
    const normalizedTestPlan = useMemo(() => {
        const map = new Map();
        rawTestPlan.forEach((entry) => {
            if (!entry || !entry.subject) {
                return;
            }
            const subject = String(entry.subject);
            map.set(subject, {
                subject,
                testDate: entry.testDate || '',
                testLocation: entry.testLocation || '',
                passed: !!entry.passed,
                notScheduled: !!entry.notScheduled,
                daysUntil: entry.daysUntil ?? null,
            });
        });
        SUBJECT_ORDER.forEach((subject) => {
            if (!map.has(subject)) {
                map.set(subject, {
                    subject,
                    testDate: '',
                    testLocation: '',
                    passed: false,
                    notScheduled: false,
                    daysUntil: null,
                });
            }
        });
        const orderedSubjects = [
            ...SUBJECT_ORDER,
            ...Array.from(map.keys()).filter((subject) => !SUBJECT_ORDER.includes(subject)),
        ];
        const seen = new Set();
        const result = [];
        orderedSubjects.forEach((subject) => {
            if (!seen.has(subject) && map.has(subject)) {
                result.push(map.get(subject));
                seen.add(subject);
            }
        });
        map.forEach((value, subject) => {
            if (!seen.has(subject)) {
                result.push(value);
            }
        });
        return result;
    }, [rawTestPlan, SUBJECT_ORDER]);

    const nextUpcoming = data?.nextUpcomingTest || null;
    const formatDayCount = (value) => {
        if (typeof value !== 'number' || !Number.isFinite(value)) {
            return null;
        }
        const rounded = Math.max(0, Math.floor(value));
        return `${rounded} day${rounded === 1 ? '' : 's'}`;
    };
    const nextUpcomingDaysText = formatDayCount(nextUpcoming?.daysUntil);
    const nextUpcomingSummary = nextUpcoming && nextUpcoming.testDate
        ? `Next test: ${nextUpcoming.subject} on ${nextUpcoming.testDate}${nextUpcomingDaysText ? ` (${nextUpcomingDaysText})` : ''}`
        : 'No test scheduled yet.';

    const selectedFromServer = useMemo(
        () => challengeOptions.filter((opt) => opt.selected).map((opt) => opt.id),
        [challengeOptions]
    );
    const [selectedIds, setSelectedIds] = useState(selectedFromServer);
    useEffect(() => {
        setSelectedIds(selectedFromServer);
    }, [selectedFromServer]);

    const groupedChallenges = useMemo(() => {
        const grouped = {};
        challengeOptions.forEach((opt) => {
            const subjectKey = opt.subject || 'Other';
            const subtopicKey = opt.subtopic || 'General';
            if (!grouped[subjectKey]) {
                grouped[subjectKey] = {};
            }
            if (!grouped[subjectKey][subtopicKey]) {
                grouped[subjectKey][subtopicKey] = [];
            }
            grouped[subjectKey][subtopicKey].push(opt);
        });
        return grouped;
    }, [challengeOptions]);

    const selectedCount = selectedIds.length;
    const highlightName = !onboardingComplete && !profile.name;
    const hasAnyTestProgress = normalizedTestPlan.some(
        (entry) => entry.passed || entry.notScheduled || entry.testDate
    );
    const highlightTest = !onboardingComplete && !hasAnyTestProgress;
    const highlightChallenges = !onboardingComplete && selectedCount === 0;

    const handleChallengeToggle = (id) => {
        setSelectedIds((prev) => {
            const next = new Set(prev);
            if (next.has(id)) {
                next.delete(id);
            } else {
                next.add(id);
            }
            return Array.from(next);
        });
        onToggleChallenge?.(id);
    };

    const handleChallengesSubmit = (event) => {
        event.preventDefault();
        onSaveChallenges?.();
    };

    const handleBackClick = () => {
        // Allow returning to dashboard even if onboarding is pending
        onBack?.();
    };

    const timezoneLabel = profile.timezone || 'America/New_York';
    const reminderLabel = profile.reminderEnabled === false ? 'Off' : 'On';

    return (
        <section id="profileView" data-view="profile" tabIndex={-1} className="outline-none">
            <div className="max-w-4xl mx-auto space-y-6 settings-card">
                <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between settings-header">
                    <div>
                        <h1 className="text-3xl font-bold text-white drop-shadow-sm">Profile</h1>
                        <p className="text-sm text-slate-500">Update your learning plan and keep your information in sync.</p>
                    </div>
                    <div className="flex flex-col gap-2 sm:flex-row sm:items-center">
                        <button
                            type="button"
                            onClick={onRefresh}
                            className="refresh-button inline-flex items-center justify-center rounded-lg border px-3 py-2 text-sm font-semibold transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                            disabled={loading}
                        >
                            {loading ? 'Refreshing…' : 'Refresh'}
                        </button>
                        <button
                            type="button"
                            onClick={onSaveAll}
                            className="inline-flex items-center justify-center rounded-lg bg-emerald-600 px-3 py-2 text-sm font-semibold text-white hover:bg-emerald-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:ring-offset-2 disabled:opacity-60"
                            disabled={!!savingAll}
                        >
                            {savingAll ? 'Saving…' : 'Save All'}
                        </button>
                        <button
                            type="button"
                            onClick={handleBackClick}
                            className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-3 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2"
                        >
                            Back to Dashboard
                        </button>
                    </div>
                </div>

                {error && !loading && (
                    <div className="rounded-xl border border-rose-200 bg-rose-50 p-4 text-sm text-rose-700" role="alert">
                        {error}
                    </div>
                )}

                {!onboardingComplete && (
                    <div
                        className="onboarding-banner"
                        style={{ border: '1px solid #f6c', background: '#fff0f6', padding: '1rem', borderRadius: '0.5rem' }}
                    >
                        <strong>Welcome!</strong> Before we start, fill this out so we can build you a plan:
                        <ol className="list-decimal pl-5 text-sm text-slate-700 space-y-1 mt-2">
                            <li>Pick the areas you struggle with</li>
                            <li>Set your test date (or mark "I passed")</li>
                            <li>Choose a display name</li>
                        </ol>
                        <div className="mt-3 flex flex-col sm:flex-row gap-2">
                            <button
                                id="finishOnboardingBtn"
                                type="button"
                                onClick={onFinishOnboarding}
                                className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                                disabled={finishingOnboarding}
                            >
                                {finishingOnboarding ? 'Checking…' : "I'm Done"}
                            </button>
                            <button
                                id="completeLaterBtn"
                                type="button"
                                onClick={onCompleteLater}
                                className="inline-flex items-center justify-center rounded-lg border px-4 py-2 text-sm font-semibold focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2"
                                aria-label="Skip onboarding for now"
                            >
                                Complete Later
                            </button>
                        </div>
                    </div>
                )}

                <form
                    onSubmit={onSubmitName}
                    className={`rounded-2xl border bg-white/95 p-5 shadow-sm space-y-4 ${highlightName ? 'border-rose-300 ring-1 ring-rose-200' : 'border-slate-200'}`}
                    aria-labelledby="profile-name-heading"
                >
                    <div>
                        <h2 id="profile-name-heading" className="text-xl font-semibold text-slate-800">Display Name</h2>
                        <p className="text-sm text-slate-500">This name appears across the app.</p>
                    </div>
                    <div className="flex flex-col gap-3 sm:flex-row sm:items-center">
                        <label className="w-full sm:flex-1">
                            <span className="sr-only">Display name</span>
                            <input
                                type="text"
                                value={nameDraft}
                                onChange={(event) => onNameDraftChange(event.target.value)}
                                maxLength={80}
                                placeholder="Your name"
                                className="w-full rounded-lg border border-slate-300 px-3 py-2 text-base focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                            />
                        </label>
                        <button
                            type="submit"
                            className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                            disabled={nameSaving}
                        >
                            {nameSaving ? 'Saving…' : 'Save Name'}
                        </button>
                    </div>
                    <p className="text-xs text-slate-500">Maximum 80 characters.</p>
                    {nameStatus && (
                        <p className="text-sm text-slate-600" role="status" aria-live="polite">
                            {nameStatus}
                        </p>
                    )}
                </form>

                <div className="grid gap-4 md:grid-cols-2">
                <section
                    id="testPlanCard"
                    className={`rounded-2xl border bg-white/95 p-5 shadow-sm space-y-4 ${highlightTest ? 'border-rose-300 ring-1 ring-rose-200' : 'border-slate-200'}`}
                >
                    <h2 className="text-lg font-semibold text-slate-900 dark:text-slate-100">Upcoming Tests</h2>
                    <div id="nextUpcomingSummary" className="note text-sm text-slate-600">
                        {nextUpcomingSummary}
                    </div>
                    <div id="testPlanList" className="grid gap-4 md:grid-cols-2">
                        {normalizedTestPlan.length === 0 ? (
                            <p className="col-span-full text-sm text-slate-500">No subjects available yet.</p>
                        ) : normalizedTestPlan.map((entry) => {
                            const edits = (subjectEdits && subjectEdits[entry.subject]) || {
                                testDate: '',
                                testLocation: '',
                                passed: false,
                                notScheduled: false,
                            };
                            const savingThisSubject = testSaving === entry.subject;
                            const isNotScheduled =
                                typeof edits.notScheduled === 'boolean'
                                    ? edits.notScheduled
                                    : !!entry.notScheduled;
                            const countdownLabel = (() => {
                                if (isNotScheduled || !entry.testDate || edits.passed) {
                                    return null;
                                }
                                if (entry.daysUntil != null) {
                                    const value = entry.daysUntil;
                                    return `${value} day${value === 1 ? '' : 's'} remaining`;
                                }
                                return 'Countdown not available';
                            })();

                            return (
                                <div
                                    key={entry.subject}
                                    className="subject-test-block rounded-xl border border-slate-200 bg-white/80 p-4 space-y-3 shadow-sm"
                                >
                                    <h3 className="text-base font-semibold text-slate-700">{entry.subject}</h3>
                                    <label className="flex flex-col gap-1 text-sm text-slate-600">
                                        Date
                                        <input
                                            type="date"
                                            className="tp-date profile-date-input rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                            data-subject={entry.subject}
                                            value={isNotScheduled ? '' : edits.testDate || ''}
                                            onChange={(event) => onSubjectFieldChange?.(entry.subject, 'testDate', event.target.value)}
                                            disabled={savingThisSubject || isNotScheduled}
                                        />
                                    </label>
                                    <label className="inline-row flex items-center gap-2 text-sm text-slate-600">
                                        <input
                                            type="checkbox"
                                            className="tp-not-scheduled h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
                                            data-subject={entry.subject}
                                            checked={!!isNotScheduled}
                                            onChange={(event) =>
                                                onSubjectFieldChange?.(entry.subject, 'notScheduled', event.target.checked)
                                            }
                                            disabled={savingThisSubject}
                                        />
                                        I have not scheduled this test yet
                                    </label>
                                    <label className="flex flex-col gap-1 text-sm text-slate-600">
                                        Location
                                        <input
                                            type="text"
                                            className="tp-location rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                                            placeholder="Test center (optional)"
                                            data-subject={entry.subject}
                                            value={edits.testLocation || ''}
                                            onChange={(event) => onSubjectFieldChange?.(entry.subject, 'testLocation', event.target.value)}
                                            disabled={savingThisSubject}
                                        />
                                    </label>
                                    <label className="inline-row flex items-center gap-2 text-sm text-slate-600">
                                        <input
                                            type="checkbox"
                                            className="tp-passed h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
                                            data-subject={entry.subject}
                                            checked={!!edits.passed}
                                            onChange={(event) => onSubjectFieldChange?.(entry.subject, 'passed', event.target.checked)}
                                            disabled={savingThisSubject}
                                        />
                                        I already passed this subject
                                    </label>
                                    <button
                                        type="button"
                                        className="btn tp-save inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                                        data-subject={entry.subject}
                                        onClick={() => onSubjectSave?.(entry.subject)}
                                        disabled={savingThisSubject}
                                    >
                                        {savingThisSubject ? 'Saving…' : `Save ${entry.subject}`}
                                    </button>
                                    {edits.passed ? (
                                        <p className="text-xs text-emerald-600">Great job! We marked this subject as passed.</p>
                                    ) : isNotScheduled ? (
                                        <p className="text-xs text-slate-500">We'll remind you to set a date when you're ready.</p>
                                    ) : countdownLabel ? (
                                        <p className="text-xs text-slate-500">{countdownLabel}</p>
                                    ) : null}
                                </div>
                            );
                        })}
                    </div>
                    <p className="text-xs text-slate-500">Dates saved here will also appear on your dashboard.</p>
                </section>

                    <article className="glass rounded-2xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 p-5 shadow-lg space-y-3">
                        <h2 className="text-lg font-semibold text-slate-800">Preferences Snapshot</h2>
                        <dl className="space-y-2 text-sm text-slate-600">
                            <div className="flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2">
                                <dt className="font-medium text-slate-700">Font Size</dt>
                                <dd className="capitalize">{profile.fontSize || 'md'}</dd>
                            </div>
                            <div className="flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2">
                                <dt className="font-medium text-slate-700">Color Contrast</dt>
                                <dd className="capitalize">Automatic</dd>
                            </div>
                            <div className="flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2">
                                <dt className="font-medium text-slate-700">Timezone</dt>
                                <dd>{timezoneLabel}</dd>
                            </div>
                            <div className="flex items-center justify-between rounded-lg bg-slate-50 px-3 py-2">
                                <dt className="font-medium text-slate-700">Test Reminders</dt>
                                <dd>{reminderLabel}</dd>
                            </div>
                        </dl>
                        <p className="text-xs text-slate-500">Adjust these settings anytime from the Settings panel.</p>
                    </article>
                </div>

                <form
                    onSubmit={handleChallengesSubmit}
                    className={`rounded-2xl border bg-white/95 p-5 shadow-sm space-y-4 ${highlightChallenges ? 'border-rose-300 ring-1 ring-rose-200' : 'border-slate-200'}`}
                >
                    <h2 className="text-lg font-semibold text-slate-900 dark:text-slate-100">Learning Challenges</h2>
                    <p className="text-sm text-slate-600">Select the areas you find tough. We’ll use this later to build a study plan for you.</p>
                    <div id="challengeList" className="max-h-64 overflow-y-auto rounded-lg border border-slate-200 p-2">
                        {Object.keys(groupedChallenges).length === 0 ? (
                            <p className="text-sm text-slate-500">No challenge options available yet.</p>
                        ) : (
                            Object.keys(groupedChallenges)
                                .sort()
                                .map((subject) => (
                                    <div key={subject} className="mb-3">
                                        <div className="challenge-subject font-semibold text-slate-700">{subject}</div>
                                        {Object.keys(groupedChallenges[subject])
                                            .sort()
                                            .map((subtopic) => (
                                                <div key={`${subject}-${subtopic}`} className="mt-1">
                                                    <div className="challenge-subtopic ml-4 text-sm italic text-slate-500">{subtopic}</div>
                                                    {groupedChallenges[subject][subtopic].map((opt) => {
                                                        const isChecked = selectedIds.includes(opt.id);
                                                        return (
                                                            <label
                                                                key={opt.id}
                                                                className={`ml-8 mt-2 flex items-start gap-2 text-sm rounded-md border px-2 py-1 transition ${isChecked ? 'bg-sky-50 border-sky-300 text-slate-700 shadow-sm' : 'bg-white border-slate-200 hover:bg-slate-50 text-slate-600'}`}
                                                                data-selected={isChecked ? 'true' : 'false'}
                                                            >
                                                                <input
                                                                    type="checkbox"
                                                                    className="challengeBox mt-1 h-4 w-4 rounded border-slate-300 text-sky-600 focus:ring-sky-500"
                                                                    data-id={opt.id}
                                                                    checked={isChecked}
                                                                    onChange={() => handleChallengeToggle(opt.id)}
                                                                    aria-checked={isChecked}
                                                                    aria-label={opt.label || opt.subtopic || opt.subject}
                                                                />
                                                                <span>{opt.label || opt.subtopic || opt.subject}</span>
                                                            </label>
                                                        );
                                                    })}
                                                </div>
                                            ))}
                                    </div>
                                ))
                        )}
                    </div>
                    <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <p className="text-xs text-slate-500">Selected: {selectedCount}</p>
                        <button
                            id="saveChallengesBtn"
                            type="submit"
                            className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60"
                            disabled={challengesSaving}
                        >
                            {challengesSaving ? 'Saving…' : 'Save Challenges'}
                        </button>
                    </div>
                </form>

                <RecentScoresPanel
                    title="Recent Scores"
                    summary={recentSummary}
                    legacyScores={legacyScores}
                    loading={loading}
                />
            </div>
        </section>
    );
}

function RecentScoresPanel({ summary, legacyScores, loading, title = 'Recent Scores' }) {
    if (loading) {
        return (
            <section className="rounded-2xl border border-slate-200 bg-white/95 p-5 shadow-sm space-y-3">
                <h2 className="text-lg font-semibold text-slate-800">{title}</h2>
                <p className="text-sm text-slate-600">Loading…</p>
            </section>
        );
    }

    const hasSummary = summary && Object.keys(summary).length > 0;
    const subjectScores = Array.isArray(summary?.subjects) ? summary.subjects : [];
    const cardScores = Array.isArray(summary?.cards) ? summary.cards : [];
    const highlightScores = Array.isArray(summary?.highlights) ? summary.highlights : [];
    const overallValue = summary?.overall ?? summary?.total ?? null;

    const formatScoreValue = (value) => {
        if (value == null) {
            return '—';
        }
        if (typeof value === 'number' && Number.isFinite(value)) {
            return `${Math.round(value)}%`;
        }
        if (typeof value === 'object') {
            if (typeof value.score === 'number') {
                return `${Math.round(value.score)}%`;
            }
            if (typeof value.value === 'number') {
                return `${Math.round(value.value)}%`;
            }
            if (typeof value.display === 'string') {
                return value.display;
            }
        }
        return String(value);
    };

    const renderCard = (item, index, fallbackLabel) => {
        const label = item?.subject || item?.name || item?.label || fallbackLabel || `Item ${index + 1}`;
        const primary = item?.latest ?? item?.score ?? item?.value ?? item?.percent ?? item?.percentage ?? item?.current ?? null;
        const secondary = item?.average ?? item?.avg ?? item?.trend ?? item?.previous ?? null;
        const note = item?.description || item?.note;
        return (
            <div key={item?.id || `${label}-${index}`} className="rounded-lg border border-slate-200 bg-white p-4 shadow-sm">
                <p className="text-xs font-semibold uppercase tracking-wide text-slate-500">{label}</p>
                {primary != null && <p className="mt-1 text-2xl font-bold text-slate-800">{formatScoreValue(primary)}</p>}
                {secondary != null && <p className="text-xs text-slate-500">Average: {formatScoreValue(secondary)}</p>}
                {note && <p className="mt-1 text-xs text-slate-500">{note}</p>}
            </div>
        );
    };

    if (hasSummary) {
        return (
            <section className="rounded-2xl border border-slate-200 bg-white/95 p-5 shadow-sm space-y-4">
                <h2 className="text-lg font-semibold text-slate-800">{title}</h2>
                <div className="space-y-4">
                    {overallValue != null && (
                        <div className="rounded-lg border border-slate-200 bg-slate-50 px-4 py-3">
                            <p className="text-xs font-semibold uppercase tracking-wide text-slate-500">Overall</p>
                            <p className="text-2xl font-bold text-slate-800">{formatScoreValue(overallValue)}</p>
                        </div>
                    )}
                    {(subjectScores.length || cardScores.length || highlightScores.length) ? (
                        <div className="grid gap-3 sm:grid-cols-2">
                            {subjectScores.map((item, index) => renderCard(item, index, 'Subject'))}
                            {cardScores.map((item, index) => renderCard(item, index + subjectScores.length, 'Summary'))}
                            {highlightScores.map((item, index) => renderCard(item, index + subjectScores.length + cardScores.length, 'Highlight'))}
                        </div>
                    ) : null}
                    {summary?.lastUpdated && (
                        <p className="text-xs text-slate-500">Last updated {summary.lastUpdated}</p>
                    )}
                    {overallValue == null && !subjectScores.length && !cardScores.length && !highlightScores.length && (
                        <pre className="whitespace-pre-wrap rounded-lg border border-slate-100 bg-slate-50 p-3 text-xs text-slate-500">{JSON.stringify(summary, null, 2)}</pre>
                    )}
                </div>
            </section>
        );
    }

    const subjectRows = Array.isArray(legacyScores?.bySubject) ? legacyScores.bySubject : [];
    const subtopicRows = Array.isArray(legacyScores?.bySubtopic) ? legacyScores.bySubtopic : [];

    if (!subjectRows.length && !subtopicRows.length) {
        return (
            <section className="rounded-2xl border border-slate-200 bg-white/95 p-5 shadow-sm space-y-3">
                <h2 className="text-lg font-semibold text-slate-800">{title}</h2>
                <p className="text-sm text-slate-600">No scores yet.</p>
            </section>
        );
    }

    return (
        <section className="rounded-2xl border border-slate-200 bg-white/95 p-5 shadow-sm space-y-4">
            <h2 className="text-lg font-semibold text-slate-800">{title}</h2>
            {subjectRows.length ? (
                <div>
                    <h3 className="text-sm font-semibold text-slate-700 uppercase tracking-wide">By Subject</h3>
                    <div className="mt-2 overflow-x-auto">
                        <table className="min-w-full divide-y divide-slate-200 text-sm">
                            <thead className="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                                <tr>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Subject</th>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Latest</th>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Average</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-200 text-slate-600">
                                {subjectRows.map((row, index) => (
                                    <tr key={`${row.subject}-${index}`}>
                                        <td className="px-3 py-2 font-medium text-slate-700">{row.subject}</td>
                                        <td className="px-3 py-2">{row.latest != null ? `${row.latest}%` : '—'}</td>
                                        <td className="px-3 py-2">{row.avg != null ? `${row.avg}%` : '—'}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            ) : null}
            {subtopicRows.length ? (
                <div>
                    <h3 className="text-sm font-semibold text-slate-700 uppercase tracking-wide">By Subtopic</h3>
                    <div className="mt-2 overflow-x-auto">
                        <table className="min-w-full divide-y divide-slate-200 text-sm">
                            <thead className="bg-slate-50 text-xs uppercase tracking-wide text-slate-500">
                                <tr>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Subject</th>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Subtopic</th>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Latest</th>
                                    <th scope="col" className="px-3 py-2 text-left font-semibold">Average</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-200 text-slate-600">
                                {subtopicRows.map((row, index) => (
                                    <tr key={`${row.subject}-${row.subtopic}-${index}`}>
                                        <td className="px-3 py-2 font-medium text-slate-700">{row.subject}</td>
                                        <td className="px-3 py-2">{row.subtopic}</td>
                                        <td className="px-3 py-2">{row.latest != null ? `${row.latest}%` : '—'}</td>
                                        <td className="px-3 py-2">{row.avg != null ? `${row.avg}%` : '—'}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            ) : null}
        </section>
    );
}

function SettingsView({ preferences, onApply, onSave, saving, status, onBack, loading }) {
    const [fontSize, setFontSize] = useState(preferences.fontSize);
    const [theme, setTheme] = useState(preferences.theme);

    useEffect(() => {
        setFontSize(preferences.fontSize);
    }, [preferences.fontSize]);

    useEffect(() => {
        setTheme(preferences.theme);
    }, [preferences.theme]);

    const fontSizeOptions = [
        { value: 'sm', label: 'Small', description: 'Compact text for dense layouts.' },
        { value: 'md', label: 'Medium', description: 'Balanced for most learners.' },
        { value: 'lg', label: 'Large', description: 'Larger text for improved legibility.' },
        { value: 'xl', label: 'Extra Large', description: 'Maximum size for easy reading.' },
    ];

    const themeOptions = [
        { value: 'light', label: 'Light', description: 'Bright background with dark text.' },
        { value: 'dark', label: 'Dark', description: 'Dim background with light text.' },
    ];

    const handleFontSizeChange = (event) => {
        const value = event.target.value;
        setFontSize(value);
        if (onApply) {
            onApply({ fontSize: value });
        }
    };

    const handleThemeChange = (event) => {
        const value = event.target.value;
        setTheme(value);
        if (onApply) {
            onApply({ theme: value });
        }
    };

    const handleSubmit = async (event) => {
        event.preventDefault();
        await onSave({ fontSize, theme });
    };

    return (
        <section id="settingsView" data-view="settings" tabIndex={-1} className="outline-none">
            <div className="max-w-4xl mx-auto space-y-6">
                <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between settings-header">
                    <div>
                        <h1 className="text-3xl font-bold text-slate-800 dark:text-slate-100">Settings</h1>
                        <p className="text-sm text-slate-500 dark:text-slate-300">Choose the font size and color mode that feel right for your reading style. Changes apply instantly.</p>
                    </div>
                    <button
                        type="button"
                        onClick={onBack}
                        className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-3 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 dark:bg-sky-500 dark:hover:bg-sky-400"
                    >
                        Back to Dashboard
                    </button>
                </div>

                <form onSubmit={handleSubmit} className="rounded-2xl border border-slate-200 dark:border-slate-700/70 bg-white/95 dark:bg-slate-900/80 p-5 shadow-sm space-y-6">
                    <fieldset className="space-y-3 settings-section">
                        <legend className="text-lg font-semibold text-slate-800 dark:text-slate-100">Font Size</legend>
                        <p className="text-sm text-slate-500 dark:text-slate-300">Pick the text size that feels comfortable on your device.</p>
                        <div className="grid gap-2 sm:grid-cols-2">
                            {fontSizeOptions.map((option) => (
                                <label
                                    key={option.value}
                                    className={`option-pill ${fontSize === option.value ? 'is-selected' : ''} flex items-center gap-3 rounded-lg border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-900/60 px-3 py-2 hover:border-sky-300 dark:hover:border-sky-400 focus-within:ring-2 focus-within:ring-sky-500`}
                                >
                                    <input
                                        type="radio"
                                        name="fontSize"
                                        value={option.value}
                                        checked={fontSize === option.value}
                                        onChange={handleFontSizeChange}
                                        className="h-4 w-4 text-sky-600 focus:ring-sky-500 dark:bg-slate-900 dark:border-slate-600"
                                    />
                                    <span className="flex flex-col">
                                        <span className="font-semibold text-slate-700 dark:text-slate-200">{option.label}</span>
                                        <span className="text-xs text-slate-500 dark:text-slate-400">{option.description}</span>
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>

                    <fieldset className="space-y-3 settings-section">
                        <legend className="text-lg font-semibold text-slate-800 dark:text-slate-100">Color Mode</legend>
                        <p className="text-sm text-slate-500 dark:text-slate-300">Choose between light and dark themes. We’ll remember your pick.</p>
                        <div className="grid gap-2 sm:grid-cols-2">
                            {themeOptions.map((option) => (
                                <label
                                    key={option.value}
                                    className={`option-pill ${theme === option.value ? 'is-selected ' : ''}flex items-center gap-3 rounded-lg border px-3 py-2 transition ${theme === option.value ? 'border-sky-400 ring-2 ring-sky-200 dark:ring-sky-500/40' : 'border-slate-200 dark:border-slate-600'} bg-white dark:bg-slate-900/60 hover:border-sky-300 dark:hover:border-sky-400`}
                                >
                                    <input
                                        type="radio"
                                        name="theme"
                                        value={option.value}
                                        checked={theme === option.value}
                                        onChange={handleThemeChange}
                                        className="h-4 w-4 text-sky-600 focus:ring-sky-500 dark:bg-slate-900 dark:border-slate-600"
                                    />
                                    <span className="flex flex-col">
                                        <span className="font-semibold text-slate-700 dark:text-slate-200">{option.label}</span>
                                        <span className="text-xs text-slate-500 dark:text-slate-400">{option.description}</span>
                                    </span>
                                </label>
                            ))}
                        </div>
                    </fieldset>

                    <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                        <p className="text-xs text-slate-500 dark:text-slate-400" role="status" aria-live="polite">
                            {status}
                        </p>
                        <button
                            type="submit"
                            className="inline-flex items-center justify-center rounded-lg bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500 focus-visible:ring-offset-2 disabled:opacity-60 dark:bg-sky-500 dark:hover:bg-sky-400"
                            disabled={saving || loading}
                        >
                            {saving ? 'Saving…' : 'Save Settings'}
                        </button>
                    </div>
                </form>

                <div className="rounded-2xl border border-slate-200 dark:border-slate-700/70 bg-slate-50 dark:bg-slate-900/60 p-5 text-sm text-slate-600 dark:text-slate-300">
                    <h2 className="text-base font-semibold text-slate-700 dark:text-slate-100">How settings work</h2>
                    <ul className="mt-2 list-disc space-y-1 pl-5">
                        <li>Changes apply instantly so you can preview them before saving.</li>
                        <li>We try to sync your preferences to the server. If that fails, they stay on this device.</li>
                        <li>Text and background colors now adjust automatically so light text sits on darker surfaces for readability.</li>
                    </ul>
                </div>
            </div>
        </section>
    );
}

function AuthScreen({ onLogin }) {
    const googleButton = useRef(null);
    const [mode, setMode] = useState('login');
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [formError, setFormError] = useState(null);
    const [formMessage, setFormMessage] = useState(null);
    const [submitting, setSubmitting] = useState(false);

    const handleCredentialResponse = useCallback(async (response) => {
        try {
            const res = await fetch(`${API_BASE_URL}/api/auth/google`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
                body: JSON.stringify({ credential: response.credential }),
            });

            if (!res.ok) {
                const text = await res.text();
                throw new Error(text || `Server responded with ${res.status}`);
            }

            const { user, token } = await res.json();
            onLogin(user, token);
        } catch (error) {
            console.error('Login Error:', error);
        }
    }, [onLogin]);

    useEffect(() => {
        const script = document.createElement('script');
        script.src = 'https://accounts.google.com/gsi/client';
        script.async = true;
        script.defer = true;
        script.onload = () => {
            if (window.google && google.accounts.id && googleButton.current) {
                google.accounts.id.initialize({
                    client_id: '828659988606-p9ct562f068p1778im2ck2o5iga89i7m.apps.googleusercontent.com',
                    callback: handleCredentialResponse,
                });
                google.accounts.id.renderButton(
                    googleButton.current,
                    { theme: "outline", size: "large", text: "signin_with", shape: "rectangular" }
                );
            }
        };
        script.onerror = () => {
            console.error('Google Sign-In script failed to load.');
        };

        document.body.appendChild(script);

        return () => {
            const goggleScript = document.querySelector('script[src="https://accounts.google.com/gsi/client"]');
            if (goggleScript) {
                document.body.removeChild(goggleScript);
            }
        };
    }, [handleCredentialResponse]);

    const modeLabel = mode === 'login' ? 'Log In' : 'Register';

    const toggleMode = () => {
        setMode((prev) => (prev === 'login' ? 'register' : 'login'));
        setFormError(null);
        setFormMessage(null);
        setPassword('');
    };

    const handleFormSubmit = async (event) => {
        event.preventDefault();
        setFormError(null);
        setFormMessage(null);

        if (!email.trim() || !password.trim()) {
            setFormError('Email and password are required');
            return;
        }

        setSubmitting(true);

        try {
            const endpoint = mode === 'login' ? '/api/login' : '/api/register';
            const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: email.trim(), password })
            });

            let body = {};
            try {
                body = await response.json();
            } catch (err) {
                body = {};
            }

            if (!response.ok) {
                throw new Error(body?.error || 'Unable to complete request');
            }

            if (body?.user && body?.token) {
                onLogin(body.user, body.token);
                setEmail('');
                setPassword('');
            } else {
                setFormMessage(body?.message || 'Success. You can now sign in.');
                if (mode === 'register') {
                    setMode('login');
                }
            }
        } catch (error) {
            setFormError(error instanceof Error ? error.message : 'Unable to complete request');
        } finally {
            setSubmitting(false);
        }
    };

    return (
        <>
            <div className="text-center max-w-md mx-auto">
                <h2 className="text-3xl font-extrabold text-slate-800 dark:text-slate-100 mb-2">Welcome!</h2>
                <p className="text-slate-500 dark:text-slate-300 mb-6">Sign in to save your progress across devices.</p>
                <form onSubmit={handleFormSubmit} className="bg-white dark:bg-slate-900/80 rounded-2xl shadow-md p-6 text-left space-y-4 border border-transparent dark:border-slate-700/60">
                    <div>
                        <label htmlFor="auth-email" className="block text-sm font-medium text-slate-600 dark:text-slate-300">Email</label>
                        <input
                            id="auth-email"
                            type="email"
                            value={email}
                            onChange={(event) => setEmail(event.target.value)}
                            className="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-700 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100 dark:placeholder-slate-500 dark:focus:border-sky-400 dark:focus:ring-sky-500"
                            autoComplete="email"
                            placeholder="you@example.com"
                            required
                        />
                    </div>
                    <div>
                        <label htmlFor="auth-password" className="block text-sm font-medium text-slate-600 dark:text-slate-300">Password</label>
                        <input
                            id="auth-password"
                            type="password"
                            value={password}
                            onChange={(event) => setPassword(event.target.value)}
                            className="mt-1 w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-700 shadow-sm focus:border-sky-500 focus:outline-none focus:ring-2 focus:ring-sky-200 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100 dark:placeholder-slate-500 dark:focus:border-sky-400 dark:focus:ring-sky-500"
                            autoComplete={mode === 'login' ? 'current-password' : 'new-password'}
                            placeholder="Enter your password"
                            required
                        />
                    </div>
                    {formError && <p className="text-sm text-red-600">{formError}</p>}
                    {formMessage && <p className="text-sm text-green-600">{formMessage}</p>}
                    <button
                        type="submit"
                        disabled={submitting}
                        className="w-full rounded-lg bg-sky-600 py-2 text-sm font-semibold text-white shadow hover:bg-sky-700 disabled:opacity-60"
                    >
                        {submitting ? 'Please wait…' : modeLabel}
                    </button>
                </form>
                <p className="mt-3 text-sm text-slate-600 dark:text-slate-300">
                    {mode === 'login' ? 'Need an account?' : 'Already have an account?'}{' '}
                    <button
                        type="button"
                        onClick={toggleMode}
                        className="font-semibold text-sky-600 hover:text-sky-800 dark:text-sky-300 dark:hover:text-sky-200"
                    >
                        {mode === 'login' ? 'Register' : 'Log in'}
                    </button>
                </p>
                <div className="my-6 flex items-center justify-center gap-3 text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500">
                    <span className="h-px w-12 bg-slate-200" aria-hidden="true"></span>
                    <span>Or continue with</span>
                    <span className="h-px w-12 bg-slate-200" aria-hidden="true"></span>
                </div>
                <div ref={googleButton} className="flex justify-center"></div>
                <p className="mt-6 text-xs text-slate-500 dark:text-slate-400">
                    Admins: Sign in with Google to access your dashboard.
                </p>
            </div>
        </>
    );
}

function AdminRoleBadge({ role }) {
    const label = role === 'super_admin'
        ? 'Super Admin'
        : role === 'org_admin'
            ? 'Organization Admin'
            : 'Student';
    const palette = role === 'super_admin'
        ? 'bg-purple-100 text-purple-700 dark:bg-purple-500/20 dark:text-purple-200'
        : role === 'org_admin'
            ? 'bg-sky-100 text-sky-700 dark:bg-sky-500/20 dark:text-sky-200'
            : 'bg-slate-200 text-slate-700 dark:bg-slate-700 dark:text-slate-200';
    return (
        <span className={`inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold ${palette}`}>
            {label}
        </span>
    );
}

function formatDateTime(value) {
    if (!value) {
        return '—';
    }
    try {
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) {
            return '—';
        }
        return date.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
    } catch (error) {
        return '—';
    }
}

function OrganizationSummaryView({ summary }) {
    if (!summary) {
        return null;
    }

    const organization = summary.organization || {};
    const users = Array.isArray(summary.users) ? summary.users : [];

    return (
        <section className="mt-10">
            <div className="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4">
                <div>
                    <h2 className="text-xl font-semibold text-slate-800 dark:text-slate-100">
                        Organization: {organization.name || 'Unknown'}
                    </h2>
                    <p className="mt-1 text-sm text-slate-500 dark:text-slate-400">
                        Roster and recent quiz activity (up to five recent attempts per learner).
                    </p>
                </div>
                <div className="text-sm text-slate-500 dark:text-slate-400">
                    {users.length} {users.length === 1 ? 'member' : 'members'}
                </div>
            </div>

            <div className="mt-6 overflow-x-auto rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700/60 dark:bg-slate-900/60">
                <table className="min-w-full divide-y divide-slate-200 dark:divide-slate-700">
                    <thead className="bg-slate-50 dark:bg-slate-800/60">
                        <tr>
                            <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Learner</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Email</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Last Login</th>
                            <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Recent Quiz Attempts</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-slate-100 bg-white text-sm dark:divide-slate-800 dark:bg-slate-900/80">
                        {users.length === 0 && (
                            <tr>
                                <td colSpan={4} className="px-4 py-6 text-center text-slate-500 dark:text-slate-400">
                                    No users are linked to this organization yet.
                                </td>
                            </tr>
                        )}
                        {users.map((user) => {
                            const attempts = Array.isArray(user.quizAttempts) ? user.quizAttempts : [];
                            return (
                                <tr key={user.id} className="hover:bg-slate-50 dark:hover:bg-slate-800/60">
                                    <td className="px-4 py-3 font-medium text-slate-700 dark:text-slate-100">
                                        {user.name || 'Learner'}
                                    </td>
                                    <td className="px-4 py-3 text-slate-500 dark:text-slate-300">
                                        {user.email || '—'}
                                    </td>
                                    <td className="px-4 py-3 text-slate-500 dark:text-slate-300">
                                        {formatDateTime(user.last_login)}
                                    </td>
                                    <td className="px-4 py-3 text-slate-600 dark:text-slate-200">
                                        {attempts.length === 0 ? (
                                            <span className="text-xs text-slate-500 dark:text-slate-400">No recent attempts</span>
                                        ) : (
                                            <ul className="space-y-1 text-xs">
                                                {attempts.map((attempt, index) => (
                                                    <li key={`${user.id}-${index}`} className="flex flex-col sm:flex-row sm:items-center sm:gap-2">
                                                        <span className="font-semibold text-slate-700 dark:text-slate-100">{attempt.subject || 'Subject N/A'}</span>
                                                        <span className="text-slate-500 dark:text-slate-300">
                                                            {attempt.quiz_type || 'Quiz'}
                                                        </span>
                                                        <span className="text-slate-500 dark:text-slate-300">
                                                            Score: {attempt.scaled_score != null ? attempt.scaled_score : '—'}
                                                        </span>
                                                        <span className="text-slate-400 dark:text-slate-400">
                                                            {formatDateTime(attempt.attempted_at)}
                                                        </span>
                                                    </li>
                                                ))}
                                            </ul>
                                        )}
                                    </td>
                                </tr>
                            );
                        })}
                    </tbody>
                </table>
            </div>
        </section>
    );
}

function SuperAdminDashboard({ user, token, onLogout }) {
    const [organizations, setOrganizations] = useState([]);
    const [loadingOrgs, setLoadingOrgs] = useState(true);
    const [orgError, setOrgError] = useState('');
    const [selectedOrgId, setSelectedOrgId] = useState(null);
    const [orgSummary, setOrgSummary] = useState(null);
    const [summaryLoading, setSummaryLoading] = useState(false);
    const [summaryError, setSummaryError] = useState('');

    const loadOrganizations = useCallback(async () => {
        setLoadingOrgs(true);
        setOrgError('');
        try {
            const headers = token ? { Authorization: `Bearer ${token}` } : undefined;
            const data = await fetchJSON(`${API_BASE_URL}/api/admin/organizations`, { headers });
            const list = Array.isArray(data?.organizations)
                ? data.organizations
                : Array.isArray(data)
                    ? data
                    : [];
            setOrganizations(list);
        } catch (error) {
            setOrgError(error?.message || 'Unable to load organizations');
        } finally {
            setLoadingOrgs(false);
        }
    }, [token]);

    const loadOrgSummary = useCallback(async (orgId) => {
        if (!orgId) {
            setOrgSummary(null);
            setSelectedOrgId(null);
            return;
        }
        setSelectedOrgId(orgId);
        setSummaryLoading(true);
        setSummaryError('');
        try {
            const headers = token ? { Authorization: `Bearer ${token}` } : undefined;
            const data = await fetchJSON(`${API_BASE_URL}/api/admin/org-summary?organization_id=${encodeURIComponent(orgId)}`, { headers });
            setOrgSummary(data);
        } catch (error) {
            setSummaryError(error?.message || 'Unable to load organization summary');
        } finally {
            setSummaryLoading(false);
        }
    }, [token]);

    useEffect(() => {
        loadOrganizations();
    }, [loadOrganizations]);

    useEffect(() => {
        if (!organizations.length) {
            return;
        }
        if (selectedOrgId != null) {
            return;
        }
        loadOrgSummary(organizations[0].id);
    }, [organizations, selectedOrgId, loadOrgSummary]);

    return (
        <div className="min-h-screen bg-slate-50 py-10 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
            <div className="mx-auto flex max-w-6xl flex-col gap-8 px-4">
                <header className="flex flex-col gap-4 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900/70 sm:flex-row sm:items-center sm:justify-between">
                    <div>
                        <h1 className="text-2xl font-bold text-slate-900 dark:text-white">Welcome back, {user?.name || user?.email || 'Administrator'}</h1>
                        <div className="mt-2 flex flex-wrap items-center gap-2 text-sm text-slate-500 dark:text-slate-300">
                            <AdminRoleBadge role={user?.role} />
                            <span>Platform-wide access</span>
                        </div>
                    </div>
                    <div className="flex items-center gap-3">
                        <button
                            type="button"
                            onClick={loadOrganizations}
                            className="rounded-full bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600"
                        >
                            Refresh Overview
                        </button>
                        <button
                            type="button"
                            onClick={onLogout}
                            className="rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500"
                        >
                            Sign out
                        </button>
                    </div>
                </header>

                <section className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900/70">
                    <div className="mb-4 flex items-center justify-between">
                        <div>
                            <h2 className="text-xl font-semibold text-slate-800 dark:text-slate-100">Partner organizations</h2>
                            <p className="text-sm text-slate-500 dark:text-slate-400">Select an organization to view its roster and quiz activity.</p>
                        </div>
                    </div>

                    {loadingOrgs ? (
                        <p className="py-4 text-sm text-slate-500 dark:text-slate-300">Loading organizations…</p>
                    ) : orgError ? (
                        <div className="rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200">
                            {orgError}
                        </div>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="min-w-full divide-y divide-slate-200 text-sm dark:divide-slate-700">
                                <thead className="bg-slate-50 dark:bg-slate-800/60">
                                    <tr>
                                        <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Organization</th>
                                        <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Members</th>
                                        <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Recent Activity</th>
                                        <th className="px-4 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500 dark:text-slate-400">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-slate-100 bg-white dark:divide-slate-800 dark:bg-slate-900/80">
                                    {organizations.length === 0 && (
                                        <tr>
                                            <td colSpan={4} className="px-4 py-6 text-center text-slate-500 dark:text-slate-400">
                                                No partner organizations found yet.
                                            </td>
                                        </tr>
                                    )}
                                    {organizations.map((org) => (
                                        <tr key={org.id} className={selectedOrgId === org.id ? 'bg-sky-50 dark:bg-sky-500/10' : 'hover:bg-slate-50 dark:hover:bg-slate-800/60'}>
                                            <td className="px-4 py-3 font-medium text-slate-700 dark:text-slate-100">{org.name}</td>
                                            <td className="px-4 py-3 text-slate-500 dark:text-slate-300">{org.userCount ?? 0}</td>
                                            <td className="px-4 py-3 text-slate-500 dark:text-slate-300">{formatDateTime(org.recentActivity)}</td>
                                            <td className="px-4 py-3">
                                                <button
                                                    type="button"
                                                    onClick={() => loadOrgSummary(org.id)}
                                                    className="rounded-full bg-sky-600 px-3 py-1 text-xs font-semibold text-white shadow hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500"
                                                >
                                                    View Org
                                                </button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </section>

                <section className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900/70">
                    {summaryLoading ? (
                        <p className="text-sm text-slate-500 dark:text-slate-300">Loading organization summary…</p>
                    ) : summaryError ? (
                        <div className="space-y-3">
                            <div className="rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200">
                                {summaryError}
                            </div>
                            <button
                                type="button"
                                onClick={() => loadOrgSummary(selectedOrgId)}
                                className="inline-flex items-center rounded-full bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600"
                            >
                                Try again
                            </button>
                        </div>
                    ) : orgSummary ? (
                        <OrganizationSummaryView summary={orgSummary} />
                    ) : (
                        <p className="text-sm text-slate-500 dark:text-slate-300">Select an organization to view details.</p>
                    )}
                </section>
            </div>
        </div>
    );
}

function OrgAdminDashboard({ user, token, onLogout }) {
    const [summary, setSummary] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState('');

    const loadSummary = useCallback(async () => {
        setLoading(true);
        setError('');
        try {
            const headers = token ? { Authorization: `Bearer ${token}` } : undefined;
            const data = await fetchJSON(`${API_BASE_URL}/api/admin/org-summary`, { headers });
            setSummary(data);
        } catch (err) {
            setError(err?.message || 'Unable to load organization data');
        } finally {
            setLoading(false);
        }
    }, [token]);

    useEffect(() => {
        loadSummary();
    }, [loadSummary]);

    const organizationName = summary?.organization?.name || user?.organization_name || 'Your organization';

    return (
        <div className="min-h-screen bg-slate-50 py-10 text-slate-900 dark:bg-slate-950 dark:text-slate-100">
            <div className="mx-auto flex max-w-6xl flex-col gap-8 px-4">
                <header className="flex flex-col gap-4 rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900/70 sm:flex-row sm:items-center sm:justify-between">
                    <div>
                        <h1 className="text-2xl font-bold text-slate-900 dark:text-white">{organizationName}</h1>
                        <div className="mt-2 flex flex-wrap items-center gap-2 text-sm text-slate-500 dark:text-slate-300">
                            <AdminRoleBadge role={user?.role} />
                            <span>Organization dashboard</span>
                        </div>
                    </div>
                    <div className="flex items-center gap-3">
                        <button
                            type="button"
                            onClick={loadSummary}
                            className="rounded-full bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600"
                        >
                            Refresh Data
                        </button>
                        <button
                            type="button"
                            onClick={onLogout}
                            className="rounded-full bg-sky-600 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-sky-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-sky-500"
                        >
                            Sign out
                        </button>
                    </div>
                </header>

                <section className="rounded-3xl border border-slate-200 bg-white p-6 shadow-sm dark:border-slate-800 dark:bg-slate-900/70">
                    {loading ? (
                        <p className="text-sm text-slate-500 dark:text-slate-300">Loading organization summary…</p>
                    ) : error ? (
                        <div className="space-y-3">
                            <div className="rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200">
                                {error}
                            </div>
                            <button
                                type="button"
                                onClick={loadSummary}
                                className="inline-flex items-center rounded-full bg-slate-200 px-4 py-2 text-sm font-semibold text-slate-700 transition hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-100 dark:hover:bg-slate-600"
                            >
                                Try again
                            </button>
                        </div>
                    ) : (
                        <OrganizationSummaryView summary={summary} />
                    )}
                </section>
            </div>
        </div>
    );
}

function DetailedProgressView({ subject, progressData, onBack }) {
    const attempts = Array.isArray(progressData?.attempts) ? progressData.attempts : [];
    const lastAttempt = progressData?.lastAttempt || (attempts.length ? attempts[0] : null);
    const totalPremade = typeof progressData?.totalPremadeExams === 'number' ? progressData.totalPremadeExams : 0;
    const completedCount = typeof progressData?.completedCount === 'number' ? progressData.completedCount : 0;
    const completionPercentage = typeof progressData?.completionPercentage === 'number' ? progressData.completionPercentage : 0;
    const averageScaledScore = typeof progressData?.averageScaledScore === 'number' ? progressData.averageScaledScore : null;

    const formatDate = (value) => {
        if (!value) return '—';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) {
            return '—';
        }
        return date.toLocaleString(undefined, { dateStyle: 'medium', timeStyle: 'short' });
    };

    const formatScore = (value) => (value == null ? 'N/A' : Math.round(value));
    const formatPassStatus = (passed) => {
        if (passed === true) return { label: 'Passed', className: 'text-emerald-600' };
        if (passed === false) return { label: 'Keep Practicing', className: 'text-amber-600' };
        return { label: '—', className: 'text-slate-500' };
    };

    const recentAttempts = attempts.slice(0, 10);

    return (
        <div className="fade-in" data-subject={subject}>
            <header className="flex items-center pb-4 mb-4 border-b">
                <button type="button" onClick={onBack} className="flex items-center gap-1 text-sm text-sky-600 hover:text-sky-800 font-semibold"><ArrowLeftIcon /> Back to Dashboard</button>
            </header>
            <h2 className="text-3xl font-extrabold subject-accent-heading mb-4">{subject} Progress Details</h2>
            <div className="space-y-6">
                <section className="rounded-lg border border-slate-200 bg-slate-50 p-5 shadow-inner panel-surface">
                    <h3 className="text-lg font-semibold subject-accent-heading">Premade Exam Progress</h3>
                    <div className="mt-3 h-3 w-full rounded-full bg-white/70">
                        <div className="h-3 rounded-full bg-sky-500 transition-all duration-300" style={{ width: `${Math.min(100, Math.max(0, completionPercentage))}%` }}></div>
                    </div>
                    <div className="mt-2 flex flex-wrap justify-between text-sm text-slate-600">
                        <span>{completedCount} of {totalPremade} exams passed</span>
                        <span>{completionPercentage}% complete</span>
                    </div>
                    {averageScaledScore != null && (
                        <p className="mt-2 text-sm text-slate-600">
                            Average scaled score: <span className="font-semibold text-slate-800">{averageScaledScore}</span>
                        </p>
                    )}
                </section>

                <section className="rounded-lg border border-slate-200 bg-white p-5 shadow-sm panel-surface">
                    <h3 className="text-lg font-semibold subject-accent-heading mb-2">Last Exam</h3>
                    {lastAttempt ? (
                        <div className="space-y-2">
                            <p className="text-xl font-bold text-slate-900">{lastAttempt.quizTitle || 'Exam'}</p>
                            <p className="text-sm text-slate-600 break-words">Code: <span className="font-mono text-slate-700">{lastAttempt.quizCode || '—'}</span></p>
                            <p className="text-lg font-semibold text-slate-800">
                                Scaled Score: <span className="text-sky-700">{formatScore(lastAttempt.scaledScore)}</span>
                                <span className={`ml-3 text-sm font-semibold ${formatPassStatus(lastAttempt.passed).className}`}>
                                    {formatPassStatus(lastAttempt.passed).label}
                                </span>
                            </p>
                            {typeof lastAttempt.score === 'number' && typeof lastAttempt.totalQuestions === 'number' && (
                                <p className="text-sm text-slate-600">Correct: {lastAttempt.score} / {lastAttempt.totalQuestions}</p>
                            )}
                            <p className="text-sm text-slate-500">Completed {formatDate(lastAttempt.attemptedAt)}</p>
                        </div>
                    ) : (
                        <p className="text-sm text-slate-600">No completed exams recorded yet. Start a premade exam to see your progress here.</p>
                    )}
                </section>

                <section>
                    <h3 className="text-lg font-semibold subject-accent-heading mb-3">Recent Attempts</h3>
                    {recentAttempts.length ? (
                        <ul className="space-y-3">
                            {recentAttempts.map((attempt, index) => {
                                const { label, className } = formatPassStatus(attempt.passed);
                                return (
                                    <li key={`${attempt.quizCode || 'attempt'}-${index}`} className="rounded-lg border border-slate-200 bg-white p-4 shadow-sm panel-surface">
                                        <div className="flex items-start justify-between gap-3">
                                            <div>
                                                <p className="font-semibold text-slate-800">{attempt.quizTitle || attempt.quizCode || `Exam ${index + 1}`}</p>
                                                <p className="text-xs text-slate-500">Code: {attempt.quizCode || '—'}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-lg font-bold text-slate-900">{formatScore(attempt.scaledScore)}</p>
                                                <p className={`text-xs font-semibold ${className}`}>{label}</p>
                                            </div>
                                        </div>
                                        <div className="mt-2 flex flex-wrap justify-between text-xs text-slate-500">
                                            <span>{formatDate(attempt.attemptedAt)}</span>
                                            {typeof attempt.score === 'number' && typeof attempt.totalQuestions === 'number' && (
                                                <span>{attempt.score} / {attempt.totalQuestions} correct</span>
                                            )}
                                        </div>
                                    </li>
                                );
                            })}
                        </ul>
                    ) : (
                        <p className="text-sm text-slate-600">No attempts logged yet. Complete a premade exam to see detailed history.</p>
                    )}
                </section>
            </div>
        </div>
    );
}

function ProgressDashboard({ progress, onSubjectClick, passedSubjectIds }) {
    // Local subject id + badge path maps (mirrors the main app maps)
    const SUBJECT_ID_MAP = {
        'Math': 'math',
        'Science': 'science',
        'Social Studies': 'social_studies',
        'Reasoning Through Language Arts (RLA)': 'rla',
        'RLA': 'rla',
    };
    const BADGE_IMG_PATHS = {
        math: '/badges/math.svg',
        science: '/badges/science.svg',
        social_studies: '/badges/social-studies.svg',
        rla: '/badges/rla.svg',
    };
    const totalAttempts = Object.values(progress).reduce((acc, subjectData) => acc + (subjectData?.attemptCount || 0), 0);
    const subjects = SUBJECT_PROGRESS_KEYS;
    const getScoreTheme = (subject) => SUBJECT_COLORS[subject] || {};
    const getCardStyles = (subject) => {
        const theme = getScoreTheme(subject);
        const gradient = SUBJECT_BG_GRADIENTS[subject];
        const style = {
            borderColor: theme.scoreBorder || 'var(--border-subtle)',
            color: theme.scoreText || theme.text || '#ffffff',
            backgroundColor: theme.scoreBackground || theme.background || 'var(--bg-overlay)',
        };
        if (gradient) {
            style.backgroundImage = gradient;
        }
        return style;
    };
    const isDark = (() => {
        if (typeof document === 'undefined') return false;
        const root = document.documentElement;
        return root.classList.contains('dark') || root.getAttribute('data-theme') === 'dark' || document.body.classList.contains('dark');
    })();
    const totalCardStyle = isDark
        ? {
            borderColor: DEFAULT_COLOR_SCHEME.scoreBorder || 'var(--border-subtle)',
            backgroundColor: 'rgba(15,23,42,0.9)',
            color: '#f8fafc',
        }
        : {
            borderColor: 'rgba(148,163,184,0.35)',
            backgroundColor: '#ffffff',
            backgroundImage: 'linear-gradient(180deg, #ffffff 0%, #f8fafc 100%)',
            color: '#0f172a',
        };

    const formatAverage = (value) => (value == null ? 'N/A' : Math.round(value));

    return (
        <div className="grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
            <div className="p-4 rounded-lg text-center shadow-inner border sm:col-span-3 lg:col-span-1" style={totalCardStyle}>
                <p className="text-sm font-semibold uppercase tracking-wider" style={{ color: isDark ? 'rgba(248,250,252,0.75)' : '#334155' }}>
                    Total Attempts
                </p>
                <p className="text-4xl font-bold" style={{ color: isDark ? '#ffffff' : '#0f172a' }}>{totalAttempts}</p>
            </div>
            {subjects.map(subject => {
                const data = progress[subject] || {};
                const cardStyle = getCardStyles(subject);
                const completionPercent = Math.min(100, Math.max(0, data.completionPercentage || 0));
                const completedCount = data.completedCount || 0;
                const totalPremade = data.totalPremadeExams || 0;
                const averageScore = formatAverage(data.averageScaledScore);
                const lastTitle = data.lastAttempt?.quizTitle;
                const lastScore = data.lastAttempt?.scaledScore;
                const truncatedTitle = lastTitle && lastTitle.length > 52 ? `${lastTitle.slice(0, 49)}…` : lastTitle;
                const subjectId = SUBJECT_ID_MAP[subject] || null;
                const isPassed = subjectId && passedSubjectIds instanceof Set ? passedSubjectIds.has(subjectId) : false;
                const badgeSrc = subjectId ? BADGE_IMG_PATHS[subjectId] : null;
                const shortLabel = (SUBJECT_SHORT_LABELS && SUBJECT_SHORT_LABELS[subject]) || (subjectId === 'rla' ? 'RLA' : subject);
                return (
                    <button
                        key={subject}
                        id={subjectId ? `subject-card-${subjectId}` : undefined}
                        onClick={() => onSubjectClick(subject)}
                        className="subject-card p-4 rounded-lg text-left shadow-inner border transition-transform duration-200 hover:-translate-y-1"
                        style={cardStyle}
                    >
                        {isPassed && (
                            <span className="subject-badge-wrap" aria-hidden>
                                {badgeSrc && (
                                    <img
                                        src={badgeSrc}
                                        alt=""
                                        className="subject-badge"
                                        onError={(e) => {
                                            try {
                                                const el = e.currentTarget;
                                                el.style.display = 'none';
                                                const pill = el.nextElementSibling;
                                                if (pill) pill.style.display = 'inline-block';
                                            } catch {}
                                        }}
                                    />
                                )}
                                <span className="subject-badge-pill" style={{ display: 'none' }}>{shortLabel}</span>
                            </span>
                        )}
                        <p className="text-sm font-semibold uppercase tracking-wider" style={{ color: 'rgba(255,255,255,0.85)' }}>
                            {subject}
                        </p>
                        <div className="mt-3 h-2 w-full rounded-full" style={{ backgroundColor: isDark ? 'rgba(255,255,255,0.3)' : '#e2e8f0' }}>
                            <div className="h-2 rounded-full shadow-sm" style={{ width: `${completionPercent}%`, opacity: 0.95, backgroundColor: isDark ? '#ffffff' : '#0f172a' }}></div>
                        </div>
                        <p className="mt-2 text-sm" style={{ color: cardStyle.color }}>
                            {completedCount} of {totalPremade} exams passed
                        </p>
                        <p className="text-xs" style={{ color: 'rgba(255,255,255,0.85)' }}>
                            Avg scaled score: <span className="font-semibold">{averageScore}</span>
                        </p>
                        {truncatedTitle && (
                            <p className="mt-2 text-xs" style={{ color: 'rgba(255,255,255,0.8)' }}>
                                Last exam: <span className="font-semibold">{truncatedTitle}</span>
                                {lastScore != null && ` (${Math.round(lastScore)})`}
                            </p>
                        )}
                    </button>
                );
            })}
        </div>
    );
}

function VocabularyTicker({ vocabulary, onWordClick }) {
    const entries = useMemo(() => {
        if (!vocabulary) return [];
        return Object.entries(vocabulary)
            .flatMap(([subject, words]) => {
                if (!Array.isArray(words) || !words.length) return [];
                return words
                    .slice(0, MAX_TICKER_WORDS_PER_SUBJECT)
                    .map((word) => ({ subject, term: word.term }))
                    .filter((item) => item.term);
            });
    }, [vocabulary]);

    if (!entries.length) {
        return null;
    }

    const repeatedEntries = [...entries, ...entries];

    return (
        <div
            className="vocabulary-spotlight glass rounded-2xl overflow-hidden shadow-lg animate-floatIn"
            style={{ borderColor: 'var(--border-strong)', backgroundColor: 'var(--bg-overlay)' }}
        >
            <div
                className="flex items-center justify-between px-4 py-3"
                style={{ backgroundColor: 'var(--nav-active-bg)', color: 'var(--nav-active-text)' }}
            >
                <span className="text-sm font-semibold uppercase tracking-wide">Vocabulary Spotlight</span>
                <span
                    className="hidden text-xs sm:inline"
                    style={{ color: 'var(--text-secondary)', opacity: 0.75 }}
                >
                    Click any word to view the full list.
                </span>
            </div>
            <div className="vocabulary-ticker">
                <div className="vocabulary-ticker-track">
                    {repeatedEntries.map((item, index) => {
                        const color = VOCABULARY_SUBJECT_COLORS[item.subject] || '#0f172a';
                        const shortLabel = SUBJECT_SHORT_LABELS[item.subject] || item.subject;
                        return (
                            <button
                                key={`${item.subject}-${item.term}-${index}`}
                                type="button"
                                onClick={() => onWordClick?.(item.subject)}
                                className="vocabulary-chip"
                                title={`View ${item.subject} vocabulary`}
                            >
                                <span className="vocabulary-chip-dot" style={{ backgroundColor: color }}></span>
                                <span style={{ color: 'var(--text-primary)' }}>{item.term}</span>
                                <span className="vocabulary-chip-label" style={{ color: 'var(--text-secondary)' }}>{shortLabel}</span>
                            </button>
                        );
                    })}
                </div>
            </div>
        </div>
    );
}

function VocabularyOverview({ vocabulary, onWordClick }) {
    const subjects = Object.entries(vocabulary || {}).filter(([, words]) => Array.isArray(words) && words.length > 0);

    if (!subjects.length) {
        return null;
    }

    return (
        <div className="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4">
            {subjects.map(([subjectName, words]) => {
                const colorScheme = SUBJECT_COLORS[subjectName] || {};
                const headerGradient = SUBJECT_BG_GRADIENTS[subjectName];
                const headerStyle = headerGradient
                    ? { backgroundImage: headerGradient }
                    : { backgroundColor: colorScheme.background || 'var(--nav-active-bg)' };
                const previewWords = words.slice(0, 3);

                return (
                    <div
                        key={subjectName}
                        className="subject-card glass animate-floatIn flex h-full flex-col overflow-hidden rounded-2xl shadow-lg"
                        style={{ backgroundColor: 'var(--bg-surface)', borderColor: 'var(--border-strong)' }}
                    >
                        <div
                            className="flex items-center justify-between px-4 py-3 shadow-inner rounded-t-2xl"
                            style={{
                                ...(headerStyle || {}),
                                backgroundColor: headerStyle?.backgroundColor || undefined,
                                backgroundImage: headerStyle?.backgroundImage || undefined,
                                color: colorScheme.text || 'var(--nav-active-text)',
                            }}
                        >
                            <h3 className="text-lg font-semibold drop-shadow-sm">{subjectName}</h3>
                            <span className="text-xs uppercase tracking-wide" style={{ color: colorScheme.text || 'var(--nav-active-text)', opacity: 0.85 }}>
                                Key Terms
                            </span>
                        </div>
                        <div className="flex flex-1 flex-col gap-4 p-4">
                            <ul className="space-y-2">
                                {previewWords.map((word) => (
                                    <li
                                        key={word.term}
                                        className="rounded-lg px-3 py-2 text-sm font-medium shadow-sm"
                                        style={{ backgroundColor: 'var(--bg-muted)', color: 'var(--text-secondary)' }}
                                    >
                                        {word.term}
                                    </li>
                                ))}
                            </ul>
                            <div className="mt-auto">
                                <div className="mb-1 text-xs font-medium" style={{ color: 'var(--text-secondary)' }}>
                                    Study Progress
                                </div>
                                <div className="h-2 w-full overflow-hidden rounded-full" style={{ backgroundColor: 'var(--border-subtle)' }}>
                                    <div
                                        className="h-full rounded-full transition-all duration-500"
                                        style={{ width: '40%', backgroundColor: colorScheme.accent || 'var(--accent)' }}
                                    />
                                </div>
                            </div>
                            <button
                                type="button"
                                onClick={() => onWordClick?.(subjectName)}
                                className="mt-2 inline-flex items-center justify-center rounded-lg px-4 py-2 text-sm font-semibold shadow-sm transition"
                                data-role="secondary"
                                style={{
                                    color: colorScheme.accentText || 'var(--accent-text)',
                                    borderColor: colorScheme.accent || 'var(--accent)',
                                }}
                            >
                                View full list
                            </button>
                        </div>
                    </div>
                );
            })}
        </div>
    );
}

function SubjectVocabularySection({ subject, words, theme = 'light' }) {
    if (!Array.isArray(words) || !words.length) {
        return null;
    }

    const isDarkMode = theme === 'dark';
    const colorScheme = SUBJECT_COLORS[subject] || {};
    const accentColor = colorScheme.accent || colorScheme.text || '#0f172a';
    const textColor = colorScheme.text || '#0f172a';
    const lightTint = SUBJECT_LIGHT_TINTS[subject] || 'rgba(148,163,184,0.28)';
    const lightSurface = SUBJECT_LIGHT_SURFACE_GRADIENTS[subject];

    const containerClasses = `animate-floatIn rounded-2xl p-6 mb-6 border transition-colors duration-300 ${isDarkMode ? 'bg-slate-900/60 border-slate-700/60' : 'bg-white shadow-xl'}`;
    const containerStyle = isDarkMode
        ? undefined
        : {
            backgroundColor: '#ffffff',
            backgroundImage: lightSurface || undefined,
            borderColor: lightTint,
            boxShadow: '0 22px 45px -32px rgba(15,23,42,0.45)',
        };

    const headerTextStyle = isDarkMode ? undefined : { color: accentColor };
    const subtextStyle = isDarkMode ? undefined : { color: textColor, opacity: 0.75 };

    const cardClasses = `rounded-xl p-4 shadow-sm border transition-all ${isDarkMode ? 'bg-slate-900/60 border-slate-700/60' : 'bg-white'}`;
    const cardStyle = isDarkMode
        ? undefined
        : {
            backgroundColor: '#ffffff',
            borderColor: lightTint,
            borderLeft: `4px solid ${accentColor}`,
            boxShadow: '0 14px 32px -28px rgba(15,23,42,0.35)',
        };

    const termStyle = isDarkMode ? undefined : { color: textColor };
    const definitionStyle = isDarkMode ? undefined : { color: textColor, opacity: 0.85 };
    const exampleStyle = isDarkMode ? undefined : { color: accentColor, opacity: 0.8 };

    return (
        <div id="subject-vocabulary-section" className={containerClasses} style={containerStyle}>
            <div className="flex flex-col gap-1 md:flex-row md:items-center md:justify-between">
                <div>
                    <h3 className="text-xl font-bold text-slate-900 dark:text-slate-100" style={headerTextStyle}>Subject Vocabulary</h3>
                    <p className="text-sm text-slate-600 dark:text-slate-300" style={subtextStyle}>Scroll through the complete list of key terms for {subject}.</p>
                </div>
            </div>
            <div className="mt-4 max-h-96 overflow-y-auto pr-1 space-y-3">
                {words.map((word) => (
                    <div key={word.term} className={cardClasses} style={cardStyle}>
                        <p className="text-lg font-semibold text-slate-900 dark:text-slate-100" style={termStyle}>{word.term}</p>
                        {word.definition && <p className="text-sm text-slate-600 dark:text-slate-300 mt-2 leading-relaxed" style={definitionStyle}>{word.definition}</p>}
                        {word.example && <p className="text-xs text-slate-500 dark:text-slate-400 italic mt-2" style={exampleStyle}>Example: {word.example}</p>}
                    </div>
                ))}
            </div>
        </div>
    );
}

const ICONS = { GlobeIcon, BookOpenIcon, BeakerIcon, CalculatorIcon, ChartBarIcon, VariableIcon, ShapesIcon };

function FormulaDisplay({ latex, className = '' }) {
    const safeLatex = normalizeFormulaLatex(latex);
    let html = '';

    try {
        html = renderLatexToHtml(safeLatex);
    } catch (error) {
        console.warn('Formula render failed:', error?.message || error);
        html = escapeHtml(typeof safeLatex === 'string' ? safeLatex : '');
    }

    return (
        <span className={className} dangerouslySetInnerHTML={{ __html: html }} />
    );
}

function ScienceFormulaSheet({ onClose }) {
    return (
        <div
            className="fixed inset-0 z-50 flex items-center justify-center"
            style={{ backgroundColor: 'var(--modal-overlay)' }}
        >
            <div className="formula-sheet science-formula-sheet rounded-xl shadow-2xl max-w-lg w-11/12 p-6 relative">
                <button
                    className="formula-sheet-close absolute top-3 right-3 font-bold hover:opacity-80 transition-opacity"
                    onClick={onClose}
                    type="button"
                    aria-label="Close science formula sheet"
                    style={{ color: 'inherit' }}
                >
                    ✕
                </button>

                <h2 className="formula-sheet-title text-xl font-bold mb-4">Science Formula Sheet</h2>

                <div className="formula-sheet-grid space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                    {(Array.isArray(ScienceFormulas) ? ScienceFormulas : []).map((item, idx) => (
                        <div key={idx} className="formula-sheet-card rounded-lg p-3 space-y-2">
                            <h3 className="formula-sheet-label font-semibold">{item.name}</h3>
                            <FormulaDisplay
                                latex={item.formula}
                                className="formula-equation rounded text-center my-2 text-lg font-mono px-2 py-2"
                            />
                            <p className="formula-sheet-description text-xs leading-snug">{item.variables}</p>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
}

function FormulaSheetModal({ onClose }) {
    const Formula = ({ title, formula, description }) => {
        const sanitizedFormula = typeof formula === 'string'
            ? (() => {
                let working = formula;
                working = applySafeMathFix(working);
                if (typeof normalizeLatexMacrosInMath === 'function') {
                    working = normalizeLatexMacrosInMath(working);
                }
                return working;
            })()
            : formula;
        let html = '';
        try {
            html = renderLatexToHtml(sanitizedFormula);
        } catch (err) {
            console.warn('KaTeX render fallback triggered:', err?.message || err);
            html = escapeHtml(typeof sanitizedFormula === 'string' ? sanitizedFormula : '');
        }

        return (
            <div className="formula-sheet-card rounded-lg p-3 space-y-2 mb-4">
                <h4 className="formula-sheet-label font-bold text-md">{title}</h4>
                <div className="formula-equation rounded text-center text-lg font-mono px-2 py-2">
                    <span dangerouslySetInnerHTML={{ __html: html }}></span>
                </div>
                {description && <p className="formula-sheet-description text-sm">{description}</p>}
            </div>
        );
    };

    return (
        <div
            className="fixed inset-0 w-full h-full flex items-center justify-center z-50"
            style={{ backgroundColor: 'var(--modal-overlay)' }}
        >
            <div className="formula-sheet rounded-lg shadow-2xl w-11/12 max-w-2xl max-h-[90vh]">
                <div
                    className="formula-sheet-header p-4 border-b flex justify-between items-center sticky top-0"
                    style={{ borderColor: 'rgba(148,163,184,0.35)' }}
                >
                    <h2 className="formula-sheet-title text-xl font-bold">GED® Mathematical Reasoning Formula Sheet</h2>
                    <button onClick={onClose} className="formula-sheet-close text-3xl hover:opacity-80 transition-opacity" style={{ color: 'inherit' }}>&times;</button>
                </div>
                <div className="p-6 overflow-y-auto max-h-[calc(90vh-65px)] grid grid-cols-1 md:grid-cols-2 gap-x-6">
                    <div>
                        <h3 className="formula-sheet-section text-lg font-bold border-b mb-2">Area</h3>
                        <Formula title="Square" formula="A = s^2" />
                        <Formula title="Rectangle" formula="A = lw" />
                        <Formula title="Parallelogram" formula="A = bh" />
                        <Formula title="Triangle" formula="A = \\\\frac{1}{2}bh" />
                        <Formula title="Trapezoid" formula="A = \\\\frac{1}{2}h(b_1 + b_2)" />
                        <Formula title="Circle" formula="A = \\pi r^2" />

                        <h3 className="formula-sheet-section text-lg font-bold border-b mt-4 mb-2">Perimeter / Circumference</h3>
                        <Formula title="Square" formula="P = 4s" />
                        <Formula title="Rectangle" formula="P = 2l + 2w" />
                        <Formula title="Triangle" formula="P = s_1 + s_2 + s_3" />
                        <Formula title="Circle (Circumference)" formula="C = 2\\\\pi r \\\\text{ or } C = \\\\pi d" />
                    </div>
                    <div>
                        <h3 className="formula-sheet-section text-lg font-bold border-b mb-2">Volume</h3>
                        <Formula title="Cube" formula="V = s^3" />
                        <Formula title="Rectangular Prism" formula="V = lwh" />
                        <Formula title="Cylinder" formula="V = \\pi r^2 h" />
                        <Formula title="Pyramid" formula="V = \\\\frac{1}{3}Bh" description="B = area of base" />
                        <Formula title="Cone" formula="V = \\\\frac{1}{3}\\\\pi r^2 h" />
                        <Formula title="Sphere" formula="V = \\\\frac{4}{3}\\\\pi r^3" />

                        <h3 className="formula-sheet-section text-lg font-bold border-b mt-4 mb-2">Data</h3>
                        <Formula title="Mean" formula="mean = \\\\frac{\\\\text{sum of values}}{\\\\text{number of values}}" />
                        <Formula title="Median" formula="median = \\\\text{middle value of an ordered data set}" />
                    </div>
                </div>
            </div>
        </div>
    );
}

function StartScreen({ currentUser, onLogout, progress, profileBundle: profileData, testDate, onboardingComplete, onShowProfile, onSelectQuiz, vocabulary, onSelectGenerator, onStartPopQuiz, onStartComprehensiveExam, setIsLoading, setLoadingMessage, setShowFormulaSheet, onOpenMathTools, theme = 'light', onRefreshProfile }) {
    const [selectedSubject, setSelectedSubject] = useState(null);
    const [selectedCategory, setSelectedCategory] = useState(null);
    const [aiQuizTopic, setAiQuizTopic] = useState('');
    const [detailedViewSubject, setDetailedViewSubject] = useState(null);
    const [viewScienceFormulas, setViewScienceFormulas] = useState(false);
    const [onboardingBannerHidden, setOnboardingBannerHidden] = useState(() => {
        try {
            return typeof sessionStorage !== 'undefined' && sessionStorage.getItem('hide_onboarding_banner') === 'true';
        } catch (_) {
            return false;
        }
    });
    const isDarkMode = theme === 'dark';
    const homePanelStyle = isDarkMode
        ? undefined
        : {
            backgroundColor: '#ffffff',
            color: '#0f172a',
            borderColor: 'rgba(148,163,184,0.32)',
        };
    const homePanelPrimaryTextClass = isDarkMode ? 'text-slate-300' : 'text-slate-900';
    const vocabularyData = vocabulary && typeof vocabulary === 'object' ? vocabulary : {};
    const profile = profileData?.profile || {};
    const challengeOptions = Array.isArray(profileData?.challengeOptions) ? profileData.challengeOptions : [];
    const selectedChallenges = challengeOptions.filter((opt) => opt.selected);
    const displayedChallenges = selectedChallenges.slice(0, 4);
    const hiddenChallengeCount = Math.max(0, selectedChallenges.length - displayedChallenges.length);
    const recentDashboardSummary = profileData?.recentScoresDashboard || {};
    const testPlan = Array.isArray(profileData?.testPlan) ? profileData.testPlan : [];
    const nextUpcomingTest = profileData?.nextUpcomingTest || null;
    const hasSavedTest = testPlan.some((entry) => entry && (entry.passed || entry.testDate));
    const allSubjectsPassed = testPlan.length > 0 && testPlan.every((entry) => entry.passed);
    const formatDayCount = (value) => {
        if (typeof value !== 'number' || !Number.isFinite(value)) {
            return null;
        }
        const rounded = Math.max(0, Math.floor(value));
        return `${rounded} day${rounded === 1 ? '' : 's'}`;
    };
    const upcomingMatch = nextUpcomingTest
        ? testPlan.find((entry) => entry.subject === nextUpcomingTest.subject && entry.testDate === nextUpcomingTest.testDate)
        : null;
    const nextUpcomingSummary = nextUpcomingTest && nextUpcomingTest.testDate
        ? {
            subject: nextUpcomingTest.subject,
            testDate: nextUpcomingTest.testDate,
            daysUntilText: formatDayCount(nextUpcomingTest.daysUntil),
            location: upcomingMatch?.testLocation || null,
        }
        : null;
    const userDisplayName = currentUser?.name || currentUser?.email || 'Learner';
    const userInitial = userDisplayName ? userDisplayName.trim().charAt(0).toUpperCase() : 'U';
    const hasVocabulary = Object.values(vocabularyData).some(words => Array.isArray(words) && words.length > 0);
    const goToProfile = () => {
        onShowProfile?.();
    };
    const hideOnboardingBanner = () => {
        setOnboardingBannerHidden(true);
        try {
            if (typeof sessionStorage !== 'undefined') {
                sessionStorage.setItem('hide_onboarding_banner', 'true');
            }
        } catch (_) {
            // ignore
        }
    };

    // --- Upcoming GED Test (profile-level) helpers ---
    const parseYMD = (str) => {
        if (!str || typeof str !== 'string') return null;
        const m = str.match(/^(\d{4})-(\d{2})-(\d{2})/);
        if (!m) return null;
        const y = Number(m[1]);
        const mo = Number(m[2]);
        const d = Number(m[3]);
        if (!y || !mo || !d) return null;
        return new Date(y, mo - 1, d);
    };
    const toLocalMidnight = (dt) => dt ? new Date(dt.getFullYear(), dt.getMonth(), dt.getDate()) : null;
    const formatMMDDYYYY = (dt) => {
        if (!(dt instanceof Date) || isNaN(dt)) return 'Invalid date';
        const mm = String(dt.getMonth() + 1).padStart(2, '0');
        const dd = String(dt.getDate()).padStart(2, '0');
        const yyyy = dt.getFullYear();
        return `${mm}/${dd}/${yyyy}`;
    };
    const diffDaysFromToday = (dateStr) => {
        const examLocal = toLocalMidnight(parseYMD(dateStr));
        if (!examLocal) return null;
        const today = new Date();
        const todayLocal = new Date(today.getFullYear(), today.getMonth(), today.getDate());
        const msPerDay = 1000 * 60 * 60 * 24;
        return Math.ceil((examLocal - todayLocal) / msPerDay);
    };

    // Refresh test plan on dashboard mount to reduce staleness
    useEffect(() => {
        onRefreshProfile?.();
    }, []);

    // Build upcoming list from testPlan with filtering and sorting
    const parseAnyDate = (s) => {
        if (!s || typeof s !== 'string') return null;
        if (/^\d{4}-\d{2}-\d{2}$/.test(s)) return parseYMD(s);
        const m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
        if (m) {
            const mm = Number(m[1]);
            const dd = Number(m[2]);
            const yyyy = Number(m[3]);
            return new Date(yyyy, mm - 1, dd);
        }
        return null;
    };
    const toISO = (dt) => dt ? `${dt.getFullYear()}-${String(dt.getMonth() + 1).padStart(2, '0')}-${String(dt.getDate()).padStart(2, '0')}` : '';
    const todayLocal = new Date();
    const todayStart = new Date(todayLocal.getFullYear(), todayLocal.getMonth(), todayLocal.getDate());
    const upcomingList = useMemo(() => {
        const rows = [];
        for (const entry of testPlan) {
            if (!entry) continue;
            const passed = !!entry.passed;
            const notScheduled = !!entry.notScheduled;
            const rawDate = entry.testDate || '';
            if (passed || notScheduled || !rawDate) continue;
            const dt = parseAnyDate(rawDate);
            if (!dt || isNaN(dt)) continue;
            const d0 = new Date(dt.getFullYear(), dt.getMonth(), dt.getDate());
            if (d0 < todayStart) continue; // past
            rows.push({
                subject: entry.subject || '',
                dateISO: toISO(d0),
                formattedDate: formatMMDDYYYY(d0),
                location: entry.testLocation || null,
                daysUntil: Math.ceil((d0 - todayStart) / (1000 * 60 * 60 * 24)),
            });
        }
        rows.sort((a, b) => (a.dateISO < b.dateISO ? -1 : a.dateISO > b.dateISO ? 1 : 0));
        return rows.slice(0, 4);
    }, [testPlan]);
    const countdownLabel = (days) => {
        if (typeof days !== 'number' || !Number.isFinite(days)) return null;
        if (days <= 0) return 'Today';
        if (days === 1) return '1 day left';
        return `${days} days left`;
    };

    const normalizedProfileTestDate = testDate || null;
    const testDateDiffDays = normalizedProfileTestDate ? diffDaysFromToday(normalizedProfileTestDate) : null;
    const testDateDisplay = normalizedProfileTestDate ? formatMMDDYYYY(parseYMD(normalizedProfileTestDate)) : null;

    // Decide which upcoming panel to show (avoid duplicates)
    const showPlanCard = Boolean(nextUpcomingSummary || hasSavedTest || allSubjectsPassed);
    const showProfileCard = !showPlanCard;

    const [showTestReminder, setShowTestReminder] = useState(null);
    useEffect(() => {
        const todayKey = new Date().toISOString().slice(0, 10);
        const storageKey = `seenTestReminder:${todayKey}`;

        // Profile-level single test date: remind for upcoming/today (>= 0 days)
        if (normalizedProfileTestDate) {
            const days = diffDaysFromToday(normalizedProfileTestDate);
            if (days != null && days >= 0) {
                try {
                    const hasSeen = typeof localStorage !== 'undefined' && localStorage.getItem(storageKey);
                    if (!hasSeen) {
                        const exam = parseYMD(normalizedProfileTestDate);
                        setShowTestReminder({ days, date: exam ? exam.toISOString().slice(0, 10) : normalizedProfileTestDate });
                        localStorage.setItem(storageKey, '1');
                        return; // show only one reminder per day
                    }
                } catch (_) {}
            }
        }

        // NEW: Test-plan nextUpcomingTest — also show when the next scheduled test is today
        if (nextUpcomingTest && nextUpcomingTest.testDate) {
            const daysFromPlan = (typeof nextUpcomingTest.daysUntil === 'number')
                ? Math.floor(nextUpcomingTest.daysUntil)
                : diffDaysFromToday(nextUpcomingTest.testDate);
            if (daysFromPlan === 0) {
                try {
                    const hasSeen = typeof localStorage !== 'undefined' && localStorage.getItem(storageKey);
                    if (!hasSeen) {
                        const exam = parseYMD(nextUpcomingTest.testDate);
                        setShowTestReminder({ days: 0, date: exam ? exam.toISOString().slice(0, 10) : nextUpcomingTest.testDate });
                        localStorage.setItem(storageKey, '1');
                    }
                } catch (_) {}
            }
        }
    }, [normalizedProfileTestDate, nextUpcomingTest?.testDate, nextUpcomingTest?.daysUntil]);

    const handleSelectSubject = (subject) => {
        setSelectedSubject(subject);
        setSelectedCategory(null);
        setAiQuizTopic('');
        setViewScienceFormulas(false);
    };

    const handleSelectCategory = (category) => {
        setSelectedCategory(category);
    };

    const handleViewVocabulary = (subject) => {
        if (!subject) return;
        const words = vocabularyData[subject];
        if (Array.isArray(words) && words.length > 0) {
            setSelectedSubject(subject);
            setSelectedCategory(null);
            setAiQuizTopic('');
            setTimeout(() => {
                const section = document.getElementById('subject-vocabulary-section');
                if (section) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 200);
        }
    };

    const handleBack = () => {
        if (selectedCategory) {
            setSelectedCategory(null);
            setAiQuizTopic('');
            return;
        }

        if (selectedSubject) {
            setSelectedSubject(null);
            setSelectedCategory(null);
            setAiQuizTopic('');
            setShowFormulaSheet?.(false);
            setViewScienceFormulas(false);
        }
    };

    // --- Earned badges (passed subjects) ---
    const SUBJECT_ID_MAP = {
        'Math': 'math',
        'Science': 'science',
        'Social Studies': 'social_studies',
        'Reasoning Through Language Arts (RLA)': 'rla',
        'RLA': 'rla',
    };
    const BADGE_IMG_PATHS = {
        math: '/badges/math.svg',
        science: '/badges/science.svg',
        social_studies: '/badges/social-studies.svg',
        rla: '/badges/rla.svg',
    };
    const profilePassedMap = useMemo(() => {
        const map = {};
        const plan = Array.isArray(profileData?.testPlan) ? profileData.testPlan : [];
        plan.forEach((row) => {
            if (!row || !row.subject) return;
            const id = SUBJECT_ID_MAP[row.subject] || null;
            if (!id) return;
            if (row.passed === true) map[id] = true;
        });
        // Also check profile.tests if present
        const pt = profileData?.profile?.tests;
        if (pt && typeof pt === 'object') {
            Object.entries(pt).forEach(([key, val]) => {
                if (!val) return;
                const id = key;
                if (val.passed === true || val.isPassed === true) map[id] = true;
            });
        }
        return map;
    }, [profileData?.testPlan, profileData?.profile?.tests]);
    const progressPassedMap = useMemo(() => {
        const map = {};
        const subjectNames = Object.keys(SUBJECT_ID_MAP);
        subjectNames.forEach((label) => {
            const id = SUBJECT_ID_MAP[label];
            const p = progress?.[label] || {};
            const passedCount = Array.isArray(p?.passedExamCodes) ? p.passedExamCodes.length : (typeof p?.completedCount === 'number' ? p.completedCount : 0);
            if (passedCount > 0) map[id] = true;
        });
        return map;
    }, [progress]);
    const earnedBadges = useMemo(() => {
        const ids = new Set();
        Object.entries(profilePassedMap).forEach(([id, val]) => { if (val) ids.add(id); });
        Object.entries(progressPassedMap).forEach(([id, val]) => { if (val) ids.add(id); });
        const order = ['math', 'rla', 'science', 'social_studies'];
        return order
            .filter((id) => ids.has(id))
            .map((id) => ({
                id,
                label: id === 'rla' ? 'Reasoning Through Language Arts (RLA)' : (id === 'social_studies' ? 'Social Studies' : id.charAt(0).toUpperCase() + id.slice(1).replace('_', ' ')),
                img: BADGE_IMG_PATHS[id]
            }));
    }, [profilePassedMap, progressPassedMap]);

    // Restore: clicking a subject opens its premade list view (do not auto-start a quiz)
    const openSubjectPremades = (subjectLabel) => {
        const subjectKey = subjectLabel; // labels already match keys in AppData
        handleSelectSubject(subjectKey);
    };

    // --- NEW: If detailed view is active, render it instead of the main dashboard ---
    if (detailedViewSubject) {
        return (
            <DetailedProgressView
                subject={detailedViewSubject}
                progressData={progress[detailedViewSubject]}
                onBack={() => setDetailedViewSubject(null)}
            />
        );
    }

    // --- NEW: Logic to get topics for the dropdown (moved from AIQuizGenerator) ---
    // This includes the fix for the white screen error using optional chaining (`?.`)
    const availableTopics = selectedSubject && AppData[selectedSubject]?.categories
        ? Object.values(AppData[selectedSubject].categories)
            .flatMap((category) => category.topics?.map((topic) => topic.title) || [])
            .filter((topicTitle) => {
                if (!topicTitle) {
                    return false;
                }
                if (
                    (selectedSubject === 'Reasoning Through Language Arts (RLA)' || selectedSubject === 'RLA') &&
                    topicTitle.trim() === 'Extended Response'
                ) {
                    return false;
                }
                return true;
            })
        : [];

    const Breadcrumb = ({ variant = 'default', color, accentColor } = {}) => {
        const isOnColor = variant === 'onColor';
        const resolvedColor = color || (isOnColor ? '#ffffff' : '#475569');
        const resolvedAccent = accentColor || resolvedColor;
        const backLabel = selectedCategory ? `Back to ${selectedSubject}` : 'Back to Main Menu';

        return (
            <div
                className={`mb-4 text-lg font-semibold flex items-center gap-2 ${isOnColor ? '' : 'text-slate-600'}`}
                style={isOnColor ? { color: resolvedColor } : undefined}
            >
                <button
                    type="button"
                    onClick={handleBack}
                    className={`flex items-center gap-2 ${isOnColor ? 'transition-colors' : 'text-sky-600 hover:underline'}`}
                    style={isOnColor ? { color: resolvedAccent } : undefined}
                    aria-label={backLabel}
                >
                    <ArrowLeftIcon />
                    <span>{backLabel}</span>
                </button>
                <span>/</span>
                <span style={isOnColor ? { color: resolvedColor } : undefined}>{selectedSubject}</span>
                {selectedCategory && (
                    <>
                        <span>/</span>
                        <span
                            className={isOnColor ? '' : 'text-slate-800'}
                            style={isOnColor ? { color: resolvedAccent } : undefined}
                        >
                            {selectedCategory}
                        </span>
                    </>
                )}
            </div>
        );
    };

    // View 3: Topic Selection
    if (selectedSubject && selectedCategory) {
        const rawTopics = AppData[selectedSubject].categories[selectedCategory].topics || [];
        const topics = rawTopics.filter((topic) => topicHasAvailableQuestions(selectedSubject, topic));
        const subjectColors = SUBJECT_COLORS[selectedSubject] || DEFAULT_COLOR_SCHEME;
        const lightTint = SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.28)';
        const lightCardBackground = SUBJECT_LIGHT_SURFACE_GRADIENTS[selectedSubject]
            || 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(148,163,184,0.12))';
        const cardTextColor = subjectColors.text || subjectColors.heroText || '#0f172a';
        const badgeTextColor = subjectColors.text || subjectColors.accent || '#0f172a';
        const gradientBackground = isDarkMode
            ? SUBJECT_BG_GRADIENTS[selectedSubject]
            : SUBJECT_LIGHT_SURFACE_GRADIENTS[selectedSubject] || SUBJECT_BG_GRADIENTS[selectedSubject];
        const heroStyles = isDarkMode
            ? (gradientBackground
                ? { backgroundImage: gradientBackground }
                : subjectColors.background
                    ? { backgroundColor: subjectColors.background }
                    : { backgroundColor: DEFAULT_COLOR_SCHEME.background })
            : {
                backgroundColor: '#ffffff',
                backgroundImage: gradientBackground || 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(148,163,184,0.12))',
                border: `1px solid ${SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.35)'}`,
            };
        const heroTextColor = isDarkMode
            ? subjectColors.heroText || subjectColors.onBackgroundText || '#ffffff'
            : subjectColors.text || subjectColors.accent || '#0f172a';
        const heroAccentColor = subjectColors.accent || subjectColors.text || '#0f172a';
        const backButtonStyle = isDarkMode
            ? {
                backgroundColor: 'rgba(255,255,255,0.18)',
                color: heroTextColor,
                border: `1px solid ${subjectColors.border || 'rgba(255,255,255,0.25)'}`,
            }
            : {
                backgroundColor: '#ffffff',
                color: heroAccentColor,
                border: `1px solid ${SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.35)'}`,
            };
        return (
            <>
                <div
                    className="hero-section animate-floatIn rounded-2xl -m-4 sm:-m-6 md:-m-8 p-4 sm:p-6 md:p-8 shadow-2xl"
                    style={{
                        ...heroStyles,
                        '--hero-text-color': heroTextColor,
                        '--hero-accent-color': heroAccentColor,
                    }}
                >
                    <Breadcrumb variant="onColor" color={heroTextColor} accentColor={heroAccentColor} />
                    <h2 className="hero-title text-3xl font-extrabold mb-4">
                        {selectedCategory}
                    </h2>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {topics.length === 0 && (
                            <div className="col-span-full text-center text-sm text-slate-600 dark:text-slate-300 bg-white/70 dark:bg-slate-800/60 border border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6">
                                Premade quizzes for this category are coming soon.
                            </div>
                        )}
                        {topics.map((topic, topicIndex) => {
                            const quizSets = Array.isArray(topic.quizzes)
                                ? topic.quizzes.filter((quiz) => quizHasAvailableQuestions(selectedSubject, topic, quiz))
                                : [];
                            const supportsMultipleQuizzes = quizSets.length > 0 && !['essay', 'simulation', 'graphing_tool'].includes(topic.type);
                            const buttonStyle = {
                                backgroundColor: subjectColors.accent || DEFAULT_COLOR_SCHEME.accent,
                                color: subjectColors.accentText || '#ffffff',
                                borderColor: subjectColors.border || subjectColors.accent || DEFAULT_COLOR_SCHEME.accent,
                                boxShadow: !isDarkMode ? '0 12px 24px -18px rgba(15,23,42,0.45)' : undefined,
                            };
                            const defaultButtonLabel = (topic.type === 'essay' || topic.type === 'simulation' || topic.type === 'graphing_tool')
                                ? 'Open'
                                : 'Start Quiz';

                            const launchQuizSet = (quiz, index) => {
                                if (typeof onSelectQuiz !== 'function' || !quiz) {
                                    return;
                                }
                                const quizLabel = quiz.label || `Quiz ${String.fromCharCode(65 + index)}`;
                                const baseTitle = topic.title || 'Quiz';
                                const derivedTitle = quiz.title || `${baseTitle} — ${quizLabel}`;
                                const quizIdBase = topic.id || `topic_${topicIndex}`;
                                const resolvedQuestions = resolveQuizQuestions(selectedSubject, topic, quiz)
                                    .map((question, questionIndex) => {
                                        if (question && typeof question === 'object') {
                                            const nextNumber = question.questionNumber ?? (questionIndex + 1);
                                            return { ...question, questionNumber: nextNumber };
                                        }
                                        return question;
                                    });

                                if (!resolvedQuestions.length) {
                                    alert('This quiz does not have any questions yet. Please try another set.');
                                    return;
                                }

                                const quizCode = quiz.quizCode || `${quizIdBase}_set_${index}`;
                                const sourceTopic = quiz.questionSourceTopicId
                                    ? getTopicById(selectedSubject, quiz.questionSourceTopicId)
                                    : null;
                                const articleSource = quiz.article || topic.article || (sourceTopic && sourceTopic.article);
                                const articleClone = cloneArticle(articleSource);
                                const resolvedImageUrl = quiz.imageUrl
                                    || topic.imageUrl
                                    || (sourceTopic && sourceTopic.imageUrl)
                                    || (articleClone && articleClone.imageUrl)
                                    || (articleSource && articleSource.imageUrl);

                                const preparedQuiz = {
                                    ...quiz,
                                    id: quiz.quizId || quizCode,
                                    quizCode,
                                    title: derivedTitle,
                                    topicId: topic.id,
                                    topicTitle: topic.title || baseTitle,
                                    description: quiz.description || topic.description,
                                    type: quiz.type || topic.type || (sourceTopic ? sourceTopic.type : 'quiz') || 'quiz',
                                    questions: resolvedQuestions,
                                };

                                if (articleClone) {
                                    preparedQuiz.article = articleClone;
                                }
                                if (!preparedQuiz.imageUrl && resolvedImageUrl) {
                                    preparedQuiz.imageUrl = resolvedImageUrl;
                                }

                                onSelectQuiz(preparedQuiz, selectedSubject);
                            };

                            return (
                                <div
                                    key={topic.id || `topic_${topicIndex}`}
                                    className="rounded-xl border bg-white/95 dark:bg-slate-900/80 dark:border-slate-700 p-5 flex flex-col justify-between shadow-lg transition-all duration-200 ease-in-out hover:-translate-y-1 hover:shadow-2xl"
                                    style={isDarkMode
                                        ? {
                                            borderColor: subjectColors.border || 'rgba(148,163,184,0.35)',
                                            color: subjectColors.text || '#f8fafc',
                                        }
                                        : {
                                            borderColor: lightTint,
                                            backgroundColor: '#ffffff',
                                            backgroundImage: lightCardBackground,
                                            color: cardTextColor,
                                            boxShadow: '0 22px 45px -34px rgba(15,23,42,0.45)',
                                        }}
                                >
                                    <div>
                                        <h3 className="text-xl font-bold" style={isDarkMode ? { color: subjectColors.text || '#f8fafc' } : { color: cardTextColor }}>
                                            {topic.title}
                                        </h3>
                                        <p
                                            className="text-sm my-3 flex-grow"
                                            style={isDarkMode
                                                ? { color: 'rgba(226,232,240,0.82)' }
                                                : { color: 'rgba(15,23,42,0.78)' }}
                                        >
                                            {topic.description}
                                        </p>
                                    </div>
                                    {supportsMultipleQuizzes ? (
                                        <div className="mt-2 space-y-3 w-full">
                                            <div className="flex flex-wrap gap-2 text-xs font-semibold uppercase tracking-wide">
                                                {quizSets.map((quiz, index) => {
                                                    const label = quiz.label || `Quiz ${String.fromCharCode(65 + index)}`;
                                                    return (
                                                        <span
                                                            key={`label-${topic.id || `topic_${topicIndex}`}-${index}`}
                                                            className="px-2 py-1 rounded-full border"
                                                            style={isDarkMode
                                                                ? {
                                                                    backgroundColor: 'rgba(148,163,184,0.12)',
                                                                    color: subjectColors.text || '#e2e8f0',
                                                                    borderColor: 'rgba(148,163,184,0.25)',
                                                                }
                                                                : {
                                                                    backgroundColor: lightTint,
                                                                    color: badgeTextColor,
                                                                    borderColor: lightTint,
                                                                }}
                                                        >
                                                            {label}
                                                        </span>
                                                    );
                                                })}
                                            </div>
                                            <div className="grid gap-2">
                                                {quizSets.map((quiz, index) => {
                                                    const label = quiz.label || `Quiz ${String.fromCharCode(65 + index)}`;
                                                    return (
                                                        <button
                                                            key={quiz.quizId || `${topic.id || `topic_${topicIndex}`}_quiz_${index}`}
                                                            onClick={() => launchQuizSet(quiz, index)}
                                                            className="w-full mt-2 px-4 py-2 rounded-lg font-semibold shadow-sm transition hover:opacity-95"
                                                            style={buttonStyle}
                                                        >
                                                            Start {label}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ) : (
                                        (() => {
                                            const fallbackTopicSlug = sanitizeCodeSegment(topic.title || `topic-${topicIndex + 1}`, `topic-${topicIndex + 1}`);
                                            const subjectSlug = sanitizeCodeSegment(selectedSubject, 'subject');
                                            const topicQuizCode = topic.quizCode || topic.id || `${subjectSlug}__${fallbackTopicSlug}`;
                                            return (
                                                <button
                                                    onClick={() => {
                                                        if (typeof onSelectQuiz !== 'function') {
                                                            return;
                                                        }
                                                        const articleClone = cloneArticle(topic.article);
                                                        const preparedQuiz = {
                                                            ...topic,
                                                            id: topic.quizCode || topicQuizCode,
                                                            quizCode: topicQuizCode,
                                                        };
                                                        if (articleClone) {
                                                            preparedQuiz.article = articleClone;
                                                        }
                                                        const fallbackImageUrl = topic.imageUrl
                                                            || (articleClone && articleClone.imageUrl)
                                                            || (topic.article && topic.article.imageUrl);
                                                        if (!preparedQuiz.imageUrl && fallbackImageUrl) {
                                                            preparedQuiz.imageUrl = fallbackImageUrl;
                                                        }
                                                        if (Array.isArray(topic.questions)) {
                                                            preparedQuiz.questions = topic.questions.map((question, questionIndex) => {
                                                                if (question && typeof question === 'object') {
                                                                    const nextNumber = question.questionNumber ?? (questionIndex + 1);
                                                                    return { ...question, questionNumber: nextNumber };
                                                                }
                                                                return question;
                                                            });
                                                        }
                                                        onSelectQuiz(preparedQuiz, selectedSubject);
                                                    }}
                                                    className="w-full mt-2 px-4 py-2 rounded-lg font-semibold shadow-sm transition hover:opacity-95"
                                                    style={buttonStyle}
                                                >
                                                    {defaultButtonLabel}
                                                </button>
                                            );
                                        })()
                                    )}
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-6">
                        <button
                            type="button"
                            onClick={handleBack}
                            className="inline-flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition"
                            style={backButtonStyle}
                        >
                            <ArrowLeftIcon />
                            <span>Back to {selectedSubject}</span>
                        </button>
                    </div>
                </div>
            </>
        );
    }

    // View 2: Category Selection (with updated "Smith a Quiz" box)
    if (selectedSubject) {
        const subject = AppData[selectedSubject];
        const subjectColors = SUBJECT_COLORS[selectedSubject] || {};
        const gradientBackground = isDarkMode
            ? SUBJECT_BG_GRADIENTS[selectedSubject]
            : SUBJECT_LIGHT_SURFACE_GRADIENTS[selectedSubject] || SUBJECT_BG_GRADIENTS[selectedSubject];
        const heroStyles = isDarkMode
            ? (gradientBackground
                ? { backgroundImage: gradientBackground }
                : subjectColors.background
                    ? { backgroundColor: subjectColors.background }
                    : { backgroundColor: DEFAULT_COLOR_SCHEME.background })
            : {
                backgroundColor: '#ffffff',
                backgroundImage: gradientBackground || 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(148,163,184,0.12))',
                border: `1px solid ${SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.35)'}`,
            };
        const heroTextColor = isDarkMode
            ? subjectColors.heroText || subjectColors.onBackgroundText || '#ffffff'
            : subjectColors.text || subjectColors.accent || '#0f172a';
        const heroAccentColor = subjectColors.accent || subjectColors.text || '#0f172a';
        const heroMutedTextStyle = isDarkMode
            ? { color: 'rgba(255,255,255,0.85)' }
            : { color: heroTextColor, opacity: 0.75 };
        const panelBorderColor = isDarkMode
            ? subjectColors.border || 'rgba(255,255,255,0.55)'
            : SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.35)';
        const panelBaseStyle = {
            borderColor: panelBorderColor,
            backgroundColor: isDarkMode ? 'rgba(255,255,255,0.08)' : '#ffffff',
            color: heroTextColor,
        };
        const panelBackground = !isDarkMode && SUBJECT_LIGHT_SURFACE_GRADIENTS[selectedSubject];
        if (panelBackground) {
            panelBaseStyle.backgroundImage = panelBackground;
            panelBaseStyle.boxShadow = '0 22px 45px -34px rgba(15,23,42,0.35)';
        }
        const selectStyle = isDarkMode
            ? {
                border: `1px solid ${subjectColors.border || 'rgba(255,255,255,0.35)'}`,
                backgroundColor: 'rgba(15,23,42,0.85)',
                color: '#f8fafc',
            }
            : {
                border: `1px solid ${panelBorderColor}`,
                backgroundColor: '#ffffff',
                color: '#0f172a',
            };
        const backButtonStyle = isDarkMode
            ? {
                backgroundColor: 'rgba(255,255,255,0.18)',
                color: heroTextColor,
                border: `1px solid ${subjectColors.border || 'rgba(255,255,255,0.25)'}`,
            }
            : {
                backgroundColor: '#ffffff',
                color: heroAccentColor,
                border: `1px solid ${SUBJECT_LIGHT_TINTS[selectedSubject] || 'rgba(148,163,184,0.35)'}`,
            };
        const subjectVocabulary = Array.isArray(vocabularyData[selectedSubject]) ? vocabularyData[selectedSubject] : [];
        const subjectPremadeTotal = getPremadeQuizTotal(selectedSubject);
        const expandedReady = (typeof window !== 'undefined' && window.ExpandedQuizData && Object.keys(window.ExpandedQuizData).length > 0);
        const subjectPremadeLabel = (subjectPremadeTotal === 1 ? '1 premade quiz ready' : `${subjectPremadeTotal} premade quizzes ready`);
        return (
            <>
                {viewScienceFormulas && (
                    <ScienceFormulaSheet onClose={() => setViewScienceFormulas(false)} />
                )}
                <div
                    className="hero-section animate-floatIn rounded-2xl -m-4 sm:-m-6 md:-m-8 p-4 sm:p-6 md:p-8 shadow-2xl"
                    style={{
                        ...heroStyles,
                        '--hero-text-color': heroTextColor,
                        '--hero-accent-color': heroAccentColor,
                    }}
                >
                    <Breadcrumb variant="onColor" color={heroTextColor} accentColor={heroAccentColor} />
                    <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between mb-4">
                        <div className="flex flex-col gap-1">
                            <h2 className="hero-title text-3xl font-extrabold">
                                {selectedSubject}
                            </h2>
                            <p className="text-sm font-semibold" style={heroMutedTextStyle}>
                                {subjectPremadeLabel}
                            </p>
                        </div>
                        {(selectedSubject === 'Math' || selectedSubject === 'Science') && (
                            <div className="flex flex-wrap gap-2">
                                {selectedSubject === 'Math' && (
                                    <>
                                        <button
                                            onClick={() => onOpenMathTools?.()}
                                            className="px-4 py-2 bg-sky-500 text-white font-semibold rounded-lg shadow-sm hover:bg-sky-600 transition"
                                        >
                                            Math Practice Tools
                                        </button>
                                        <button
                                            onClick={() => setShowFormulaSheet(true)}
                                            className="px-4 py-2 bg-white/90 text-sky-700 font-semibold rounded-lg hover:bg-white transition"
                                        >
                                            Formula Sheet
                                        </button>
                                    </>
                                )}
                                {selectedSubject === 'Science' && (
                                    <button
                                        type="button"
                                        onClick={() => setViewScienceFormulas(true)}
                                        className="px-4 py-2 font-semibold rounded-lg border-2 transition hover:opacity-90"
                                        style={{
                                            borderColor: isDarkMode ? subjectColors.border || 'rgba(255,255,255,0.5)' : panelBorderColor,
                                            color: heroAccentColor,
                                            backgroundColor: isDarkMode ? 'transparent' : '#ffffff',
                                        }}
                                    >
                                        View Science Formula Sheet
                                    </button>
                                )}
                            </div>
                        )}
                    </div>
                    {subjectVocabulary.length > 0 && (
                        <SubjectVocabularySection
                            subject={selectedSubject}
                            words={subjectVocabulary}
                            theme={theme}
                        />
                    )}
                    {/* New clustered quiz browser */}
                    <SubjectQuizBrowser subjectName={selectedSubject} onSelectQuiz={onSelectQuiz} theme={theme} />
                    {/* Keep generator and comprehensive exam below the cluster UI */}
                    {(selectedSubject === 'Social Studies' || selectedSubject === 'Reasoning Through Language Arts (RLA)' || selectedSubject === 'Science' || selectedSubject === 'Math') && (
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4">
                            {selectedSubject === 'Reasoning Through Language Arts (RLA)' && (
                                <div
                                    className="border-2 border-dashed rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-all"
                                    style={{ ...panelBaseStyle, borderStyle: 'dashed' }}
                                >
                                    <div>
                                        <div className="flex items-center justify-center gap-2" style={{ color: heroAccentColor }}>
                                            <BookOpenIcon className="h-8 w-8" />
                                            <h3 className="text-xl font-bold" style={{ color: heroTextColor }}>Essay Practice Tool</h3>
                                        </div>
                                        <p className="text-sm my-2 text-center" style={heroMutedTextStyle}>
                                            Build your extended response with guided support.
                                        </p>
                                    </div>
                                    <button
                                        onClick={() => onSelectQuiz({ id: 'essay_practice_tool', type: 'essay', title: 'GED® Essay Practice Toolkit' }, selectedSubject)}
                                        className="w-full mt-2 px-4 py-2 bg-white text-slate-900 font-semibold rounded-md hover:bg-white/90 transition"
                                    >
                                        Launch Essay Practice
                                    </button>
                                </div>
                            )}
                            <div
                                className="border-2 border-dashed rounded-lg p-4 flex flex-col justify-between hover:shadow-lg transition-all"
                                style={{ ...panelBaseStyle, borderStyle: 'dashed' }}
                            >
                                <div>
                                    <div className="flex items-center justify-center gap-2" style={{ color: heroAccentColor }}>
                                        <SparklesIcon className="h-8 w-8" />
                                        <h3 className="text-xl font-bold" style={{ color: heroTextColor }}>Smith a Quiz</h3>
                                    </div>
                                    <p className="text-sm my-2 text-center" style={heroMutedTextStyle}>
                                        Generate a new quiz for any topic in {selectedSubject}.
                                    </p>
                                    <div className="mt-2">
                                        <label
                                            className="block font-semibold mb-1"
                                            htmlFor="ai-quiz-topic"
                                            style={{ color: heroTextColor }}
                                        >
                                            Choose a topic
                                        </label>
                                        <select
                                            id="ai-quiz-topic"
                                            value={aiQuizTopic}
                                            onChange={(e) => setAiQuizTopic(e.target.value)}
                                            className="w-full px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-0"
                                            style={selectStyle}
                                        >
                                            <option value="">Select a topic</option>
                                            {availableTopics.map((topic, idx) => topic && <option key={`${topic}-${idx}`} value={topic}>{topic}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <button
                                    onClick={() => onSelectGenerator(selectedSubject, aiQuizTopic, setIsLoading, setLoadingMessage)}
                                    disabled={!aiQuizTopic}
                                    className="w-full mt-2 px-4 py-2 bg-white text-slate-900 font-semibold rounded-md transition hover:bg-white/90 disabled:bg-white/60 disabled:text-slate-400 disabled:cursor-not-allowed"
                                >
                                    Generate Quiz
                                </button>
                            </div>
                            <div
                                className="border-2 border-dashed rounded-lg p-4 flex flex-col justify-center items-center hover:shadow-lg transition-all md:col-span-2 lg:col-span-1"
                                style={{ ...panelBaseStyle, borderStyle: 'dashed' }}
                            >
                                <SparklesIcon className="h-8 w-8" style={{ color: heroAccentColor }} />
                                <h3 className="text-xl font-bold mt-2" style={{ color: heroTextColor }}>Comprehensive Exam</h3>
                                <p className="text-sm my-2 text-center" style={heroMutedTextStyle}>
                                    Take a full-length practice exam for {selectedSubject}.
                                </p>
                                <button onClick={async () => await onStartComprehensiveExam(selectedSubject)} className="w-full mt-2 px-4 py-2 bg-white text-slate-900 font-semibold rounded-md hover:bg-white/90 transition">
                                    Start Comprehensive Exam
                                </button>
                            </div>
                        </div>
                    )}
                    <div className="mt-6">
                        <button
                            type="button"
                            onClick={handleBack}
                            className="inline-flex items-center gap-2 px-4 py-2 rounded-lg font-semibold transition"
                            style={backButtonStyle}
                        >
                            <ArrowLeftIcon />
                            <span>Back to Main Menu</span>
                        </button>
                    </div>
                </div>
            </>
        );
    }

    // View 1: Subject Selection (Default)
    return (
        <>
            <div className="fade-in">
                <header className="text-center pb-4 mb-4">
                {currentUser ? (
                    <div className="flex flex-col items-center gap-2">
                        {currentUser.picture ? (
                            <img src={currentUser.picture} alt="User" className="w-16 h-16 rounded-full shadow-lg" />
                        ) : (
                                <div className="w-16 h-16 rounded-full bg-sky-600 text-white flex items-center justify-center text-2xl font-bold shadow-lg">
                                    {userInitial}
                                </div>
                            )}
                            <h1 className="text-4xl font-extrabold text-slate-800 dark:text-slate-100">Welcome, {userDisplayName}!</h1>
                            <p className="text-slate-500 dark:text-slate-300">Please select a subject to begin.</p>
                            <button onClick={onLogout} className="text-sm font-semibold text-sky-600 hover:text-sky-800 dark:text-sky-300 dark:hover:text-sky-200">[ Log Out ]</button>
                        </div>
                    ) : (
                        <>
                            <h1 className="text-4xl font-extrabold text-slate-800 dark:text-slate-100">Mr. Smith's Learning Canvas</h1>
                            <p className="text-slate-500 dark:text-slate-300 mt-2">An interactive learning experience.</p>
                        </>
                    )}
                </header>
                {!onboardingComplete && !onboardingBannerHidden && (
                    <div className="mb-6 rounded-xl border border-amber-300 bg-amber-50 p-4 text-amber-900 shadow-sm flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
                        <div className="space-y-1">
                            <p className="font-semibold">Finish setting up your learning plan</p>
                            <p className="text-sm opacity-90">Add your name, pick a few challenge areas, and set test dates to personalize your dashboard.</p>
                        </div>
                        <div className="flex gap-2 shrink-0">
                            <button
                                type="button"
                                onClick={goToProfile}
                                className="inline-flex items-center justify-center rounded-lg bg-amber-600 px-4 py-2 text-sm font-semibold text-white hover:bg-amber-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2"
                            >
                                Continue Onboarding
                            </button>
                            <button
                                type="button"
                                onClick={hideOnboardingBanner}
                                className="inline-flex items-center justify-center rounded-lg border px-4 py-2 text-sm font-semibold hover:bg-white/60 focus:outline-none focus-visible:ring-2 focus-visible:ring-amber-500 focus-visible:ring-offset-2"
                                aria-label="Hide onboarding reminder for now"
                            >
                                Hide for now
                            </button>
                        </div>
                    </div>
                )}
                <div className="dashboard-sections">
                    {currentUser && (
                        <div className={`grid gap-4 ${showProfileCard && showPlanCard ? 'md:grid-cols-2' : 'md:grid-cols-1'} mb-6 dashboard-row`}>
                            {/* Upcoming GED Test (Profile-level) - only when no plan data yet */}
                            {showProfileCard && (
                            <article className="glass rounded-2xl border border-slate-200/70 dark:border-slate-700/60 p-5 shadow-lg space-y-2 dark:bg-slate-800/70 block-profile-test panel card" style={homePanelStyle}>
                                <div className="flex items-center justify-between">
                                    <h2
                                        className="text-lg font-semibold text-slate-900 dark:text-slate-100"
                                        style={isDarkMode ? undefined : { color: '#000000' }}
                                    >
                                        Upcoming GED Test
                                    </h2>
                                    <button
                                        type="button"
                                        onClick={goToProfile}
                                        className="text-sm font-semibold text-sky-600 hover:text-sky-800 dark:text-sky-300 dark:hover:text-sky-200"
                                    >
                                        Edit
                                    </button>
                                </div>
                                {normalizedProfileTestDate ? (
                                    (() => {
                                        if (testDateDiffDays == null) {
                                            return <p className={`text-sm ${homePanelPrimaryTextClass}`}>Test date unavailable. Please update in profile.</p>;
                                        }
                                        if (testDateDiffDays > 1) {
                                            return (
                                                <div className={`text-sm ${homePanelPrimaryTextClass}`}>
                                                    <p>Your test is in <strong>{testDateDiffDays}</strong> days ({testDateDisplay}).</p>
                                                    <span className="countdown-chip mt-2 inline-block">{testDateDiffDays} days left</span>
                                                </div>
                                            );
                                        }
                                        if (testDateDiffDays === 1) {
                                            return (
                                                <div className={`text-sm ${homePanelPrimaryTextClass}`}>
                                                    <p>Your test is <strong>tomorrow</strong> ({testDateDisplay}).</p>
                                                    <span className="countdown-chip mt-2 inline-block">1 day left</span>
                                                </div>
                                            );
                                        }
                                        if (testDateDiffDays === 0) {
                                            return <p className={`text-sm ${homePanelPrimaryTextClass}`}><strong>Your test is today.</strong> Good luck!</p>;
                                        }
                                        // Past date
                                        return <p className={`text-sm ${homePanelPrimaryTextClass}`}>Your previous test date was {testDateDisplay}. Set a new one.</p>;
                                    })()
                                ) : (
                                    <p className={`text-sm ${homePanelPrimaryTextClass}`}>No test date on file. Set one in your profile.</p>
                                )}
                                <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-800'}`}>This uses the single profile test date.</p>
                            </article>
                            )}
                            {showPlanCard && (
                            <article className="glass rounded-2xl border border-slate-200/70 dark:border-slate-700/60 p-5 shadow-lg space-y-2 dark:bg-slate-800/70 block-test-date panel card" style={homePanelStyle}>
                            <div className="flex items-center justify-between">
                                <h2
                                    className="text-lg font-semibold text-slate-900 dark:text-slate-100"
                                    style={isDarkMode ? undefined : { color: '#000000' }}
                                >
                                    Upcoming Tests
                                </h2>
                                <button
                                    type="button"
                                    onClick={goToProfile}
                                    className="text-sm font-semibold text-sky-600 hover:text-sky-800 dark:text-sky-300 dark:hover:text-sky-200"
                                >
                                    Edit
                                </button>
                            </div>
                            <p className={`text-sm ${homePanelPrimaryTextClass}`}>Keep adding your remaining test dates to stay organized.</p>
                            {allSubjectsPassed ? (
                                <p className="text-sm text-emerald-600">You marked every GED subject as passed. Amazing work!</p>
                            ) : (upcomingList && upcomingList.length > 0) ? (
                                <div className="mt-2 space-y-2">
                                    {upcomingList.map((item, idx) => (
                                        <div key={`${item.subject}-${item.dateISO}-${idx}`} className="flex items-center justify-between py-1">
                                            <div>
                                                <p className="font-semibold text-slate-900 dark:text-slate-100">{item.subject}</p>
                                                <p className={`text-sm ${homePanelPrimaryTextClass}`}>
                                                    {item.formattedDate}
                                                    {item.location ? <span> • {item.location}</span> : null}
                                                </p>
                                            </div>
                                            <span className="countdown-chip inline-flex">
                                                <span className="dot"></span>
                                                <span className="label">{countdownLabel(item.daysUntil)}</span>
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            ) : hasSavedTest ? (
                                <p className={`text-sm ${homePanelPrimaryTextClass}`}>No test scheduled yet.</p>
                            ) : (
                                <p className={`text-sm ${homePanelPrimaryTextClass}`}>Set your test dates to start the countdown.</p>
                            )}
                            <p className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-800'}`}>Need changes? Update them from your profile.</p>
                        </article>
                        )}
                        <article className="glass rounded-2xl border border-slate-200/70 dark:border-slate-700/60 p-5 shadow-lg space-y-2 dark:bg-slate-800/70 block-challenges panel card" style={homePanelStyle}>
                            <div className="flex items-center justify-between">
                                <h2
                                    className="text-lg font-semibold text-slate-900 dark:text-slate-100"
                                    style={isDarkMode ? undefined : { color: '#000000' }}
                                >
                                    Learning Challenges
                                </h2>
                                <button
                                    type="button"
                                    onClick={goToProfile}
                                    className="text-sm font-semibold text-sky-600 hover:text-sky-800 dark:text-sky-300 dark:hover:text-sky-200"
                                >
                                    Update
                                </button>
                            </div>
                            {selectedChallenges.length ? (
                                <ul className={`space-y-1 text-sm ${homePanelPrimaryTextClass}`}>
                                    {displayedChallenges.map((challenge) => (
                                        <li key={challenge.id}>• {challenge.label || `${challenge.subject} — ${challenge.subtopic}`}</li>
                                    ))}
                                    {hiddenChallengeCount > 0 && (
                                        <li className={`text-xs ${isDarkMode ? 'text-slate-400' : 'text-slate-800'}`}>and {hiddenChallengeCount} more…</li>
                                    )}
                                </ul>
                            ) : (
                                <p className={`text-sm ${homePanelPrimaryTextClass}`}>Tell us what topics to focus on to unlock a tailored plan.</p>
                            )}
                            {!onboardingComplete && (
                                <p className="text-xs text-rose-500">Finish selecting challenges to complete onboarding.</p>
                            )}
                        </article>
                    </div>
                )}
                {currentUser && (
                    <div id="progress" className="animate-floatIn block-profile panel">
                        <ProgressDashboard
                            progress={progress}
                            onSubjectClick={setDetailedViewSubject}
                            passedSubjectIds={new Set((earnedBadges || []).map((b) => b.id))}
                        />
                    </div>
                )}
                {profileData && (
                    <div className="mb-6 block-profile panel scores-shell">
                        <RecentScoresPanel
                            title="Latest Scores"
                            summary={recentDashboardSummary}
                            legacyScores={profileData?.scores}
                            loading={false}
                        />
                    </div>
                )}
                {hasVocabulary && (
                    <div className="mb-6 space-y-6 block-vocab panel vocab-shell">
                        <VocabularyTicker vocabulary={vocabularyData} onWordClick={handleViewVocabulary} />
                        <VocabularyOverview vocabulary={vocabularyData} onWordClick={handleViewVocabulary} />
                    </div>
                )}
                <section className="block-start-quiz">
                    <div className="my-6 text-center panel card">
                        <button
                            onClick={onStartPopQuiz}
                            className="px-8 py-4 bg-purple-600 text-white font-bold rounded-lg shadow-lg hover:bg-purple-700 transition-transform transform hover:scale-105 quiz-start-btn"
                        >
                            Start a 5-Minute Pop Quiz ⏱️
                        </button>
                    </div>
                    <div id="quizzes" className="grid grid-cols-1 md:grid-cols-3 gap-6 subject-bar">
                        {Object.entries(AppData).map(([subjectName, subject]) => {
                            // Robust icon resolution: fall back by subject name if subject.icon missing
                            const fallbackIconMap = {
                                'Math': 'CalculatorIcon',
                                'Science': 'BeakerIcon',
                                'Social Studies': 'GlobeIcon',
                                'Reasoning Through Language Arts (RLA)': 'BookOpenIcon',
                                'RLA': 'BookOpenIcon',
                            };
                            const iconKey = subject?.icon || fallbackIconMap[subjectName] || 'ChartBarIcon';
                            const IconComponent = ICONS[iconKey] || (() => null);
                            const colorScheme = SUBJECT_COLORS[subjectName] || {};
                            const gradientBackground = SUBJECT_BG_GRADIENTS[subjectName];
                            const iconWrapperStyle = gradientBackground
                                ? { backgroundImage: gradientBackground }
                                : colorScheme.background
                                    ? { backgroundColor: colorScheme.background }
                                    : { backgroundColor: DEFAULT_COLOR_SCHEME.background };
                            const subjectTextColor = colorScheme.text || '#ffffff';
                            const premadeTotal = getPremadeQuizTotal(subjectName);
                            const expandedReady = (typeof window !== 'undefined' && window.ExpandedQuizData && Object.keys(window.ExpandedQuizData).length > 0);
                            const premadeLabel = (premadeTotal === 1 ? '1 premade quiz ready' : `${premadeTotal} premade quizzes ready`);
                            const subjectDataKey = SUBJECT_SHORT_LABELS[subjectName] || subjectName;
                            return (
                                <button
                                    key={subjectName}
                                    onClick={() => openSubjectPremades(subjectName)}
                                    className="subject-card glass group flex flex-col items-center justify-between gap-4 p-6 rounded-2xl border border-slate-200/70 dark:border-slate-700/70 shadow-lg transition-all duration-300 subject-choice"
                                    data-testid={`subject-button-${subjectName.toLowerCase().replace(/[\s()]+/g, '-').replace(/-$/, '')}`}
                                >
                                    <div
                                    className="w-full rounded-xl py-6 flex items-center justify-center shadow-inner"
                                    style={{
                                        ...iconWrapperStyle,
                                        color: subjectTextColor,
                                    }}
                                >
                                    <IconComponent className="h-12 w-12 text-white drop-shadow" />
                                </div>
                                <h2 className="text-xl font-semibold text-slate-800 dark:text-slate-100" style={{ color: (subjectName === 'Math') ? (isDarkMode ? (colorScheme.text || undefined) : (colorScheme.accent || undefined)) : (colorScheme.text || undefined) }}>
                                    {subjectName}
                                </h2>
                                <span
                                    className="quiz-count-text text-sm text-center"
                                    data-subject={subjectDataKey}
                                    style={isDarkMode ? { color: subjectTextColor } : undefined}
                                >
                                    {premadeLabel}
                                </span>
                            </button>
                            );
                        })}
                    </div>
                </section>
                </div>
            </div>
            {/* Test reminder modal/toast (scoped to StartScreen) */}
            {showTestReminder && (
                <div
                    className="fixed inset-0 z-50 flex items-center justify-center p-4"
                    role="dialog"
                    aria-modal="true"
                    style={{ backgroundColor: 'var(--modal-overlay)' }}
                >
                    <div
                        className="rounded-lg shadow-2xl w-full max-w-md p-6"
                        style={{ backgroundColor: 'var(--modal-surface)', color: 'var(--modal-text)', border: '1px solid var(--modal-border)' }}
                    >
                        <h2 className="text-xl font-bold mb-2">Upcoming GED test</h2>
                        <p className="mb-4">Your test is in <strong>{showTestReminder.days}</strong> day(s): {showTestReminder.date}</p>
                        <div className="flex justify-end">
                            <button
                                type="button"
                                onClick={() => setShowTestReminder(null)}
                                className="px-4 py-2 rounded-md font-semibold border"
                                style={{ background: 'transparent', color: 'var(--text-primary)', borderColor: 'var(--border-subtle)' }}
                            >
                                Got it
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </>
    );
}


function Stem({ item }) {
    const passageContent = typeof item.passage === 'string' ? item.passage.trim() : '';
    const questionContent = typeof (item.questionText || item.question) === 'string'
        ? (item.questionText || item.question).trim()
        : '';

    const displaySource = (item?.asset && item.asset.displaySource)
        || item.displaySource
        || item.source
        || '';

    return (
        <div className="stem space-y-4">
            {item.stimulusImage?.src && (
                <div className="mb-3">
                    <img
                        src={item.stimulusImage.src}
                        alt={item.stimulusImage.alt || 'stimulus'}
                        className="max-w-full rounded-md shadow"
                        loading="lazy"
                    />
                </div>
            )}

            {passageContent && (
                <div
                    className="question-stem block"
                    dangerouslySetInnerHTML={renderQuestionTextForDisplay(passageContent, item.isPremade === true)}
                />
            )}

            {questionContent && (
                <div className="mt-2">
                    <div
                        className="question-stem block font-bold text-slate-900"
                        dangerouslySetInnerHTML={renderQuestionTextForDisplay(questionContent, item.isPremade === true)}
                    />
                </div>
            )}

            {displaySource && (
                <div className="mt-2 text-xs opacity-70">Source: {displaySource}</div>
            )}
        </div>
    );
}

function QuizInterface({ questions, answers, setAnswers, onComplete, buttonText, quizTitle, onExit, timeLimit, subject, showTimer = true, quizConfig, article = null, articleImage = null }) {
    const [currentIndex, setCurrentIndex] = useState(0);
    const [marked, setMarked] = useState(Array(questions.length).fill(false));
    const [confidence, setConfidence] = useState(Array(questions.length).fill(null));
    const [timeLeft, setTimeLeft] = useState(timeLimit || questions.length * 90);
    const [isPaused, setIsPaused] = useState(false);
    const [pausesRemaining, setPausesRemaining] = useState(2);
    const handleSubmitRef = useRef(() => {});
    const [showMathFormulas, setShowMathFormulas] = useState(false);
    const [showScienceFormulas, setShowScienceFormulas] = useState(false);
    const [showArticle, setShowArticle] = useState(Boolean(article));

    useEffect(() => {
        setTimeLeft(timeLimit || questions.length * 90);
        setIsPaused(false);
        setPausesRemaining(2);
    }, [questions, timeLimit]);

    useEffect(() => {
        setShowArticle(Boolean(article));
    }, [article]);

    useEffect(() => {
        if (!onComplete || isPaused) return; // Don't run timer if there's no completion action (e.g., in a part of a larger quiz)
        const timer = setInterval(() => {
            setTimeLeft(prev => {
                if (prev <= 1) {
                    clearInterval(timer);
                    handleSubmitRef.current?.();
                    return 0;
                }
                return prev - 1;
            });
        }, 1000);
        return () => clearInterval(timer);
    }, [onComplete, isPaused]);

    const handleSelect = (optionText) => {
        const newAnswers = [...answers];
        newAnswers[currentIndex] = optionText;
        setAnswers(newAnswers);
    };

    const handleInputChange = (e) => {
        const newAnswers = [...answers];
        newAnswers[currentIndex] = e.target.value;
        setAnswers(newAnswers);
    };

    const handleConfidenceSelect = (level) => {
        const newConfidence = [...confidence];
        newConfidence[currentIndex] = level;
        setConfidence(newConfidence);
    };

    const handleSubmit = useCallback(() => {
        onComplete({ answers, marked, confidence });
    }, [answers, marked, onComplete, confidence]);

    useEffect(() => {
        handleSubmitRef.current = handleSubmit;
    }, [handleSubmit]);

    const handlePauseToggle = () => {
        if (isPaused) {
            setIsPaused(false);
            return;
        }
        if (pausesRemaining > 0) {
            setIsPaused(true);
            setPausesRemaining(prev => prev - 1);
        }
    };

    const formatTime = (seconds) => {
        const safeSeconds = Math.max(0, seconds);
        return `${Math.floor(safeSeconds / 60)}:${(safeSeconds % 60).toString().padStart(2, '0')}`;
    };
    const currentQ = questions[currentIndex];
    if (!currentQ) return <div>Loading question...</div>;

    const isFillInTheBlank = currentQ.type === 'fill-in-the-blank' || (!currentQ.answerOptions || currentQ.answerOptions.length === 0);

    const subjectForRender = currentQ.subject || subject || 'Default';
    const quizSubject = subject || 'Default';
    const formulaSheetEnabled = Boolean(quizConfig?.formulaSheet);
    const canShowMathFormulas = formulaSheetEnabled && quizSubject === 'Math';
    const canShowScienceFormulas = formulaSheetEnabled && quizSubject === 'Science';
    const subjectColors = SUBJECT_COLORS[subjectForRender] || {};
    const scheme = { ...DEFAULT_COLOR_SCHEME, ...subjectColors };
    const timerStyle = timeLeft <= 60
        ? { backgroundColor: scheme.timerLowBg, color: scheme.timerLowText }
        : { backgroundColor: scheme.timerDefaultBg, color: scheme.timerDefaultText };

    return (
        <div className="fade-in">
            {canShowMathFormulas && showMathFormulas && (
                <FormulaSheetModal onClose={() => setShowMathFormulas(false)} />
            )}
            {canShowScienceFormulas && showScienceFormulas && (
                <ScienceFormulaSheet onClose={() => setShowScienceFormulas(false)} />
            )}
            <div
                className="quiz-panel rounded-2xl p-4 sm:p-6 shadow-lg"
                data-subject={quizSubject}
                style={{ backgroundColor: scheme.surface, border: `1px solid ${scheme.surfaceBorder}` }}
            >
                {showTimer && (
                    <header
                        className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pb-4 mb-4"
                        style={{ borderBottom: `1px solid ${scheme.divider}` }}
                    >
                        {onExit && (
                            <button
                                onClick={onExit}
                                className="flex items-center gap-1 text-sm font-semibold hover:underline"
                                style={{ color: scheme.mutedText }}
                            >
                                <ArrowLeftIcon /> Back
                            </button>
                        )}
                        <h2
                            className="flex-1 text-center text-xl font-bold"
                            style={{ color: scheme.text }}
                        >
                            {quizTitle}
                        </h2>
                        <div className="flex flex-col sm:items-end gap-2">
                            <div
                                className="flex items-center gap-2 rounded-full px-3 py-1 font-mono text-lg font-semibold"
                                style={timerStyle}
                            >
                                <span role="img" aria-label="timer">⏱️</span>
                                <span>{formatTime(timeLeft)}</span>
                                {isPaused && (
                                    <span className="text-xs uppercase tracking-wide" style={{ color: scheme.mutedText }}>
                                        Paused
                                    </span>
                                )}
                            </div>
                            <div className="flex items-center gap-2">
                                <button
                                    type="button"
                                    onClick={handlePauseToggle}
                                    disabled={!isPaused && pausesRemaining === 0}
                                    className="rounded-md px-3 py-1 text-sm font-semibold transition-colors"
                                    style={isPaused
                                        ? {
                                            backgroundColor: 'var(--success-bg)',
                                            color: 'var(--success-text)',
                                            border: '1px solid var(--success-border)',
                                        }
                                        : {
                                            backgroundColor: scheme.accent,
                                            color: scheme.accentText,
                                            border: `1px solid ${scheme.accent}`,
                                        }
                                    }
                                >
                                    {isPaused ? 'Resume Timer' : 'Pause Timer'}
                                </button>
                                <span className="text-xs" style={{ color: scheme.mutedText }}>
                                    {pausesRemaining} pause{pausesRemaining === 1 ? '' : 's'} left
                                </span>
                            </div>
                            {formulaSheetEnabled && (
                                <div className="flex flex-wrap justify-end gap-2">
                                    {canShowMathFormulas && (
                                        <button
                                            type="button"
                                            onClick={() => setShowMathFormulas(true)}
                                            className="rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition"
                                            data-role="secondary"
                                            style={{
                                                color: scheme.accentText,
                                                borderColor: scheme.accent,
                                            }}
                                        >
                                            View Formula Sheet
                                        </button>
                                    )}
                                    {canShowScienceFormulas && (
                                        <button
                                            type="button"
                                            onClick={() => setShowScienceFormulas(true)}
                                            className="rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition"
                                            data-role="secondary"
                                            style={{
                                                color: 'var(--danger-text)',
                                                borderColor: 'var(--danger-border)',
                                            }}
                                        >
                                            View Science Formula Sheet
                                        </button>
                                    )}
                                </div>
                            )}
                        </div>
                    </header>
                )}

                {article && (
                    <section className="mb-6">
                        <div className="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
                            <div>
                                <h3 className="text-lg font-semibold" style={{ color: scheme.text }}>Reading Passage</h3>
                                {article.genre && (
                                    <p className="text-xs uppercase tracking-wide" style={{ color: scheme.mutedText }}>
                                        {article.genre}
                                    </p>
                                )}
                            </div>
                            <button
                                type="button"
                                onClick={() => setShowArticle((prev) => !prev)}
                                className="inline-flex items-center gap-2 rounded-md px-3 py-1 text-sm font-semibold transition-colors"
                                style={{
                                    color: scheme.accentText,
                                    backgroundColor: scheme.accent,
                                    border: `1px solid ${scheme.accent}`,
                                }}
                            >
                                {showArticle ? 'Hide Passage' : 'Show Passage'}
                            </button>
                        </div>
                        {showArticle && (
                            <div
                                className="mt-3 space-y-3 rounded-xl p-4 text-sm leading-relaxed"
                                style={{
                                    backgroundColor: scheme.surfaceStrong,
                                    border: `1px solid ${scheme.surfaceBorder}`,
                                    maxHeight: '18rem',
                                    overflowY: 'auto',
                                }}
                            >
                                {article.title && (
                                    <h4
                                        className="text-base font-bold"
                                        style={{ color: scheme.text }}
                                        dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(article.title, { normalizeSpacing: true }) }}
                                    />
                                )}
                                {(article.imageUrl || articleImage) && (
                                    <img
                                        src={article.imageUrl || articleImage}
                                        alt={article.imageAlt || article.title || 'Reading passage illustration'}
                                        className="max-h-40 w-full rounded-lg object-cover"
                                    />
                                )}
                                {(article.text || []).map((paragraph, index) => (
                                    <p
                                        key={index}
                                        className="text-sm"
                                        style={{ color: scheme.text }}
                                        dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(paragraph, { normalizeSpacing: true }) }}
                                    />
                                ))}
                            </div>
                        )}
                    </section>
                )}

                <div className="mb-4 flex flex-wrap gap-2 quiz-nav">
                    {questions.map((_, i) => {
                        const isActive = i === currentIndex;
                        const isAnswered = Boolean(answers[i]);
                        const navStyle = isActive
                            ? { backgroundColor: scheme.background, color: scheme.onBackgroundText }
                            : isAnswered
                                ? { backgroundColor: scheme.navAnsweredBg, color: scheme.navAnsweredText }
                                : { backgroundColor: scheme.navDefaultBg, color: scheme.navDefaultText };
                        if (marked[i]) {
                            navStyle.boxShadow = `0 0 0 2px ${scheme.navMarkedRing}`;
                        }
                        return (
                            <button
                                key={i}
                                onClick={() => setCurrentIndex(i)}
                                className="h-8 w-8 rounded-full text-sm font-bold transition"
                                style={navStyle}
                            >
                                {i + 1}
                            </button>
                        );
                    })}
                </div>

                <div
                    className="question-container rounded-xl p-4 sm:p-6 shadow-inner"
                    data-subject={quizSubject}
                    style={{
                        border: `1px solid ${scheme.surfaceBorder}`,
                        backgroundColor: scheme.surfaceStrong || scheme.surface,
                    }}
                >
                    <div className="mb-4">
                        <div className="flex items-start gap-3">
                            <span
                                className="text-xl font-semibold leading-relaxed"
                                style={{ color: scheme.text }}
                            >
                                {currentQ.questionNumber}.
                            </span>
                            <Stem item={currentQ} />
                        </div>
                    </div>
                    {currentQ.imageUrl && !currentQ.stimulusImage?.src && (
                        <img
                            src={currentQ.imageUrl}
                            alt={`Visual for question ${currentQ.questionNumber}`}
                            className="my-4 h-auto max-w-full rounded-md"
                            style={{ border: `1px solid ${scheme.surfaceBorder}` }}
                        />
                    )}
                    {GEOMETRY_FIGURES_ENABLED && currentQ.geometrySpec && (
                        <div
                            className="my-4 mx-auto max-w-md rounded-md p-4 shadow-sm bg-white text-black dark:bg-slate-900 dark:text-slate-100"
                            style={{ border: `1px solid ${scheme.surfaceBorder}` }}
                        >
                            <GeometryFigure spec={currentQ.geometrySpec} className="w-full h-auto" />
                        </div>
                    )}

                    {isFillInTheBlank ? (
                        <div>
                            <label
                                htmlFor="fill-in-blank-answer"
                                className="mb-1 block text-sm font-medium"
                                style={{ color: scheme.mutedText }}
                            >
                                Enter your answer:
                            </label>
                            <input
                                id="fill-in-blank-answer"
                                type="text"
                                value={answers[currentIndex] || ''}
                                onChange={handleInputChange}
                                placeholder="Type your answer here"
                                className="w-full max-w-sm rounded-lg p-3 focus:outline-none"
                                style={{
                                    border: `1px solid ${scheme.inputBorder}`,
                                    color: 'var(--text-primary)',
                                }}
                            />
                        </div>
                    ) : (
                        <div className="space-y-3">
                            {(currentQ.answerOptions || []).map((opt, i) => {
                                const cleanedOptionText = opt.text.trim().replace(/^\$\$/, '$');
                                const isSelected = answers[currentIndex] === opt.text;
                                const optionStyles = {};
                                if (isSelected) {
                                    optionStyles.backgroundColor = scheme.optionSelectedBg;
                                    optionStyles.borderColor = scheme.optionSelectedBorder;
                                    optionStyles.color = scheme.accentText;
                                }
                                const optionClassNames = ['option', 'answer-option', 'w-full', 'text-left', 'transition'];
                                if (isSelected) {
                                    optionClassNames.push('selected');
                                }
                                return (
                                    <button
                                        key={i}
                                        onClick={() => handleSelect(opt.text)}
                                        className={optionClassNames.join(' ')}
                                        style={optionStyles}
                                    >
                                        <span className="flex-grow text-left" style={{ color: 'var(--text-primary)' }}>
                                            <span className="mr-2 font-bold">{String.fromCharCode(65 + i)}.</span>
                                            <span
                                                className="question-stem"
                                                dangerouslySetInnerHTML={renderQuestionTextForDisplay(cleanedOptionText, currentQ.isPremade === true)}
                                            />
                                        </span>
                                    </button>
                                );
                            })}
                        </div>
                    )}
                </div>

                <div className="mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <button
                        onClick={() => setCurrentIndex(p => Math.max(0, p - 1))}
                        disabled={currentIndex === 0}
                        className="rounded-md px-4 py-2 font-semibold transition"
                        data-role="secondary"
                        style={{
                            borderColor: scheme.surfaceBorder,
                            color: scheme.mutedText,
                            opacity: currentIndex === 0 ? 0.6 : 1,
                        }}
                    >
                        Previous
                    </button>
                    <button
                        onClick={() => setMarked(m => { const newM = [...m]; newM[currentIndex] = !newM[currentIndex]; return newM; })}
                        className="rounded-md px-4 py-2 font-semibold transition"
                        style={marked[currentIndex]
                            ? {
                                backgroundColor: scheme.navMarkedRing,
                                color: scheme.onBackgroundText,
                                border: `1px solid ${scheme.navMarkedRing}`,
                            }
                            : {
                                backgroundColor: scheme.navDefaultBg,
                                color: scheme.navDefaultText,
                                border: `1px solid ${scheme.navDefaultBg}`,
                            }
                        }
                    >
                        {marked[currentIndex] ? 'Unmark' : 'Mark'} for Review
                    </button>
                    {currentIndex === questions.length - 1 ? (
                        <button
                            onClick={handleSubmit}
                            className="rounded-md px-4 py-2 font-semibold"
                            data-role="primary"
                            style={{
                                backgroundColor: scheme.accent,
                                color: scheme.accentText,
                                borderColor: scheme.accent,
                            }}
                        >
                            {buttonText || 'Finish'}
                        </button>
                    ) : (
                        <button
                            onClick={() => setCurrentIndex(p => Math.min(questions.length - 1, p + 1))}
                            className="rounded-md px-4 py-2 font-semibold"
                            data-role="primary"
                            style={{
                                backgroundColor: scheme.accent,
                                color: scheme.accentText,
                                borderColor: scheme.accent,
                            }}
                        >
                            Next
                        </button>
                    )}
                </div>
            </div>
        </div>
    );
}

function StandardQuizRunner({ quiz, onComplete, onExit }) {
    const questions = quiz.questions || [];
    const [answers, setAnswers] = useState(Array(questions.length).fill(null));

    const handleComplete = (result) => {
        let score = 0;
        questions.forEach((q, i) => {
            const options = Array.isArray(q.answerOptions) ? q.answerOptions : [];
            const correctOption = options.find(opt => opt.isCorrect);
            if (correctOption && result.answers[i] === correctOption.text) {
                score++;
            }
        });
        const percentage = (score / questions.length) * 100;
        const scaledScore = Math.round(percentage < 65 ? 100 + (percentage / 65 * 44) : 145 + ((percentage - 65) / 35 * 55));

        onComplete({ score, totalQuestions: questions.length, scaledScore, answers: result.answers, subject: quiz.subject, marked: result.marked, confidence: result.confidence, quiz });
    };

    return <QuizInterface
        questions={questions}
        answers={answers}
        setAnswers={setAnswers}
        onComplete={handleComplete}
        quizTitle={quiz.title}
        onExit={onExit}
        timeLimit={quiz.timeLimit}
        subject={quiz.subject}
        quizConfig={quiz.config}
        article={quiz.article}
        articleImage={quiz.imageUrl}
    />;
}

function MultiPartMathRunner({ quiz, onComplete, onExit }) {
    const [part, setPart] = useState(1);
    const [part1Result, setPart1Result] = useState(null);

    const part1Questions = quiz.questions.slice(0, 5);
    const part2Questions = quiz.questions.slice(5);

    const [part1Answers, setPart1Answers] = useState(Array(part1Questions.length).fill(null));
    const [part2Answers, setPart2Answers] = useState(Array(part2Questions.length).fill(null));

    const handlePart1Complete = (result) => {
        setPart1Result(result);
        setPart('interstitial'); // Go to interstitial screen
    };

    const handlePart2Complete = (result) => {
        // Defensive merging in case part1Result is null/partial
        const p1 = part1Result || {
            answers: Array(part1Questions.length).fill(null),
            marked: Array(part1Questions.length).fill(false),
            confidence: Array(part1Questions.length).fill(null)
        };

        const finalAnswers = [...(p1.answers || []), ...(result.answers || [])];
        const finalMarked = [...(p1.marked || []), ...(result.marked || [])];
        const finalConfidence = [...(p1.confidence || []), ...(result.confidence || [])];

        // Normalization helpers to avoid crashes and tolerate light formatting
        const normalizeAnswer = (val) => {
            if (val === null || val === undefined) return '';
            return String(val)
                .replace(/^\$+|\$+$/g, '') // strip surrounding $
                .replace(/\u00A0/g, ' ')     // non-breaking space to regular space if present
                .replace(/\s+/g, ' ')
                .trim();
        };
        const isNumericEqual = (a, b) => {
            const na = Number(a);
            const nb = Number(b);
            if (!Number.isFinite(na) || !Number.isFinite(nb)) return false;
            return Math.abs(na - nb) < 1e-9;
        };

        let score = 0;
        const missing = [];
        quiz.questions.forEach((q, i) => {
            const isFillIn = !q.answerOptions || q.answerOptions.length === 0;
            if (isFillIn) {
                const user = normalizeAnswer(finalAnswers[i]);
                const correct = normalizeAnswer(q.correctAnswer);
                if (!user || !correct) {
                    // Skip silently but track for a one-time log
                    if (!correct) missing.push(i + 1);
                    return;
                }
                if (user === correct || isNumericEqual(user, correct)) {
                    score++;
                }
            } else {
                const correctOption = q.answerOptions.find(opt => opt.isCorrect);
                if (correctOption && finalAnswers[i] === correctOption.text) {
                    score++;
                }
            }
        });

        if (missing.length) {
            // Non-spammy single warning per submission with question numbers lacking correctAnswer
            console.warn(`[grader] ${missing.length} fill-in question(s) missing correctAnswer: #${missing.join(', ')}`);
        }

        const percentage = (score / quiz.questions.length) * 100;
        const scaledScore = Math.round(percentage < 65 ? 100 + (percentage / 65 * 44) : 145 + ((percentage - 65) / 35 * 55));

        onComplete({ score, totalQuestions: quiz.questions.length, scaledScore, answers: finalAnswers, subject: quiz.subject, marked: finalMarked, confidence: finalConfidence, quiz });
    };

    if (part === 1) {
        return <QuizInterface
            questions={part1Questions}
            answers={part1Answers}
            setAnswers={setPart1Answers}
            onComplete={handlePart1Complete}
            quizTitle="Part 1: Non-Calculator Section"
            buttonText="Continue to Part 2"
            onExit={onExit}
            subject={quiz.subject}
            quizConfig={quiz.config}
        />;
    }

    if (part === 'interstitial') {
        return (
            <div className="text-center p-8 fade-in">
                <h2 className="text-2xl font-bold mb-4">You have completed the non-calculator section.</h2>
                <p className="text-lg mb-6">You may now use a calculator for the remainder of the test.</p>
                <button onClick={() => setPart(2)} className="px-8 py-3 bg-sky-600 text-white font-bold rounded-lg">
                    Start Part 2
                </button>
            </div>
        );
    }

    if (part === 2) {
        return <QuizInterface
            questions={part2Questions}
            answers={part2Answers}
            setAnswers={setPart2Answers}
            onComplete={handlePart2Complete}
            quizTitle="Part 2: Calculator-Permitted Section"
            buttonText="Finish Exam"
            onExit={onExit}
            subject={quiz.subject}
            quizConfig={quiz.config}
        />;
    }

    return null;
}

function QuizRunner({ quiz, onComplete, onExit }) {
    console.log("QuizRunner received quiz:", quiz); // Debugging line
    if (!quiz) return <div className="text-center p-8">Loading quiz...</div>;

    switch (quiz.type) {
        case 'multi-part-math':
            return <MultiPartMathRunner quiz={quiz} onComplete={onComplete} onExit={onExit} />;
        case 'multi-part-rla':
            // The existing MultiPartRlaRunner can be used as is for now
            return <MultiPartRlaRunner quiz={quiz} onComplete={onComplete} onExit={onExit} />;
        default:
            return <StandardQuizRunner quiz={quiz} onComplete={onComplete} onExit={onExit} />;
    }
}

function MultiPartRlaRunner({ quiz, onComplete, onExit }) {
    const [currentPart, setCurrentPart] = useState(1);
    const [isPaused, setIsPaused] = useState(false);
    const [timeLeft, setTimeLeft] = useState(0);
    const [pausesRemaining, setPausesRemaining] = useState(2);

    const PART_TIMES = { 1: 35 * 60, 2: 45 * 60, 3: 70 * 60 };

    const [part1Answers, setPart1Answers] = useState(Array(quiz.part1_reading.length).fill(null));
    const [part3Answers, setPart3Answers] = useState(Array(quiz.part3_language.length).fill(null));
    const [essayText, setEssayText] = useState('');
    const [isScoring, setIsScoring] = useState(false);
    const [essayScore, setEssayScore] = useState(null);
    const [part1Result, setPart1Result] = useState(null);

    useEffect(() => {
        setTimeLeft(PART_TIMES[currentPart]);
        setIsPaused(false);
        setPausesRemaining(2);
    }, [currentPart]);

    useEffect(() => {
        if (isPaused || timeLeft <= 0) return;
        const timerId = setInterval(() => setTimeLeft(t => t - 1), 1000);
        return () => clearInterval(timerId);
    }, [isPaused, timeLeft]);

    const handlePauseToggle = () => {
        if (isPaused) {
            setIsPaused(false);
            return;
        }
        if (pausesRemaining > 0) {
            setIsPaused(true);
            setPausesRemaining(prev => prev - 1);
        }
    };

    const formatTime = (seconds) => `${Math.floor(Math.max(0, seconds) / 60)}:${(Math.max(0, seconds) % 60).toString().padStart(2, '0')}`;

    const handlePart1Complete = (result) => {
        setPart1Result(result);
        setCurrentPart(2);
    };

    const handlePart2Complete = async () => {
        if (isScoring) return;
        const result = await handleScoreEssay();
        if (!result) return;
        setCurrentPart(3);
    };

    const handleFinalSubmit = (part3Result) => {
        const part1Questions = quiz.part1_reading || [];
        const part3Questions = quiz.part3_language || [];

        const part1Data = part1Result || {
            answers: part1Answers,
            marked: Array(part1Questions.length).fill(false),
            confidence: Array(part1Questions.length).fill(null)
        };

        const part3Data = part3Result || {
            answers: part3Answers,
            marked: Array(part3Questions.length).fill(false),
            confidence: Array(part3Questions.length).fill(null)
        };

        const combinedAnswers = [
            ...(part1Data.answers || part1Answers),
            ...(part3Data.answers || part3Answers)
        ];

        const combinedMarked = [
            ...(part1Data.marked || Array(part1Questions.length).fill(false)),
            ...(part3Data.marked || Array(part3Questions.length).fill(false))
        ];

        const combinedConfidence = [
            ...(part1Data.confidence || Array(part1Questions.length).fill(null)),
            ...(part3Data.confidence || Array(part3Questions.length).fill(null))
        ];

        const part1Correct = part1Questions.reduce((count, question, index) => {
            const correctOption = (question.answerOptions || []).find(opt => opt.isCorrect);
            return count + (correctOption && correctOption.text === (part1Data.answers?.[index] ?? null) ? 1 : 0);
        }, 0);

        const part3Correct = part3Questions.reduce((count, question, index) => {
            const correctOption = (question.answerOptions || []).find(opt => opt.isCorrect);
            return count + (correctOption && correctOption.text === (part3Data.answers?.[index] ?? null) ? 1 : 0);
        }, 0);

        const score = part1Correct + part3Correct;
        const totalQuestions = part1Questions.length + part3Questions.length;
        const multipleChoicePercentage = totalQuestions > 0 ? (score / totalQuestions) * 100 : 0;

        const essayOverallScore = typeof essayScore?.overallScore === 'number' ? essayScore.overallScore : null;
        const essayPercentage = essayOverallScore !== null ? (essayOverallScore / 6) * 100 : 0;

        const finalPercentage = (multipleChoicePercentage * 0.6) + (essayPercentage * 0.4);
        const scaledScore = Math.round(finalPercentage < 65 ? 100 + (finalPercentage / 65 * 44) : 145 + ((finalPercentage - 65) / 35 * 55));

        const combinedQuestions = [...part1Questions, ...part3Questions];
        const normalizedQuiz = { ...quiz, questions: combinedQuestions };

        onComplete({
            score,
            totalQuestions,
            scaledScore,
            subject: quiz.subject,
            answers: combinedAnswers,
            marked: combinedMarked,
            confidence: combinedConfidence,
            essayScore,
            multipleChoicePercentage,
            essayPercentage,
            finalPercentage,
            quiz: normalizedQuiz
        });
    };

    const handleScoreEssay = async () => {
        if (!essayText.trim()) {
            alert("Please write an essay before continuing.");
            return null;
        }

        if (isScoring) {
            return essayScore;
        }

        setIsScoring(true);
        try {
            const response = await fetch('https://ged-website.onrender.com/score-essay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ essayText, completion: '5/5' })
            });
            if (!response.ok) throw new Error('Failed to score essay.');
            const result = await response.json();
            let jsonText = result.candidates[0].content.parts[0].text.replace(/```json/g, '').replace(/```/g, '').trim();
            const parsedScore = JSON.parse(jsonText);
            setEssayScore(parsedScore);
            return parsedScore;
        } catch (error) {
            console.error("Error scoring essay:", error);
            const errorResult = { error: "Sorry, could not score your essay." };
            setEssayScore(errorResult);
            alert("We couldn't score your essay automatically, but you can continue to the final section.");
            return errorResult;
        } finally {
            setIsScoring(false);
        }
    };

    const renderCurrentPart = () => {
        switch (currentPart) {
            case 1:
                return (
                    <div>
                        <h3 className="text-2xl font-bold mb-4">Part 1: Reading Comprehension</h3>
                        <QuizInterface
                            questions={quiz.part1_reading}
                            answers={part1Answers}
                            setAnswers={setPart1Answers}
                            onComplete={handlePart1Complete}
                            quizTitle="Part 1: Reading Comprehension"
                            buttonText="Continue to Essay"
                            subject={quiz.subject}
                            showTimer={false}
                            quizConfig={quiz.config}
                        />
                    </div>
                );
            case 2:
                return (
                    <div>
                        <h3 className="text-2xl font-bold mb-4 subject-accent-heading">Part 2: Extended Response (Essay)</h3>
                        <div className="prose passage-section max-w-none bg-slate-50 p-4 rounded-lg mb-4">
                            <h4 className="question-stem">{quiz.part2_essay.passages[0].title}</h4>
                            <div dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(quiz.part2_essay.passages[0].content, { normalizeSpacing: true }) }} />
                        </div>
                        <div className="prose passage-section max-w-none bg-slate-50 p-4 rounded-lg">
                            <h4 className="question-stem">{quiz.part2_essay.passages[1].title}</h4>
                            <div dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(quiz.part2_essay.passages[1].content, { normalizeSpacing: true }) }} />
                        </div>
                        <div className="mt-4">
                            <h4 className="font-bold">Essay Prompt:</h4>
                            <p className="mb-2">{quiz.part2_essay.prompt}</p>
                            <textarea className="w-full h-64 p-2 border rounded" value={essayText} onChange={(e) => setEssayText(e.target.value)} placeholder="Type your essay response here..."/>
                        </div>
                        <div className="mt-4 flex justify-end">
                            <button
                                type="button"
                                onClick={handlePart2Complete}
                                disabled={isScoring}
                                className="px-6 py-2 bg-sky-600 text-white font-bold rounded-lg disabled:bg-slate-400 disabled:cursor-not-allowed"
                            >
                                {isScoring ? 'Scoring Essay...' : 'Continue to Final Section'}
                            </button>
                        </div>
                        {isScoring && (
                            <p className="mt-2 text-sm text-slate-500">Scoring your essay with AI feedback. Please hold tight...</p>
                        )}
                    </div>
                );
            case 3:
                return (
                    <div>
                        <h3 className="text-2xl font-bold mb-4">Part 3: Language &amp; Grammar</h3>
                        <QuizInterface
                            questions={quiz.part3_language}
                            answers={part3Answers}
                            setAnswers={setPart3Answers}
                            onComplete={handleFinalSubmit}
                            quizTitle="Part 3: Language & Grammar"
                            buttonText="Finish Exam"
                            subject={quiz.subject}
                            showTimer={false}
                            quizConfig={quiz.config}
                        />
                    </div>
                );
            default: return null;
        }
    };

    return (
        <div className="fade-in">
             <header className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pb-4 mb-4 border-b">
                 <button onClick={onExit} className="flex items-center gap-1 text-sm text-slate-600 hover:text-sky-600 font-semibold"><ArrowLeftIcon /> Back</button>
                 <h2 className="text-xl font-bold text-center text-slate-800 flex-1">{quiz.title}</h2>
                 <div className="flex flex-col sm:items-end gap-2">
                    <div className={`flex items-center gap-2 px-3 py-1 rounded-full font-mono text-lg font-semibold ${timeLeft <= 60 ? 'bg-red-100 text-red-700' : 'bg-slate-100 text-slate-700'}`}>
                        <span role="img" aria-label="timer">⏱️</span>
                        <span>{formatTime(timeLeft)}</span>
                        {isPaused && <span className="text-xs uppercase tracking-wide">Paused</span>}
                    </div>
                    <div className="flex items-center gap-2">
                        <button
                            type="button"
                            onClick={handlePauseToggle}
                            disabled={!isPaused && pausesRemaining === 0}
                            className={`px-3 py-1 rounded-md text-sm font-semibold transition-colors ${isPaused ? 'bg-green-600 text-white hover:bg-green-700' : 'bg-sky-600 text-white hover:bg-sky-700 disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed'}`}
                        >
                            {isPaused ? 'Resume Timer' : 'Pause Timer'}
                        </button>
                        <span className="text-xs text-slate-500">
                            {pausesRemaining} pause{pausesRemaining === 1 ? '' : 's'} left
                        </span>
                    </div>
                 </div>
            </header>
            {isPaused ? (
                <div className="text-center p-12 bg-slate-100 rounded-lg">
                    <h2 className="text-3xl font-bold">Exam Paused</h2>
                    <button onClick={() => setIsPaused(false)} className="mt-4 px-8 py-3 bg-sky-600 text-white font-bold rounded-lg">Resume</button>
                </div>
            ) : renderCurrentPart()}
        </div>
    );
}

function ResultsScreen({ results, quiz, onRestart, onHome, onReviewMarked }) {
    const getPerf = (score) => {
        if (score >= 175) return { level: "GED® College Ready + Credit", color: "text-purple-600" };
        if (score >= 165) return { level: "GED® College Ready", color: "text-blue-600" };
        if (score >= 145) return { level: "GED® Passing Score", color: "text-green-600" };
        return { level: "Keep studying!", color: "text-amber-600" };
    };

    const performance = getPerf(results.scaledScore);
    const markedQuestions = quiz.questions.filter((_, index) => results.marked[index]);

    const performanceByCategory = quiz.questions.reduce((acc, question, index) => {
        const type = question.type || 'knowledge'; // Default type if not specified
        if (!acc[type]) {
            acc[type] = { correct: 0, total: 0 };
        }
        acc[type].total++;
        const correctAnswer = question.answerOptions.find(opt => opt.isCorrect)?.text;
        if (results.answers[index] === correctAnswer) {
            acc[type].correct++;
        }
        return acc;
    }, {});

    const categoryNames = {
        'text': 'Text Analysis',
        'image': 'Image/Map Interpretation',
        'knowledge': 'Knowledge-Based',
        'quote': 'Quote Analysis',
        'cause-effect': 'Cause & Effect',
        'multi-source': 'Multi-Source Analysis',
        'analysis': 'Paired Passage Analysis',
        'chart': 'Chart/Data Analysis'
    };

    return (
        <div className="text-center fade-in results-screen" data-subject={quiz.subject}>
            <h2 className="text-3xl font-bold subject-accent-heading">Results: {quiz.title}</h2>
            <div className="my-6">
                <p className="text-lg text-slate-600">Your estimated GED® Score is:</p>
                <p className={`text-6xl font-bold my-2 ${performance.color}`}>{results.scaledScore}</p>
                <p className={`text-2xl font-semibold mb-2 ${performance.color}`}>{performance.level}</p>
                <p className="text-lg text-slate-500">{results.score} / {results.totalQuestions} Correct</p>
            </div>

            <div className="mt-8 pt-6 border-t max-w-lg mx-auto">
                <h3 className="text-xl font-bold subject-accent-heading mb-4">Performance by Category</h3>
                <div className="space-y-3 text-left">
                    {Object.entries(performanceByCategory).map(([type, data]) => (
                        <div key={type} className="bg-slate-100 p-3 rounded-lg panel-surface">
                            <div className="flex justify-between items-center">
                                <span className="font-semibold text-slate-600">{categoryNames[type] || type}</span>
                                <span className="font-bold text-slate-800">{data.correct} / {data.total}</span>
                            </div>
                            <div className="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                                <div className="bg-sky-500 h-2.5 rounded-full" style={{ width: `${(data.correct / data.total) * 100}%` }}></div>
                            </div>
                        </div>
                    ))}
                </div>
            </div>

             <div className="mt-8 flex justify-center gap-4">
                 <button onClick={onHome} className="px-6 py-2 bg-slate-600 text-white font-bold rounded-lg hover:bg-slate-700">Go Home</button>
                      {markedQuestions.length > 0 && (
                          <button onClick={() => onReviewMarked(markedQuestions, quiz.subject)} className="px-6 py-2 bg-yellow-500 text-white font-bold rounded-lg hover:bg-yellow-600">
                        Review {markedQuestions.length} Marked
                    </button>
                 )}
                 <button onClick={onRestart} className="px-6 py-2 bg-sky-600 text-white font-bold rounded-lg hover:bg-sky-700">Try Again</button>
            </div>

            <div className="mt-8 pt-6 border-t">
                <h3 className="text-xl font-bold subject-accent-heading mb-4">Detailed Question Review</h3>
                <div className="space-y-4 text-left">
                    {(quiz.questions || []).map((question, index) => {
                        const userAnswer = results.answers[index];
                        const correctAnswer = (question.answerOptions || []).find(opt => opt.isCorrect);
                        const isCorrect = correctAnswer && userAnswer === correctAnswer.text;
                        const confidenceLevel = results.confidence ? results.confidence[index] : null;

                        const getConfidenceColor = (level) => {
                            if (level === 'Confident') return 'bg-green-100 text-green-800';
                            if (level === 'Unsure') return 'bg-yellow-100 text-yellow-800';
                            if (level === 'Guessing') return 'bg-red-100 text-red-800';
                            return 'bg-slate-100 text-slate-800';
                        };

                        return (
                            <div key={index} className={`p-4 rounded-lg border panel-surface ${isCorrect ? 'border-green-200' : 'border-red-200'}`}>
                                <div className="mb-2 flex items-start gap-3">
                                    <span className="font-semibold question-stem leading-relaxed">{question.questionNumber}.</span>
                                    <Stem item={question} />
                                </div>
                                {question.imageUrl && !question.stimulusImage?.src && (
                                    <img src={question.imageUrl} alt={`Visual for question ${question.questionNumber}`} className="my-2 rounded-md border max-w-xs h-auto" />
                                )}
                                {GEOMETRY_FIGURES_ENABLED && question.geometrySpec && (
                                    <div className="my-3 max-w-md">
                                        <GeometryFigure spec={question.geometrySpec} className="w-full h-auto" />
                                    </div>
                                )}
                                <p className={`mt-2 ${isCorrect ? 'text-green-700' : 'text-red-700'}`}>
                                    Your answer: {userAnswer || "No answer"} {isCorrect ? '✔' : '✘'}
                                </p>
                                {!isCorrect && correctAnswer && (
                                    <p className="text-green-700 question-stem">
                                        Correct answer: <span className="question-stem" dangerouslySetInnerHTML={renderQuestionTextForDisplay(correctAnswer.text, question.isPremade === true)} />
                                    </p>
                                )}
                                {correctAnswer && correctAnswer.rationale && (
                                    <div className="explanation">
                                        <span className="font-semibold">Rationale:</span>{' '}
                                        <span className="question-stem" dangerouslySetInnerHTML={renderQuestionTextForDisplay(correctAnswer.rationale, question.isPremade === true)} />
                                    </div>
                                )}
                                {confidenceLevel && (
                                    <div className="mt-2">
                                        <span className="font-semibold text-sm text-slate-600">Your confidence: </span>
                                        <span className={`px-2 py-0.5 text-xs font-bold rounded-full ${getConfidenceColor(confidenceLevel)}`}>
                                            {confidenceLevel}
                                        </span>
                                    </div>
                                )}
                            </div>
                        );
                    })}
                </div>
            </div>
        </div>
    );
}

function ReadingPractice({ quiz, onComplete, onExit }) {
     const [answers, setAnswers] = useState({});
     const [isSubmitted, setIsSubmitted] = useState(false);

    const handleAnswer = (qIndex, answer) => {
        if(isSubmitted) return;
        setAnswers(prev => ({ ...prev, [qIndex]: answer }));
    };

    const handleSubmit = () => {
        if (Object.keys(answers).length !== quiz.questions.length) {
            if(!confirm("You have unanswered questions. Are you sure you want to submit?")) {
                return;
            }
        }
        setIsSubmitted(true);
        let score = 0;
        quiz.questions.forEach((q, i) => {
             const correctOption = (q.answerOptions || []).find(opt => opt.isCorrect);
            if(correctOption && answers[i] === correctOption.text) {
                score++;
            }
        });
        const percentage = (score / quiz.questions.length) * 100;
        const scaledScore = Math.round(percentage < 65 ? 100 + (percentage / 65 * 44) : 145 + ((percentage - 65) / 35 * 55));
        onComplete({ score, totalQuestions: quiz.questions.length, scaledScore, subject: quiz.subject, quiz });
    };

    return (
        <div className="fade-in" data-subject={quiz.subject}>
             <header className="flex justify-between items-center pb-4 mb-4 border-b">
                 <button onClick={onExit} className="flex items-center gap-1 text-sm text-slate-600 hover:text-sky-600 font-semibold"><ArrowLeftIcon /> Back</button>
                 <h2 className="text-xl font-bold text-center subject-accent-heading">{quiz.title}</h2>
                 <div></div>
            </header>
            <article className="prose passage-section max-w-none">
                <h3 className="text-2xl font-bold question-stem" dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(quiz.article.title, { normalizeSpacing: true }) }}></h3>
                <p className="text-sm italic text-slate-500">{quiz.article.genre}</p>
                {quiz.imageUrl && <img src={quiz.imageUrl} alt="Article supplemental image" className="my-4 mx-auto rounded-md border" />}
                {quiz.article.text.map((p, i) => <p key={i} dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(p, { normalizeSpacing: true }) }}></p>)}
            </article>
            <section className="mt-8 pt-6 border-t">
                <h3 className="text-2xl font-bold mb-4 subject-accent-heading">Questions</h3>
                <div className="space-y-6">
                    {quiz.questions.map((q, i) => (
                        <div key={i} className={`question-container p-4 rounded-lg transition-colors ${isSubmitted ? (answers[i] === (q.answerOptions || []).find(o=>o.isCorrect)?.text ? 'bg-green-50' : 'bg-red-50') : 'bg-slate-50'}`}>
                            {q.imageUrl && !(q.stimulusImage && q.stimulusImage.src) && (
                                <img src={q.imageUrl} alt={`Visual for question ${i + 1}`} className="my-2 rounded-md border max-w-xs h-auto" />
                            )}
                            {GEOMETRY_FIGURES_ENABLED && q.geometrySpec && (
                                <div className="my-3 max-w-md">
                                    <GeometryFigure spec={q.geometrySpec} className="w-full h-auto" />
                                </div>
                            )}
                            <div className="mb-2 flex items-start gap-3">
                                <span className="font-semibold question-stem leading-relaxed">{i+1}.</span>
                                <Stem item={{ ...q, questionNumber: q.questionNumber ?? (i + 1) }} />
                            </div>
                            <div className="mt-2 space-y-1">
                                {(q.answerOptions || []).map((opt, j) => {
                                    const isSelectedOption = answers[i] === opt.text;
                                    const optionClasses = [
                                        'answer-option flex items-center p-2 rounded cursor-pointer',
                                        isSelectedOption ? 'bg-slate-200' : 'hover:bg-slate-100',
                                        isSubmitted && opt.isCorrect ? 'correct' : '',
                                        isSubmitted && isSelectedOption && !opt.isCorrect ? 'incorrect' : '',
                                    ].filter(Boolean).join(' ');
                                    return (
                                        <label key={j} className={optionClasses}>
                                            <input type="radio" name={`q${i}`} value={opt.text} onChange={() => handleAnswer(i, opt.text)} disabled={isSubmitted} className="mr-2"/>
                                            <span className={`${isSubmitted && opt.isCorrect ? 'font-bold text-green-700' : ''} ${isSubmitted && isSelectedOption && !opt.isCorrect ? 'line-through text-red-700' : ''} question-stem`}>
                                                <span className="question-stem" dangerouslySetInnerHTML={renderQuestionTextForDisplay(opt.text, q.isPremade === true)} />
                                            </span>
                                        </label>
                                    );
                                })}
                            </div>
                        </div>
                    ))}
                </div>
                {!isSubmitted && <button onClick={handleSubmit} className="mt-6 w-full px-6 py-3 bg-sky-600 text-white font-bold rounded-lg hover:bg-sky-700">Submit Answers</button>}
            </section>
        </div>
    );
}

function EssayGuide({ onExit }) {
    const [activeTab, setActiveTab] = useState('passages');
    const [selectedTopic, setSelectedTopic] = useState(0);
    const [timer, setTimer] = useState(45 * 60);
    const [timerActive, setTimerActive] = useState(false);
    const [essayText, setEssayText] = useState({ intro: '', body1: '', body2: '', body3: '', conclusion: '' });
    const [showModal, setShowModal] = useState(false);
    const [isScoring, setIsScoring] = useState(false);
    const [scoreResult, setScoreResult] = useState(null);
    const [showPromptOverlay, setShowPromptOverlay] = useState(false);
    const [overlayView, setOverlayView] = useState('prompt');

    const intervalRef = useRef(null);

const passagesData = [
    // --- All 10 Topics Updated with Highlighted & Imbalanced Evidence ---
    {
        topic: "Should the Voting Age Be Lowered to 16?",
        passage1: {
            title: "Dr. Alisa Klein, Sociologist (Stronger Argument)",
            content: "<p>Lowering the voting age to 16 is a crucial step for a healthier democracy. At 16, many young people are employed, pay taxes on their earnings, and are subject to the laws of the land. It is a fundamental principle of democracy—'no taxation without representation'—that they should have a voice in shaping policies that directly affect them, from education funding to climate change.</p><p><span class='good-evidence'>Furthermore, research shows that voting is a habit; a 2020 study from Tufts University found that cities that allow 16-year-olds to vote in local elections see significantly higher youth turnout in subsequent national elections.</span> Enabling citizens to vote at an age when they are still living in a stable home and learning about civics in school increases the likelihood they will become lifelong voters.</p><p><span class='good-evidence'>As political scientist Dr. Mark Franklin notes, 'The earlier a citizen casts their first ballot, the more likely they are to become a consistent participant in our democracy.'</span> It is a vital step toward strengthening civic engagement for generations to come.</p>"
        },
        passage2: {
            title: "Marcus heavyweight, Political Analyst (Weaker Argument)",
            content: "<p>While the idealism behind lowering the voting age is appealing, the practical realities suggest it would be a mistake. The adolescent brain is still undergoing significant development, particularly in areas related to long-term decision-making and impulse control. The political landscape is complex, requiring a level of experience and cognitive maturity that most 16-year-olds have not yet developed.</p><p>We risk trivializing the profound responsibility of voting by extending it to a demographic that is, by and large, not yet equipped to handle it. <span class='bad-evidence'>I remember being 16, and my friends and I were far more concerned with prom dates and getting a driver's license than with monetary policy.</span> Their priorities are simply not aligned with the serious nature of national governance.</p><p>The current age of 18 strikes a reasonable balance, marking a clear transition into legal adulthood and the full spectrum of responsibilities that come with it. To change this is to experiment with the foundation of our republic for no clear gain.</p>"
        }
    },
    {
        topic: "Is Universal Basic Income (UBI) a Viable Solution to Poverty?",
        passage1: {
            title: "Anna Coote, Economist (Stronger Argument)",
            content: "<p>A Universal Basic Income, while well-intentioned, is an inefficient and expensive tool for poverty reduction. It fails to target the individuals who need support the most, instead distributing funds to everyone, which ultimately dilutes its impact. <span class='good-evidence'>According to a 2018 analysis by the Center on Budget and Policy Priorities, replacing existing targeted aid programs with a modest UBI would actually increase the poverty rate.</span></p><p>Existing programs like SNAP (food stamps) and Medicaid are designed to address the specific, varied hardships of poverty. UBI risks dismantling this targeted support system. Furthermore, there is a significant danger of UBI entrenching low pay and precarious work, as it could effectively subsidize employers who pay poverty wages, normalizing economic instability rather than solving its root causes.</p><p><span class='good-evidence'>This is a logical consequence, as a guaranteed income floor reduces the pressure on companies to offer competitive wages and benefits to attract workers for undesirable jobs.</span> The focus should be on strengthening our existing, targeted safety nets and promoting policies that lead to higher wages and better job quality.</p>"
        },
        passage2: {
            title: "Robert Doar, Poverty Studies Fellow (Weaker Argument)",
            content: "<p>The concept of a guaranteed income has merit as a powerful tool to provide stability in an unstable world. A regular, predictable income floor would act as a safety net, allowing individuals to invest in new skills or find more suitable jobs without the constant threat of destitution. It provides the foundation upon which individuals can build more productive and independent lives.</p><p><span class='bad-evidence'>Everyone knows that if you're not worried about next month's rent, you can make better long-term decisions.</span> It just makes sense that this freedom would lead to a boom in entrepreneurship and creativity, unleashing human potential that is currently suppressed by economic anxiety.</p><p>The goal is not to give up on work, but to provide a cushion that allows for smarter work. Opponents worry that people will stop working, but this is a cynical view of human nature. Most people want to contribute and improve their lives; UBI simply gives them the security to do so more effectively.</p>"
        }
    },
    {
        topic: "Should Governments Aggressively Subsidize Renewable Energy?",
        passage1: {
            title: "Energy Policy Journal (Stronger Argument)",
            content: "<p>Government subsidies are essential for accelerating the transition to renewable energy sources like solar and wind. The primary benefit is environmental; renewables produce little to no greenhouse gases, combating climate change and improving public health. <span class='good-evidence'>A report from the National Renewable Energy Laboratory (NREL) concluded that achieving 80% renewable electricity by 2050 could reduce economy-wide carbon emissions by 81%.</span></p><p>While the initial costs can be high, subsidies make them accessible and competitive with established fossil fuels, which have themselves been subsidized for decades. This investment creates jobs in a growing clean energy sector and fosters energy independence. <span class='good-evidence'>According to the U.S. Bureau of Labor Statistics, solar panel installer and wind turbine technician are two of the fastest-growing jobs in the country.</span></p><p>In the long run, supporting renewables is not just an environmental decision, but a strategic economic one. It leads to stable, predictable energy costs free from the price volatility of the global oil market. It is a necessary investment in a cleaner and more economically secure future.</p>"
        },
        passage2: {
            title: "Institute for Energy Research (Weaker Argument)",
            content: "<p>While renewable energy is a worthy goal, aggressive government subsidies create significant problems. The high upfront cost of technologies like solar panels and wind turbines are passed on to taxpayers, creating a massive financial burden. These systems also have geographic limitations—they are only effective in specific locations with consistent sun or wind.</p><p>Furthermore, energy production is often intermittent, requiring expensive battery storage solutions that are not yet advanced enough. <span class='bad-evidence'>Think of the poor families who will have their lights go out on a calm, cloudy day.</span> It's simply not reliable enough to power a modern economy without fossil fuel backup, which defeats the entire purpose.</p><p>A market-driven approach, rather than government intervention, would allow the most efficient and affordable technologies to emerge naturally. We shouldn't let the government pick winners and losers with taxpayer money; we should let innovation and competition determine the best path forward.</p>"
        }
    },
    {
        topic: "Does Social Media Do More Harm Than Good for Teen Mental Health?",
        passage1: {
            title: "U.S. Surgeon General's Advisory (Stronger Argument)",
            content: "<p>There is a profound risk of harm to the mental health and well-being of children and adolescents from social media. <span class='good-evidence'>A 2022 study published in the Journal of the American Medical Association (JAMA) showed that teens who spend more than three hours a day on social media face double the risk of experiencing depression and anxiety symptoms.</span> These platforms are often designed to maximize user engagement, which can disrupt sleep and expose young users to harmful content.</p><p>The adolescent brain is highly susceptible to social comparison and peer pressure. Social media platforms can create a distorted reality, where teens are constantly comparing their own lives to the curated, idealized posts of others. <span class='good-evidence'>This has been directly linked to lower self-esteem and poor body image, particularly among adolescent girls, as noted by the American Psychological Association.</span></p><p><span class='bad-evidence'>It feels like every teenager I meet is more anxious than the last, and they are all glued to their phones.</span> The connection is obvious. We need better safeguards, and parents need to be more aware of the very real dangers these platforms pose to their children's developing minds.</p>"
        },
        passage2: {
            title: "Youth Mental Health Council (Weaker Argument)",
            content: "<p>While risks exist, social media often provides essential benefits for teens. Many report that it helps them feel more accepted and connected to their friends. These online connections are especially crucial for marginalized youth, such as LGBTQ teens, who may find a supportive community online that is unavailable to them in their immediate environment.</p><p><span class='bad-evidence'>My own daughter was struggling to make friends, but she found a wonderful group of people online who share her passion for art. It completely turned her life around.</span> This just goes to show how vital these connections can be for a young person's happiness.</p><p>Social media platforms can foster a sense of belonging and provide a place for creative self-expression. They also help teens access information and resources about mental health, which can promote help-seeking behaviors. To focus only on the negatives is to ignore the powerful role social media can play in supporting youth well-being.</p>"
        }
    },
    {
        topic: "Is a Four-Year College Degree the Best Path to a Successful Career?",
        passage1: {
            title: "Dr. Anya Sharma, Education Policy Analyst (Weaker Argument)",
            content: "<p>A four-year college degree remains the most reliable pathway to long-term career success and economic mobility. While vocational training has its place, a bachelor's degree provides something far more valuable: a foundation in critical thinking, complex problem-solving, and communication. These are not just job skills; they are life skills that allow graduates to adapt to a rapidly changing economy.</p><p>Statistically, the evidence is overwhelming. College graduates consistently earn significantly more over their lifetimes than those without a degree. <span class='bad-evidence'>Everyone knows someone who got a degree and became successful.</span> This 'degree premium' is not just about the first job out of college, but about the upward trajectory that a broad-based education enables.</p><p>Furthermore, the college experience itself fosters personal growth and exposure to diverse perspectives. To suggest that a narrow, job-specific training program is equivalent is to ignore the fundamental purpose of higher education: to create not just workers, but informed and adaptable citizens.</p>"
        },
        passage2: {
            title: "Marco Diaz, Skilled Trades Advocate (Stronger Argument)",
            content: "<p>For too long, we have pushed a 'college-for-all' mentality that has left millions of young people with crippling student loan debt. It is time we recognize that vocational training offers a more direct and affordable path to a stable career. <span class='good-evidence'>According to the Bureau of Labor Statistics, many skilled trades, such as electricians and plumbers, have median salaries comparable to or exceeding those of many bachelor's degree holders, without the upfront cost.</span></p><p>Vocational programs provide hands-on skills that are immediately applicable. Students often enter paid apprenticeship programs where they earn while they learn. This model avoids the massive debt associated with a four-year degree and allows young adults to begin building financial independence years earlier. <span class='good-evidence'>A 2021 report from the National Center for Education Statistics highlights that the average student loan debt for a bachelor's degree is over $30,000.</span></p><p>We must stop stigmatizing skilled labor. By promoting vocational education as a respectable and intelligent alternative, we can build a stronger, more practical workforce and offer a debt-free path to the middle class for millions of Americans.</p>"
        }
    },
    {
        topic: "Should Schools Ban the Use of Smartphones in the Classroom?",
        passage1: {
            title: "Principal Thompson, Educator (Stronger Argument)",
            content: "<p>Smartphones have become the single greatest source of distraction in the modern classroom, and it is time for a clear and consistent ban. These devices fragment student attention and disrupt the learning environment. The primary purpose of a classroom is education, and anything that fundamentally undermines that purpose must be removed.</p><p><span class='good-evidence'>A comprehensive study by the London School of Economics analyzed schools in four English cities and found that after phones were banned, student test scores improved by an average of 6.4%.</span> This effect was even more pronounced for lower-achieving students, suggesting a ban can help close the achievement gap. This data provides clear, empirical evidence that removing phones leads to better academic outcomes.</p><p>A firm ban sends an unambiguous message about our academic priorities and helps students develop the crucial skill of focused, sustained attention, a skill that is eroding in the digital age.</p>"
        },
        passage2: {
            title: "Dr. Helen Tran, Digital Learning Expert (Weaker Argument)",
            content: "<p>Banning smartphones in schools is a Luddite response to a modern reality. Instead of banning these powerful tools, we should be teaching students how to use them responsibly. Smartphones provide instant access to a world of information, acting as research tools and collaborative devices. To deny students access is to cripple them with an outdated model of education.</p><p><span class='bad-evidence'>The people who want to ban phones are just old-fashioned and afraid of technology.</span> This argument ignores the fact that the modern workplace requires digital literacy. Schools have a responsibility to prepare students for the world they will actually live and work in, and that world is saturated with technology.</p><p>The challenge is not the device, but the pedagogy. We need to train teachers to leverage these tools for learning, not run from them. <span class='bad-evidence'>It's just common sense that you can't prepare kids for the future by taking away future tools.</span></p>"
        }
    },
    {
        topic: "Should Fast-Food Restaurants Be Required to Display Calorie Counts?",
        passage1: {
            title: "Center for Public Health (Stronger Argument)",
            content: "<p>In the fight against the obesity epidemic, information is one of our most powerful weapons. Requiring fast-food chains to prominently display calorie counts on their menus is a common-sense policy that empowers consumers to make healthier choices. It is a simple matter of transparency; people have a right to know what is in the food they are purchasing.</p><p><span class='good-evidence'>A study published in the American Journal of Public Health found that after New York City implemented menu labeling, consumers at fast-food chains purchased, on average, 25 fewer calories per transaction.</span> While this may seem small, these small changes, compounded over time, can lead to significant positive health outcomes for the population.</p><p>This isn't about banning choices; it's about enabling informed ones. Just as the FDA requires nutrition labels on packaged foods, providing clear, accessible information at the point of purchase is a minimal and effective step to help people take better control of their own health.</p>"
        },
        passage2: {
            title: "Restaurant Industry Association (Weaker Argument)",
            content: "<p>Mandatory calorie labeling for fast-food restaurants is a costly and ineffective government overreach. The financial burden of analyzing every menu item and reprinting menu boards is significant, especially for smaller franchise owners. This is a classic case of the government imposing a one-size-fits-all solution that hurts small businesses.</p><p><span class='bad-evidence'>I know plenty of people who see a high calorie count and just order the item anyway, so it clearly doesn't work.</span> People go to fast-food restaurants for convenience and taste, not for a health experience. Consumer behavior is driven by many factors, and a single number on a menu board is unlikely to be the deciding one.</p><p>Ultimately, this policy is based on the flawed assumption that a lack of information is the cause of poor dietary choices. <span class='bad-evidence'>Everyone already knows that a burger and fries isn't a health food.</span> The focus should be on personal responsibility, not on more government regulations.</p>"
        }
    },
    {
        topic: "Should National Parks Implement a Lottery System to Manage Overcrowding?",
        passage1: {
            title: "Dr. David Chen, Conservation Biologist (Stronger Argument)",
            content: "<p>Our most beloved national parks are being loved to death. The surge in visitor numbers has led to traffic gridlock, trail erosion, and damage to fragile ecosystems. To protect these natural treasures for future generations, we must implement more restrictive access systems, and a lottery is the fairest way to do so.</p><p><span class='good-evidence'>The National Park Service's own data shows that in parks like Zion and Arches, unmanaged visitor numbers have led to significant soil compaction and vegetation loss along popular trails.</span> A lottery system would directly mitigate this environmental damage by controlling the number of people on the trails each day. This is a necessary management tool to fulfill the Park Service's core mission of preservation.</p><p><span class='good-evidence'>Furthermore, a 2021 study on visitor experiences in Yosemite concluded that overcrowding significantly diminishes the quality of the visitor experience, leading to lower satisfaction.</span> A reservation system provides certainty and allows visitors to plan their trips effectively, ensuring a better experience for those who do attend.</p>"
        },
        passage2: {
            title: "Brenda Walsh, Public Lands Advocate (Weaker Argument)",
            content: "<p>National parks were created to be accessible to all Americans, not just the lucky few who win a lottery. Implementing a reservation system fundamentally changes the nature of these public lands from a shared national birthright into an exclusive commodity. It creates a barrier that will disproportionately affect families who cannot plan their vacations months in advance.</p><p><span class='bad-evidence'>My family has always taken spontaneous trips to the parks, and a lottery system would destroy that tradition.</span> This would harm the local gateway communities whose economies depend on a steady flow of tourists, not just a pre-determined, limited number.</p><p><span class='bad-evidence'>Turning our parks into an exclusive club is a betrayal of the very idea of 'America's Best Idea.'</span> We must focus on smart solutions like more shuttle buses, rather than simply locking people out.</p>"
        }
    },
    {
        topic: "Should Standardized Test Scores Be a Primary Factor in College Admissions?",
        passage1: {
            title: "Dr. Richard Evans, Admissions Counselor (Stronger Argument)",
            content: "<p>Relying heavily on standardized test scores like the SAT and ACT in college admissions is an outdated and inequitable practice. These tests are not a pure measure of merit; they are strongly correlated with a student's family income and access to resources. Students from affluent families can afford expensive test prep courses, giving them an unfair advantage.</p><p><span class='good-evidence'>A landmark study of over 123,000 students at 33 test-optional colleges found that there was virtually no difference in college GPA or graduation rates between students who submitted scores and those who did not.</span> This proves that high school grades are a far better predictor of college success. A student's performance over four years is a much more holistic and accurate measure of their ability and work ethic.</p><p>By moving to a test-optional system, colleges can assess applicants more equitably, considering their academic record, essays, and activities. This allows them to build a more diverse and capable student body, rewarding long-term diligence over the ability to perform well on a single, high-stakes exam.</p>"
        },
        passage2: {
            title: "Dr. Susan Gerson, Education Measurement Specialist (Weaker Argument)",
            content: "<p>While standardized tests are not perfect, they are the most objective and reliable tool we have for comparing students from tens of thousands of different high schools. Grade inflation is rampant, and an 'A' in one school is not equivalent to an 'A' in another. The SAT and ACT provide a common yardstick to measure core academic skills.</p><p><span class='bad-evidence'>Without tests, admissions would just become a subjective guessing game about who wrote the prettiest essay.</span> It would be chaos. These tests can help identify promising students from less well-known high schools whose grades might otherwise be overlooked. To ignore test scores is to ignore a valuable piece of data.</p><p>Rather than eliminating these tests, we should focus on ensuring all students have access to free, high-quality test preparation resources. Fixing the access problem is a better solution than throwing away our only objective measurement tool.</p>"
        }
    },
    {
        topic: "Is a Remote Work Model More Beneficial Than a Traditional In-Office Model?",
        passage1: {
            title: "Jennifer Lee, Chief Financial Officer (Stronger Argument)",
            content: "<p>The shift to remote work has proven to be a resounding success, offering significant financial and operational benefits. By reducing the need for large, expensive office spaces, companies can drastically cut overhead costs related to rent and utilities. These savings can be reinvested into growth and innovation.</p><p>From a human resources perspective, the benefits are even more compelling. Offering remote work allows a company to recruit from a global talent pool, not just a single city. <span class='good-evidence'>A 2021 survey by Stanford University of 16,000 workers over 9 months found that remote work not only increased employee satisfaction but also boosted productivity by 13%.</span> Happier, more autonomous employees are more productive employees.</p><p>Furthermore, remote work improves employee retention and well-being. <span class='good-evidence'>According to a Gallup poll, a majority of remote-capable employees who are forced to return to the office full-time are actively seeking new employment.</span> A flexible, remote-first model is not just a trend; it is the future of a more efficient and humane way of doing business.</p>"
        },
        passage2: {
            title: "Robert Chen, Management Consultant (Weaker Argument)",
            content: "<p>The alleged benefits of remote work are largely illusory and ignore the long-term damage it does to a company's culture. The office is a hub for spontaneous collaboration and mentorship that simply cannot be replicated over scheduled Zoom calls. The informal 'water cooler' conversations that spark new ideas are lost forever.</p><p><span class='bad-evidence'>It's just common sense that people are going to be less productive at home with all the distractions of laundry and television.</span> While some companies may see short-term gains in routine tasks, the long-term cost in terms of lost innovation and team cohesion will be immense.</p><p>Junior employees, in particular, suffer from a lack of mentorship and observational learning that is critical for their career development. A vibrant, in-person workplace remains the most powerful engine for collaborative success, and we are losing that in favor of a lonely, disconnected workforce.</p>"
        }
    }
];

    useEffect(() => {
        if (timerActive && timer > 0) {
            intervalRef.current = setInterval(() => {
                setTimer(t => t - 1);
            }, 1000);
        } else if (timer <= 0) {
            clearInterval(intervalRef.current);
            setTimerActive(false);
            finishPractice();
        }
        return () => clearInterval(intervalRef.current);
    }, [timerActive, timer]);

    useEffect(() => {
        if (activeTab !== 'structure') {
            setShowPromptOverlay(false);
        }
    }, [activeTab]);

    useEffect(() => {
        setOverlayView('prompt');
    }, [selectedTopic]);

    const startPractice = () => {
        setTimerActive(true);
    };

    const resetPractice = () => {
        setTimerActive(false);
        clearInterval(intervalRef.current);
        setTimer(45 * 60);
        setEssayText({ intro: '', body1: '', body2: '', body3: '', conclusion: '' });
        setScoreResult(null);
    };

    const finishPractice = () => {
        setTimerActive(false);
        clearInterval(intervalRef.current);
        setShowModal(true);
    };

    const handleTextChange = (e) => {
        const { name, value } = e.target;
        setEssayText(prev => ({ ...prev, [name]: value }));
    };

    const handleGetScore = async () => {
        setIsScoring(true);
        setScoreResult(null);
        const fullEssay = Object.values(essayText).join("\n\n").trim();
        const completionCount = Object.values(essayText).filter(text => text.trim() !== '').length;

        try {
            const response = await fetch('https://ged-website.onrender.com/score-essay', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    essayText: fullEssay,
                    completion: `${completionCount}/5` // Send completion data
                })
            });
            if (!response.ok) throw new Error('Failed to get score from the server.');

            const result = await response.json();
            let jsonText = result.candidates[0].content.parts[0].text;
            jsonText = jsonText.replace(/```json/g, '').replace(/```/g, '').trim();
            const parsedScore = JSON.parse(jsonText);
            setScoreResult(parsedScore);

        } catch (error) {
            console.error("Error scoring essay:", error);
            setScoreResult({ error: "Sorry, we couldn't score your essay at this time." });
        } finally {
            setIsScoring(false);
        }
    };

    const formatTime = (seconds) => `${Math.floor(seconds / 60)}:${(seconds % 60).toString().padStart(2, '0')}`;
    const selectedPassage = passagesData[selectedTopic];
    const promptSummary = selectedPassage
        ? `After reading both passages about "${selectedPassage.topic}", write an essay in which you explain which author presents the more convincing argument. Support your response with evidence from both passages and explain why the evidence you cite supports your evaluation.`
        : '';
    const overlayButtons = [
        { id: 'prompt', label: 'Essay Prompt', title: 'GED® RLA Essay Prompt' },
        { id: 'passage1', label: 'Passage A', title: selectedPassage?.passage1?.title || 'Passage A' },
        { id: 'passage2', label: 'Passage B', title: selectedPassage?.passage2?.title || 'Passage B' }
    ];

    const renderOverlayBody = () => {
        if (!selectedPassage) return null;
        switch (overlayView) {
            case 'passage1':
                return (
                    <div className="prose passage-section max-w-none text-sm text-slate-700" dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(selectedPassage.passage1.content, { normalizeSpacing: true }) }} />
                );
            case 'passage2':
                return (
                    <div className="prose passage-section max-w-none text-sm text-slate-700" dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(selectedPassage.passage2.content, { normalizeSpacing: true }) }} />
                );
            default:
                return (
                    <div className="space-y-3 text-sm leading-relaxed text-slate-700">
                        <p>{promptSummary}</p>
                        <ul className="list-disc pl-5 space-y-2">
                            <li>Clearly state which author presents the stronger argument on the topic.</li>
                            <li>Use at least two specific pieces of evidence from the passages to support your evaluation.</li>
                            <li>Explain why the evidence you cite strengthens one argument or weakens the other.</li>
                            <li>Organize your ideas with an introduction, body paragraphs, and a conclusion.</li>
                        </ul>
                    </div>
                );
        }
    };

    const renderTabs = () => (
        <nav className="flex flex-wrap justify-center border-b-2 border-gray-300 mb-8">
            {['passages', 'structure', 'strengths', 'weaknesses'].map(tab => (
                <button
                    key={tab}
                    onClick={() => setActiveTab(tab)}
                    className={`tab-button text-lg font-semibold py-4 px-6 text-gray-600 capitalize ${activeTab === tab ? 'active' : ''}`}
                >
                    {tab.replace('_', ' ')}
                </button>
            ))}
        </nav>
    );

    const renderContent = () => {
        switch(activeTab) {
            case 'passages':
                return (
                    <div>
                        <div className="mb-6 bg-white p-4 rounded-lg shadow-md">
                            <label htmlFor="topic-selector" className="block text-lg font-semibold text-gray-800 mb-2">Select an Article Topic:</label>
                            <select id="topic-selector" className="w-full p-2 border border-gray-300 rounded-md text-lg" value={selectedTopic} onChange={e => setSelectedTopic(Number(e.target.value))}>
                                {passagesData.map((p, i) => <option key={i} value={i}>{p.topic}</option>)}
                            </select>
                        </div>
                        <div className="grid lg:grid-cols-2 gap-8">
                            <article className="bg-white p-6 rounded-lg shadow-md">
                                <h2 className="text-2xl font-bold mb-4 text-gray-900 border-b pb-2 question-stem">{selectedPassage.passage1.title}</h2>
                                <div dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(selectedPassage.passage1.content, { normalizeSpacing: true }) }} />
                            </article>
                            <article className="bg-white p-6 rounded-lg shadow-md">
                                <h2 className="text-2xl font-bold mb-4 text-gray-900 border-b pb-2 question-stem">{selectedPassage.passage2.title}</h2>
                                <div dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(selectedPassage.passage2.content, { normalizeSpacing: true }) }} />
                            </article>
                        </div>
                    </div>
                );
            case 'structure':
                 return (
                    <div className="space-y-6">
                        <div className="bg-white p-4 rounded-lg shadow-inner mb-6 flex flex-col sm:flex-row items-center justify-between space-y-4 sm:space-y-0">
                            <div className="text-center sm:text-left">
                                <h3 className="text-xl font-bold text-gray-800">Typing Practice Mode</h3>
                                <p className="text-sm text-gray-600">Click Start to begin a 45-minute timed session.</p>
                            </div>
                            <div className="flex items-center space-x-2 sm:space-x-4">
                                <button onClick={startPractice} disabled={timerActive} className="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition-colors disabled:opacity-50">Start</button>
                                <div className={`text-3xl font-mono font-bold ${timer < 300 ? 'text-red-500' : 'text-gray-800'}`}>{formatTime(timer)}</div>
                                <button onClick={finishPractice} className="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded transition-colors">Finish & Review</button>
                                <button onClick={resetPractice} className="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition-colors">Reset</button>
                            </div>
                        </div>

                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                            <div>
                                <h4 className="text-lg font-semibold text-blue-900">Need the prompt while you type?</h4>
                                <p className="text-sm text-blue-800">Open the overlay to view the essay prompt or either passage without leaving the practice screen.</p>
                            </div>
                            <button
                                onClick={() => setShowPromptOverlay(prev => !prev)}
                                className="self-start md:self-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold px-4 py-2 rounded transition-colors"
                            >
                                {showPromptOverlay ? 'Hide Prompt Overlay' : 'Show Prompt Overlay'}
                            </button>
                        </div>

                        {/* Textarea sections */}
                        <div className="practice-section bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-2xl font-bold mb-3 text-gray-900">Introduction Paragraph</h3>
                            <p className="text-gray-700 leading-relaxed mb-4">The two passages present conflicting views on the topic of <span className="text-blue-600 font-semibold">[topic of both articles]</span>. In the first passage, <span className="text-blue-600 font-semibold">[Author 1's Last Name]</span> argues that <span className="text-blue-600 font-semibold">[explain Author 1's main claim]</span>. Conversely, in the second passage, <span className="text-blue-600 font-semibold">[Author 2's Last Name]</span> claims that <span className="text-blue-600 font-semibold">[explain Author 2's main claim]</span>. After analyzing both arguments, it is clear that <span className="text-blue-600 font-semibold">[Author's Last Name]</span> presents the more convincing case by effectively using <span className="text-blue-600 font-semibold">[list key evidence types]</span>.</p>
                            <textarea name="intro" onPaste={(e) => e.preventDefault()} value={essayText.intro} onChange={handleTextChange} disabled={!timerActive} className="practice-textarea w-full h-48 p-3 border-gray-300 rounded-md" placeholder="Type your introduction here..."></textarea>
                        </div>
                         <div className="practice-section bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-2xl font-bold mb-3 text-gray-900">Body Paragraph #1: Analyze Strong Evidence</h3>
                            <p className="text-gray-700 leading-relaxed mb-4">First, <span className="text-blue-600 font-semibold">[Stronger Author's Last Name]</span> effectively builds their argument by using <span className="text-blue-600 font-semibold">[type of evidence]</span>. The author states, <span className="text-blue-600 font-semibold">["quote or paraphrase"]</span>. This evidence is highly convincing because <span className="text-blue-600 font-semibold">[explain why]</span>.</p>
                            <textarea name="body1" onPaste={(e) => e.preventDefault()} value={essayText.body1} onChange={handleTextChange} disabled={!timerActive} className="practice-textarea w-full h-32 p-3 border-gray-300 rounded-md" placeholder="Analyze the stronger argument's first piece of evidence..."></textarea>
                        </div>
                        <div className="practice-section bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-2xl font-bold mb-3 text-gray-900">Body Paragraph #2: Analyze More Strong Evidence</h3>
                            <p className="text-gray-700 leading-relaxed mb-4">Furthermore, <span className="text-blue-600 font-semibold">[Stronger Author's Last Name]</span> strengthens their position with <span className="text-blue-600 font-semibold">[another type of evidence]</span>. For example, the author points out that <span className="text-blue-600 font-semibold">["quote or paraphrase"]</span>. This is a logical and persuasive point because <span className="text-blue-600 font-semibold">[explain why]</span>.</p>
                            <textarea name="body2" onPaste={(e) => e.preventDefault()} value={essayText.body2} onChange={handleTextChange} disabled={!timerActive} className="practice-textarea w-full h-32 p-3 border-gray-300 rounded-md" placeholder="Analyze the stronger argument's second piece of evidence..."></textarea>
                        </div>
                        <div className="practice-section bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-2xl font-bold mb-3 text-gray-900">Body Paragraph #3: Analyze the Weaker Argument</h3>
                            <p className="text-gray-700 leading-relaxed mb-4">In contrast, the argument presented by <span className="text-blue-600 font-semibold">[Weaker Author's Last Name]</span> is not as well-supported. A key weakness is the author's reliance on <span className="text-blue-600 font-semibold">[identify a weakness]</span>. For instance, the author claims that <span className="text-blue-600 font-semibold">["quote or paraphrase"]</span>. This argument is unconvincing because <span className="text-blue-600 font-semibold">[explain why]</span>.</p>
                            <textarea name="body3" onPaste={(e) => e.preventDefault()} value={essayText.body3} onChange={handleTextChange} disabled={!timerActive} className="practice-textarea w-full h-32 p-3 border-gray-300 rounded-md" placeholder="Analyze a weakness in the opposing argument..."></textarea>
                        </div>
                        <div className="practice-section bg-white p-6 rounded-lg shadow-md">
                            <h3 className="text-2xl font-bold mb-3 text-gray-900">Conclusion Paragraph</h3>
                            <p className="text-gray-700 leading-relaxed mb-4">In conclusion, while both authors address the topic, <span className="text-blue-600 font-semibold">[Stronger Author's Last Name]</span> presents a more compelling argument. By skillfully using <span className="text-blue-600 font-semibold">[restate evidence types]</span>, the author builds a case that is more persuasive than the weakly supported claims by <span className="text-blue-600 font-semibold">[Weaker Author's Last Name]</span>.</p>
                            <textarea name="conclusion" onPaste={(e) => e.preventDefault()} value={essayText.conclusion} onChange={handleTextChange} disabled={!timerActive} className="practice-textarea w-full h-40 p-3 border-gray-300 rounded-md" placeholder="Write your conclusion..."></textarea>
                        </div>
                    </div>
                 );
            case 'strengths':
                return (
                    <div className="grid md:grid-cols-2 gap-6">
                        <div className="p-6 rounded-lg bg-green-50 border border-green-200">
                            <h4 className="text-xl font-bold mb-2 text-green-800">Statistical Data</h4>
                            <p className="text-gray-700">Using numbers, percentages, or data from credible sources (e.g., studies, reports). This provides objective proof for a claim.</p>
                        </div>
                        <div className="p-6 rounded-lg bg-green-50 border border-green-200">
                            <h4 className="text-xl font-bold mb-2 text-green-800">Expert Testimony</h4>
                            <p className="text-gray-700">Quoting a recognized expert or authority in a relevant field. This adds credibility to the argument.</p>
                        </div>
                        <div className="p-6 rounded-lg bg-green-50 border border-green-200">
                            <h4 className="text-xl font-bold mb-2 text-green-800">Logical Reasoning</h4>
                            <p className="text-gray-700">Connecting ideas in a clear, cause-and-effect manner that shows the author has thought through their position.</p>
                        </div>
                        <div className="p-6 rounded-lg bg-green-50 border border-green-200">
                            <h4 className="text-xl font-bold mb-2 text-green-800">Historical Precedent</h4>
                            <p className="text-gray-700">Using a past event to support a claim about a present or future situation. This shows a pattern of results.</p>
                        </div>
                    </div>
                );
            case 'weaknesses':
                return (
                    <div className="grid md:grid-cols-2 gap-6">
                         <div className="p-6 rounded-lg bg-red-50 border border-red-200">
                            <h4 className="text-xl font-bold mb-2 text-red-800">Unsupported Claims</h4>
                            <p className="text-gray-700">Making a statement of fact without providing any evidence to back it up. It's an opinion disguised as a fact.</p>
                        </div>
                         <div className="p-6 rounded-lg bg-red-50 border border-red-200">
                            <h4 className="text-xl font-bold mb-2 text-red-800">Overgeneralization</h4>
                            <p className="text-gray-700">Drawing a broad conclusion from a very small or unrepresentative sample of evidence.</p>
                        </div>
                         <div className="p-6 rounded-lg bg-red-50 border border-red-200">
                            <h4 className="text-xl font-bold mb-2 text-red-800">Anecdotal Evidence</h4>
                            <p className="text-gray-700">Using a personal story or a single, isolated example as proof for a major claim, instead of broader data.</p>
                        </div>
                         <div className="p-6 rounded-lg bg-red-50 border border-red-200">
                            <h4 className="text-xl font-bold mb-2 text-red-800">Emotional Appeal</h4>
                            <p className="text-gray-700">Trying to persuade the reader by appealing to their feelings (fear, pity, anger) instead of using logic and facts.</p>
                        </div>
                    </div>
                );
            default: return null;
        }
    };

    const renderModalContent = () => {
        const fullEssay = Object.values(essayText).join("\n\n").trim();
        return (
            <>
                <div className="p-8 prose max-w-none">
                    {fullEssay ? <div dangerouslySetInnerHTML={{ __html: sanitizeHtmlContent(fullEssay.replace(/\n/g, '<br/>'), { normalizeSpacing: true }) }} /> : <p><em>You did not write anything in the practice area.</em></p>}
                </div>
                <div className="p-6 border-t bg-gray-50 space-y-4">
                    <button onClick={handleGetScore} disabled={isScoring || !fullEssay} className="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        {isScoring ? 'Scoring...' : 'Get AI Score & Feedback'}
                    </button>
                    {scoreResult && (
                        <div className="mt-4 p-4 bg-indigo-50 rounded-lg text-left">
                            {scoreResult.error ? <p className="text-red-600">{scoreResult.error}</p> : (
                                <div>
                                    <h4 className="text-xl font-bold text-indigo-800">AI Feedback</h4>
                                    <p className="mt-2"><strong>Overall Score:</strong> {scoreResult.overallScore}/6</p>
                                    <p className="mt-1"><strong>Feedback:</strong> {scoreResult.overallFeedback}</p>
                                    <details className="mt-2">
                                        <summary className="font-semibold cursor-pointer">View Trait-by-Trait Breakdown</summary>
                                        <div className="mt-2 pl-4 border-l-2 border-indigo-200">
                                            <p><strong>Trait 1 (Analysis):</strong> Score {scoreResult.trait1.score}/2. {scoreResult.trait1.feedback}</p>
                                            <p><strong>Trait 2 (Evidence):</strong> Score {scoreResult.trait2.score}/2. {scoreResult.trait2.feedback}</p>
                                            <p><strong>Trait 3 (Clarity):</strong> Score {scoreResult.trait3.score}/2. {scoreResult.trait3.feedback}</p>
                                        </div>
                                    </details>
                                </div>
                            )}
                        </div>
                    )}
                </div>
            </>
        );
    };

    return (
        <div className="fade-in" data-subject="Reasoning Through Language Arts (RLA)">
            <header className="flex justify-between items-center pb-4 mb-4 border-b">
                 <button onClick={onExit} className="flex items-center gap-1 text-sm text-slate-600 hover:text-sky-600 font-semibold"><ArrowLeftIcon /> Back</button>
                    <h2 className="text-xl font-bold text-center subject-accent-heading">Interactive Essay Guide</h2>
                 <div></div>
            </header>

            {renderTabs()}
            <main>{renderContent()}</main>

            {activeTab === 'structure' && showPromptOverlay && (
                <div className="fixed bottom-4 right-4 w-full max-w-xl sm:w-[28rem] md:w-[32rem] bg-white border border-slate-200 rounded-xl shadow-2xl z-40">
                    <div className="flex items-start justify-between gap-3 px-4 py-3 border-b">
                        <div>
                            <h3 className="text-base font-semibold text-slate-900">Prompt Reference Overlay</h3>
                            <p className="text-xs text-slate-500">Switch views to revisit the essay prompt or source passages while you write.</p>
                        </div>
                        <button
                            onClick={() => setShowPromptOverlay(false)}
                            className="text-slate-500 hover:text-slate-800"
                            aria-label="Close prompt overlay"
                        >
                            &times;
                        </button>
                    </div>
                    <div className="px-4 py-3 border-b bg-slate-50">
                        <div className="flex flex-wrap gap-2">
                            {overlayButtons.map(({ id, label, title }) => (
                                <button
                                    key={id}
                                    onClick={() => setOverlayView(id)}
                                    title={title}
                                    className={`px-3 py-1.5 text-sm font-semibold rounded-full border transition-colors ${overlayView === id ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-slate-700 border-slate-300 hover:bg-slate-100'}`}
                                >
                                    {label}
                                </button>
                            ))}
                        </div>
                    </div>
                    <div className="px-4 py-4 max-h-[60vh] overflow-y-auto">
                        {renderOverlayBody()}
                    </div>
                </div>
            )}

            {showModal && (
                <div
                    className="fixed inset-0 w-full h-full flex items-center justify-center"
                    style={{ backgroundColor: 'var(--modal-overlay)' }}
                >
                    <div className="bg-white rounded-lg shadow-2xl w-11/12 max-w-2xl max-h-[90vh] overflow-y-auto">
                        <div className="p-6 border-b flex justify-between items-center sticky top-0 bg-white">
                            <h2 className="text-2xl font-bold">Your Completed Essay</h2>
                            <button onClick={() => {setShowModal(false); setScoreResult(null);}} className="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                        </div>
                        {renderModalContent()}
                    </div>
                </div>
            )}
        </div>
    );
}

function AIQuizGenerator({ subject, onQuizGenerated, onExit, setIsLoading, setLoadingMessage }) {
    const [selectedTopic, setSelectedTopic] = useState('');
    const [error, setError] = useState(null);

    const availableTopics = AppData[subject]
        ? Object.values(AppData[subject].categories).flatMap(category => category.topics.map(topic => topic.title))
        : [];

    const handleGenerate = async () => {
        if (!selectedTopic) {
            setError("Please select a topic first.");
            return;
        }
        const subjectParam = resolveSubjectParam(subject);
        if (!subjectParam) {
            setError('Sorry, this subject is not supported yet.');
            return;
        }
        setLoadingMessage("Please give us a moment to smith this for you");
        setIsLoading(true);
        setError(null);

        try {
            const questions = await generateTopicQuiz(subjectParam, selectedTopic);

            if (!questions.length) {
                throw new Error('The quiz service returned an empty quiz.');
            }

            const generatedQuiz = {
                subject,
                topic: selectedTopic,
                id: `ai_${Date.now()}`,
                title: `${subject} Quiz: ${selectedTopic}`,
                questions
            };

            onQuizGenerated(generatedQuiz);

        } catch (err) {
            console.error("Error generating quiz:", err);
            setError(`Sorry, something went wrong. ${err.message}`);
        } finally {
            setIsLoading(false);
        }
    };

    return (
        <div className="fade-in text-center">
            <header className="flex justify-between items-center pb-4 mb-4 border-b">
                 <button onClick={onExit} className="flex items-center gap-1 text-sm text-slate-600 hover:text-sky-600 font-semibold"><ArrowLeftIcon /> Back</button>
                 <h2 className="text-xl font-bold text-center text-slate-800">Smith a Quiz</h2>
                 <div></div>
            </header>
            <div className="max-w-md mx-auto">
                <h3 className="text-2xl font-bold text-slate-800">Create a New Quiz</h3>
                <p className="text-slate-500 mt-2 mb-6">Select a topic from {subject} to generate a unique 15-question practice exam.</p>
                
                <select 
                    value={selectedTopic}
                    onChange={(e) => setSelectedTopic(e.target.value)}
                    className="w-full p-3 border border-sky-300 rounded-md mb-4 text-lg"
                >
                    <option value="">-- Select a Topic --</option>
                    {availableTopics.map((topic, idx) => <option key={`${topic}-${idx}`} value={topic}>{topic}</option>)}
                </select>

                <button 
                    onClick={handleGenerate} 
                    disabled={isLoading}
                    className="w-full px-8 py-4 bg-sky-600 text-white font-bold rounded-lg shadow-md hover:bg-sky-700 disabled:bg-slate-400 disabled:cursor-not-allowed transition-colors"
                >
                    {isLoading ? "Generating..." : "Generate Quiz"}
                </button>
                {error && <p className="text-red-500 mt-4">{error}</p>}
            </div>
        </div>
    );
}


function GeometryPracticeTool({ onExit }) {
    const roundToTwo = (value) => Math.round(value * 100) / 100;
    const formatNumber = (value) => {
        const rounded = roundToTwo(value);
        return Number.isInteger(rounded) ? rounded : rounded.toFixed(2);
    };

    const SHAPE_LIBRARY = {
        rectangle: {
            questions: [
                {
                    type: 'area',
                    getPrompt: (shapeLabel) => `What is the area of the ${shapeLabel}?`,
                    getAnswer: (dims) => dims.w * dims.h,
                },
                {
                    type: 'perimeter',
                    getPrompt: (shapeLabel) => `What is the perimeter of the ${shapeLabel}?`,
                    getAnswer: (dims) => 2 * (dims.w + dims.h),
                },
                {
                    type: 'missing_height',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has an area of ${formatNumber(dims.w * dims.h)} and a width of ${formatNumber(dims.w)}. What is the missing height?`,
                    getAnswer: (dims) => dims.h,
                    getContext: () => ({ hiddenLabels: ['h'] }),
                },
            ],
            generateDims: () => ({ w: Math.floor(Math.random() * 20) + 5, h: Math.floor(Math.random() * 20) + 5 }),
            render: ({ w, h }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g>
                        <rect x="50" y="75" width={w * 8} height={h * 8} stroke="currentColor" fill="none" strokeWidth="2" />
                        <text x={50 + (w*8)/2} y="65" textAnchor="middle" fill="currentColor">{hidden.includes('w') ? '?' : w}</text>
                        <text x={40} y={75 + (h*8)/2} textAnchor="end" dominantBaseline="middle" fill="currentColor">{hidden.includes('h') ? '?' : h}</text>
                    </g>
                );
            }
        },
        triangle: {
            questions: [
                {
                    type: 'area',
                    getPrompt: (shapeLabel) => `What is the area of the ${shapeLabel}?`,
                    getAnswer: (dims) => 0.5 * dims.b * dims.h,
                },
                {
                    type: 'missing_height',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has an area of ${formatNumber(0.5 * dims.b * dims.h)} and a base of ${formatNumber(dims.b)}. What is the missing height?`,
                    getAnswer: (dims) => dims.h,
                    getContext: () => ({ hiddenLabels: ['h'] }),
                },
            ],
            generateDims: () => ({ b: Math.floor(Math.random() * 20) + 8, h: Math.floor(Math.random() * 15) + 6 }),
            render: ({ b, h }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g>
                        <polygon points={`50,${50+h*8} ${50+b*8},${50+h*8} ${50+b*8},50`} stroke="currentColor" fill="none" strokeWidth="2" />
                        <text x={50 + (b*8)/2} y={65+h*8} textAnchor="middle" fill="currentColor">{hidden.includes('b') ? '?' : b}</text>
                        <text x={60+b*8} y={50+(h*8)/2} dominantBaseline="middle" fill="currentColor">{hidden.includes('h') ? '?' : h}</text>
                    </g>
                );
            }
        },
        circle: {
            questions: [
                {
                    type: 'area',
                    getPrompt: (shapeLabel) => `What is the area of the ${shapeLabel}?`,
                    getAnswer: (dims) => Math.PI * dims.r * dims.r,
                },
                {
                    type: 'circumference',
                    getPrompt: (shapeLabel) => `What is the circumference of the ${shapeLabel}?`,
                    getAnswer: (dims) => 2 * Math.PI * dims.r,
                },
                {
                    type: 'missing_radius',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has an area of ${formatNumber(Math.PI * dims.r * dims.r)}. What is the radius?`,
                    getAnswer: (dims) => dims.r,
                    getContext: () => ({ hiddenLabels: ['r'] }),
                },
            ],
            generateDims: () => ({ r: Math.floor(Math.random() * 10) + 5 }),
            render: ({ r }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g>
                        <circle cx="150" cy="150" r={r * 8} stroke="currentColor" fill="none" strokeWidth="2" />
                        <line x1="150" y1="150" x2={150 + r * 8} y2="150" stroke="currentColor" strokeDasharray="4" />
                        <text x={150 + (r*8)/2} y="140" fill="currentColor">{hidden.includes('r') ? '?' : r}</text>
                    </g>
                );
            }
        },
        rectangular_prism: {
            questions: [
                {
                    type: 'volume',
                    getPrompt: (shapeLabel) => `What is the volume of the ${shapeLabel}?`,
                    getAnswer: (dims) => dims.l * dims.w * dims.h,
                },
                {
                    type: 'missing_height',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has a volume of ${formatNumber(dims.l * dims.w * dims.h)}, a length of ${formatNumber(dims.l)}, and a width of ${formatNumber(dims.w)}. What is the missing height?`,
                    getAnswer: (dims) => dims.h,
                    getContext: () => ({ hiddenLabels: ['h'] }),
                },
            ],
            generateDims: () => ({ l: Math.floor(Math.random() * 15) + 8, w: Math.floor(Math.random() * 10) + 5, h: Math.floor(Math.random() * 10) + 5 }),
            render: ({ l, w, h }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g stroke="currentColor" fill="none" strokeWidth="2">
                        <rect x={50} y={50} width={l*8} height={h*8} />
                        <path d={`M ${50},${50} l ${w*3},-${w*3}`} />
                        <path d={`M ${50+l*8},${50} l ${w*3},-${w*3}`} />
                        <path d={`M ${50+l*8},${50+h*8} l ${w*3},-${w*3}`} />
                        <path d={`M ${50+w*3},${50-w*3} H ${50+w*3+l*8}`} />
                        <path d={`M ${50+w*3+l*8},${50-w*3} V ${50-w*3+h*8}`} />
                        <text x={50 + (l*8)/2} y={60+h*8} textAnchor="middle" fill="currentColor">{hidden.includes('l') ? '?' : l}</text>
                        <text x={55+l*8+(w*3)/2} y={40-w*3} textAnchor="middle" fill="currentColor">{hidden.includes('w') ? '?' : w}</text>
                        <text x={40} y={50 + (h*8)/2} textAnchor="end" dominantBaseline="middle" fill="currentColor">{hidden.includes('h') ? '?' : h}</text>
                    </g>
                );
            }
        },
        cylinder: {
            questions: [
                {
                    type: 'volume',
                    getPrompt: (shapeLabel) => `What is the volume of the ${shapeLabel}?`,
                    getAnswer: (dims) => Math.PI * dims.r * dims.r * dims.h,
                },
                {
                    type: 'surface_area',
                    getPrompt: (shapeLabel) => `What is the surface area of the ${shapeLabel}?`,
                    getAnswer: (dims) => 2 * Math.PI * dims.r * (dims.r + dims.h),
                },
                {
                    type: 'missing_height',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has a volume of ${formatNumber(Math.PI * dims.r * dims.r * dims.h)} and a radius of ${formatNumber(dims.r)}. What is the missing height?`,
                    getAnswer: (dims) => dims.h,
                    getContext: () => ({ hiddenLabels: ['h'] }),
                },
            ],
            generateDims: () => ({ r: Math.floor(Math.random() * 8) + 3, h: Math.floor(Math.random() * 15) + 5 }),
            render: ({ r, h }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g stroke="currentColor" fill="none" strokeWidth="2">
                        <ellipse cx="150" cy="50" rx={r*5} ry={r*2} />
                        <path d={`M ${150 - r*5},50 L ${150 - r*5},${50 + h*5}`} />
                        <path d={`M ${150 + r*5},50 L ${150 + r*5},${50 + h*5}`} />
                        <ellipse cx="150" cy={50 + h*5} rx={r*5} ry={r*2} />
                        <text x="140" y={50 + (h*5)/2} textAnchor="end" dominantBaseline="middle" fill="currentColor">{hidden.includes('h') ? '?' : h}</text>
                        <text x={150} y={65+h*5} textAnchor="middle" fill="currentColor">{hidden.includes('r') ? '?' : r}</text>
                    </g>
                );
            }
        },
        cone: {
            questions: [
                {
                    type: 'volume',
                    getPrompt: (shapeLabel) => `What is the volume of the ${shapeLabel}?`,
                    getAnswer: (dims) => (Math.PI * dims.r * dims.r * dims.h) / 3,
                },
                {
                    type: 'surface_area',
                    getPrompt: (shapeLabel) => `What is the surface area of the ${shapeLabel}?`,
                    getAnswer: (dims) => Math.PI * dims.r * (dims.r + Math.sqrt(dims.h * dims.h + dims.r * dims.r)),
                },
                {
                    type: 'missing_height',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has a volume of ${formatNumber((Math.PI * dims.r * dims.r * dims.h) / 3)} and a radius of ${formatNumber(dims.r)}. What is the missing height?`,
                    getAnswer: (dims) => dims.h,
                    getContext: () => ({ hiddenLabels: ['h'] }),
                },
            ],
            generateDims: () => ({ r: Math.floor(Math.random() * 6) + 3, h: Math.floor(Math.random() * 12) + 5 }),
            render: ({ r, h }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                const baseRadius = r * 6;
                const height = h * 6;
                const centerX = 150;
                const baseY = 200;
                return (
                    <g stroke="currentColor" fill="none" strokeWidth="2">
                        <ellipse cx={centerX} cy={baseY} rx={baseRadius} ry={baseRadius / 3} />
                        <line x1={centerX - baseRadius} y1={baseY} x2={centerX} y2={baseY - height} />
                        <line x1={centerX + baseRadius} y1={baseY} x2={centerX} y2={baseY - height} />
                        <text x={centerX - baseRadius - 10} y={baseY - height / 2} textAnchor="end" dominantBaseline="middle" fill="currentColor">{hidden.includes('h') ? '?' : h}</text>
                        <text x={centerX + baseRadius / 2} y={baseY + 20} textAnchor="middle" fill="currentColor">{hidden.includes('r') ? '?' : r}</text>
                    </g>
                );
            }
        },
        sphere: {
            questions: [
                {
                    type: 'volume',
                    getPrompt: (shapeLabel) => `What is the volume of the ${shapeLabel}?`,
                    getAnswer: (dims) => (4 / 3) * Math.PI * Math.pow(dims.r, 3),
                },
                {
                    type: 'surface_area',
                    getPrompt: (shapeLabel) => `What is the surface area of the ${shapeLabel}?`,
                    getAnswer: (dims) => 4 * Math.PI * dims.r * dims.r,
                },
                {
                    type: 'missing_radius',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has a volume of ${formatNumber((4 / 3) * Math.PI * Math.pow(dims.r, 3))}. What is the radius?`,
                    getAnswer: (dims) => dims.r,
                    getContext: () => ({ hiddenLabels: ['r'] }),
                },
            ],
            generateDims: () => ({ r: Math.floor(Math.random() * 8) + 3 }),
            render: ({ r }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                return (
                    <g stroke="currentColor" fill="none" strokeWidth="2">
                        <circle cx="150" cy="130" r={r * 8} />
                        <ellipse cx="150" cy="130" rx={r * 8} ry={r * 3} strokeDasharray="6" />
                        <line x1="150" y1="130" x2={150 + r * 8} y2="130" strokeDasharray="4" />
                        <text x={150 + (r*8)/2} y="115" fill="currentColor">{hidden.includes('r') ? '?' : r}</text>
                    </g>
                );
            }
        },
        right_triangle: {
            questions: [
                {
                    type: 'hypotenuse',
                    getPrompt: (shapeLabel, dims) => `The ${shapeLabel} has legs a = ${formatNumber(dims.a)} and b = ${formatNumber(dims.b)}. What is the length of the hypotenuse?`,
                    getAnswer: (dims) => Math.sqrt(dims.a * dims.a + dims.b * dims.b),
                },
            ],
            generateDims: () => ({ a: Math.floor(Math.random() * 10) + 4, b: Math.floor(Math.random() * 10) + 4 }),
            render: ({ a, b }, context = {}) => {
                const hidden = context.hiddenLabels || [];
                const scale = 10;
                const startX = 60;
                const startY = 200;
                const pointB = [startX + a * scale, startY];
                const pointC = [startX, startY - b * scale];
                return (
                    <g stroke="currentColor" fill="none" strokeWidth="2">
                        <polygon points={`${startX},${startY} ${pointB[0]},${pointB[1]} ${pointC[0]},${pointC[1]}`} />
                        <path d={`M ${startX + 20},${startY} L ${startX + 20},${startY - 20} L ${startX},${startY - 20}`} strokeWidth="2" />
                        <text x={startX + (a * scale) / 2} y={startY + 20} textAnchor="middle" fill="currentColor">{hidden.includes('a') ? '?' : `a = ${a}`}</text>
                        <text x={startX - 20} y={startY - (b * scale) / 2} textAnchor="end" dominantBaseline="middle" fill="currentColor">{hidden.includes('b') ? '?' : `b = ${b}`}</text>
                        <text x={(startX + pointB[0]) / 2 + 10} y={(startY + pointC[1]) / 2} textAnchor="middle" fill="currentColor">c</text>
                    </g>
                );
            }
        },
    };

    const [currentProblem, setCurrentProblem] = useState(null);
    const [userAnswer, setUserAnswer] = useState('');
    const [feedback, setFeedback] = useState('');

    const generateProblem = (shape) => {
        const shapeData = SHAPE_LIBRARY[shape];
        if (!shapeData) return;

        const questionConfig = shapeData.questions[Math.floor(Math.random() * shapeData.questions.length)];
        const dims = shapeData.generateDims();
        const shapeLabel = shape.replace('_', ' ');
        const context = questionConfig.getContext ? questionConfig.getContext(dims) : {};
        const correctAnswer = roundToTwo(questionConfig.getAnswer(dims));
        const prompt = questionConfig.getPrompt(shapeLabel, dims, context);

        setCurrentProblem({
            shape,
            dims,
            questionType: questionConfig.type,
            correctAnswer,
            renderer: shapeData.render,
            prompt,
            context,
        });
        setFeedback('');
        setUserAnswer('');
    };

    const checkAnswer = () => {
        const answer = parseFloat(userAnswer);
        if (isNaN(answer)) {
            setFeedback('Please enter a valid number.');
            return;
        }

        if (Math.abs(answer - currentProblem.correctAnswer) < 0.01) {
            setFeedback('Correct! Great job!');
        } else {
            setFeedback(`Not quite. The correct answer is ${currentProblem.correctAnswer}.`);
        }
    };

    useEffect(() => {
        // Generate a problem when the component mounts
        generateProblem('rectangle');
    }, []);

    const getCurrentTheme = useCallback(() => {
        if (typeof document === 'undefined') {
            return 'light';
        }
        const root = document.documentElement;
        if (!root) {
            return 'light';
        }
        const explicit = root.getAttribute('data-theme');
        if (explicit === 'dark') return 'dark';
        if (explicit === 'light') return 'light';
        return root.classList.contains('dark') ? 'dark' : 'light';
    }, []);

    const [activeTheme, setActiveTheme] = useState(getCurrentTheme);

    useEffect(() => {
        if (typeof document === 'undefined' || typeof MutationObserver === 'undefined') {
            return;
        }
        const root = document.documentElement;
        if (!root) {
            return;
        }
        const observer = new MutationObserver(() => {
            setActiveTheme(getCurrentTheme());
        });
        observer.observe(root, { attributes: true, attributeFilter: ['data-theme', 'class'] });
        return () => observer.disconnect();
    }, [getCurrentTheme]);

    const isDarkMode = activeTheme === 'dark';
    const surfaceColor = isDarkMode ? '#020617' : '#ffffff';
    const geometryPalette = isDarkMode
        ? { text: '#e2fdff' }
        : { text: '#0f172a' };

    const showExitButton = typeof onExit === 'function';

    return (
        <div
            className="fade-in space-y-6 bg-white text-black dark:bg-slate-900 dark:text-slate-100"
            style={{ backgroundColor: surfaceColor }}
        >
            <header className="flex flex-wrap items-center justify-between gap-3 pb-4 mb-2 border-b border-slate-200 dark:border-slate-700">
                <div className="flex-none min-w-[140px]">
                    {showExitButton && (
                        <button
                            onClick={onExit}
                            className={`flex items-center gap-1 text-sm font-semibold transition-colors ${isDarkMode
                                ? 'text-slate-200 hover:text-sky-300'
                                : 'text-slate-900 hover:text-sky-700'}`}
                        >
                            <ArrowLeftIcon /> Back
                        </button>
                    )}
                </div>
                <h2 className="text-2xl font-bold text-center flex-1">Geometry Practice Tool</h2>
                <div className="flex-none min-w-[140px]" aria-hidden="true"></div>
            </header>
            <div className="grid gap-6 lg:grid-cols-[minmax(0,1.65fr)_minmax(0,1fr)]">
                <div
                    className="bg-white text-slate-900 dark:bg-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 rounded-2xl p-6 shadow-sm flex flex-col items-center justify-center min-h-[420px]"
                    style={{ backgroundColor: surfaceColor }}
                >
                    {currentProblem ? (
                        <>
                            <svg
                                className="w-full max-w-2xl h-[360px] text-slate-900 dark:text-white bg-white dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-700"
                                style={{ backgroundColor: surfaceColor }}
                                viewBox="0 0 400 320"
                                preserveAspectRatio="xMidYMid meet"
                            >
                                {currentProblem.renderer(currentProblem.dims, currentProblem.context)}
                            </svg>
                            <p className="text-lg font-semibold mt-6 text-center max-w-2xl" style={{ color: geometryPalette.text }}>
                                {currentProblem.prompt}
                            </p>
                        </>
                    ) : (
                        <p className="text-base">
                            Select a shape to begin.
                        </p>
                    )}
                </div>
                <div
                    className="space-y-5 bg-white text-black dark:bg-slate-900 dark:text-slate-100 border border-slate-200 dark:border-slate-700 rounded-2xl p-5 shadow-sm"
                    style={{ backgroundColor: surfaceColor }}
                >
                    <div>
                        <h3 className="text-lg font-semibold mb-3" style={{ color: geometryPalette.text }}>
                            Shapes
                        </h3>
                        <div className="grid grid-cols-2 gap-2">
                            {Object.keys(SHAPE_LIBRARY).map(shape => (
                                <button
                                    key={shape}
                                    onClick={() => generateProblem(shape)}
                                    className={`p-2 font-semibold rounded-md transition capitalize border ${currentProblem?.shape === shape
                                        ? 'bg-sky-600 text-white shadow border-transparent'
                                        : isDarkMode
                                            ? 'bg-slate-800 text-slate-100 hover:bg-slate-700 border-slate-600'
                                            : 'bg-slate-700 text-white hover:bg-slate-600 border-slate-500'}`}
                                >
                                    {shape.replace('_', ' ')}
                                </button>
                            ))}
                        </div>
                    </div>
                    {currentProblem && (
                        <div className="space-y-3">
                            <label htmlFor="answer" className="font-semibold" style={{ color: geometryPalette.text }}>
                                Your Answer:
                            </label>
                            <input
                                type="number"
                                id="answer"
                                value={userAnswer}
                                onChange={(e) => setUserAnswer(e.target.value)}
                                className="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-md bg-white dark:bg-slate-950 text-black dark:text-slate-100 focus:outline-none focus:ring-2 focus:ring-sky-500"
                            />
                            <button onClick={checkAnswer} className="w-full p-2 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition">Check Answer</button>
                            {feedback && (
                                <p
                                    className={`mt-2 p-2 rounded-md text-center font-semibold ${feedback.includes('Correct')
                                        ? 'bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-200'
                                        : 'bg-red-100 text-red-800 dark:bg-red-900/60 dark:text-red-200'}`}
                                >
                                    {feedback}
                                </p>
                            )}
                            <button onClick={() => generateProblem(currentProblem.shape)} className="w-full p-2 bg-sky-500 text-white font-bold rounded-lg hover:bg-sky-600 transition">Next Problem</button>
                        </div>
                    )}
                </div>
            </div>
        </div>
    );
}

// (Removed) SmithGameOfLife React component in favor of embedding the authored HTML simulation

function GraphingTool({ onExit }) {
    const boardRef = React.useRef(null);
    const boardInstance = React.useRef(null);
    const plottedFunctions = React.useRef([]);
    const intersectionPoints = React.useRef([]);
    const plottedPoints = React.useRef([]);
    const toolModeRef = React.useRef('plotLine');
    const [equationInputs, setEquationInputs] = React.useState(['2x + 1']);
    const [tableData, setTableData] = React.useState([]);
    const [error, setError] = React.useState('');
    const [toolMode, setToolMode] = React.useState('plotLine'); // 'plotLine' or 'plotPoint'

    React.useEffect(() => {
        if (!boardInstance.current) {
            boardInstance.current = JXG.JSXGraph.initBoard(boardRef.current.id, {
                boundingbox: [-10, 10, 10, -10],
                axis: true,
                grid: true,
                showCopyright: false
            });

            boardInstance.current.on('up', function(e) {
                if (toolModeRef.current === 'plotPoint') {
                    const coords = boardInstance.current.getUsrCoordsOfMouse(e);
                    const x = Math.round(coords[0]);
                    const y = Math.round(coords[1]);
                    const point = boardInstance.current.create('point', [x, y], { name: `(${x}, ${y})`, size: 4 });
                    plottedPoints.current.push(point);
                }
            });
        }
    }, []);

    React.useEffect(() => {
        toolModeRef.current = toolMode;
    }, [toolMode]);

    const palette = ['#2563eb', '#16a34a', '#f97316', '#9333ea', '#ef4444', '#0ea5e9', '#facc15', '#a855f7'];

    const clearPlottedObjects = React.useCallback(() => {
        const board = boardInstance.current;
        if (!board) return;
        board.suspendUpdate();
        const removeIfExists = (obj) => {
            if (obj && obj.id && board.objects[obj.id]) {
                board.removeObject(obj);
            }
        };
        plottedFunctions.current.forEach(removeIfExists);
        intersectionPoints.current.forEach(removeIfExists);
        plottedPoints.current.forEach(removeIfExists);
        plottedFunctions.current = [];
        intersectionPoints.current = [];
        plottedPoints.current = [];
        board.unsuspendUpdate();
    }, []);

    const handlePlot = () => {
        setError('');
        if (toolMode !== 'plotLine') return;

        try {
            const board = boardInstance.current;
            if (!board) return;

            const parsedEquations = equationInputs.map((input) => {
                const trimmed = (input || '').trim();
                if (!trimmed) {
                    throw new Error('Please enter an equation for each input field.');
                }
                const preparedInput = trimmed.toLowerCase().replace(/\s/g, '');
                const parts = preparedInput.match(/^(-?\d*\.?\d*)x([+-]\d+\.?\d*)?$/);
                if (!parts) {
                    throw new Error("Use 'mx+b' format, e.g., '3x-4'.");
                }

                const m = parts[1] === '-' ? -1 : (parts[1] === '' ? 1 : parseFloat(parts[1]));
                const b = parts[2] ? parseFloat(parts[2]) : 0;
                if (isNaN(m) || isNaN(b)) {
                    throw new Error('Invalid number format.');
                }

                return {
                    input: trimmed,
                    func: (x) => m * x + b,
                };
            });

            clearPlottedObjects();

            board.suspendUpdate();

            const newTableData = [];

            parsedEquations.forEach(({ input, func }, index) => {
                const color = palette[index % palette.length];
                const graph = board.create('functiongraph', [func], {
                    strokeColor: color,
                    strokeWidth: 3,
                });
                plottedFunctions.current.push(graph);

                const values = Array.from({ length: 11 }, (_, idx) => {
                    const x = idx - 5;
                    return { x, y: func(x) };
                });

                newTableData.push({ equation: input, color, values });
            });

            if (plottedFunctions.current.length > 1) {
                for (let i = 0; i < plottedFunctions.current.length - 1; i++) {
                    for (let j = i + 1; j < plottedFunctions.current.length; j++) {
                        const intersection = board.create('intersection', [plottedFunctions.current[i], plottedFunctions.current[j]], {
                            name: '',
                            size: 3,
                            strokeColor: '#f97316',
                            fillColor: '#f97316',
                        });
                        if (intersection.label) {
                            intersection.label.setText(() => `(${intersection.X().toFixed(2)}, ${intersection.Y().toFixed(2)})`);
                            intersection.label.setAttribute({
                                offset: [10, -10],
                                strokeColor: '#0f172a',
                            });
                        }
                        intersectionPoints.current.push(intersection);
                    }
                }
            }

            board.unsuspendUpdate();
            setTableData(newTableData);
        } catch (e) {
            setError(e.message || "Could not plot equation.");
        }
    };

    const handleClear = () => {
        clearPlottedObjects();
        setError('');
        setTableData([]);
        setEquationInputs(['2x + 1']);
    };

    const handleEquationChange = (index, value) => {
        setEquationInputs((prev) => {
            const updated = [...prev];
            updated[index] = value;
            return updated;
        });
    };

    const addEquationInput = () => {
        setEquationInputs((prev) => [...prev, '']);
    };

    const removeEquationInput = (index) => {
        setEquationInputs((prev) => {
            if (prev.length === 1) return prev;
            const updated = prev.filter((_, idx) => idx !== index);
            return updated.length > 0 ? updated : ['2x + 1'];
        });
    };

    const showExitButton = typeof onExit === 'function';

    return (
        <div className="fade-in">
            <header className="flex flex-wrap items-center justify-between gap-3 pb-4 mb-4 border-b">
                <div className="flex-none min-w-[120px]">
                    {showExitButton && (
                        <button onClick={onExit} className="flex items-center gap-1 text-sm text-slate-600 hover:text-sky-600 font-semibold"><ArrowLeftIcon /> Back</button>
                    )}
                </div>
                <h2 className="text-xl font-bold text-center text-white flex-1">Interactive Graphing Tool</h2>
                <div className="flex-none min-w-[120px]" aria-hidden="true"></div>
            </header>
            <div className="flex flex-col md:flex-row gap-6">
                <div className="flex-grow">
                    <div id="graphing-tool-board" ref={boardRef} className="jxgbox" style={{ width: '100%', height: '400px' }}></div>
                </div>
                <div className="md:w-72 flex-shrink-0 text-black dark:text-white">
                    <h3 className="text-lg font-semibold text-black dark:text-white mb-2">Tools</h3>
                    <div className="flex gap-2 mb-4">
                        <button onClick={() => setToolMode('plotLine')} className={`flex-1 p-2 font-semibold rounded-md transition ${toolMode === 'plotLine' ? 'bg-sky-600 text-white' : 'bg-slate-200 hover:bg-slate-300'}`}>Plot Line</button>
                        <button onClick={() => setToolMode('plotPoint')} className={`flex-1 p-2 font-semibold rounded-md transition ${toolMode === 'plotPoint' ? 'bg-sky-600 text-white' : 'bg-slate-200 hover:bg-slate-300'}`}>Plot Point</button>
                    </div>

                    {toolMode === 'plotLine' ? (
                        <div>
                            <p className="font-semibold text-black dark:text-slate-200 mb-2 equations-label">Equations (y = )</p>
                            <div className="space-y-3">
                                {equationInputs.map((value, index) => (
                                    <div key={index} className="flex items-center gap-2">
                                        <input
                                            type="text"
                                            value={value}
                                            onChange={(e) => handleEquationChange(index, e.target.value)}
                                            placeholder="e.g., 2x - 3"
                                            className="flex-1 p-2 border border-slate-300 rounded-md"
                                        />
                                        <button
                                            onClick={() => removeEquationInput(index)}
                                            className="p-2 text-sm bg-slate-200 text-black rounded-md hover:bg-slate-300"
                                            title="Remove equation"
                                            disabled={equationInputs.length === 1}
                                        >
                                            Remove
                                        </button>
                                    </div>
                                ))}
                            </div>
                            <div className="flex gap-2 mt-3">
                                <button onClick={addEquationInput} className="flex-1 p-2 bg-slate-200 text-black font-semibold rounded-md hover:bg-slate-300 transition">Add Equation</button>
                                <button onClick={handlePlot} className="flex-1 p-2 bg-sky-600 text-white font-bold rounded-md hover:bg-sky-700 transition">Plot All</button>
                            </div>
                        </div>
                    ) : (
                        <div>
                            <p className="p-2 bg-sky-50 text-sky-800 rounded-md text-center">Click anywhere on the graph to plot a point.</p>
                        </div>
                    )}
                    <button onClick={handleClear} className="w-full p-2 mt-3 bg-red-500 text-white font-bold rounded-lg hover:bg-red-600 transition">Clear All</button>
                    {error && <p className="text-red-500 text-sm mt-3">{error}</p>}
                </div>
            </div>
            <div className="mt-6 bg-white shadow-sm rounded-lg p-4">
                <h3 className="text-lg font-semibold text-slate-700 mb-3">Table of Values</h3>
                {tableData.length === 0 ? (
                    <p className="text-slate-500 text-sm">Plot at least one equation to see table values from x = -5 to x = 5.</p>
                ) : (
                    <div className="grid md:grid-cols-2 gap-4">
                        {tableData.map(({ equation, color, values }, index) => (
                            <div key={index} className="border border-slate-200 rounded-md overflow-hidden">
                                <div className="flex items-center justify-between bg-slate-100 px-3 py-2">
                                    <span className="text-sm font-semibold text-slate-700">y = {equation}</span>
                                    <span className="inline-flex items-center gap-2 text-xs text-slate-500">
                                        <span className="w-3 h-3 rounded-full" style={{ backgroundColor: color }}></span>
                                        Graph Color
                                    </span>
                                </div>
                                <table className="w-full text-sm">
                                    <thead>
                                        <tr className="bg-slate-50 text-slate-600">
                                            <th className="px-3 py-2 text-left">x</th>
                                            <th className="px-3 py-2 text-left">y</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {values.map(({ x, y }) => (
                                            <tr key={x} className="odd:bg-white even:bg-slate-50 text-slate-700">
                                                <td className="px-3 py-1">{x}</td>
                                                <td className="px-3 py-1">{Number.isFinite(y) ? y.toFixed(2) : 'N/A'}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        </div>
    );
}

function MathPracticeToolsPage({ onExit, activeTab, onTabChange, graphingNode, geometryNode }) {
    const tabs = [
        { id: 'graphing', label: 'Graphing Tool' },
        { id: 'geometry', label: 'Geometry Tool' },
    ];
    const isLightMode = (() => {
        if (typeof document === 'undefined') return true;
        const root = document.documentElement;
        const themeAttr = root.getAttribute('data-theme');
        const hasDarkClass = root.classList.contains('dark') || document.body.classList.contains('dark');
        if (themeAttr === 'dark' || hasDarkClass) return false;
        return true;
    })();

    const renderContent = () => {
        if (activeTab === 'graphing') {
            return graphingNode || (
                <div className="py-16 text-center text-slate-500 dark:text-slate-300">
                    Preparing the graphing workspace...
                </div>
            );
        }

        if (activeTab === 'geometry') {
            return geometryNode || (
                <div className="py-16 text-center text-slate-500 dark:text-slate-300">
                    Preparing the geometry playground...
                </div>
            );
        }

        return null;
    };

    return (
        <div className="fade-in space-y-6">
            <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between border-b border-slate-200/80 dark:border-slate-700/70 pb-4 math-practice-header">
                <button
                    onClick={onExit}
                    className="inline-flex items-center gap-2 text-sm font-semibold text-sky-600 hover:text-sky-700 dark:text-sky-300 dark:hover:text-sky-200"
                >
                    <ArrowLeftIcon />
                    <span>Back to Dashboard</span>
                </button>
                <h1 className="text-3xl font-bold text-slate-800 dark:text-slate-100 text-center flex-1">
                    Math Practice Tools
                </h1>
                <span className="hidden sm:block sm:w-40"></span>
            </div>
            <div className="flex flex-wrap gap-3 math-tools-tabs">
                {tabs.map((tab) => (
                    <button
                        key={tab.id}
                        onClick={() => onTabChange?.(tab.id)}
                        className={`px-4 py-2 rounded-lg font-semibold transition ${activeTab === tab.id
                            ? (isLightMode ? 'bg-sky-600 text-black shadow' : 'bg-sky-600 text-white shadow')
                            : 'bg-slate-200 text-slate-700 hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600'}`}
                    >
                        {tab.label}
                    </button>
                ))}
            </div>
            <section className="bg-white dark:bg-slate-900/70 border border-slate-200/80 dark:border-slate-700/70 rounded-2xl shadow-lg p-4 sm:p-6">
                {renderContent()}
            </section>
        </div>
    );
}

const MATH_PIPELINE_TEST_CASES = [
    { description: 'Trailing currency symbol', input: 'The price is 7$ today.' },
    { description: 'Leading currency symbol', input: 'Please pay $30 before Friday.' },
    { description: 'Escaped currency should persist', input: 'Escaped currency \\$18 should stay as dollars.' },
    { description: 'Inline math remains intact', input: 'Solve the equation $x + 3 = 9$ now.' },
    { description: 'Display math remains intact', input: 'Compute $$\\frac{3}{4}$$ of the recipe.' },
    { description: 'Broken LaTeX treated as text', input: 'Broken latex \\frac{2}{5} should remain plain text.' },
    { description: 'Table with currency values', input: '<table><tr><th>Item</th><th>Cost ($)</th></tr><tr><td>Book</td><td>$5</td></tr></table>' },
    { description: 'Spaced table markup with dollars', input: '< table >< tr >< td >$10< /td ></tr></table>' },
    { description: 'Stray dollar sign in sentence', input: 'Sentence with stray $ sign in the middle.' },
    { description: 'HTML entity currency stays escaped', input: 'HTML entity shows 5&#36; plus tax.' },
    { description: 'Angles with math delimiters', input: 'Angles like $m\\angle ABC = 45^\\circ$ are fine.' },
    { description: 'Table header currency', input: '<table><thead><tr><th>Revenue $ (USD)</th></tr></thead></table>' }
];

function runMathPipelineDiagnostics() {
    const failures = [];

    MATH_PIPELINE_TEST_CASES.forEach((test, index) => {
        const processed = preprocessRawContent(test.input, { normalizeSpacing: true });
        const segments = extractMathSegments(processed);
        const textSegments = segments.filter(segment => segment.type === 'text');

        const issues = [];

        if (textSegments.some(seg => /(^|[^\\])\$(?!\$)/.test(seg.value))) {
            issues.push('loneDollarSign');
        }

        if (textSegments.some(seg => /<\s*(?:tr|th|td)/i.test(seg.value))) {
            issues.push('rawTableMarkup');
        }

        const displayDelimiterMatches = processed.match(/\$\$/g) || [];
        if (displayDelimiterMatches.length % 2 !== 0) {
            issues.push('unbalancedDisplayMath');
        }

        const inlineScope = processed.replace(/\$\$[\s\S]+?\$\$/g, '');
        const inlineDelimiterMatches = inlineScope.match(/\$/g) || [];
        if (inlineDelimiterMatches.length % 2 !== 0) {
            issues.push('unbalancedInlineMath');
        }

        if (issues.length > 0) {
            failures.push({ index, description: test.description, issues, processed, segments });
        }
    });

    if (failures.length > 0) {
        console.warn('[MathPipelineDiagnostics] Failures detected:', failures);
    } else {
        console.info('[MathPipelineDiagnostics] All test cases passed.');
    }
}

if (typeof window !== 'undefined' && window.location && window.location.search.includes('mathdiag=1')) {
    setTimeout(runMathPipelineDiagnostics, 0);
}

function LifeChoicesSimulation({ srcPath }) {
    const [srcDoc, setSrcDoc] = React.useState(null);
    const iframeRef = React.useRef(null);

    React.useEffect(() => {
        let cancelled = false;
        async function load() {
            try {
                const res = await fetch(srcPath, { cache: 'no-store' });
                if (!res.ok) throw new Error(`Failed to load ${srcPath}: ${res.status}`);
                const html = await res.text();
                if (!cancelled) setSrcDoc(html);
            } catch (e) {
                console.warn('Falling back to src attribute for simulation:', e?.message || e);
                if (!cancelled) setSrcDoc(null);
            }
        }
        load();
        return () => { cancelled = true; };
    }, [srcPath]);

    return (
        <iframe
            ref={iframeRef}
            title="The Game of Life"
            className="w-full h-[80vh] rounded-lg"
            style={{ border: '1px solid var(--subject-simulations-border)', background: 'white' }}
            sandbox="allow-scripts allow-same-origin allow-popups allow-forms"
            src={srcDoc ? undefined : srcPath}
            srcDoc={srcDoc || undefined}
        />
    );
}

function useThemeController() {
    const [theme, setTheme] = useState(() => {
        if (typeof window === 'undefined') {
            return 'light';
        }
        return window.__START_THEME__ === 'dark' ? 'dark' : 'light';
    });

    const applyTheme = useCallback((nextTheme) => {
        const normalized = nextTheme === 'dark' ? 'dark' : 'light';
        if (typeof document !== 'undefined') {
            const body = document.body;
            if (body) {
                body.classList.toggle('dark', normalized === 'dark');
                body.setAttribute('data-theme', normalized);
            }
            const root = document.documentElement;
            if (root) {
                root.classList.toggle('dark', normalized === 'dark');
                root.setAttribute('data-theme', normalized);
            }
        }
        try {
            if (typeof window !== 'undefined' && window.localStorage) {
                window.localStorage.setItem('appTheme', normalized);
            }
        } catch (error) {
            console.warn('Unable to persist theme preference:', error);
        }
        setTheme((current) => (current === normalized ? current : normalized));
    }, []);

    const toggleTheme = useCallback(() => {
        applyTheme(theme === 'dark' ? 'light' : 'dark');
    }, [theme, applyTheme]);

    return { theme, toggleTheme, applyTheme };
}

function RootApp() {
    const { theme, applyTheme } = useThemeController();

    const handleThemeChange = useCallback((nextTheme) => {
        applyTheme(nextTheme);
    }, [applyTheme]);

    return (
        <>
            <ErrorBoundary>
                <App externalTheme={theme} onThemeChange={handleThemeChange} />
            </ErrorBoundary>
        </>
    );
}

// --- RENDER APP ---
const container = document.getElementById('root');
const root = ReactDOM.createRoot(container);
root.render(<RootApp />);

</script>

</body>
</html>
