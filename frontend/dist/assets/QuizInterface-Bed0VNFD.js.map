{"version":3,"mappings":"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","names":["useRef","useEffect","jsx","jsxs","useState","_a","currentQ","isMultipleSelect","useCallback","Fragment"],"ignoreList":[],"sources":["../../hooks/useInteractiveToolPanel.js","../../config/subjectVisuals.js","../../components/MathInputWithPad.jsx","../../components/quiz/QuizInterface.jsx"],"sourcesContent":["/**\r\n * useInteractiveToolPanel Hook\r\n *\r\n * Manages the lifecycle of interactive tool panels (graph and geometry)\r\n * for quiz questions that require visual aids.\r\n */\r\n\r\nimport { useEffect, useRef } from 'react';\r\n\r\nexport function useInteractiveToolPanel({\r\n  enabled,\r\n  currentQuestion,\r\n  toolPanelRef,\r\n  hasGraphData,\r\n  hasGeometryData,\r\n}) {\r\n  const toolInstanceRef = useRef(null);\r\n  const toolTypeRef = useRef(null);\r\n\r\n  const currentIndex = currentQuestion?.index ?? -1;\r\n\r\n  // Determine if we need to show the tool panel\r\n  const needsToolPanel = enabled && (hasGraphData || hasGeometryData);\r\n\r\n  useEffect(() => {\r\n    if (!enabled || !toolPanelRef?.current) return;\r\n\r\n    const panel = toolPanelRef.current;\r\n    const currentQ = currentQuestion;\r\n\r\n    // Determine which tool type to mount\r\n    const nextType = hasGraphData\r\n      ? 'graph'\r\n      : hasGeometryData\r\n      ? 'geometry'\r\n      : null;\r\n\r\n    // Cleanup previous tool\r\n    const destroyTool = () => {\r\n      if (toolInstanceRef.current) {\r\n        try {\r\n          if (typeof toolInstanceRef.current.destroy === 'function') {\r\n            toolInstanceRef.current.destroy();\r\n          } else if (typeof toolInstanceRef.current.unmount === 'function') {\r\n            toolInstanceRef.current.unmount();\r\n          }\r\n        } catch (err) {\r\n          console.warn('[tool-panel] destroy error:', err?.message || err);\r\n        }\r\n        toolInstanceRef.current = null;\r\n      }\r\n      toolTypeRef.current = null;\r\n    };\r\n\r\n    // If same tool type and question, skip remounting\r\n    if (toolTypeRef.current === nextType && nextType) {\r\n      return;\r\n    }\r\n\r\n    destroyTool();\r\n\r\n    // If no tool needed, hide and exit\r\n    if (!nextType) {\r\n      try {\r\n        panel.style.display = 'none';\r\n        panel.setAttribute('aria-hidden', 'true');\r\n      } catch {}\r\n      return;\r\n    }\r\n\r\n    // Show panel\r\n    try {\r\n      panel.style.display = '';\r\n      panel.removeAttribute('aria-hidden');\r\n    } catch {}\r\n\r\n    // Ensure container has a reasonable height for canvases\r\n    panel.style.minHeight = '320px';\r\n\r\n    // Dynamically import modules served from /frontend\r\n    (async () => {\r\n      try {\r\n        if (!enabled) return;\r\n\r\n        if (nextType === 'graph') {\r\n          const mod = await import('../graphing/GraphCanvas.js');\r\n          const mount = mod && mod.mount;\r\n          const unmount = mod && mod.unmount;\r\n          const GraphCanvas = mod && (mod.default || mod.GraphCanvas);\r\n          const payload = {\r\n            graphSpec:\r\n              (currentQ &&\r\n                (currentQ.graphSpec ||\r\n                  currentQ.graphData ||\r\n                  currentQ.coordinatePlane)) ||\r\n              null,\r\n          };\r\n          if (typeof mount === 'function') {\r\n            mount(panel, payload);\r\n            toolInstanceRef.current = {\r\n              destroy: () => {\r\n                try {\r\n                  unmount && unmount(panel);\r\n                } catch {}\r\n              },\r\n            };\r\n            toolTypeRef.current = 'graph';\r\n          } else if (typeof GraphCanvas === 'function') {\r\n            toolInstanceRef.current = new GraphCanvas(panel, {\r\n              spec: payload.graphSpec,\r\n            });\r\n            toolTypeRef.current = 'graph';\r\n          }\r\n        } else if (nextType === 'geometry') {\r\n          const mod = await import('../geometry/GeometryCanvas.js');\r\n          const mount = mod && mod.mount;\r\n          const unmount = mod && mod.unmount;\r\n          const GeometryCanvas = mod && (mod.default || mod.GeometryCanvas);\r\n          const payload = {\r\n            geometrySpec: (currentQ && currentQ.geometrySpec) || null,\r\n          };\r\n          if (typeof mount === 'function') {\r\n            mount(panel, payload);\r\n            toolInstanceRef.current = {\r\n              destroy: () => {\r\n                try {\r\n                  unmount && unmount(panel);\r\n                } catch {}\r\n              },\r\n            };\r\n            toolTypeRef.current = 'geometry';\r\n          } else if (typeof GeometryCanvas === 'function') {\r\n            toolInstanceRef.current = new GeometryCanvas(panel, {\r\n              spec: payload.geometrySpec,\r\n            });\r\n            toolTypeRef.current = 'geometry';\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn(\r\n          '[tool-panel] failed to mount tool:',\r\n          nextType,\r\n          e?.message || e\r\n        );\r\n      }\r\n    })();\r\n\r\n    // Cleanup on unmount or question change\r\n    return () => {\r\n      destroyTool();\r\n    };\r\n  }, [\r\n    enabled,\r\n    currentIndex,\r\n    currentQuestion?.useGraphTool,\r\n    currentQuestion?.useGeometryTool,\r\n    hasGraphData,\r\n    hasGeometryData,\r\n  ]);\r\n\r\n  return { needsToolPanel };\r\n}\r\n\r\n// Legacy window attachment (will be removed once all consumers use ES modules)\r\nif (typeof window !== 'undefined') {\r\n  window.Hooks = Object.assign(window.Hooks || {}, { useInteractiveToolPanel });\r\n}\r\n","// Centralized subject visual + vocabulary meta constants\r\n// Extracted from app.jsx to reduce monolith size and prevent drift.\r\n\r\nexport const SUBJECT_NAMES = ['Math', 'RLA', 'Science', 'Social Studies'];\r\n\r\nexport const SUBJECT_COLORS = {\r\n  Science: {\r\n    background: 'var(--subject-science-accent)',\r\n    text: 'var(--subject-science-surface-text)',\r\n    heroText: 'var(--subject-science-text)',\r\n    border: 'var(--subject-science-border)',\r\n    scoreBackground: 'var(--bg-overlay)',\r\n    scoreText: 'var(--subject-science-text)',\r\n    scoreBorder: 'var(--subject-science-border)',\r\n    accent: 'var(--subject-science-accent)',\r\n    accentText: 'var(--subject-science-accent-text)',\r\n  },\r\n  'Social Studies': {\r\n    background: 'var(--subject-social-accent)',\r\n    text: 'var(--subject-social-surface-text)',\r\n    heroText: 'var(--subject-social-text)',\r\n    border: 'var(--subject-social-border)',\r\n    scoreBackground: 'var(--bg-overlay)',\r\n    scoreText: 'var(--subject-social-text)',\r\n    scoreBorder: 'var(--subject-social-border)',\r\n    accent: 'var(--subject-social-accent)',\r\n    accentText: 'var(--subject-social-accent-text)',\r\n  },\r\n  'Reasoning Through Language Arts (RLA)': {\r\n    background: 'var(--subject-rla-accent)',\r\n    text: 'var(--subject-rla-surface-text)',\r\n    heroText: 'var(--subject-rla-text)',\r\n    border: 'var(--subject-rla-border)',\r\n    scoreBackground: 'var(--bg-overlay)',\r\n    scoreText: 'var(--subject-rla-text)',\r\n    scoreBorder: 'var(--subject-rla-border)',\r\n    accent: 'var(--subject-rla-accent)',\r\n    accentText: 'var(--subject-rla-accent-text)',\r\n  },\r\n  Math: {\r\n    background: 'var(--subject-math-accent)',\r\n    text: 'var(--math-text)',\r\n    heroText: 'var(--subject-math-text)',\r\n    border: 'var(--math-surface-border)',\r\n    scoreBackground: 'var(--bg-overlay)',\r\n    scoreText: 'var(--math-text)',\r\n    scoreBorder: 'var(--math-surface-border)',\r\n    accent: 'var(--subject-math-accent)',\r\n    accentText: 'var(--subject-math-accent-text)',\r\n    surface: 'var(--math-surface)',\r\n    surfaceStrong: 'var(--math-surface)',\r\n    surfaceBorder: 'var(--math-surface-border)',\r\n    divider: 'var(--math-divider)',\r\n    mutedText: 'var(--math-muted-text)',\r\n    onBackgroundText: 'var(--math-text)',\r\n  },\r\n  Workforce: {\r\n    background: 'var(--subject-workforce-accent)',\r\n    text: 'var(--subject-workforce-surface-text)',\r\n    heroText: 'var(--subject-workforce-text)',\r\n    border: 'var(--subject-workforce-border)',\r\n    scoreBackground: 'var(--bg-overlay)',\r\n    scoreText: 'var(--subject-workforce-text)',\r\n    scoreBorder: 'var(--subject-workforce-border)',\r\n    accent: 'var(--subject-workforce-accent)',\r\n    accentText: 'var(--subject-workforce-accent-text)',\r\n  },\r\n};\r\n\r\nexport const SUBJECT_BG_GRADIENTS = {\r\n  Math: 'var(--subject-math-gradient)',\r\n  Science: 'var(--subject-science-gradient)',\r\n  'Social Studies': 'var(--subject-social-gradient)',\r\n  'Reasoning Through Language Arts (RLA)': 'var(--subject-rla-gradient)',\r\n  Workforce: 'var(--subject-workforce-gradient)',\r\n};\r\n\r\nexport const SUBJECT_LIGHT_SURFACE_GRADIENTS = {\r\n  Math: 'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(2,132,199,0.12))',\r\n  Science:\r\n    'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(220,38,38,0.12))',\r\n  'Social Studies':\r\n    'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(22,163,74,0.12))',\r\n  'Reasoning Through Language Arts (RLA)':\r\n    'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(124,58,237,0.12))',\r\n  Workforce:\r\n    'linear-gradient(135deg, rgba(255,255,255,0.98), rgba(20,184,166,0.12))',\r\n};\r\n\r\nexport const SUBJECT_LIGHT_TINTS = {\r\n  Math: 'rgba(2,132,199,0.2)',\r\n  Science: 'rgba(220,38,38,0.2)',\r\n  'Social Studies': 'rgba(22,163,74,0.2)',\r\n  'Reasoning Through Language Arts (RLA)': 'rgba(124,58,237,0.2)',\r\n  Workforce: 'rgba(20,184,166,0.2)',\r\n};\r\n\r\nexport const SUBJECT_SHORT_LABELS = {\r\n  Science: 'Science',\r\n  Math: 'Math',\r\n  'Social Studies': 'Social Studies',\r\n  'Reasoning Through Language Arts (RLA)': 'RLA',\r\n  Workforce: 'Workforce',\r\n};\r\n\r\nexport const VOCABULARY_SUBJECT_COLORS = {\r\n  Science: '#dc2626',\r\n  Math: '#0284c7',\r\n  'Social Studies': '#16a34a',\r\n  'Reasoning Through Language Arts (RLA)': '#7c3aed',\r\n};\r\n\r\nexport const MAX_TICKER_WORDS_PER_SUBJECT = 10;\r\n\r\n// Fallback vocabulary remains in app.jsx for now to reduce diff size.\r\n// It can be moved here later once references are confirmed.\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.SubjectVisuals = Object.assign(window.SubjectVisuals || {}, {\r\n    SUBJECT_NAMES,\r\n    SUBJECT_COLORS,\r\n    SUBJECT_BG_GRADIENTS,\r\n    SUBJECT_LIGHT_SURFACE_GRADIENTS,\r\n    SUBJECT_LIGHT_TINTS,\r\n    SUBJECT_SHORT_LABELS,\r\n    VOCABULARY_SUBJECT_COLORS,\r\n    MAX_TICKER_WORDS_PER_SUBJECT,\r\n  });\r\n}\r\n\n\n// Legacy window attachment\nif (typeof window !== 'undefined') {\n  window.SubjectVisuals = { SUBJECT_NAMES, SUBJECT_COLORS, SUBJECT_BG_GRADIENTS, SUBJECT_LIGHT_SURFACE_GRADIENTS, SUBJECT_LIGHT_TINTS, SUBJECT_SHORT_LABELS, VOCABULARY_SUBJECT_COLORS, MAX_TICKER_WORDS_PER_SUBJECT };\n}","// Math Input with Pad Component\r\n// Reusable onscreen calculator pad for all math fill-in questions\r\n// Pure client-side, no AI or backend calls\r\n\r\nconst MathInputWithPad = ({\r\n  value = '',\r\n  onChange,\r\n  placeholder = 'Type your answer',\r\n  disabled = false,\r\n  className = '',\r\n}) => {\r\n  const { useRef, useCallback } = React;\r\n  const inputRef = useRef(null);\r\n\r\n  // Insert text at cursor position\r\n  const insertAtCursor = useCallback(\r\n    (textToInsert) => {\r\n      if (!inputRef.current || disabled) return;\r\n\r\n      const input = inputRef.current;\r\n      const start = input.selectionStart || 0;\r\n      const end = input.selectionEnd || 0;\r\n      const currentValue = value || '';\r\n\r\n      // Insert the text\r\n      const newValue =\r\n        currentValue.substring(0, start) +\r\n        textToInsert +\r\n        currentValue.substring(end);\r\n\r\n      // Update value\r\n      onChange(newValue);\r\n\r\n      // Set cursor position after the inserted text\r\n      setTimeout(() => {\r\n        if (input) {\r\n          const newPos = start + textToInsert.length;\r\n          input.selectionStart = newPos;\r\n          input.selectionEnd = newPos;\r\n          input.focus();\r\n        }\r\n      }, 0);\r\n    },\r\n    [value, onChange, disabled]\r\n  );\r\n\r\n  // Backspace function\r\n  const handleBackspace = useCallback(() => {\r\n    if (!inputRef.current || disabled) return;\r\n\r\n    const input = inputRef.current;\r\n    const start = input.selectionStart || 0;\r\n    const end = input.selectionEnd || 0;\r\n    const currentValue = value || '';\r\n\r\n    let newValue;\r\n    let newCursorPos;\r\n\r\n    if (start !== end) {\r\n      // Delete selection\r\n      newValue = currentValue.substring(0, start) + currentValue.substring(end);\r\n      newCursorPos = start;\r\n    } else if (start > 0) {\r\n      // Delete character before cursor\r\n      newValue =\r\n        currentValue.substring(0, start - 1) + currentValue.substring(start);\r\n      newCursorPos = start - 1;\r\n    } else {\r\n      // Nothing to delete\r\n      return;\r\n    }\r\n\r\n    onChange(newValue);\r\n\r\n    setTimeout(() => {\r\n      if (input) {\r\n        input.selectionStart = newCursorPos;\r\n        input.selectionEnd = newCursorPos;\r\n        input.focus();\r\n      }\r\n    }, 0);\r\n  }, [value, onChange, disabled]);\r\n\r\n  // Toggle negative sign\r\n  const toggleNegative = useCallback(() => {\r\n    if (disabled) return;\r\n\r\n    const currentValue = value || '';\r\n    let newValue;\r\n\r\n    if (currentValue.startsWith('-')) {\r\n      // Remove negative sign\r\n      newValue = currentValue.substring(1);\r\n    } else {\r\n      // Add negative sign\r\n      newValue = '-' + currentValue;\r\n    }\r\n\r\n    onChange(newValue);\r\n\r\n    // Maintain cursor position\r\n    setTimeout(() => {\r\n      if (inputRef.current) {\r\n        inputRef.current.focus();\r\n      }\r\n    }, 0);\r\n  }, [value, onChange, disabled]);\r\n\r\n  // Clear all\r\n  const handleClear = useCallback(() => {\r\n    if (disabled) return;\r\n    onChange('');\r\n    setTimeout(() => {\r\n      if (inputRef.current) {\r\n        inputRef.current.focus();\r\n      }\r\n    }, 0);\r\n  }, [onChange, disabled]);\r\n\r\n  // Button component\r\n  const PadButton = ({ label, insertText, onClick, ariaLabel, span = 1 }) => {\r\n    const buttonClass = `\r\n      px-3 py-2 rounded-lg font-semibold transition\r\n      ${\r\n        disabled\r\n          ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n          : 'bg-blue-500 text-white hover:bg-blue-600 active:bg-blue-700'\r\n      }\r\n      ${span === 2 ? 'col-span-2' : ''}\r\n    `;\r\n\r\n    return (\r\n      <button\r\n        type=\"button\"\r\n        onClick={() => {\r\n          if (onClick) onClick();\r\n          else if (insertText) insertAtCursor(insertText);\r\n        }}\r\n        disabled={disabled}\r\n        aria-label={ariaLabel || `Insert ${label}`}\r\n        className={buttonClass}\r\n      >\r\n        {label}\r\n      </button>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className={`math-input-with-pad ${className}`}>\r\n      {/* Text Input */}\r\n      <input\r\n        ref={inputRef}\r\n        type=\"text\"\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        placeholder={placeholder}\r\n        disabled={disabled}\r\n        className={`\r\n          w-full px-4 py-3 mb-3 text-lg border-2 rounded-lg\r\n          ${\r\n            disabled\r\n              ? 'bg-gray-100 border-gray-300 text-gray-500 cursor-not-allowed'\r\n              : 'bg-white border-blue-400 text-gray-900 focus:border-blue-600 focus:ring-2 focus:ring-blue-200'\r\n          }\r\n          dark:bg-gray-800 dark:border-gray-600 dark:text-white dark:focus:border-blue-500\r\n        `}\r\n        aria-label=\"Math answer input\"\r\n      />\r\n\r\n      {/* Math Keypad */}\r\n      <div\r\n        className={`\r\n        math-keypad p-3 rounded-lg border-2\r\n        ${\r\n          disabled\r\n            ? 'bg-gray-100 border-gray-300'\r\n            : 'bg-blue-50 border-blue-300'\r\n        }\r\n        dark:bg-gray-700 dark:border-gray-600\r\n      `}\r\n      >\r\n        <div className=\"grid grid-cols-5 gap-2\">\r\n          {/* Row 1: 7 8 9 + - */}\r\n          <PadButton label=\"7\" insertText=\"7\" ariaLabel=\"Insert 7\" />\r\n          <PadButton label=\"8\" insertText=\"8\" ariaLabel=\"Insert 8\" />\r\n          <PadButton label=\"9\" insertText=\"9\" ariaLabel=\"Insert 9\" />\r\n          <PadButton label=\"+\" insertText=\"+\" ariaLabel=\"Insert plus\" />\r\n          <PadButton label=\"−\" insertText=\"-\" ariaLabel=\"Insert minus\" />\r\n\r\n          {/* Row 2: 4 5 6 × ÷ */}\r\n          <PadButton label=\"4\" insertText=\"4\" ariaLabel=\"Insert 4\" />\r\n          <PadButton label=\"5\" insertText=\"5\" ariaLabel=\"Insert 5\" />\r\n          <PadButton label=\"6\" insertText=\"6\" ariaLabel=\"Insert 6\" />\r\n          <PadButton label=\"×\" insertText=\"*\" ariaLabel=\"Insert multiply\" />\r\n          <PadButton label=\"÷\" insertText=\"/\" ariaLabel=\"Insert divide\" />\r\n\r\n          {/* Row 3: 1 2 3 ( ) */}\r\n          <PadButton label=\"1\" insertText=\"1\" ariaLabel=\"Insert 1\" />\r\n          <PadButton label=\"2\" insertText=\"2\" ariaLabel=\"Insert 2\" />\r\n          <PadButton label=\"3\" insertText=\"3\" ariaLabel=\"Insert 3\" />\r\n          <PadButton\r\n            label=\"(\"\r\n            insertText=\"(\"\r\n            ariaLabel=\"Insert left parenthesis\"\r\n          />\r\n          <PadButton\r\n            label=\")\"\r\n            insertText=\")\"\r\n            ariaLabel=\"Insert right parenthesis\"\r\n          />\r\n\r\n          {/* Row 4: 0 . ^ / */}\r\n          <PadButton label=\"0\" insertText=\"0\" ariaLabel=\"Insert 0\" span={2} />\r\n          <PadButton\r\n            label=\".\"\r\n            insertText=\".\"\r\n            ariaLabel=\"Insert decimal point\"\r\n          />\r\n          <PadButton label=\"^\" insertText=\"^\" ariaLabel=\"Insert exponent\" />\r\n          <PadButton\r\n            label=\"/\"\r\n            insertText=\"/\"\r\n            ariaLabel=\"Insert fraction slash\"\r\n          />\r\n\r\n          {/* Row 5: x y π +/- ← */}\r\n          <PadButton label=\"x\" insertText=\"x\" ariaLabel=\"Insert variable x\" />\r\n          <PadButton label=\"y\" insertText=\"y\" ariaLabel=\"Insert variable y\" />\r\n          <PadButton label=\"π\" insertText=\"π\" ariaLabel=\"Insert pi\" />\r\n          <PadButton\r\n            label=\"±\"\r\n            onClick={toggleNegative}\r\n            ariaLabel=\"Toggle negative sign\"\r\n          />\r\n          <PadButton\r\n            label=\"←\"\r\n            onClick={handleBackspace}\r\n            ariaLabel=\"Backspace\"\r\n          />\r\n        </div>\r\n\r\n        {/* Bottom row: Clear */}\r\n        <div className=\"mt-2\">\r\n          <button\r\n            type=\"button\"\r\n            onClick={handleClear}\r\n            disabled={disabled}\r\n            className={`\r\n              w-full px-3 py-2 rounded-lg font-semibold transition\r\n              ${\r\n                disabled\r\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\r\n                  : 'bg-red-500 text-white hover:bg-red-600'\r\n              }\r\n            `}\r\n            aria-label=\"Clear all\"\r\n          >\r\n            Clear\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Export for use in app.jsx\r\nif (typeof window !== 'undefined') {\r\n  window.MathInputWithPad = MathInputWithPad;\r\n}\r\n\r\nexport default MathInputWithPad;\r\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\r\nimport { useInteractiveToolPanel } from '../../hooks/useInteractiveToolPanel.js';\r\nimport { SUBJECT_COLORS } from '../../config/subjectVisuals.js';\r\nimport {\r\n  FormulaSheetModal,\r\n  ScienceFormulaSheet,\r\n} from '../formula/FormulaSheets.jsx';\r\nimport { MathText } from '../math/MathText.jsx';\r\nimport { GeometryFigure } from '../geometry/GeometryFigure.jsx';\r\nimport { ChartDisplay } from '../charts/ChartDisplay.jsx';\r\nimport { renderQuestionTextForDisplay } from '../../utils/mathUtils.js';\r\nimport {\r\n  getOptionText,\r\n  getOptionIsCorrect,\r\n  isShortResponseQuestion,\r\n} from '../../utils/textUtils.js';\r\nimport MathInputWithPad from '../MathInputWithPad.jsx';\r\nimport { TI30XSCalculator } from '../TI30XSCalculator.jsx';\r\n\r\nconst DEFAULT_COLOR_SCHEME = {\r\n  background: 'var(--nav-active-bg)',\r\n  text: 'var(--text-primary)',\r\n  mutedText: 'var(--text-muted)',\r\n  accent: 'var(--accent-blue)',\r\n  accentText: '#ffffff',\r\n  surface: 'var(--surface-primary)',\r\n  surfaceBorder: 'var(--border-primary)',\r\n  divider: 'var(--border-muted)',\r\n  timerDefaultBg: 'var(--surface-secondary)',\r\n  timerDefaultText: 'var(--text-primary)',\r\n  timerLowBg: '#fee2e2',\r\n  timerLowText: '#991b1b',\r\n};\r\n\r\nexport function QuizInterface({\r\n  questions,\r\n  answers,\r\n  setAnswers,\r\n  onComplete,\r\n  buttonText,\r\n  quizTitle,\r\n  onExit,\r\n  timeLimit,\r\n  subject,\r\n  showTimer = true,\r\n  quizConfig,\r\n  article = null,\r\n  articleImage = null,\r\n}) {\r\n  const [currentIndex, setCurrentIndex] = useState(0);\r\n  const [marked, setMarked] = useState(Array(questions.length).fill(false));\r\n  const [confidence, setConfidence] = useState(\r\n    Array(questions.length).fill(null)\r\n  );\r\n  const [timeLeft, setTimeLeft] = useState(timeLimit || questions.length * 90);\r\n  const [isPaused, setIsPaused] = useState(false);\r\n  const [pausesRemaining, setPausesRemaining] = useState(2);\r\n  const handleSubmitRef = useRef(() => {});\r\n  const [showMathFormulas, setShowMathFormulas] = useState(false);\r\n  const [showScienceFormulas, setShowScienceFormulas] = useState(false);\r\n  const [showArticle, setShowArticle] = useState(Boolean(article));\r\n  const toolPanelRef = useRef(null);\r\n  const toolInstanceRef = useRef(null);\r\n  const toolTypeRef = useRef(null); // 'graph' | 'geometry' | null\r\n  const [showCalculator, setShowCalculator] = useState(false);\r\n  const [zenMode, setZenMode] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setTimeLeft(timeLimit || questions.length * 90);\r\n    setIsPaused(false);\r\n    setPausesRemaining(2);\r\n  }, [questions, timeLimit]);\r\n\r\n  useEffect(() => {\r\n    setShowArticle(Boolean(article));\r\n  }, [article]);\r\n\r\n  useEffect(() => {\r\n    if (!onComplete || isPaused) return; // Don't run timer if there's no completion action (e.g., in a part of a larger quiz)\r\n    const timer = setInterval(() => {\r\n      setTimeLeft((prev) => {\r\n        if (prev <= 1) {\r\n          clearInterval(timer);\r\n          handleSubmitRef.current?.();\r\n          return 0;\r\n        }\r\n        return prev - 1;\r\n      });\r\n    }, 1000);\r\n    return () => clearInterval(timer);\r\n  }, [onComplete, isPaused]);\r\n\r\n  // MULTIPLE-SELECT ENHANCEMENT: Support both single-select and multiple-select questions\r\n  const handleSelect = (optionText) => {\r\n    const currentQ = questions[currentIndex];\r\n    const isMultipleSelect =\r\n      currentQ.selectType === 'multiple' || currentQ.type === 'multiple-select';\r\n\r\n    const newAnswers = [...answers];\r\n\r\n    if (isMultipleSelect) {\r\n      // Toggle selection for multiple-select questions\r\n      const currentSelections = Array.isArray(newAnswers[currentIndex])\r\n        ? newAnswers[currentIndex]\r\n        : newAnswers[currentIndex]\r\n        ? [newAnswers[currentIndex]]\r\n        : [];\r\n\r\n      const index = currentSelections.indexOf(optionText);\r\n      if (index > -1) {\r\n        // Deselect: remove from array\r\n        currentSelections.splice(index, 1);\r\n      } else {\r\n        // Select: add to array\r\n        currentSelections.push(optionText);\r\n      }\r\n      newAnswers[currentIndex] =\r\n        currentSelections.length > 0 ? currentSelections : null;\r\n    } else {\r\n      // Single-select: replace with new selection\r\n      newAnswers[currentIndex] = optionText;\r\n    }\r\n\r\n    setAnswers(newAnswers);\r\n  };\r\n\r\n  const handleInputChange = (e) => {\r\n    const newAnswers = [...answers];\r\n    const value = e.target.value;\r\n\r\n    // For Science and Math: enforce numeric-only for fill-in questions without answer options\r\n    const isScienceOrMath = /science|math/i.test(\r\n      subject || quiz?.subject || ''\r\n    );\r\n    const isNumericQuestion =\r\n      currentQ.type === 'numeric' || currentQ.responseType === 'numeric';\r\n    const isFillInNoOptions =\r\n      (!Array.isArray(currentQ.answerOptions) ||\r\n        currentQ.answerOptions.length === 0) &&\r\n      !isShortResponseQuestion(currentQ);\r\n\r\n    if (isScienceOrMath && (isNumericQuestion || isFillInNoOptions)) {\r\n      // Allow only numeric characters, decimal points, negative signs, fractions, percents\r\n      const numericPattern = /^[\\d\\.\\-\\/%\\s\\(\\)]*$/;\r\n      if (!numericPattern.test(value)) {\r\n        // Show validation message briefly\r\n        console.log(\r\n          '[UI] Numeric answers only for Science/Math fill-in questions'\r\n        );\r\n        return; // Don't update answer if non-numeric input\r\n      }\r\n    }\r\n\r\n    newAnswers[currentIndex] = value;\r\n    setAnswers(newAnswers);\r\n  };\r\n\r\n  const handleConfidenceSelect = (level) => {\r\n    const newConfidence = [...confidence];\r\n    newConfidence[currentIndex] = level;\r\n    setConfidence(newConfidence);\r\n  };\r\n\r\n  const handleSubmit = useCallback(() => {\r\n    onComplete({ answers, marked, confidence });\r\n  }, [answers, marked, onComplete, confidence]);\r\n\r\n  useEffect(() => {\r\n    handleSubmitRef.current = handleSubmit;\r\n  }, [handleSubmit]);\r\n\r\n  const handlePauseToggle = () => {\r\n    if (isPaused) {\r\n      setIsPaused(false);\r\n      return;\r\n    }\r\n    if (pausesRemaining > 0) {\r\n      setIsPaused(true);\r\n      setPausesRemaining((prev) => prev - 1);\r\n    }\r\n  };\r\n\r\n  const formatTime = (seconds) => {\r\n    const safeSeconds = Math.max(0, seconds);\r\n    return `${Math.floor(safeSeconds / 60)}:${(safeSeconds % 60)\r\n      .toString()\r\n      .padStart(2, '0')}`;\r\n  };\r\n  const currentQ = questions[currentIndex];\r\n  if (!currentQ) return <div>Loading question...</div>;\r\n\r\n  const baseFillIn =\r\n    currentQ.type === 'fill-in-the-blank' ||\r\n    !Array.isArray(currentQ.answerOptions) ||\r\n    currentQ.answerOptions.length === 0;\r\n\r\n  // NUMERIC ENTRY ENHANCEMENT: Detect numeric entry questions for Math\r\n  const isNumericEntry =\r\n    currentQ.type === 'numeric' || currentQ.responseType === 'numeric';\r\n\r\n  const isShortResponse = isShortResponseQuestion(currentQ);\r\n  const isFillInTheBlank = baseFillIn && !isNumericEntry && !isShortResponse;\r\n\r\n  // MULTIPLE-SELECT ENHANCEMENT: Determine if current question is multiple-select\r\n  const isMultipleSelect =\r\n    currentQ.selectType === 'multiple' || currentQ.type === 'multiple-select';\r\n  const currentAnswer = answers[currentIndex];\r\n  const selectedOptions = isMultipleSelect\r\n    ? Array.isArray(currentAnswer)\r\n      ? currentAnswer\r\n      : currentAnswer\r\n      ? [currentAnswer]\r\n      : []\r\n    : [currentAnswer];\r\n\r\n  // Enable interactive tool panel only for Math questions (was hard-disabled)\r\n  const TOOL_PANEL_ENABLED = /math/i.test(subjectForRender || subject || '');\r\n\r\n  // Precompute if the question would need a tool (ignored when flag is false)\r\n  const hasGraphDataForRender = Boolean(\r\n    currentQ &&\r\n      (currentQ.graphSpec || currentQ.graphData || currentQ.coordinatePlane)\r\n  );\r\n  const hasGeometryDataForRender = Boolean(currentQ && currentQ.geometrySpec);\r\n\r\n  const subjectForRender = currentQ.subject || subject || 'Default';\r\n  const quizSubject = subject || 'Default';\r\n  const formulaSheetEnabled = Boolean(quizConfig?.formulaSheet);\r\n  const canShowMathFormulas = formulaSheetEnabled && quizSubject === 'Math';\r\n  const canShowScienceFormulas =\r\n    formulaSheetEnabled && quizSubject === 'Science';\r\n  const subjectColors = SUBJECT_COLORS[subjectForRender] || {};\r\n  const scheme = { ...DEFAULT_COLOR_SCHEME, ...subjectColors };\r\n  const timerStyle =\r\n    timeLeft <= 60\r\n      ? { backgroundColor: scheme.timerLowBg, color: scheme.timerLowText }\r\n      : {\r\n          backgroundColor: scheme.timerDefaultBg,\r\n          color: scheme.timerDefaultText,\r\n        };\r\n\r\n  // PASSAGE LINKING ENHANCEMENT: Check if current question has an associated passage\r\n  const hasPassage = Boolean(currentQ.passage || currentQ.passageId);\r\n  const passageContent = currentQ.passage || '';\r\n\r\n  // Interactive tool mounting lifecycle (extracted to useInteractiveToolPanel hook)\r\n  const { needsToolPanel } = useInteractiveToolPanel({\r\n    enabled: TOOL_PANEL_ENABLED,\r\n    currentQuestion: currentQ,\r\n    toolPanelRef,\r\n    hasGraphData: hasGraphDataForRender,\r\n    hasGeometryData: hasGeometryDataForRender,\r\n  });\r\n\r\n  return (\r\n    <div className=\"fade-in\">\r\n      {canShowMathFormulas && showMathFormulas && (\r\n        <FormulaSheetModal onClose={() => setShowMathFormulas(false)} />\r\n      )}\r\n      {canShowScienceFormulas && showScienceFormulas && (\r\n        <ScienceFormulaSheet onClose={() => setShowScienceFormulas(false)} />\r\n      )}\r\n      {showCalculator && (\r\n        <TI30XSCalculator onClose={() => setShowCalculator(false)} />\r\n      )}\r\n      <div\r\n        className=\"quiz-panel rounded-2xl p-4 sm:p-6 shadow-lg\"\r\n        data-subject={quizSubject}\r\n        style={{\r\n          backgroundColor: scheme.surface,\r\n          border: `1px solid ${scheme.surfaceBorder}`,\r\n        }}\r\n      >\r\n        {showTimer && (\r\n          <header\r\n            className=\"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between pb-4 mb-4\"\r\n            style={{\r\n              borderBottom: `1px solid ${scheme.divider}`,\r\n              opacity: zenMode ? 0.2 : 1,\r\n              transition: 'opacity 0.3s ease',\r\n            }}\r\n            onMouseEnter={(e) =>\r\n              zenMode && (e.currentTarget.style.opacity = '1')\r\n            }\r\n            onMouseLeave={(e) =>\r\n              zenMode && (e.currentTarget.style.opacity = '0.2')\r\n            }\r\n          >\r\n            {onExit && (\r\n              <button\r\n                onClick={onExit}\r\n                className=\"flex items-center gap-1 text-sm font-semibold hover:underline\"\r\n                style={{ color: scheme.mutedText }}\r\n              >\r\n                <ArrowLeftIcon /> ← Back\r\n              </button>\r\n            )}\r\n            <h2\r\n              className=\"flex-1 text-center text-xl font-bold exam-title\"\r\n              style={{ color: scheme.text }}\r\n            >\r\n              {quizTitle}\r\n            </h2>\r\n            <div className=\"flex flex-col sm:items-end gap-2\">\r\n              <div\r\n                className=\"flex items-center gap-2 rounded-full px-3 py-1 font-mono text-lg font-semibold\"\r\n                style={timerStyle}\r\n              >\r\n                <span role=\"img\" aria-label=\"timer\">\r\n                  ⏱️\r\n                </span>\r\n                <span>{formatTime(timeLeft)}</span>\r\n                {isPaused && (\r\n                  <span\r\n                    className=\"text-xs uppercase tracking-wide\"\r\n                    style={{ color: scheme.mutedText }}\r\n                  >\r\n                    Paused\r\n                  </span>\r\n                )}\r\n              </div>\r\n              <div className=\"flex items-center gap-2\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={handlePauseToggle}\r\n                  disabled={!isPaused && pausesRemaining === 0}\r\n                  className=\"rounded-md px-3 py-1 text-sm font-semibold transition-colors\"\r\n                  style={\r\n                    isPaused\r\n                      ? {\r\n                          backgroundColor: 'var(--success-bg)',\r\n                          color: 'var(--success-text)',\r\n                          border: '1px solid var(--success-border)',\r\n                        }\r\n                      : {\r\n                          backgroundColor: scheme.accent,\r\n                          color: scheme.accentText,\r\n                          border: `1px solid ${scheme.accent}`,\r\n                        }\r\n                  }\r\n                >\r\n                  {isPaused ? '▶️ Resume Timer' : '⏸️ Pause Timer'}\r\n                </button>\r\n                <span className=\"text-xs\" style={{ color: scheme.mutedText }}>\r\n                  ⏯️ {pausesRemaining} pause{pausesRemaining === 1 ? '' : 's'}{' '}\r\n                  left\r\n                </span>\r\n              </div>\r\n              {formulaSheetEnabled && (\r\n                <div className=\"flex flex-wrap justify-end gap-2\">\r\n                  {canShowMathFormulas && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowMathFormulas(true)}\r\n                      className=\"rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition\"\r\n                      data-role=\"secondary\"\r\n                      style={{\r\n                        color: scheme.accentText,\r\n                        borderColor: scheme.accent,\r\n                      }}\r\n                    >\r\n                      📐 Formula Sheet\r\n                    </button>\r\n                  )}\r\n                  {canShowScienceFormulas && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowScienceFormulas(true)}\r\n                      className=\"rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition\"\r\n                      data-role=\"secondary\"\r\n                      style={{\r\n                        color: 'var(--danger-text)',\r\n                        borderColor: 'var(--danger-border)',\r\n                      }}\r\n                    >\r\n                      🧪 Science Formulas\r\n                    </button>\r\n                  )}\r\n                  {quizConfig?.calculator && (\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setShowCalculator(true)}\r\n                      className=\"rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition\"\r\n                      data-role=\"secondary\"\r\n                      style={{\r\n                        color: scheme.accentText,\r\n                        borderColor: scheme.accent,\r\n                      }}\r\n                    >\r\n                      🧮 Calculator\r\n                    </button>\r\n                  )}\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setZenMode((prev) => !prev)}\r\n                    className=\"rounded-md px-3 py-1.5 text-sm font-semibold shadow-sm transition\"\r\n                    data-role=\"secondary\"\r\n                    style={{\r\n                      color: zenMode ? scheme.accent : scheme.text,\r\n                      borderColor: scheme.accent,\r\n                      backgroundColor: zenMode\r\n                        ? `${scheme.accent}22`\r\n                        : 'transparent',\r\n                    }}\r\n                    title={\r\n                      zenMode ? 'Exit Zen Mode' : 'Zen Mode: Hide distractions'\r\n                    }\r\n                  >\r\n                    {zenMode ? '👁️ Exit Zen' : '🧘 Zen Mode'}\r\n                  </button>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </header>\r\n        )}\r\n\r\n        <div\r\n          className={article || hasPassage ? 'ged-split-view' : ''}\r\n          style={{\r\n            backgroundColor: zenMode ? '#1a1a1a' : 'transparent',\r\n            borderRadius: zenMode ? '1rem' : '0',\r\n            padding: zenMode ? '2rem' : '0',\r\n            transition: 'all 0.3s ease',\r\n          }}\r\n        >\r\n          {(article || hasPassage) && (\r\n            <div\r\n              className=\"passage-pane mb-6 lg:mb-0\"\r\n              style={{\r\n                backgroundColor: scheme.surfaceStrong,\r\n                border: `1px solid ${scheme.surfaceBorder}`,\r\n                borderRadius: '0.75rem',\r\n                padding: '1rem',\r\n              }}\r\n            >\r\n              <div className=\"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between lg:hidden\">\r\n                <div>\r\n                  <h3\r\n                    className=\"text-lg font-semibold\"\r\n                    style={{ color: scheme.text }}\r\n                  >\r\n                    {article ? 'Reading Passage' : 'Passage'}\r\n                  </h3>\r\n                </div>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setShowArticle((prev) => !prev)}\r\n                  className=\"inline-flex items-center gap-2 rounded-md px-3 py-1 text-sm font-semibold transition-colors\"\r\n                  style={{\r\n                    color: scheme.accentText,\r\n                    backgroundColor: scheme.accent,\r\n                    border: `1px solid ${scheme.accent}`,\r\n                  }}\r\n                >\r\n                  {showArticle ? 'Hide Passage' : 'Show Passage'}\r\n                </button>\r\n              </div>\r\n\r\n              {/* Always show on desktop (split view), toggle on mobile */}\r\n              <div className={showArticle ? 'block' : 'hidden lg:block'}>\r\n                <div className=\"mt-3 space-y-3 text-sm leading-relaxed\">\r\n                  {article ? (\r\n                    <>\r\n                      {article.title && (\r\n                        <h4\r\n                          className=\"text-base font-bold\"\r\n                          style={{ color: scheme.text }}\r\n                          dangerouslySetInnerHTML={{\r\n                            __html: sanitizeHtmlContent(article.title, {\r\n                              normalizeSpacing: true,\r\n                            }),\r\n                          }}\r\n                        />\r\n                      )}\r\n                      {(article.imageUrl || articleImage) &&\r\n                        (() => {\r\n                          const rawImg = article.imageUrl || articleImage;\r\n                          const imgSrc = resolveAssetUrl(rawImg);\r\n                          return imgSrc ? (\r\n                            <img\r\n                              src={imgSrc}\r\n                              alt={\r\n                                article.imageAlt ||\r\n                                article.title ||\r\n                                'Reading passage illustration'\r\n                              }\r\n                              className=\"max-h-40 w-full rounded-lg object-cover\"\r\n                              style={{\r\n                                border: '1px solid var(--border-subtle)',\r\n                              }}\r\n                            />\r\n                          ) : null;\r\n                        })()}\r\n                      {(article.text || []).map((paragraph, index) => (\r\n                        <p\r\n                          key={index}\r\n                          className=\"text-sm\"\r\n                          style={{ color: scheme.text }}\r\n                          dangerouslySetInnerHTML={{\r\n                            __html: sanitizeHtmlContent(paragraph, {\r\n                              normalizeSpacing: true,\r\n                            }),\r\n                          }}\r\n                        />\r\n                      ))}\r\n                    </>\r\n                  ) : hasPassage ? (\r\n                    <div\r\n                      dangerouslySetInnerHTML={{\r\n                        __html: sanitizeHtmlContent(passageContent, {\r\n                          normalizeSpacing: true,\r\n                        }),\r\n                      }}\r\n                      style={{ color: scheme.text }}\r\n                    />\r\n                  ) : null}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"question-pane\">\r\n            <div className=\"mb-4 flex flex-wrap gap-2 quiz-nav\">\r\n              {questions.map((_, i) => {\r\n                const isActive = i === currentIndex;\r\n                const isAnswered = Boolean(answers[i]);\r\n                const navStyle = isActive\r\n                  ? {\r\n                      backgroundColor: scheme.background,\r\n                      color: scheme.onBackgroundText,\r\n                    }\r\n                  : isAnswered\r\n                  ? {\r\n                      backgroundColor: scheme.navAnsweredBg,\r\n                      color: scheme.navAnsweredText,\r\n                    }\r\n                  : {\r\n                      backgroundColor: scheme.navDefaultBg,\r\n                      color: scheme.navDefaultText,\r\n                    };\r\n                if (marked[i]) {\r\n                  navStyle.boxShadow = `0 0 0 2px ${scheme.navMarkedRing}`;\r\n                }\r\n                return (\r\n                  <button\r\n                    key={i}\r\n                    onClick={() => setCurrentIndex(i)}\r\n                    className=\"h-8 w-8 rounded-full text-sm font-bold transition\"\r\n                    style={navStyle}\r\n                  >\r\n                    {i + 1}\r\n                  </button>\r\n                );\r\n              })}\r\n            </div>\r\n\r\n            <div\r\n              className=\"question-container rounded-xl p-4 sm:p-6 shadow-inner\"\r\n              data-subject={quizSubject}\r\n              style={{\r\n                border: `1px solid ${scheme.surfaceBorder}`,\r\n                backgroundColor: scheme.surfaceStrong || scheme.surface,\r\n              }}\r\n            >\r\n              {currentQ.clusterLabel && (\r\n                <div\r\n                  className=\"mb-3 rounded-md border px-3 py-2 text-sm\"\r\n                  style={{\r\n                    borderColor: scheme.surfaceBorder,\r\n                    backgroundColor: scheme.surface,\r\n                    color: scheme.mutedText,\r\n                  }}\r\n                >\r\n                  <span\r\n                    className=\"font-semibold\"\r\n                    style={{ color: scheme.text }}\r\n                  >\r\n                    Scenario:\r\n                  </span>{' '}\r\n                  {currentQ.clusterLabel}\r\n                </div>\r\n              )}\r\n              <div className=\"mb-4\">\r\n                <div className=\"flex items-start gap-3\">\r\n                  <span\r\n                    className=\"text-xl font-semibold leading-relaxed\"\r\n                    style={{ color: scheme.text }}\r\n                  >\r\n                    {currentIndex + 1}.\r\n                  </span>\r\n                  <Stem item={currentQ} />\r\n                </div>\r\n              </div>\r\n              {(() => {\r\n                const rawImgSrc =\r\n                  !currentQ.stimulusImage?.src && currentQ.imageUrl\r\n                    ? currentQ.imageUrl\r\n                    : null;\r\n                const imgSrc = resolveAssetUrl(rawImgSrc);\r\n                return imgSrc ? (\r\n                  <img\r\n                    src={imgSrc}\r\n                    alt={`Visual for question ${currentQ.questionNumber}`}\r\n                    className=\"my-4 h-auto max-w-full rounded-md\"\r\n                    style={{ border: `1px solid ${scheme.surfaceBorder}` }}\r\n                    onError={(e) => {\r\n                      if (e.target.dataset.fallbackApplied) {\r\n                        e.target.style.display = 'none';\r\n                        return;\r\n                      }\r\n                      e.target.dataset.fallbackApplied = '1';\r\n                      const src = e.target.getAttribute('src') || '';\r\n                      const origin =\r\n                        (typeof window !== 'undefined' &&\r\n                          window.location &&\r\n                          window.location.origin) ||\r\n                        '';\r\n                      const idx = src.indexOf('/Images/');\r\n                      if (idx !== -1) {\r\n                        const rel = src\r\n                          .substring(idx)\r\n                          .replace('/Images/', '/frontend/Images/');\r\n                        e.target.src = origin + rel;\r\n                      } else {\r\n                        e.target.style.display = 'none';\r\n                      }\r\n                    }}\r\n                  />\r\n                ) : null;\r\n              })()}\r\n              {GEOMETRY_FIGURES_ENABLED && currentQ.geometrySpec && (\r\n                <div\r\n                  className=\"my-4 mx-auto max-w-md rounded-md p-4 shadow-sm bg-white text-black dark:bg-slate-900 dark:text-slate-100\"\r\n                  style={{ border: `1px solid ${scheme.surfaceBorder}` }}\r\n                >\r\n                  <GeometryFigure\r\n                    spec={currentQ.geometrySpec}\r\n                    className=\"w-full h-auto\"\r\n                  />\r\n                </div>\r\n              )}\r\n\r\n              {/* Interactive tool panel (conditionally rendered; disabled via flag) */}\r\n              {TOOL_PANEL_ENABLED && needsToolPanel && (\r\n                <div\r\n                  id=\"interactive-tool-panel\"\r\n                  ref={toolPanelRef}\r\n                  className=\"quiz-tool-panel my-4 rounded-lg\"\r\n                  role=\"region\"\r\n                  aria-label=\"Interactive math tool\"\r\n                  style={{\r\n                    backgroundColor: scheme.surface,\r\n                    border: `1px dashed ${scheme.surfaceBorder}`,\r\n                    padding: '0.75rem',\r\n                  }}\r\n                />\r\n              )}\r\n\r\n              {isShortResponse ? (\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"short-response-answer\"\r\n                    className=\"mb-1 block text-sm font-medium\"\r\n                    style={{ color: scheme.mutedText }}\r\n                  >\r\n                    Enter a short constructed response (2–4 sentences):\r\n                  </label>\r\n                  <textarea\r\n                    id=\"short-response-answer\"\r\n                    value={answers[currentIndex] || ''}\r\n                    onChange={handleInputChange}\r\n                    rows={5}\r\n                    className=\"w-full rounded-lg p-3 text-base leading-relaxed focus:outline-none\"\r\n                    style={{\r\n                      border: `1px solid ${scheme.inputBorder}`,\r\n                      color: scheme.text,\r\n                      backgroundColor: scheme.surface,\r\n                      resize: 'vertical',\r\n                    }}\r\n                    placeholder=\"Type your response and reference the passage or data when possible.\"\r\n                  />\r\n                  <p\r\n                    className=\"mt-2 text-xs\"\r\n                    style={{ color: scheme.mutedText }}\r\n                  >\r\n                    These items are scored manually. Focus on evidence and clear\r\n                    reasoning.\r\n                  </p>\r\n                  {(() => {\r\n                    const rubricHints = Array.isArray(currentQ.expectedFeatures)\r\n                      ? currentQ.expectedFeatures\r\n                      : Array.isArray(currentQ.rubricHints)\r\n                      ? currentQ.rubricHints\r\n                      : [];\r\n                    const sampleAnswer =\r\n                      typeof currentQ.sampleAnswer === 'string'\r\n                        ? currentQ.sampleAnswer.trim()\r\n                        : '';\r\n                    if (!rubricHints.length && !sampleAnswer) return null;\r\n                    return (\r\n                      <div\r\n                        className=\"mt-4 rounded-lg border p-3 text-sm\"\r\n                        style={{\r\n                          borderColor: scheme.surfaceBorder,\r\n                          backgroundColor: scheme.surface,\r\n                        }}\r\n                      >\r\n                        {rubricHints.length > 0 && (\r\n                          <div>\r\n                            <p\r\n                              className=\"font-semibold\"\r\n                              style={{ color: scheme.text }}\r\n                            >\r\n                              Rubric checklist\r\n                            </p>\r\n                            <ul className=\"mt-2 list-disc pl-5 space-y-1\">\r\n                              {rubricHints.map((hint, idx) => (\r\n                                <li\r\n                                  key={idx}\r\n                                  className=\"text-xs\"\r\n                                  style={{ color: scheme.mutedText }}\r\n                                >\r\n                                  {hint}\r\n                                </li>\r\n                              ))}\r\n                            </ul>\r\n                          </div>\r\n                        )}\r\n                        {sampleAnswer && (\r\n                          <details\r\n                            className=\"mt-3 text-xs\"\r\n                            style={{ color: scheme.mutedText }}\r\n                          >\r\n                            <summary className=\"cursor-pointer font-semibold\">\r\n                              View sample answer\r\n                            </summary>\r\n                            <p\r\n                              className=\"mt-2 leading-relaxed\"\r\n                              style={{ color: scheme.text }}\r\n                            >\r\n                              {sampleAnswer}\r\n                            </p>\r\n                          </details>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })()}\r\n                </div>\r\n              ) : isFillInTheBlank || isNumericEntry ? (\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"fill-in-blank-answer\"\r\n                    className=\"mb-1 block text-sm font-medium\"\r\n                    style={{ color: scheme.mutedText }}\r\n                  >\r\n                    {isNumericEntry\r\n                      ? 'Enter your numeric answer:'\r\n                      : 'Enter your answer:'}\r\n                  </label>\r\n                  {(isNumericEntry ||\r\n                    (/science|math/i.test(subject || quiz?.subject || '') &&\r\n                      !Array.isArray(currentQ.answerOptions) &&\r\n                      !currentQ.answerOptions?.length)) && (\r\n                    <p\r\n                      className=\"mb-2 text-xs\"\r\n                      style={{\r\n                        color: 'var(--warning-text)',\r\n                        backgroundColor: 'var(--warning-bg)',\r\n                        padding: '0.5rem',\r\n                        borderRadius: '0.375rem',\r\n                        border: '1px solid var(--warning-border)',\r\n                      }}\r\n                    >\r\n                      ⚠️ Numeric answers only. Enter numbers, decimals, or\r\n                      fractions (e.g., 42, 3.14, 1/2, 25%).\r\n                    </p>\r\n                  )}\r\n                  {/* Use MathInputWithPad for Math subjects */}\r\n                  {/math/i.test(subject || quiz?.subject || '') ? (\r\n                    <MathInputWithPad\r\n                      value={answers[currentIndex] || ''}\r\n                      onChange={(newValue) => {\r\n                        const newAnswers = [...answers];\r\n                        newAnswers[currentIndex] = newValue;\r\n                        setAnswers(newAnswers);\r\n                      }}\r\n                      placeholder={\r\n                        isNumericEntry\r\n                          ? 'Enter a number (e.g., 3.5 or 3/4)'\r\n                          : 'Type your answer here'\r\n                      }\r\n                      disabled={false}\r\n                    />\r\n                  ) : (\r\n                    <input\r\n                      id=\"fill-in-blank-answer\"\r\n                      type={isNumericEntry ? 'text' : 'text'}\r\n                      inputMode={isNumericEntry ? 'decimal' : 'text'}\r\n                      value={answers[currentIndex] || ''}\r\n                      onChange={handleInputChange}\r\n                      onKeyDown={(e) => {\r\n                        if (e.key === 'Enter') {\r\n                          e.preventDefault();\r\n                          if (currentIndex === questions.length - 1) {\r\n                            handleSubmit();\r\n                          } else {\r\n                            setCurrentIndex((p) =>\r\n                              Math.min(questions.length - 1, p + 1)\r\n                            );\r\n                          }\r\n                        }\r\n                      }}\r\n                      placeholder={\r\n                        isNumericEntry\r\n                          ? 'Enter a number (e.g., 3.5 or 3/4)'\r\n                          : 'Type your answer here'\r\n                      }\r\n                      className=\"w-full max-w-sm rounded-lg p-3 focus:outline-none\"\r\n                      style={{\r\n                        border: `1px solid ${scheme.inputBorder}`,\r\n                        color: scheme.text,\r\n                      }}\r\n                    />\r\n                  )}\r\n                </div>\r\n              ) : currentQ.itemType === 'inline_dropdown' &&\r\n                currentQ.passageWithPlaceholders ? (\r\n                // RLA Part 3: Inline Dropdown (Cloze) passage\r\n                <div>\r\n                  <p\r\n                    className=\"mb-4 text-sm font-medium\"\r\n                    style={{ color: scheme.mutedText }}\r\n                  >\r\n                    Select the best option for each dropdown to complete the\r\n                    passage correctly.\r\n                  </p>\r\n                  <InlineDropdownPassage\r\n                    passageText={currentQ.passageWithPlaceholders}\r\n                    questions={questions.filter(\r\n                      (q) =>\r\n                        q.itemType === 'inline_dropdown' &&\r\n                        q.passage === currentQ.passage\r\n                    )}\r\n                    answers={answers}\r\n                    onAnswerChange={(index, value) => {\r\n                      const newAnswers = [...answers];\r\n                      newAnswers[index] = value;\r\n                      setAnswers(newAnswers);\r\n                    }}\r\n                  />\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-3\">\r\n                  {/* Multi-select instruction */}\r\n                  {isMultipleSelect && (\r\n                    <p\r\n                      className=\"mb-3 text-sm font-medium px-3 py-2 rounded-lg\"\r\n                      style={{\r\n                        color: scheme.accentText,\r\n                        backgroundColor: scheme.accentSoft,\r\n                        border: `1px solid ${scheme.accentBorder}`,\r\n                      }}\r\n                    >\r\n                      ℹ️ Select ALL correct answers. Multiple answers may be\r\n                      correct.\r\n                    </p>\r\n                  )}\r\n                  {(currentQ.answerOptions || []).map((opt, i) => {\r\n                    // Handle both string and object formats for answerOptions\r\n                    const optText =\r\n                      typeof opt === 'string' ? opt : opt?.text || '';\r\n                    const cleanedOptionText =\r\n                      typeof optText === 'string'\r\n                        ? optText.trim().replace(/^\\$\\$/, '$')\r\n                        : '';\r\n                    // MULTIPLE-SELECT ENHANCEMENT: Check if option is selected (works for both modes)\r\n                    const isSelected = selectedOptions.includes(optText);\r\n                    const optionStyles = {};\r\n                    if (isSelected) {\r\n                      optionStyles.backgroundColor = scheme.optionSelectedBg;\r\n                      optionStyles.borderColor = scheme.optionSelectedBorder;\r\n                      optionStyles.color = scheme.accentText;\r\n                    }\r\n                    // MULTIPLE-SELECT ENHANCEMENT: Add class for multiple-select mode\r\n                    const optionClassNames = [\r\n                      'option',\r\n                      'answer-option',\r\n                      'w-full',\r\n                      'text-left',\r\n                      'transition',\r\n                      isMultipleSelect ? 'multiple-select' : '',\r\n                    ];\r\n                    if (isSelected) {\r\n                      optionClassNames.push('selected');\r\n                    }\r\n                    return (\r\n                      <button\r\n                        key={i}\r\n                        onClick={() => handleSelect(optText)}\r\n                        className={optionClassNames.join(' ')}\r\n                        style={optionStyles}\r\n                      >\r\n                        {/* MULTIPLE-SELECT: Show checkbox icon for multi-select questions */}\r\n                        {isMultipleSelect && (\r\n                          <span\r\n                            className=\"mr-2 text-lg\"\r\n                            style={{\r\n                              color: isSelected\r\n                                ? scheme.accent\r\n                                : scheme.mutedText,\r\n                            }}\r\n                          >\r\n                            {isSelected ? '☑' : '☐'}\r\n                          </span>\r\n                        )}\r\n                        <span\r\n                          className=\"flex-grow text-left\"\r\n                          style={{ color: scheme.text }}\r\n                        >\r\n                          <span className=\"mr-2 font-bold\">\r\n                            {String.fromCharCode(65 + i)}.\r\n                          </span>\r\n                          <span\r\n                            className=\"question-stem\"\r\n                            dangerouslySetInnerHTML={renderQuestionTextForDisplay(\r\n                              cleanedOptionText,\r\n                              currentQ.isPremade === true,\r\n                              currentQ\r\n                            )}\r\n                          />\r\n                        </span>\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* CONFIDENCE TRACKING */}\r\n            <div className=\"confidence-toggle mt-4\">\r\n              <button\r\n                onClick={() => handleConfidenceSelect('sure')}\r\n                className={`confidence-btn sure ${\r\n                  confidence[currentIndex] === 'sure' ? 'active' : ''\r\n                }`}\r\n              >\r\n                ✓ I'm Sure\r\n              </button>\r\n              <button\r\n                onClick={() => handleConfidenceSelect('guessing')}\r\n                className={`confidence-btn guessing ${\r\n                  confidence[currentIndex] === 'guessing' ? 'active' : ''\r\n                }`}\r\n              >\r\n                ? I'm Guessing\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"mt-6 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between\">\r\n              <button\r\n                onClick={() => setCurrentIndex((p) => Math.max(0, p - 1))}\r\n                disabled={currentIndex === 0}\r\n                className=\"rounded-md px-4 py-2 font-semibold transition\"\r\n                data-role=\"secondary\"\r\n                style={{\r\n                  borderColor: scheme.surfaceBorder,\r\n                  color: scheme.mutedText,\r\n                  opacity: currentIndex === 0 ? 0.6 : 1,\r\n                }}\r\n              >\r\n                Previous\r\n              </button>\r\n              <button\r\n                onClick={() =>\r\n                  setMarked((m) => {\r\n                    const newM = [...m];\r\n                    newM[currentIndex] = !newM[currentIndex];\r\n                    return newM;\r\n                  })\r\n                }\r\n                className=\"rounded-md px-4 py-2 font-semibold transition\"\r\n                style={\r\n                  marked[currentIndex]\r\n                    ? {\r\n                        backgroundColor: scheme.navMarkedRing,\r\n                        color: scheme.onBackgroundText,\r\n                        border: `1px solid ${scheme.navMarkedRing}`,\r\n                      }\r\n                    : {\r\n                        backgroundColor: scheme.navDefaultBg,\r\n                        color: scheme.navDefaultText,\r\n                        border: `1px solid ${scheme.navDefaultBg}`,\r\n                      }\r\n                }\r\n              >\r\n                {marked[currentIndex] ? 'Unmark' : 'Mark'} for Review\r\n              </button>\r\n              {currentIndex === questions.length - 1 ? (\r\n                <button\r\n                  onClick={handleSubmit}\r\n                  className=\"rounded-md px-4 py-2 font-semibold\"\r\n                  data-role=\"primary\"\r\n                  style={{\r\n                    backgroundColor: scheme.accent,\r\n                    color: scheme.accentText,\r\n                    borderColor: scheme.accent,\r\n                  }}\r\n                >\r\n                  {buttonText || 'Finish'}\r\n                </button>\r\n              ) : (\r\n                <button\r\n                  onClick={() =>\r\n                    setCurrentIndex((p) =>\r\n                      Math.min(questions.length - 1, p + 1)\r\n                    )\r\n                  }\r\n                  className=\"rounded-md px-4 py-2 font-semibold\"\r\n                  data-role=\"primary\"\r\n                  style={{\r\n                    backgroundColor: scheme.accent,\r\n                    color: scheme.accentText,\r\n                    borderColor: scheme.accent,\r\n                  }}\r\n                >\r\n                  Next\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction StandardQuizRunner({ quiz, onComplete, onExit }) {\r\n  const questions = quiz.questions || [];\r\n  const [answers, setAnswers] = useState(Array(questions.length).fill(null));\r\n\r\n  // --- Math Answer Normalization & Equivalence Helpers (Fill-in-the-Blank) ---\r\n  // Lightweight parser supporting: fractions (a/b), mixed numbers (a b/c), ratios (a:b), percents (50%), currency ($1,050.25),\r\n  // comma-separated multi answers (\"18,19\"), decimals, integers, tolerating whitespace & leading zeros.\r\n  const MATH_EQUIV = {\r\n    // Configurable numeric tolerance for float comparisons\r\n    EPS: 1e-9,\r\n    // Percent – decimal conversion regex\r\n    PERCENT_RE: /^[-+]?\\d+(?:\\.\\d+)?%$/,\r\n    // Currency detection\r\n    CURRENCY_RE: /^\\$\\s*[-+]?\\d{1,3}(?:,\\d{3})*(?:\\.\\d+)?$/,\r\n    // Fraction (simple) a/b\r\n    FRACTION_RE: /^[-+]?\\d+\\s*\\/\\s*\\d+$/,\r\n    // Mixed number: a b/c (allow sign on first part)\r\n    MIXED_RE: /^[-+]?\\d+\\s+\\d+\\s*\\/\\s*\\d+$/,\r\n    // Ratio a:b (integers only)\r\n    RATIO_RE: /^[-+]?\\d+\\s*:\\s*[-+]?\\d+$/,\r\n    // Multi-answer list separated by comma\r\n    MULTI_SPLIT_RE: /\\s*,\\s*/,\r\n  };\r\n\r\n  const normalizeRaw = (val) => {\r\n    if (val === null || val === undefined) return '';\r\n    return String(val)\r\n      .replace(/\\u00A0/g, ' ') // non-breaking space\r\n      .replace(/\\s+/g, ' ') // collapse internal whitespace\r\n      .trim();\r\n  };\r\n\r\n  const stripCurrency = (s) => s.replace(/^\\$/, '').replace(/,/g, '');\r\n  const parseFraction = (s) => {\r\n    const [a, b] = s.split('/').map((t) => t.trim());\r\n    const num = Number(a),\r\n      den = Number(b);\r\n    if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0)\r\n      return null;\r\n    return num / den;\r\n  };\r\n  const parseMixed = (s) => {\r\n    const parts = s.split(/\\s+/);\r\n    if (parts.length < 2) return null;\r\n    const whole = Number(parts[0]);\r\n    const frac = parseFraction(parts.slice(1).join(' '));\r\n    if (frac === null || !Number.isFinite(whole)) return null;\r\n    return whole >= 0 ? whole + frac : whole - frac; // sign on whole applies\r\n  };\r\n  const parsePercent = (s) => {\r\n    const num = Number(s.replace('%', ''));\r\n    return Number.isFinite(num) ? num / 100 : null;\r\n  };\r\n  const parseCurrency = (s) => {\r\n    const num = Number(stripCurrency(s));\r\n    return Number.isFinite(num) ? num : null;\r\n  };\r\n  const parseRatio = (s) => {\r\n    const [a, b] = s.split(':').map((t) => t.trim());\r\n    const na = Number(a),\r\n      nb = Number(b);\r\n    if (!Number.isFinite(na) || !Number.isFinite(nb) || nb === 0) return null;\r\n    return na / nb;\r\n  };\r\n\r\n  const numericValue = (raw) => {\r\n    const s = normalizeRaw(raw);\r\n    if (!s) return null;\r\n    if (MATH_EQUIV.PERCENT_RE.test(s)) return parsePercent(s);\r\n    if (MATH_EQUIV.CURRENCY_RE.test(s)) return parseCurrency(s);\r\n    if (MATH_EQUIV.MIXED_RE.test(s)) return parseMixed(s);\r\n    if (MATH_EQUIV.FRACTION_RE.test(s)) return parseFraction(s);\r\n    if (MATH_EQUIV.RATIO_RE.test(s)) return parseRatio(s);\r\n    // plain number (allow commas)\r\n    const plain = s.replace(/,/g, '');\r\n    const num = Number(plain);\r\n    return Number.isFinite(num) ? num : null;\r\n  };\r\n\r\n  // Produce canonical string tokens for multi-answer sets (order-insensitive) or single answer.\r\n  const canonicalTokens = (raw) => {\r\n    const s = normalizeRaw(raw);\r\n    if (!s) return [];\r\n    // Multi-answer if comma present\r\n    if (s.includes(',')) {\r\n      return s\r\n        .split(MATH_EQUIV.MULTI_SPLIT_RE)\r\n        .filter(Boolean)\r\n        .map((t) => normalizeRaw(t));\r\n    }\r\n    return [s];\r\n  };\r\n\r\n  const areTokenSetsEqual = (expTokens, userTokens) => {\r\n    if (expTokens.length !== userTokens.length) return false;\r\n    const a = [...expTokens].sort();\r\n    const b = [...userTokens].sort();\r\n    return a.every((v, i) => v === b[i]);\r\n  };\r\n\r\n  const isNumericEqual = (a, b) => {\r\n    const na = numericValue(a);\r\n    const nb = numericValue(b);\r\n    if (na === null || nb === null) return false;\r\n    return Math.abs(na - nb) < MATH_EQUIV.EPS;\r\n  };\r\n\r\n  const isEquivalentAnswer = (expected, user) => {\r\n    const e = normalizeRaw(expected);\r\n    const u = normalizeRaw(user);\r\n    if (!e || !u) return false;\r\n    if (e === u) return true; // exact match quick path\r\n    // Numeric equivalence (covers fraction/decimal/percent/ratio/currency)\r\n    if (isNumericEqual(e, u)) return true;\r\n    // Multi-answer comparison (e.g. \"18,19\" vs \"19,18\")\r\n    if (e.includes(',') || u.includes(',')) {\r\n      return areTokenSetsEqual(canonicalTokens(e), canonicalTokens(u));\r\n    }\r\n    // Ratio vs fraction equivalence: treat ratio numeric already handled by numericValue\r\n    return false;\r\n  };\r\n\r\n  // Helper: check if a fill-in question is correct\r\n  const checkFillInQuestionCorrect = (q, userAns) => {\r\n    return isEquivalentAnswer(q.correctAnswer, userAns);\r\n  };\r\n\r\n  // NUMERIC ENTRY ENHANCEMENT: Check numeric questions with optional tolerance\r\n  const checkNumericQuestionCorrect = (q, userAns) => {\r\n    if (!q.correctAnswer || !userAns) return false;\r\n\r\n    const correctVal = numericValue(q.correctAnswer);\r\n    const userVal = numericValue(userAns);\r\n\r\n    if (correctVal === null || userVal === null) return false;\r\n\r\n    // Check if tolerance is specified\r\n    const tolerance =\r\n      typeof q.tolerance === 'number' && q.tolerance >= 0 ? q.tolerance : 0;\r\n\r\n    return Math.abs(userVal - correctVal) <= tolerance;\r\n  };\r\n\r\n  const handleComplete = (result) => {\r\n    // 1) helper: normalize text\r\n    const normalizeText = (val) => (val ?? '').toString().trim().toLowerCase();\r\n\r\n    // 2) compute earned/possible with weights, all-or-nothing\r\n    let earnedPoints = 0;\r\n    let possiblePoints = 0;\r\n    const manualShortResponseIndexes = [];\r\n\r\n    (quiz.questions || []).forEach((q, idx) => {\r\n      if (isShortResponseQuestion(q)) {\r\n        manualShortResponseIndexes.push(idx);\r\n        return;\r\n      }\r\n      const pts = typeof q.points === 'number' && q.points > 0 ? q.points : 1;\r\n      possiblePoints += pts;\r\n\r\n      const userAns = result.answers[idx];\r\n\r\n      let isCorrect = false;\r\n\r\n      // NUMERIC ENTRY ENHANCEMENT: Check numeric entry questions first\r\n      if (q.type === 'numeric' || q.responseType === 'numeric') {\r\n        isCorrect = checkNumericQuestionCorrect(q, userAns);\r\n      } else if (Array.isArray(q.answerOptions) && q.answerOptions.length > 0) {\r\n        // multiple-choice / multi-select\r\n        const correctOpts = q.answerOptions.filter((o) => o && o.isCorrect);\r\n        if (correctOpts.length === 1) {\r\n          // single correct - use enhanced comparison for math questions\r\n          const correctText = correctOpts[0].text;\r\n          isCorrect = compareAnswers(correctText, userAns, {\r\n            subject: quiz.subject,\r\n            questionType: q.type,\r\n          });\r\n        } else if (correctOpts.length > 1) {\r\n          // multi-correct, all-or-nothing\r\n          const correctSet = correctOpts\r\n            .map((o) => normalizeText(o.text))\r\n            .sort();\r\n          const userSet = (Array.isArray(userAns) ? userAns : [userAns])\r\n            .map((v) => normalizeText(v))\r\n            .filter(Boolean)\r\n            .sort();\r\n          if (userSet.length === correctSet.length) {\r\n            isCorrect = userSet.every((val, i) => val === correctSet[i]);\r\n          } else {\r\n            isCorrect = false;\r\n          }\r\n        }\r\n      } else {\r\n        // fill-in questions - use enhanced comparison\r\n        isCorrect = compareAnswers(q.correctAnswer, userAns, {\r\n          subject: quiz.subject,\r\n          questionType: q.type,\r\n        });\r\n      }\r\n\r\n      if (isCorrect) {\r\n        earnedPoints += pts;\r\n      }\r\n    });\r\n\r\n    // 3) percentage from points\r\n    const percentage =\r\n      possiblePoints > 0 ? (earnedPoints / possiblePoints) * 100 : 0;\r\n\r\n    // 4) GED-ish scaling: 3 segments\r\n    let scaledScore;\r\n    if (percentage <= 40) {\r\n      // 0–40% => 100–135\r\n      scaledScore = 100 + (percentage / 40) * 35;\r\n    } else if (percentage <= 65) {\r\n      // 40–65% => 135–145\r\n      scaledScore = 135 + ((percentage - 40) / 25) * 10;\r\n    } else {\r\n      // 65–100% => 145–200\r\n      scaledScore = 145 + ((percentage - 65) / 35) * 55;\r\n    }\r\n    scaledScore = Math.round(scaledScore);\r\n\r\n    // 5) pass is still 145\r\n    const passed = scaledScore >= 145;\r\n\r\n    onComplete({\r\n      score: earnedPoints,\r\n      totalQuestions: possiblePoints, // we're using points here\r\n      percentage,\r\n      scaledScore,\r\n      passed,\r\n      subject: quiz.subject,\r\n      answers: result.answers, // include user answers for results screen\r\n      marked: result.marked,\r\n      confidence: result.confidence,\r\n      manualShortResponseIndexes,\r\n      quiz,\r\n    });\r\n  };\r\n\r\n  return (\r\n    <QuizInterface\r\n      questions={questions}\r\n      answers={answers}\r\n      setAnswers={setAnswers}\r\n      onComplete={handleComplete}\r\n      quizTitle={quiz.title}\r\n      onExit={onExit}\r\n      timeLimit={quiz.timeLimit}\r\n      subject={quiz.subject}\r\n      quizConfig={quiz.config}\r\n      article={quiz.article}\r\n      articleImage={quiz.imageUrl}\r\n    />\r\n  );\r\n}\r\n\r\nfunction MultiPartMathRunner({ quiz, onComplete, onExit }) {\r\n  const [part, setPart] = useState(1);\r\n  const [part1Result, setPart1Result] = useState(null);\r\n\r\n  const part1Questions = quiz.questions.slice(0, 5);\r\n  const part2Questions = quiz.questions.slice(5);\r\n\r\n  const [part1Answers, setPart1Answers] = useState(\r\n    Array(part1Questions.length).fill(null)\r\n  );\r\n  const [part2Answers, setPart2Answers] = useState(\r\n    Array(part2Questions.length).fill(null)\r\n  );\r\n\r\n  const handlePart1Complete = (result) => {\r\n    setPart1Result(result);\r\n    setPart('interstitial'); // Go to interstitial screen\r\n  };\r\n\r\n  const handlePart2Complete = (result) => {\r\n    // Defensive merging in case part1Result is null/partial\r\n    const p1 = part1Result || {\r\n      answers: Array(part1Questions.length).fill(null),\r\n      marked: Array(part1Questions.length).fill(false),\r\n      confidence: Array(part1Questions.length).fill(null),\r\n    };\r\n\r\n    const finalAnswers = [...(p1.answers || []), ...(result.answers || [])];\r\n    const finalMarked = [...(p1.marked || []), ...(result.marked || [])];\r\n    const finalConfidence = [\r\n      ...(p1.confidence || []),\r\n      ...(result.confidence || []),\r\n    ];\r\n\r\n    // Robust equivalence (match StandardQuizRunner helpers)\r\n    const normalizeRaw = (val) => {\r\n      if (val === null || val === undefined) return '';\r\n      return String(val)\r\n        .replace(/\\u00A0/g, ' ')\r\n        .replace(/\\s+/g, ' ')\r\n        .trim();\r\n    };\r\n    const numericValue = (raw) => {\r\n      const s = normalizeRaw(raw);\r\n      if (!s) return null;\r\n      if (/^[-+]?\\d+(?:\\.\\d+)?%$/.test(s)) {\r\n        const n = Number(s.replace('%', ''));\r\n        return Number.isFinite(n) ? n / 100 : null;\r\n      }\r\n      if (/^\\$\\s*[-+]?\\d{1,3}(?:,\\d{3})*(?:\\.\\d+)?$/.test(s)) {\r\n        const n = Number(s.replace(/^\\$/, '').replace(/,/g, ''));\r\n        return Number.isFinite(n) ? n : null;\r\n      }\r\n      if (/^[-+]?\\d+\\s+\\d+\\s*\\/\\s*\\d+$/.test(s)) {\r\n        const parts = s.split(/\\s+/);\r\n        const whole = Number(parts[0]);\r\n        const fracParts = parts.slice(1).join(' ').split('/');\r\n        const num = Number(fracParts[0]);\r\n        const den = Number(fracParts[1]);\r\n        if (\r\n          !Number.isFinite(whole) ||\r\n          !Number.isFinite(num) ||\r\n          !Number.isFinite(den) ||\r\n          den === 0\r\n        )\r\n          return null;\r\n        const frac = num / den;\r\n        return whole >= 0 ? whole + frac : whole - frac;\r\n      }\r\n      if (/^[-+]?\\d+\\s*\\/\\s*\\d+$/.test(s)) {\r\n        const [a, b] = s.split('/').map((t) => t.trim());\r\n        const num = Number(a),\r\n          den = Number(b);\r\n        if (!Number.isFinite(num) || !Number.isFinite(den) || den === 0)\r\n          return null;\r\n        return num / den;\r\n      }\r\n      if (/^[-+]?\\d+\\s*:\\s*[-+]?\\d+$/.test(s)) {\r\n        const [a, b] = s.split(':').map((t) => t.trim());\r\n        const na = Number(a),\r\n          nb = Number(b);\r\n        if (!Number.isFinite(na) || !Number.isFinite(nb) || nb === 0)\r\n          return null;\r\n        return na / nb;\r\n      }\r\n      const plain = s.replace(/,/g, '');\r\n      const num = Number(plain);\r\n      return Number.isFinite(num) ? num : null;\r\n    };\r\n    const isNumericEqual = (a, b) => {\r\n      const na = numericValue(a),\r\n        nb = numericValue(b);\r\n      return na !== null && nb !== null && Math.abs(na - nb) < 1e-9;\r\n    };\r\n    const tokenize = (raw) => {\r\n      const s = normalizeRaw(raw);\r\n      if (!s) return [];\r\n      if (s.includes(','))\r\n        return s\r\n          .split(/\\s*,\\s*/)\r\n          .filter(Boolean)\r\n          .map(normalizeRaw);\r\n      return [s];\r\n    };\r\n    const setsEqual = (a, b) => {\r\n      if (a.length !== b.length) return false;\r\n      const sa = [...a].sort();\r\n      const sb = [...b].sort();\r\n      return sa.every((v, i) => v === sb[i]);\r\n    };\r\n\r\n    let score = 0;\r\n    const missing = [];\r\n    quiz.questions.forEach((q, i) => {\r\n      const isFillIn =\r\n        !q.answerOptions ||\r\n        q.answerOptions.length === 0 ||\r\n        q.type === 'fill-in-the-blank';\r\n      if (!isFillIn) {\r\n        const correctOpt = findCorrectOption(q.answerOptions);\r\n        if (correctOpt && finalAnswers[i] === correctOpt.text) {\r\n          score++;\r\n        }\r\n      } else {\r\n        const user = normalizeRaw(finalAnswers[i]);\r\n        const correct = normalizeRaw(q.correctAnswer);\r\n        if (!user || !correct) {\r\n          if (!correct) missing.push(i + 1);\r\n          return;\r\n        }\r\n        if (\r\n          user === correct ||\r\n          isNumericEqual(user, correct) ||\r\n          setsEqual(tokenize(user), tokenize(correct))\r\n        ) {\r\n          score++;\r\n        }\r\n      }\r\n    });\r\n\r\n    if (missing.length) {\r\n      // Non-spammy single warning per submission with question numbers lacking correctAnswer\r\n      console.warn(\r\n        `[grader] ${\r\n          missing.length\r\n        } fill-in question(s) missing correctAnswer: #${missing.join(', ')}`\r\n      );\r\n    }\r\n\r\n    // New 3-segment scoring system\r\n    // 1) helper: normalize text for MC questions\r\n    const normalizeText = (val) => (val ?? '').toString().trim().toLowerCase();\r\n\r\n    // 2) compute earned/possible with weights, all-or-nothing\r\n    let earnedPoints = 0;\r\n    let possiblePoints = 0;\r\n\r\n    quiz.questions.forEach((q, idx) => {\r\n      const pts = typeof q.points === 'number' && q.points > 0 ? q.points : 1;\r\n      possiblePoints += pts;\r\n\r\n      const userAns = finalAnswers[idx];\r\n      let isCorrect = false;\r\n\r\n      const isFillIn =\r\n        !q.answerOptions ||\r\n        q.answerOptions.length === 0 ||\r\n        q.type === 'fill-in-the-blank';\r\n\r\n      if (!isFillIn) {\r\n        // multiple-choice\r\n        const correctOpts = q.answerOptions.filter((o) => o && o.isCorrect);\r\n        if (correctOpts.length === 1) {\r\n          const correctText = normalizeText(correctOpts[0].text);\r\n          const userText = normalizeText(userAns);\r\n          isCorrect = userText === correctText;\r\n        } else if (correctOpts.length > 1) {\r\n          // multi-correct, all-or-nothing\r\n          const correctSet = correctOpts\r\n            .map((o) => normalizeText(o.text))\r\n            .sort();\r\n          const userSet = (Array.isArray(userAns) ? userAns : [userAns])\r\n            .map((v) => normalizeText(v))\r\n            .filter(Boolean)\r\n            .sort();\r\n          if (userSet.length === correctSet.length) {\r\n            isCorrect = userSet.every((val, i) => val === correctSet[i]);\r\n          }\r\n        }\r\n      } else {\r\n        // fill-in: use existing equivalence logic\r\n        const user = normalizeRaw(userAns);\r\n        const correct = normalizeRaw(q.correctAnswer);\r\n        if (user && correct) {\r\n          isCorrect =\r\n            user === correct ||\r\n            isNumericEqual(user, correct) ||\r\n            setsEqual(tokenize(user), tokenize(correct));\r\n        }\r\n      }\r\n\r\n      if (isCorrect) {\r\n        earnedPoints += pts;\r\n      }\r\n    });\r\n\r\n    // 3) percentage from points\r\n    const percentage =\r\n      possiblePoints > 0 ? (earnedPoints / possiblePoints) * 100 : 0;\r\n\r\n    // 4) GED-ish scaling: 3 segments\r\n    let scaledScore;\r\n    if (percentage <= 40) {\r\n      // 0–40% => 100–135\r\n      scaledScore = 100 + (percentage / 40) * 35;\r\n    } else if (percentage <= 65) {\r\n      // 40–65% => 135–145\r\n      scaledScore = 135 + ((percentage - 40) / 25) * 10;\r\n    } else {\r\n      // 65–100% => 145–200\r\n      scaledScore = 145 + ((percentage - 65) / 35) * 55;\r\n    }\r\n    scaledScore = Math.round(scaledScore);\r\n\r\n    // 5) pass is still 145\r\n    const passed = scaledScore >= 145;\r\n\r\n    onComplete({\r\n      score: earnedPoints,\r\n      totalQuestions: possiblePoints,\r\n      percentage,\r\n      scaledScore,\r\n      passed,\r\n      answers: finalAnswers,\r\n      subject: quiz.subject,\r\n      marked: finalMarked,\r\n      confidence: finalConfidence,\r\n      quiz,\r\n    });\r\n  };\r\n\r\n  if (part === 1) {\r\n    return (\r\n      <QuizInterface\r\n        questions={part1Questions}\r\n        answers={part1Answers}\r\n        setAnswers={setPart1Answers}\r\n        onComplete={handlePart1Complete}\r\n        quizTitle=\"Part 1: Non-Calculator Section\"\r\n        buttonText=\"Continue to Part 2\"\r\n        onExit={onExit}\r\n        subject={quiz.subject}\r\n        quizConfig={quiz.config}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (part === 'interstitial') {\r\n    return (\r\n      <div className=\"text-center p-8 fade-in\">\r\n        <h2 className=\"text-2xl font-bold mb-4\">\r\n          You have completed the non-calculator section.\r\n        </h2>\r\n        <p className=\"text-lg mb-6\">\r\n          You may now use a calculator for the remainder of the test.\r\n        </p>\r\n        <button\r\n          onClick={() => setPart(2)}\r\n          className=\"px-8 py-3 bg-sky-600 text-white font-bold rounded-lg\"\r\n        >\r\n          Start Part 2\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (part === 2) {\r\n    return (\r\n      <QuizInterface\r\n        questions={part2Questions}\r\n        answers={part2Answers}\r\n        setAnswers={setPart2Answers}\r\n        onComplete={handlePart2Complete}\r\n        quizTitle=\"Part 2: Calculator-Permitted Section\"\r\n        buttonText=\"Finish Exam\"\r\n        onExit={onExit}\r\n        subject={quiz.subject}\r\n        quizConfig={quiz.config}\r\n      />\r\n    );\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.Components = window.Components || {};\r\n  window.Components.QuizInterface = QuizInterface;\r\n}\r\n"],"file":"assets/QuizInterface-Bed0VNFD.js"}