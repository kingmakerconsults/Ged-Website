const L=(i,t=3)=>{if(i==null||Number.isNaN(i))return null;const e=10**t;return Math.round((i+Number.EPSILON)*e)/e},p=(i,t=3)=>{const e=L(i,t);return e===null?"—":Number.isFinite(e)?Number(e).toFixed(Math.min(t,3)).replace(/\.0+$/,""):e>0?"∞":e<0?"-∞":"∞"},P=(i,t)=>{if(!i||!t)return null;const e=t.x-i.x,s=t.y-i.y;return Math.abs(e)<1e-9?1/0:s/e},q=(i,t)=>{if(!i||!t)return{slope:null,intercept:null};const e=P(i,t);if(!Number.isFinite(e))return{slope:1/0,intercept:null,verticalX:i.x};const s=i.y-e*i.x;return{slope:e,intercept:s,verticalX:null}},X=({slope:i,intercept:t,verticalX:e})=>e??(!Number.isFinite(i)||Math.abs(i)<1e-9?null:-t/i),S=({slope:i,intercept:t,verticalX:e})=>e!=null?null:t,w=(i,t)=>i.verticalX!==null&&i.verticalX!==void 0?null:i.slope*t+i.intercept,I=(i,t)=>{const{a:e=1,b:s=0,c:n=0}=i;return e*t*t+s*t+n},G=(i,t)=>{const{a:e=1,h:s=0,k:n=0}=i;return e*Math.abs(t-s)+n},Y=(i,t)=>{if(!i)return null;switch(i.subtype){case"linear":return w(i.coefficients,t);case"quadratic":return I(i.coefficients,t);case"absolute":return G(i.coefficients,t);default:return null}},O=i=>{if(!i)return"y = ?";switch(i.subtype){case"linear":{const{m:t=1,b:e=0}=i.coefficients,s=t===1?"x":t===-1?"-x":`${p(t)}x`,n=e===0?"":e>0?` + ${p(e)}`:` - ${p(Math.abs(e))}`;return`y = ${s}${n}`}case"quadratic":{const{a:t=1,b:e=0,c:s=0}=i.coefficients,n=[];if(t!==0){const r=t===1?"":t===-1?"-":`${p(t)}`;n.push(`${r}x²`)}if(e!==0){const r=e>0?" + ":" - ",o=Math.abs(e)===1?"":p(Math.abs(e));n.push(`${r}${o}x`)}if(s!==0||n.length===0){const r=s>=0?n.length?" + ":"":" - ";n.push(`${r}${p(Math.abs(s))}`)}return`y = ${n.join("").replace(/^ \+ /,"")}`}case"absolute":{const{a:t=1,h:e=0,k:s=0}=i.coefficients,n=t===1?"":t===-1?"-":`${p(t)}`,r=e===0?"x":e>0?`(x - ${p(e)})`:`(x + ${p(Math.abs(e))})`,o=s===0?"":s>0?` + ${p(s)}`:` - ${p(Math.abs(s))}`;return`y = ${n}|${r}|${o}`}default:return"y = ?"}},R=i=>{const{h:t=0,k:e=0}=i;return{x:t,y:e}},z=i=>{const{a:t=1,b:e=0,c:s=0}=i,n=-e/(2*t),r=I(i,n);return{x:n,y:r}},D=(i,t,e=160)=>{if(!i||!t)return[];const[s,n]=t,r=(n-s)/(e-1),o=[];for(let a=0;a<e;a+=1){const l=s+r*a,d=Y(i,l);Number.isFinite(d)&&o.push({x:l,y:d})}return o},$=i=>{if(!i||!Number.isFinite(i)||i<=0)return 1;const t=i/8,e=Math.pow(10,Math.floor(Math.log10(t))),s=[1,2,5,10];for(const n of s){const r=e*n;if(r>=t)return r}return e*10},T=i=>{if(!i)return null;if(i.form==="two-points"){const[s,n]=i.points||[];return q(s,n)}if(i.form==="standard"){const{a:s=0,b:n=0,c:r=0}=i;if(Math.abs(n)<1e-9)return{slope:1/0,intercept:null,verticalX:-r/s};const o=-s/n,a=-r/n;return{slope:o,intercept:a,verticalX:null}}const{slope:t=0,intercept:e=0}=i;return{slope:t,intercept:e,verticalX:null}},V=i=>i===">"||i===">=",_=i=>({inclusive:i===">="||i==="<=",side:V(i)?"above":"below"}),E=(i,t={})=>{if(!i)return"Line";if(Number.isFinite(i.slope)){const e=p(i.slope),s=p(i.intercept);return`Line with slope ${e} and y-intercept ${s}`}return`Vertical line x = ${p(t.verticalX??i.verticalX)}`},M=i=>{if(!i)return"Line";if(i.verticalX!==null&&i.verticalX!==void 0)return`x = ${p(i.verticalX)}`;if(Math.abs(i.slope)<1e-9)return`y = ${p(i.intercept)}`;const t=p(i.slope),e=i.intercept||0;let s="";return e>0?s=` + ${p(e)}`:e<0&&(s=` - ${p(Math.abs(e))}`),`y = ${t}x${s}`},U=(i={})=>{const t={id:i.id||null,type:i.type,definition:{...i.definition},metadata:{},ariaLabel:""};switch(i.type){case"point":{const{x:e=0,y:s=0,label:n=null}=i.definition||{};t.metadata={x:e,y:s,label:n,formatted:`(${p(e)}, ${p(s)})`},t.ariaLabel=`Point at (${p(e)}, ${p(s)})`;break}case"line":{const e=T(i.definition);t.metadata={...e,form:i.definition.form||"slope-intercept",through:i.definition.points||null,expression:M(e),xIntercept:X(e),yIntercept:S(e)},t.ariaLabel=E(e,{verticalX:e.verticalX});break}case"inequality":{const{comparison:e=">",...s}=i.definition||{},n=T(s),r=_(e);t.metadata={...n,comparison:e,...r,expression:n.verticalX!==null&&n.verticalX!==void 0?`x ${{">":">",">=":"≥","<":"<","<=":"≤"}[e]||e} ${p(n.verticalX)}`:(()=>{const a=M(n),l=a.startsWith("y = ")?a.slice(4):a;return`y ${e} ${l}`})(),xIntercept:X(n),yIntercept:S(n)};const o=r.side==="above"?"above":"below";t.ariaLabel=`Shaded region ${o} the line ${E(n)}`;break}case"function":{const{subtype:e="linear",coefficients:s={}}=i.definition||{};let n=null;e==="quadratic"?n=z(s):e==="absolute"&&(n=R(s)),t.metadata={subtype:e,coefficients:s,expression:O({subtype:e,coefficients:s}),vertex:n,direction:e==="quadratic"||e==="absolute"?s.a>=0?"opens up":"opens down":s.m>=0?"increasing":"decreasing"},t.ariaLabel=`${e.charAt(0).toUpperCase()}${e.slice(1)} function ${t.metadata.expression}`;break}default:t.metadata={},t.ariaLabel="Graph object"}return t},j=(i,t)=>{if(!i||!t)return[];const{minX:e,maxX:s,minY:n,maxY:r}=t,o=[];if(i.verticalX!==null&&i.verticalX!==void 0)return o.push({x:i.verticalX,y:n}),o.push({x:i.verticalX,y:r}),o;const a=[],l=w(i,e),d=w(i,s);if(l!==null&&a.push({x:e,y:l}),d!==null&&a.push({x:s,y:d}),i.slope!==0){const c=X(i);c!==null&&c>=e&&c<=s&&a.push({x:c,y:0})}const h=S(i);if(h!==null&&h>=n&&h<=r&&a.push({x:0,y:h}),a.length<2){const c=(e+s)/2;if(w(i,c)!==null){const x=(s-e)/2,v=w(i,c-x),y=w(i,c+x);v!==null&&a.push({x:c-x,y:v}),y!==null&&a.push({x:c+x,y})}}const g=[],m=new Set;return a.forEach(c=>{const u=`${L(c.x,6)}:${L(c.y,6)}`;m.has(u)||(m.add(u),g.push(c))}),g.length<2?g:(g.sort((c,u)=>c.x-u.x),[g[0],g[g.length-1]])};let H=1;const F=i=>JSON.parse(JSON.stringify(i)),f={theme:"light",mode:"pan",objects:[],selectedId:null,aiHelpEnabled:!1,viewport:{x:-12,y:-10,width:24,height:20}},k=new Set,A=()=>{const i=F(f);k.forEach(t=>{try{t(i)}catch(e){console.error("graphStore listener error",e)}})},W=i=>(k.add(i),()=>k.delete(i)),J=()=>F(f),K=(i={})=>{const t=i.id||`graph-object-${H++}`;if(!i.type)throw new Error('graphStore.addObject requires a "type" property.');const e={id:t,type:i.type,definition:{...i.definition}},s=U(e);return s.id=t,f.objects=[...f.objects,s],f.selectedId=t,A(),t},C=i=>{f.selectedId=i,A()},Q=i=>{f.mode=i,A()},B=i=>{i&&(f.viewport={...f.viewport,...i},A())},b="http://www.w3.org/2000/svg",N={light:{background:"#ffffff",grid:"#e5e5e5",axis:"#111827",axisLabel:"#111827",highlight:"#0ea5e9",objectStroke:"#1f2937",objectFill:"rgba(14, 165, 233, 0.12)",shadeFill:"rgba(14, 165, 233, 0.12)",trace:"#111827"},dark:{background:"#020617",grid:"rgba(14, 165, 233, 0.22)",axis:"#f8fafc",axisLabel:"#f8fafc",highlight:"#38bdf8",objectStroke:"#ffffff",objectFill:"rgba(56, 189, 248, 0.18)",shadeFill:"rgba(56, 189, 248, 0.16)",trace:"#f8fafc"}},Z=()=>{if(document.getElementById("graph-canvas-styles"))return;const i=document.createElement("style");i.id="graph-canvas-styles",i.textContent=`
    .graph-canvas-root {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 28px 60px rgba(15, 23, 42, 0.22);
      background: var(--graph-canvas-background, #ffffff);
      transition: background 180ms ease;
      touch-action: none;
      user-select: none;
    }
    .graph-canvas-svg {
      width: 100%;
      height: 100%;
      display: block;
    }
    .graph-grid-line {
      stroke-width: 0.015;
    }
    .graph-axis-line {
      stroke-width: 0.04;
    }
    .graph-axis-label {
      font-size: 0.35px;
      font-family: 'Inter', 'Segoe UI', sans-serif;
      pointer-events: none;
      paint-order: stroke;
      stroke: rgba(0,0,0,0.08);
      stroke-width: 0.02;
    }
    .graph-object {
      cursor: pointer;
      transition: stroke 150ms ease, fill 150ms ease, opacity 150ms ease;
      opacity: 0;
      animation: graph-object-fade 150ms ease forwards;
    }
    .graph-object.selected {
      stroke-width: 0.08 !important;
      filter: drop-shadow(0 0 12px rgba(56, 189, 248, 0.6));
    }
    .graph-inequality-fill {
      pointer-events: none;
      transition: opacity 160ms ease;
      opacity: 0;
      animation: graph-object-fade 160ms ease forwards;
    }
    .graph-trace-tooltip {
      position: absolute;
      pointer-events: none;
      background: rgba(15, 23, 42, 0.9);
      color: #f8fafc;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.25);
      transform: translate(-50%, -120%);
      white-space: nowrap;
      z-index: 10;
      opacity: 0;
      transition: opacity 100ms ease;
    }
    .graph-trace-tooltip.visible {
      opacity: 1;
    }
    @keyframes graph-object-fade {
      from { opacity: 0; transform: scale(0.98); }
      to { opacity: 1; transform: scale(1); }
    }
  `,document.head.appendChild(i)};class tt{constructor(t,e={}){if(!t)throw new Error("GraphCanvas requires a mount container");Z(),this.container=t,this.options=e,this.state=J(),this.viewBox={...this.state.viewport},this.root=document.createElement("div"),this.root.className="graph-canvas-root",this.container.appendChild(this.root),this.svg=document.createElementNS(b,"svg"),this.svg.setAttribute("class","graph-canvas-svg"),this.svg.setAttribute("role","application"),this.svg.setAttribute("aria-label","Interactive graphing canvas"),this.svg.setAttribute("viewBox",`${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`),this.root.appendChild(this.svg),this.gridLayer=document.createElementNS(b,"g"),this.axesLayer=document.createElementNS(b,"g"),this.objectsLayer=document.createElementNS(b,"g"),this.overlayLayer=document.createElementNS(b,"g"),this.svg.appendChild(this.gridLayer),this.svg.appendChild(this.axesLayer),this.svg.appendChild(this.objectsLayer),this.svg.appendChild(this.overlayLayer),this.traceTooltip=document.createElement("div"),this.traceTooltip.className="graph-trace-tooltip",this.root.appendChild(this.traceTooltip),this.resizeObserver=new ResizeObserver(()=>this.handleResize()),this.resizeObserver.observe(this.root),this.svg.addEventListener("pointerdown",this.handlePointerDown.bind(this)),this.svg.addEventListener("pointermove",this.handlePointerMove.bind(this)),window.addEventListener("pointerup",this.handlePointerUp.bind(this)),this.svg.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1}),this.svg.addEventListener("click",s=>{s.target===this.svg&&C(null)}),this.panContext=null,this.unsubscribe=W(s=>{this.state=s,this.viewBox={...s.viewport},this.updateViewBox(),this.render()}),this.render()}destroy(){var t,e;(t=this.unsubscribe)==null||t.call(this),(e=this.resizeObserver)==null||e.disconnect(),this.root.remove()}handleResize(){const{width:t,height:e}=this.root.getBoundingClientRect();if(e===0||t===0)return;const s=t/e,n=this.viewBox.width/s;if(Number.isFinite(n)){const r=this.viewBox.y+this.viewBox.height/2;this.viewBox.height=n,this.viewBox.y=r-n/2,B(this.viewBox)}}handlePointerDown(t){const e=this.screenToGraph(t),s=this.state.mode;if(s==="add-point"){K({type:"point",definition:{x:e.x,y:e.y}}),Q("pan");return}(s==="pan"||s==="trace")&&(this.panContext={startX:t.clientX,startY:t.clientY,origin:{...this.viewBox}},this.svg.setPointerCapture(t.pointerId))}handlePointerMove(t){if(this.state.mode==="trace"?this.updateTraceTooltip(t):this.hideTraceTooltip(),!this.panContext)return;const{startX:e,startY:s,origin:n}=this.panContext,r=t.clientX-e,o=t.clientY-s,a=this.root.getBoundingClientRect(),l=n.width/a.width,d=n.height/a.height,h={x:n.x-r*l,y:n.y+o*d,width:n.width,height:n.height};this.viewBox=h,B(h)}handlePointerUp(t){this.panContext&&(this.svg.releasePointerCapture(t.pointerId),this.panContext=null),this.hideTraceTooltip()}handleWheel(t){if(!t.ctrlKey)return;t.preventDefault();const e=t.deltaY>0?1.1:.9,s=this.screenToGraph(t),n=this.viewBox.width*e,r=this.viewBox.height*e,o=(s.x-this.viewBox.x)/this.viewBox.width,a=(s.y-this.viewBox.y)/this.viewBox.height;this.viewBox={x:s.x-n*o,y:s.y-r*a,width:n,height:r},B(this.viewBox)}updateViewBox(){this.svg.setAttribute("viewBox",`${this.viewBox.x} ${this.viewBox.y} ${this.viewBox.width} ${this.viewBox.height}`),this.root.style.setProperty("--graph-canvas-background",N[this.state.theme].background)}screenToGraph(t){const e=this.root.getBoundingClientRect(),s=(t.clientX-e.left)/e.width,n=(t.clientY-e.top)/e.height,r=this.viewBox.x+this.viewBox.width*s,o=this.viewBox.y+this.viewBox.height*n;return{x:r,y:this.invertY(o)}}invertY(t){const e=this.viewBox.y;return this.viewBox.y+this.viewBox.height-(t-e)}graphToSvg(t){return{x:t.x,y:this.viewBox.y+this.viewBox.height-(t.y-this.viewBox.y)}}hideTraceTooltip(){this.traceTooltip.classList.remove("visible")}updateTraceTooltip(t){const e=this.state.objects.filter(l=>l.type==="function"||l.type==="line");if(e.length===0){this.hideTraceTooltip();return}const n=this.state.objects.find(l=>l.id===this.state.selectedId&&(l.type==="function"||l.type==="line"))||e[0],r=this.screenToGraph(t);let o=null;if(n.type==="line"){const{metadata:l}=n;l.verticalX!==null&&l.verticalX!==void 0?o=null:o=l.slope*r.x+l.intercept}else o=Y({subtype:n.metadata.subtype,coefficients:n.metadata.coefficients},r.x);if(o===null||!Number.isFinite(o)){this.hideTraceTooltip();return}const a=this.root.getBoundingClientRect();this.traceTooltip.textContent=`(${p(r.x)}, ${p(o)})`,this.traceTooltip.style.left=`${t.clientX-a.left}px`,this.traceTooltip.style.top=`${t.clientY-a.top}px`,this.traceTooltip.classList.add("visible")}render(){const t=N[this.state.theme];this.root.style.setProperty("--graph-canvas-background",t.background),this.traceTooltip.style.background=this.state.theme==="dark"?"rgba(15, 23, 42, 0.92)":"rgba(255, 255, 255, 0.95)",this.traceTooltip.style.color=this.state.theme==="dark"?"#f8fafc":"#0f172a",this.traceTooltip.style.boxShadow=this.state.theme==="dark"?"0 12px 24px rgba(14, 165, 233, 0.25)":"0 12px 24px rgba(15, 23, 42, 0.18)",this.renderGrid(t),this.renderAxes(t),this.renderObjects(t)}getGraphBounds(){const t=this.viewBox.x,e=this.viewBox.x+this.viewBox.width,s=this.invertY(this.viewBox.y),n=this.invertY(this.viewBox.y+this.viewBox.height);return{minX:t,maxX:e,minY:n,maxY:s}}renderGrid(t){const e=$(this.viewBox.width);this.gridLayer.replaceChildren();const s=this.viewBox.x,n=this.viewBox.x+this.viewBox.width,r=this.viewBox.y,o=this.viewBox.y+this.viewBox.height,a=Math.floor(s/e)*e,l=Math.floor(r/e)*e;for(let d=a;d<=n;d+=e){const h=document.createElementNS(b,"line");h.setAttribute("x1",`${d}`),h.setAttribute("x2",`${d}`),h.setAttribute("y1",`${r}`),h.setAttribute("y2",`${o}`),h.setAttribute("stroke",t.grid),h.setAttribute("class","graph-grid-line"),this.gridLayer.appendChild(h)}for(let d=l;d<=o;d+=e){const h=document.createElementNS(b,"line");h.setAttribute("x1",`${s}`),h.setAttribute("x2",`${n}`),h.setAttribute("y1",`${d}`),h.setAttribute("y2",`${d}`),h.setAttribute("stroke",t.grid),h.setAttribute("class","graph-grid-line"),this.gridLayer.appendChild(h)}}renderAxes(t){this.axesLayer.replaceChildren();const e=document.createElementNS(b,"line");e.setAttribute("x1",`${this.viewBox.x}`),e.setAttribute("x2",`${this.viewBox.x+this.viewBox.width}`);const s=this.graphToSvg({x:0,y:0}).y;e.setAttribute("y1",`${s}`),e.setAttribute("y2",`${s}`),e.setAttribute("stroke",t.axis),e.setAttribute("class","graph-axis-line"),this.axesLayer.appendChild(e);const n=document.createElementNS(b,"line");n.setAttribute("y1",`${this.viewBox.y}`),n.setAttribute("y2",`${this.viewBox.y+this.viewBox.height}`);const r=this.graphToSvg({x:0,y:0}).x;n.setAttribute("x1",`${r}`),n.setAttribute("x2",`${r}`),n.setAttribute("stroke",t.axis),n.setAttribute("class","graph-axis-line"),this.axesLayer.appendChild(n);const o=this.getGraphBounds(),{minX:a,maxX:l,minY:d,maxY:h}=o,g=$(l-a),m=$(h-d),c=document.createElementNS(b,"g");for(let u=Math.floor(a/g)*g;u<=l;u+=g){const x=this.graphToSvg({x:u,y:0}),v=document.createElementNS(b,"text");v.textContent=p(u,2),v.setAttribute("x",`${x.x+.1}`),v.setAttribute("y",`${x.y-.35}`),v.setAttribute("fill",t.axisLabel),v.setAttribute("class","graph-axis-label"),c.appendChild(v);const y=document.createElementNS(b,"line");y.setAttribute("x1",`${x.x}`),y.setAttribute("x2",`${x.x}`),y.setAttribute("y1",`${x.y-.25}`),y.setAttribute("y2",`${x.y+.25}`),y.setAttribute("stroke",t.axis),y.setAttribute("stroke-width","0.04"),this.axesLayer.appendChild(y)}for(let u=Math.floor(d/m)*m;u<=h;u+=m){if(Math.abs(u)<1e-9)continue;const x=this.graphToSvg({x:0,y:u}),v=document.createElementNS(b,"text");v.textContent=p(u,2),v.setAttribute("x",`${x.x+.3}`),v.setAttribute("y",`${x.y+.4}`),v.setAttribute("fill",t.axisLabel),v.setAttribute("class","graph-axis-label"),c.appendChild(v);const y=document.createElementNS(b,"line");y.setAttribute("x1",`${x.x-.25}`),y.setAttribute("x2",`${x.x+.25}`),y.setAttribute("y1",`${x.y}`),y.setAttribute("y2",`${x.y}`),y.setAttribute("stroke",t.axis),y.setAttribute("stroke-width","0.04"),this.axesLayer.appendChild(y)}this.axesLayer.appendChild(c)}renderObjects(t){this.objectsLayer.replaceChildren(),this.state.objects.forEach(e=>{const s=this.renderObject(e,t);s&&(s.dataset.id=e.id,s.addEventListener("click",n=>{n.stopPropagation(),C(e.id)}),this.objectsLayer.appendChild(s))})}renderObject(t,e){switch(t.type){case"point":return this.renderPoint(t,e);case"line":return this.renderLine(t,e);case"inequality":return this.renderInequality(t,e);case"function":return this.renderFunction(t,e);default:return null}}renderPoint(t,e){const s=document.createElementNS(b,"g");s.setAttribute("class",`graph-object ${t.id===this.state.selectedId?"selected":""}`.trim()),s.setAttribute("role","img"),s.setAttribute("aria-label",t.ariaLabel);const n=this.graphToSvg({x:t.metadata.x,y:t.metadata.y}),r=document.createElementNS(b,"circle");return r.setAttribute("cx",`${n.x}`),r.setAttribute("cy",`${n.y}`),r.setAttribute("r",`${this.viewBox.width*.01}`),r.setAttribute("fill",e.objectFill),r.setAttribute("stroke",e.objectStroke),r.setAttribute("stroke-width","0.05"),r.setAttribute("aria-label",t.ariaLabel),s.appendChild(r),s}renderLine(t,e){const s=t.metadata,n=j(s,this.getGraphBounds());if(n.length<2)return null;const r=this.graphToSvg(n[0]),o=this.graphToSvg(n[1]),a=document.createElementNS(b,"line");return a.setAttribute("x1",`${r.x}`),a.setAttribute("x2",`${o.x}`),a.setAttribute("y1",`${r.y}`),a.setAttribute("y2",`${o.y}`),a.setAttribute("stroke",e.objectStroke),a.setAttribute("stroke-width","0.06"),a.setAttribute("class",`graph-object ${t.id===this.state.selectedId?"selected":""}`.trim()),a.setAttribute("role","img"),a.setAttribute("aria-label",t.ariaLabel),a}renderFunction(t,e){const s=[this.viewBox.x,this.viewBox.x+this.viewBox.width],n=D({subtype:t.metadata.subtype,coefficients:t.metadata.coefficients},s,260);if(n.length<2)return null;const r=document.createElementNS(b,"polyline"),o=n.filter(a=>Number.isFinite(a.y)).map(a=>{const l=this.graphToSvg(a);return`${l.x},${l.y}`}).join(" ");return r.setAttribute("points",o),r.setAttribute("fill","none"),r.setAttribute("stroke",e.objectStroke),r.setAttribute("stroke-width","0.06"),r.setAttribute("class",`graph-object ${t.id===this.state.selectedId?"selected":""}`.trim()),r.setAttribute("role","img"),r.setAttribute("aria-label",t.ariaLabel),r}renderInequality(t,e){const s=t.metadata,n=this.renderLine({...t,type:"line"},e);if(!n)return null;s.inclusive||n.setAttribute("stroke-dasharray","0.4,0.2");const r=this.buildInequalityPolygon(s),o=document.createElementNS(b,"g");if(o.setAttribute("class",`graph-object ${t.id===this.state.selectedId?"selected":""}`.trim()),o.setAttribute("role","img"),o.setAttribute("aria-label",t.ariaLabel),n.setAttribute("aria-label",t.ariaLabel),r.length>=3){const a=document.createElementNS(b,"polygon");a.setAttribute("points",r.map(l=>{const d=this.graphToSvg(l);return`${d.x},${d.y}`}).join(" ")),a.setAttribute("fill",e.shadeFill),a.setAttribute("class","graph-inequality-fill"),o.appendChild(a)}return o.appendChild(n),o}buildInequalityPolygon(t){const{side:e}=t,s=this.getGraphBounds(),{minX:n,maxX:r,minY:o,maxY:a}=s,l=[{x:n,y:o},{x:r,y:o},{x:r,y:a},{x:n,y:a}],d=(c,u)=>{if(t.verticalX!==null&&t.verticalX!==void 0)return e==="above"?c>=t.verticalX:c<=t.verticalX;const x=t.slope*c+t.intercept;return e==="above"?u>=x:u<=x},h=[];if(l.forEach(c=>{const u={x:c.x,y:c.y};d(u.x,u.y)&&h.push(u)}),this.computeBoundaryIntersections(t,s).forEach(c=>{h.some(u=>Math.abs(u.x-c.x)<1e-6&&Math.abs(u.y-c.y)<1e-6)||h.push(c)}),h.length<3)return[];const m=h.reduce((c,u)=>({x:c.x+u.x/h.length,y:c.y+u.y/h.length}),{x:0,y:0});return h.sort((c,u)=>Math.atan2(c.y-m.y,c.x-m.x)-Math.atan2(u.y-m.y,u.x-m.x)),h}computeBoundaryIntersections(t,e){const{minX:s,maxX:n,minY:r,maxY:o}=e,a=[];if(t.verticalX!==null&&t.verticalX!==void 0)return t.verticalX>=s&&t.verticalX<=n&&(a.push({x:t.verticalX,y:r}),a.push({x:t.verticalX,y:o})),a;const l=t.slope,d=t.intercept,h=l*s+d,g=l*n+d;if(h>=r&&h<=o&&a.push({x:s,y:h}),g>=r&&g<=o&&a.push({x:n,y:g}),Math.abs(l)>1e-9){const m=(r-d)/l,c=(o-d)/l;m>=s&&m<=n&&a.push({x:m,y:r}),c>=s&&c<=n&&a.push({x:c,y:o})}return a}}export{tt as default};
